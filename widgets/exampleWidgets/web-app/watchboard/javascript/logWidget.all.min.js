var util={namespace:function(l){l=l.split(".");var g=window,w;for(w=0;w<l.length;w++)void 0===g[l[w]]&&(g[l[w]]={}),g=g[l[w]]}};(function(l){for(var g,w={},v=function(){},T=["memory"],U="assert count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profileEnd time timeEnd trace warn".split(" ");g=T.pop();)l[g]=l[g]||w;for(;g=U.pop();)l[g]=l[g]||v})(window.console=window.console||{});util.namespace("jc2cui");
jc2cui.logWidget=function(){function l(a,b,c,e,h,t,s){if(!h||!O[h]){O[h]=!0;c=c||160;e=e||250;var x=$("<div>"+a+"</div>"),ca;s||(ca={Ok:function(){x.dialog("close")}});x.dialog({preferredHeight:c,preferredWidth:e,height:Math.min(c,m.height-20),width:Math.min(e,m.width-20),modal:!s&&!t,title:b,buttons:ca,close:function(a,c){delete O[h];clearTimeout(x.timeout);x.remove()}});s&&(x.click(function(){delete O[h];l(a,b,c,e,h,!0);x.dialog("option","hide",null).dialog("close")}),x.timeout=setTimeout(function(){x.dialog("option",
"hide",{effect:"fadeOut",duration:3E3}).dialog("close")},2E3))}}function g(a){l(a,"Error")}function w(a){46===a.keyCode||(8===a.keyCode||37<=a.keyCode&&40>=a.keyCode)||(48>a.keyCode||57<a.keyCode)&&(96>a.keyCode||105<a.keyCode)&&a.preventDefault()}function v(){var d=a.rowsToShow;a.copWidgetSyncState&&(a.rowsToShow={});Ozone.pref.PrefServer.setUserPreference({namespace:V,name:"options",value:JSON.stringify(a),onFailure:function(a,c){g("Error updating preferences. Status Code: "+c+" . Error message: "+
a)}});a.rowsToShow=d}function T(){if(!G){var d=$('<form class="config"><fieldset><label for="gcssSuite">GCSS Suite:</label><input type="text" name="gcssSuite" id="gcssSuite" class="text ui-widget-content ui-corner-all" /></fieldset></form>').appendTo($("body")),b=$("#gcssSuite",d),c=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/;b.val(a.gcssSuiteUrl||"");G=d;G.dialog({preferredHeight:225,preferredWidth:350,height:Math.min(225,m.height-20),width:Math.min(350,m.width-
20),modal:!0,title:"Set URL to GCSS Suite",buttons:{Set:function(){var d=$.trim(b.val());!c.test(d)||0<=d.indexOf('"')?g("Please enter a valid URL."):(a.gcssSuiteUrl!==d&&(a.gcssSuiteUrl=d,v()),G.dialog("close"))},Cancel:function(){G.dialog("close")}},close:function(a,c){G.remove();G=null}})}}function U(d){if(a.gcssSuiteUrl){var b=(new Date).getTime(),c;W&&b-da<6E4*a.watchboardsTimeout?d(W):(da=b,c=a.gcssSuiteUrl+"supply-rest/watchboard",c=y.proxy+encodeURIComponent(c),$.ajax({url:c,dataType:"xml",
success:function(a){W=a;d(a)},error:function(a,b,t){a="Error getting watchboard data from "+c;b&&"error"!==b&&(a+=" "+b);g(a);d()}}))}else g("No GCSS Suite URL set. Unable to fetch watchboard data. Use configure toolbar button to set URL.")}function ea(){var d,b,c=100,e;"none"===a.lowestThreshold?d=n:(d=[],b={location:!0},"amber"===a.lowestThreshold?c=a.thresholds.green-1:"red"===a.lowestThreshold?c=a.thresholds.amber-1:"black"===a.lowestThreshold&&(c=a.thresholds.red-1),k&&$.each(k,function(a,d){if(X(d))for(e=
1;e<n.length;e++)d[n[e].field].statusPercentage<=c&&(b[n[e].field]=!0)}),n&&$.each(n,function(a,c){b[c.field]&&d.push(c)}));return d}function fa(){var d,b=r.getColumns();a.userModifiedColumnData={order:[],widths:{}};for(d=0;d<b.length;d++)a.userModifiedColumnData.order.push(b[d].id),a.userModifiedColumnData.widths[b[d].id]=b[d].width;v()}function la(){r&&(r.destroy(),r=null);$("#grid").empty();var d,b,c,e,h={};a.columnsToShow?(d=[],$.each(n,function(c,b){a.columnsToShow[b.field]&&d.push(b)})):d=ea();
if(a.userModifiedColumnData){b=[];for(c=0;c<a.userModifiedColumnData.order.length;c++)for(e=0;e<d.length;e++)if(d[e].id===a.userModifiedColumnData.order[c]){h[d[e].id]=!0;b.push(d[e]);break}for(c=0;c<d.length;c++)h[d[c].id]||b.push(d[c])}else b=d;r=new Slick.Grid("#grid",p,b,{frozenColumn:0});r.onClick.subscribe(function(a,c){var b;if($(a.target).hasClass("toggle")){if(b=p.getItem(c.row))b.collapsed=b.collapsed?!1:!0,p.updateItem(b.id,b);a.stopImmediatePropagation()}});r.onColumnsResized.subscribe(function(a,
c){fa()});r.onColumnsReordered.subscribe(function(a,c){fa()});P=new Slick.Controls.ColumnPicker(n,r);P.onColumnChanged.subscribe(function(c,b){a.lowestThreshold="none";a.columnsToShow={};$.each(r.getColumns(),function(c,b){a.columnsToShow[b.field]=!0});clearTimeout(ga);ga=setTimeout(function(){v()},1E3)})}function Y(d){var b=$("#title"),c;a.selectedWatchboard?(r&&(r.destroy(),r=null),$("#grid").empty(),k=[],b.empty(),b.append('<div><span></span><img src="../common/images/activity.gif" alt="..." /></div>'),
$("span",b).text("Loading "+a.selectedWatchboard.name),c=a.gcssSuiteUrl+"supply-rest/watchboard/"+a.selectedWatchboard.id,c=y.proxy+encodeURIComponent(c),$.ajax({url:c,dataType:"xml",success:function(c){Z=(new Date).getTime();clearTimeout(Q);Q=setTimeout(function(){R()},6E4*a.watchboardRefreshTime);d&&$("#loaded").text(a.selectedWatchboard.name+" Loaded").show().fadeOut(2E3);b.text(a.selectedWatchboard.name);var h=[],t=[],s=function(c,b,d,e,s){c=['<span title="',!d||isNaN(d.objective)&&isNaN(d.quantity)&&
isNaN(d.statusPercentage)?"no data":["objective: ",isNaN(d.objective)?"unknown":d.objective,", quantity: ",isNaN(d.quantity)?"unknown":d.quantity,", status: ",isNaN(d.statusPercentage)?"unknown":isFinite(d.statusPercentage)?d.statusPercentage+"%":"NA"].join(""),'"'];b="";d?(isNaN(d.statusPercentage)||(b=d.statusPercentage>=a.thresholds.green?"green":d.statusPercentage>=a.thresholds.amber?"amber":d.statusPercentage>=a.thresholds.red?"red":"black"),c.push(" class='colorCell ui-corner-all "),c.push(b),
c.push("'>"),isNaN(d.quantity)||c.push(d.quantity)):c.push(" class='emptyCell'>");c.push("</span>");return c.join("")};X=function(a){if(!a.included)return!1;if(null!==a.parent)for(a=k[a.parent];a;){if(a.collapsed)return!1;a=k[a.parent]}return!0};n=[{id:"location",name:"Location",field:"location",cssClass:"cell-title",width:160,formatter:function(a,c,b,d,e){a=["<span class='spacer' style='width:",15*e.indent,"px;'></span><span class='toggle"];c=p.getIdxById(e.id);k[c+1]&&k[c+1].indent>k[c].indent&&
(e.collapsed?a.push(" expand"):a.push(" collapse"));a.push("'></span>&nbsp;");a.push(b);return a.join("")}}];$(c).find("locations").each(function(a){a={name:$(this).children("displayName").text(),depth:parseInt($(this).children("levelDepth").text(),10)};h.push(a)});$(c).find("items").each(function(c){c=$(this).children("displayName").text();var b=y.columnWidth;a.userModifiedColumnData&&a.userModifiedColumnData.widths[c]&&(b=a.userModifiedColumnData.widths[c]);n.push({id:c,name:c,field:c,width:b,formatter:s})});
$.each(h,function(c,b){for(;t.length&&t[t.length-1].indent+1>=b.depth;)t.pop();k[c]={location:b.name,indent:b.depth-1,id:c,included:!a.rowsToShow||a.rowsToShow[c]};b.depth>=a.defaultExpansion&&(k[c].collapsed=!0);t.length&&(k[c].parent=t[t.length-1].id,t[t.length-1].hasChildren=!0);t.push(k[c])});$(c).find("measures").each(function(c){if(k[c].hasChildren){var b;for(b=1;b<n.length;b++)k[c][n[b].field]={objective:NaN,quantity:NaN,statusPercentage:NaN};return!0}$(this).find("item").each(function(b){var d=
parseInt($(this).children("objective").text(),10),e=parseInt($(this).children("quantity").text(),10),f=Math.round(100*(e/d));k[c][n[b+1].field]={objective:d,quantity:e,statusPercentage:f};if(!(a.rowsToShow&&!a.rowsToShow[c]||isNaN(d)&&isNaN(e)))for(f=k[c];void 0!==f.parent;)f=k[f.parent],isNaN(d)||(f[n[b+1].field].objective=isNaN(f[n[b+1].field].objective)?d:f[n[b+1].field].objective+d),isNaN(e)||(f[n[b+1].field].quantity=isNaN(f[n[b+1].field].quantity)?e:f[n[b+1].field].quantity+e),f[n[b+1].field].statusPercentage=
Math.round(100*(f[n[b+1].field].quantity/f[n[b+1].field].objective))})});p=new Slick.Data.DataView;p.beginUpdate();p.setItems(k);p.setFilter(X);p.endUpdate();p.onRowCountChanged.subscribe(function(a,c){r.updateRowCount();r.render()});p.onRowsChanged.subscribe(function(a,c){r.invalidateRows(c.rows);r.render()});la()},error:function(d,h,t){d="Error getting watchboard data from "+c;h&&"error"!==h&&(d+=" "+h);g(d);b.empty();b.text("Unable to load "+a.selectedWatchboard.name)}})):g("No watchboard selected. Please configure watchboard using configure toolbar button")}
function ma(){z||(z=$('<div id="watchboards"><div>Loading... <img src="../common/images/activity.gif" alt="..." /></div></div>').appendTo($("body")),z.dialog({preferredHeight:300,preferredWidth:400,height:Math.min(300,m.height-20),width:Math.min(400,m.width-20),modal:!0,title:"Select Watchboard",buttons:{Ok:function(){z.dialog("close")},Cancel:function(){z.dialog("close")}},close:function(a,b){z.remove();z=null}}),U(function(d){if(z)if(d){z.empty();var b=z.dynatree({onActivate:function(c){c.data.id&&
(a.selectedWatchboard&&a.selectedWatchboard.id===c.data.id||(a=$.extend(!0,{},L),a.selectedWatchboard={id:c.data.id,name:c.data.title},v()),z.dialog("close"),Y(!0))},persist:!1,idPrefix:"watchboard_",debugLevel:0}).dynatree("getTree"),c;$(d).find("Owner").each(function(a){c=b.getRoot().addChild({title:$(this).children("name").text(),isFolder:!0});$(this).find("CommodityType").each(function(a){var b=c.addChild({title:$(this).children("name").text(),isFolder:!0});$(this).find("Watchboard").each(function(a){a=
{title:$(this).children("name").text(),id:$(this).children("id").text()};b.addChild(a)})})})}else g("No watchboard data found."),z.dialog("close")}))}function na(){if(!B){var d=['<form class="movingAverage"><fieldset><label for="expireTime">Time until watchboard list expires (minutes): </label> <input type="text" name="expireTime" id="expireTime" value="',a.watchboardsTimeout||"",'" class="text ui-widget-content ui-corner-all" /></fieldset></form>'].join(""),b;B=$(d).appendTo($("body"));b=$("#expireTime",
B);b.keydown(w);B.dialog({preferredHeight:225,preferredWidth:350,height:Math.min(225,m.height-20),width:Math.min(350,m.width-20),modal:!0,title:"Set Watchboard List Expiration Time",buttons:{Set:function(){var c=parseInt(b.val(),10);a.watchboardsTimeout!==c&&(a.watchboardsTimeout=c,v());B.dialog("close")},Cancel:function(){B.dialog("close")}},close:function(a,b){B.remove();B=null}})}}function oa(){if(!C){var d=['<form class="movingAverage"><fieldset><label for="refreshTime">Time until loaded watchboard refreshes (minutes): </label> <input type="text" name="refreshTime" id="refreshTime" value="',
a.watchboardRefreshTime||"",'" class="text ui-widget-content ui-corner-all" /></fieldset></form>'].join(""),b;C=$(d).appendTo($("body"));b=$("#refreshTime",C);b.keydown(w);C.dialog({preferredHeight:225,preferredWidth:350,height:Math.min(225,m.height-20),width:Math.min(350,m.width-20),modal:!0,title:"Set Watchboard Refresh Time",buttons:{Set:function(){var c=parseInt(b.val(),10);a.watchboardRefreshTime!==c&&(a.watchboardRefreshTime=c,v(),c=6E4*a.watchboardRefreshTime-((new Date).getTime()-Z),0<c?(clearTimeout(Q),
Q=setTimeout(function(){R()},c)):R());C.dialog("close")},Cancel:function(){C.dialog("close")}},close:function(a,b){C.remove();C=null}})}}function I(){var d;a.columnsToShow?(d=[],$.each(n,function(b,c){a.columnsToShow[c.field]&&d.push(c)})):d=ea();r&&r.setColumns(d)}function pa(){if(!u){var d=$.browser.msie&&7===parseInt($.browser.version,10)?330:280,b=['<form class="threshold"><fieldset><div id="slider"></div><div><label for="green" class="bigLabel">Green: </label><input type="text" name="green" id="green" value="',
a.thresholds.green,'" class="text ui-widget-content ui-corner-all" /> <label class="smallLabel">&nbsp;-&nbsp;</label> <input type="text" readonly="true" name="green2" id="green2" value="100" class="text ui-widget-content ui-corner-all" /></div><div><label for="amber" class="bigLabel">Amber: </label><input type="text" name="amber" id="amber" value="',a.thresholds.amber,'" class="text ui-widget-content ui-corner-all" /> <label class="smallLabel">&nbsp;-&nbsp;</label> <input type="text" name="amber2" id="amber2" value="',
a.thresholds.green-1,'" class="text ui-widget-content ui-corner-all" /></div><div><label for="red" class="bigLabel">Red: </label><input type="text" name="red" id="red" value="',a.thresholds.red,'" class="text ui-widget-content ui-corner-all" /> <label class="smallLabel">&nbsp;-&nbsp;</label> <input type="text" name="red2" id="red2" value="',a.thresholds.amber-1,'" class="text ui-widget-content ui-corner-all" /></div><div><label for="black" class="bigLabel">Black: </label><input type="text" readonly="true" name="black" id="black" value="0" class="text ui-widget-content ui-corner-all" /> <label class="smallLabel">&nbsp;-&nbsp;</label> <input type="text" name="black2" id="black2" value="',
a.thresholds.red-1,'" class="text ui-widget-content ui-corner-all" /></div></fieldset></form>'].join(""),c,e=0,h,t=function(){h=h.sort(function(a,c){return $(c).position().left-$(a).position().left});h.removeClass("green amber red");$(h[0]).addClass("green");$(h[1]).addClass("amber");$(h[2]).addClass("red");$("#blackSlider",c).css("width",100*($(h[2]).position().left/c.width())+"%");$("#redSlider",c).css("width",100*($(h[1]).position().left/c.width())+"%");$("#amberSlider",c).css("width",100*($(h[0]).position().left/
c.width())+"%")},s,x,g,k,l,n,f=[0,a.thresholds.red-1,a.thresholds.red,a.thresholds.amber-1,a.thresholds.amber,a.thresholds.green-1,a.thresholds.green,100],q=function(){s.val(f[1]);x.val(f[2]);g.val(f[3]);k.val(f[4]);l.val(f[5]);n.val(f[6])},p=function(a){var b,d=0,e=100;for(b=a-1;0<b;b--)0!==b%2&&f[b]>=f[b+1]?f[b]=f[b+1]-1:f[b]>f[b+1]&&(f[b]=f[b+1]);for(b=a+1;b<f.length-1;b++)0===b%2&&f[b]<=f[b-1]?f[b]=f[b-1]+1:f[b]<f[b-1]&&(f[b]=f[b-1]);for(b=0;b<f.length;b++)f[b]<d&&(f[b]=d),0!==b%2&&d++;for(b=
f.length-1;0<b;b--)f[b]>e&&(f[b]=e),0===b%2&&e--;q();c.slider("values",[f[2],f[4],f[6]]);t()};u=$(b).appendTo($("body"));c=$("#slider",u).slider({values:[a.thresholds.red,a.thresholds.amber,a.thresholds.green],slide:function(a,b){t();return!0},stop:function(a,b){t();var d=c.slider("values").sort(function(a,b){return a-b});f=[0,d[0]-1,d[0],d[1]-1,d[1],d[2]-1,d[2],100];q();p(0)}}).append('<div id="blackSlider" class="black dummySlider ui-slider-horizontal ui-corner-left"></div><div id="redSlider" class="red dummySlider ui-slider-horizontal ui-corner-left"></div><div id="amberSlider" class="amber dummySlider ui-slider-horizontal ui-widget-content ui-corner-left"></div><div id="greenSlider" class="green dummySlider ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all"></div>');
for(e=0;110>e;e+=10)b=$('<span class="tick">'+e+"</span>").appendTo(c),b.css({left:e+"%",width:"10%"});h=$(".ui-slider-handle",c);t();e=$("input:text",u);s=$("#black2",u);x=$("#red",u);g=$("#red2",u);k=$("#amber",u);l=$("#amber2",u);n=$("#green",u);e.keydown(w);s.change(function(){var a=parseInt(s.val(),10);f[1]=a;f[2]=a+1;p(1)});x.change(function(){var a=parseInt(x.val(),10);f[2]=a;f[1]=a-1;p(2)});g.change(function(){var a=parseInt(g.val(),10);f[3]=a;f[4]=a+1;p(3)});k.change(function(){var a=parseInt(k.val(),
10);f[4]=a;f[3]=a-1;p(4)});l.change(function(){var a=parseInt(l.val(),10);f[5]=a;f[6]=a+1;p(5)});n.change(function(){var a=parseInt(n.val(),10);f[6]=a;f[5]=a-1;p(6)});u.dialog({preferredHeight:d,preferredWidth:350,height:Math.min(d,m.height-20),width:Math.min(350,m.width-20),modal:!0,title:"Set Thresholds",buttons:{Set:function(){var b=parseInt($("#green",u).val(),10),c=parseInt($("#amber",u).val(),10),d=parseInt($("#red",u).val(),10);if(a.thresholds.green!==b||a.thresholds.amber!==c||a.thresholds.red!==
d)a.thresholds.green=b,a.thresholds.amber=c,a.thresholds.red=d,v(),I(),r&&r.invalidate();u.dialog("close")},Cancel:function(){u.dialog("close")}},close:function(a,b){u.remove();u=null}});$.ui.dialog.overlay.resize()}}function qa(){if(!D){var d=['<form class="movingAverage"><fieldset><label for="movingAverage">Number of days: </label> <input type="text" name="movingAverage" id="movingAverage" value="',a.movingAverage||"",'" class="text ui-widget-content ui-corner-all" readonly/></fieldset><h4>NOTE: This value not yet supported by GCSS-J. Actual current values are provided.</h4></form>'].join(""),
b;D=$(d).appendTo($("body"));b=$("#movingAverage",D);b.keydown(w);D.dialog({preferredHeight:225,preferredWidth:350,height:Math.min(225,m.height-20),width:Math.min(350,m.width-20),modal:!0,title:"Set Number Of Days In Moving Average",buttons:[{id:"setButton",text:"Set",click:function(){var c=parseInt(b.val(),10);a.movingAverage!==c&&(a.movingAverage=c,v());D.dialog("close")}},{text:"Cancel",click:function(){D.dialog("close")}}],close:function(a,b){D.remove();D=null}});$("#setButton").button("disable")}}
function ra(d){if(!A){var b,c={},e=[],h=function(){var c={},d=!1;b.visit(function(a){var b=k[a.data.key],e,h=a.isSelected()||a.hasSubSel;h&&(c[a.data.key]=!0);if(b.included!==h){d=!0;b.included=h;if(b.hasChildren)return!0;$.each(n,function(a,c){if("Location"===c.name)return!0;var d=b[c.field],s,g;if(d&&(!isNaN(d.objective)||!isNaN(d.quantity)))for(isNaN(d.objective)||(s=h?d.objective:-d.objective),isNaN(d.quantity)||(g=h?d.quantity:-d.quantity),e=k[b.parent];e;)isNaN(s)||(e[c.field].objective=isNaN(e[c.field].objective)?
s:e[c.field].objective+s),isNaN(g)||(e[c.field].quantity=isNaN(e[c.field].quantity)?g:e[c.field].quantity+g),e[c.field].statusPercentage=Math.round(100*(e[c.field].quantity/e[c.field].objective)),e=k[e.parent]})}});d&&(a.rowsToShow=c,v(),p&&p.refresh(),I())};A=$('<div id="watchboards"></div>').appendTo($("body"));A.dialog({preferredHeight:300,preferredWidth:400,height:Math.min(300,m.height-20),width:Math.min(400,m.width-20),modal:!0,title:"Select Sites",buttons:{Ok:function(){h();A.dialog("close")},
Cancel:function(){A.dialog("close")}},close:function(a,b){A.remove();A=null}});k&&0!==k.length?(A.empty(),$.each(k,function(b,d){var h={title:d.location,isFolder:d.hasChildren,expand:!0,select:!a.rowsToShow||a.rowsToShow[d.id],key:d.id};h.isFolder&&(c[h.key]=h);void 0!==d.parent?(c[d.parent].children=c[d.parent].children||[],c[d.parent].children.push(h)):e.push(h)}),b=A.dynatree({checkbox:!0,selectMode:2,children:e,onDblClick:function(a,b){a.toggleSelect()},onKeydown:function(a,b){if(32===b.which)return a.toggleSelect(),
!1},persist:!1,idPrefix:"location_",debugLevel:0}).dynatree("getTree")):(g("No watchboard loaded. Unable to choose sites"),A.dialog("close"))}}function sa(d){if(!E){var b;E=$('<form class="defaultExpansion"><fieldset><label for="defaultExpansion">Default Rollup Level: </label> <select id="defaultExpansion" class="text ui-widget-content ui-corner-left"><option value="1">COCOM</option><option value="2">JOA/Region/Operation</option><option value="3">Service</option><option value="4">Supply Point</option></select></fieldset></form>').appendTo($("body"));
b=$("#defaultExpansion",E);b.val(a.defaultExpansion).attr("selected","selected");E.dialog({preferredHeight:200,preferredWidth:300,height:Math.min(200,m.height-20),width:Math.min(300,m.width-20),modal:!0,title:"Set Default Rollup Level",buttons:{Set:function(){var c=b.find("option:selected").val();a.defaultExpansion!==c&&(a.defaultExpansion=c,v(),E.dialog("close"),$.each(k,function(b,c){c.collapsed=c.hasChildren&&c.indent+1>=a.defaultExpansion?!0:!1}),p&&p.refresh(),I())},Cancel:function(){E.dialog("close")}},
close:function(a,b){E.remove();E=null}})}}function ta(d){if(!F){d=['<form class="defaultExpansion"><fieldset><label for="thresholdCutoff">Default Minimum Displayed Threshold: </label> <select id="thresholdCutoff" class="',a.lowestThreshold,' text ui-widget-content ui-corner-left"><option value="none">None</option><option class="green" value="green">Green</option><option class="amber" value="amber">Amber</option><option class="red" value="red">Red</option><option class="black" value="black">Black</option></select></fieldset></form>'].join("");
var b;F=$(d).appendTo($("body"));b=$("#thresholdCutoff",F);b.val(a.lowestThreshold).attr("selected","selected");b.change(function(){var a=b.find("option:selected").val();b.removeClass("none green amber red black");b.addClass(a)});F.dialog({preferredHeight:200,preferredWidth:300,height:Math.min(200,m.height-20),width:Math.min(300,m.width-20),modal:!0,title:"Set Default Minimum Displayed Threshold",buttons:{Set:function(){var c=b.find("option:selected").val();a.lowestThreshold!==c&&(a.lowestThreshold=
c,a.columnsToShow=null,v(),I());F.dialog("close")},Cancel:function(){F.dialog("close")}},close:function(a,b){F.remove();F=null}})}}function aa(d){var b,c;if(d.shipNames&&$.isArray(d.shipNames))if(k&&0!==k.length){if(b=d.shipNames.slice(),a.rowsToShow={},$.each(k,function(d,h){h.hasChildren&&(h.collapsed=!1);var g=-1,s=h.location.toLowerCase(),k;for(c=0;c<b.length;c++)if(k=b[c].toLowerCase(),J){if(J[k]===s){g=c;break}if(k===s){g=c;break}}else if(-1<s.indexOf(k)||-1<k.indexOf(s)){g=c;break}-1<g&&b.splice(g,
1);h.included=-1<g;a.rowsToShow[h.id]=h.included}),p&&p.refresh(),I(),a.showNonMatchedPopup&&b.length){d=["<div>No data found for the following vessels:<ul>"];for(c=0;c<b.length;c++)d.push("<li>"),d.push(b[c]),d.push("</li>");l(d.join(""),"Missing Vessels",null,null,null,!0,!0)}}else console.log("All ships watchboard either not loaded or has no data!");else console.log("copwid.maritime.shipNames message with no ship names array received!")}function ua(){S.subscribe("copwid.maritime.shipNames",function(d,
b){try{b="string"===typeof b?JSON.parse(b):b}catch(c){console.log("invalid JSON in copwid.maritime.shipNames message!")}K=b;a.copWidgetSyncState&&aa(K)})}function va(){var d=a.gcssSuiteUrl+"supply-rest/supplypoint/afloat",d=y.proxy+encodeURIComponent(d);J=null;$.ajax({url:d,dataType:"xml",success:function(a){J={};$(a).find("afloatSupplyPointResult").each(function(a){var b=$(this);a=b.children("name").text();b=b.children("shipName").text();a&&b&&(J[b.toLowerCase()]=a.toLowerCase())});K&&aa(K)},error:function(a,
c,e){a="Error getting ship name data from "+d;c&&"error"!==c&&(a+=" "+c);g(a)}})}function ha(){a.rowsToShow={};$.each(k,function(d,b){b.included=!1;a.rowsToShow[b.id]=!1;b.hasChildren&&(b.collapsed=!1)});p&&p.refresh();I()}function ia(){a.copWidgetSyncState&&(void 0===J?(k&&ha(),va()):K?aa(K):k&&ha());M.updateHeaderButtons({items:[{itemId:"sync",xtype:"button",icon:H+"images/"+(a.copWidgetSyncState?"syncon.png":"syncoff.png"),text:"Sync "+(a.copWidgetSyncState?"On ":"Off"),tooltip:{text:(a.copWidgetSyncState?
"":"not ")+"synchronizing with Maritime COP widget"}}]});$("#copWidgetSync",q).prop("checked",a.copWidgetSyncState)}function ja(){a.copWidgetSyncState=!a.copWidgetSyncState;a.copWidgetSyncState&&(a.defaultExpansion=4,a.rowsToShow={});ia();v()}function ba(){q||(q=$('<div class="config"><div><a id="watchboards">Select Watchboard</a></div><div><a id="thresholds">Configure Thresholds</a></div><div><a id="average">Configure Moving Average</a></div><div><a id="expansion">Set Default Rollup Level</a></div><div><a id="thresholdCutoff">Set Default Minimum Displayed Threshold</a></div><div><a id="columns">Choose Columns</a></div><div><a id="locations">Choose Sites</a></div><hr/><div><input type="checkbox" id="copWidgetSync">Sync with Maritime COP widget</div><div><input type="checkbox" id="showNonMatchedPopup">Show non matched vessel warning</div><hr/><div><a id="gcssUrl">Set GCSS Suite URL</a></div><div><a id="watchboardListExpire">Set Watchboard List Refresh Time</a></div><div><a id="watchboardRefresh">Set Watchboard Refresh Time</a></div></div>').appendTo($("body")),
$("#gcssUrl",q).click(function(){T()}),$("#watchboards",q).click(function(){ma()}),$("#watchboardListExpire",q).click(function(){na()}),$("#watchboardRefresh",q).click(function(){oa()}),$("#thresholds",q).click(function(){pa()}),$("#average",q).click(function(){qa()}),$("#columns",q).click(function(a){P?(q&&q.dialog("close"),a.pageY-=120,P.show(a)):g("No watchboard loaded. Unable to choose columns")}),$("#locations",q).click(function(d){a.copWidgetSyncState?l("Sites are selected automatically when synchronized with Maritime COP widget",
"Select Sites"):ra(d)}),$("#copWidgetSync",q).prop("checked",a.copWidgetSyncState).change(function(){ja()}),$("#showNonMatchedPopup",q).prop("checked",a.showNonMatchedPopup).change(function(){a.showNonMatchedPopup=!a.showNonMatchedPopup;v()}),$("#expansion",q).click(function(d){a.copWidgetSyncState?l('Rollup Level is automatically set to "Supply Point" when synchronized with Maritime COP widget',"Set Default Rollup Level"):sa(d)}),$("#thresholdCutoff",q).click(function(a){ta(a)}),q.dialog({preferredHeight:272,
preferredWidth:350,height:Math.min(272,m.height-20),width:Math.min(350,m.width-20),modal:!0,title:"Configure",buttons:{Ok:function(){q.dialog("close")}},close:function(d,b){q.remove();q=null;a.gcssSuiteUrl?a.selectedWatchboard||g("No watchboard selected. Unable to display watchboard data. Use configure toolbar button to select watchboard."):g("No GCSS Suite URL set. Unable to fetch watchboard data. Use configure toolbar button to set URL.")}}))}function wa(a){Ozone.pref.PrefServer.getUserPreference({namespace:V,
name:"options",onSuccess:function(b){a(b)},onFailure:function(b,c){void 0!==c&&"undefined : undefined"!==b&&g("Got an error getting preferences! Status Code: "+c+" . Error message: "+b);a()}})}function ka(){var a=["<strong>JC2CUI Log Widget<hr>Widget Version</strong> - "];$.ajax({url:"pkginfo.json",dataType:"json",success:function(b){a.push(b.version);a.push(" Release: ");a.push(b.release);l(a.join(""),"About",160,300,"about")},error:function(b,c,e){a.push("Unknown");l(a.join(""),"About",160,300,
"about")}})}function xa(){if(y.owf){var d=jQuery;$.ajax({url:y.owf+"/js-min/owf-widget-min.js",dataType:"script",cache:!0,timeout:2E4,success:function(b,c){var e,h;if("object"===typeof Ozone&&Ozone.util.isRunningInOWF())if($=jQuery=d||jQuery,owfdojo.config.dojoBlankHtmlUrl="../common/javascript/dojo-1.5.0-windowname-only/dojo/resources/blank.html",y.owfRelay){try{Ozone.eventing.Widget.widgetRelayURL=y.owfRelay,S=Ozone.eventing.Widget.getInstance(),h=JSON.parse(S.getWidgetId()).id,V="jc2cui.mapWidget."+
h,ua(),M=Ozone.chrome.WidgetChrome.getInstance({widgetEventingController:S}),M.isModified({callback:function(a){a=JSON.parse(a);var b;a.success&&(b=a.modified?"updateHeaderButtons":"insertHeaderButtons",M[b]({items:[{itemId:"sync",xtype:"button",handler:function(a,b){ja()}},{type:"help",itemId:"help",handler:function(a,b){ka()}},{type:"gear",itemId:"gear",handler:function(a,b){ba()}}]}),"fit"===JSON.parse(window.name).layout&&(b=a.modified?"updateHeaderMenus":"addHeaderMenus",M[b]({items:[{itemId:"configure",
text:"Configure",icon:H+"images/gear.png",handler:function(a,b){ba()}},{itemId:"about",text:"About",icon:H+"images/help.png",handler:function(a,b){ka()}}]})))}})}catch(k){g("Error setting up OWF eventing"+k?": "+k:"")}y.proxy||g("Missing proxy configuration attribute in config file.");L.gcssSuiteUrl=$.trim(y.gcssSuiteUrl);a.gcssSuiteUrl=L.gcssSuiteUrl;wa(function(b){b&&b.value?(b=JSON.parse(b.value),a=$.extend({},L,b)):a.showNonMatchedPopup=y.showNonMatchedPopup;ia();a.gcssSuiteUrl&&a.selectedWatchboard?
Y():ba()});N.resize(function(){var a={height:N.innerHeight(),width:N.innerWidth()};if(3<Math.abs(m.width-a.width)||3<Math.abs(m.height-a.height))clearTimeout(e),e=setTimeout(function(){r&&r.resizeCanvas();$(".ui-dialog-content:visible").each(function(){var b=$(this),c=b.data("ui-dialog")||b.data("uiDialog")||b.data("dialog"),b=c.uiDialog.width(),d=c.uiDialog.height(),e,g,f;a.width<m.width?(e=a.width-20,b>e&&(g=e)):a.width>m.width&&b<c.options.preferredWidth&&(g=b+(a.width-m.width),g=Math.min(c.options.preferredWidth,
g));a.height<m.height?(e=a.height-20,d>e&&(f=e)):a.height>m.height&&d<c.options.preferredHeight&&(f=d+(a.height-m.height),f=Math.min(c.options.preferredHeight,f));g&&g!==b&&c.option("width",g);f&&f!==d&&c.option("height",f);setTimeout(function(){c.option("position",c.options.position);$.ui.dialog.overlay.resize()},1)});m=a},200)})}else g("Missing owfRelay configuration attribute in config file.");else g("Watchboard Widget only works as a widget in an OWF dashboard")},error:function(a,c,d){a="Error loading OWF script "+
y.owf;c&&"error"!==c&&(a+=": "+c);g(a)}})}else g("Missing owf configuration attribute in config file.")}var N=$(window),m={height:N.innerHeight(),width:N.innerWidth()},V,S,M,y,q,G,z,B,C,u,D,E,F,L={gcssSuiteUrl:null,watchboardsTimeout:10,selectedWatchboard:null,watchboardRefreshTime:720,movingAverage:1,defaultExpansion:4,thresholds:{green:80,amber:60,red:40},lowestThreshold:"none",columnsToShow:null,rowsToShow:null,copWidgetSyncState:!1},a=$.extend(!0,{},L),k,p,r,n,P,ga,X,A,da=0,W,Q,Z=0,R,O={},H,K,
J;R=function(){a.selectedWatchboard&&(new Date).getTime()-Z>=6E4*a.watchboardRefreshTime&&Y()};return{init:function(a){H=document.location.href;H=H.substring(0,H.lastIndexOf("/")+1);y=a;xa()},showErrorMessage:g}}();
$(document).ready(function(){$.ajaxSetup({cache:!1});$.ajax({url:"config/logWidgetConfig.json",dataType:"json",success:function(l){l?jc2cui.logWidget.init(l):jc2cui.logWidget.showErrorMessage("Error loading log widget configuration: No data")},error:function(l,g,w){l="Error loading log widget configuration: config/logWidgetConfig.json";g&&"error"!==g&&(l+=" "+g);jc2cui.logWidget.showErrorMessage(l)}})});
