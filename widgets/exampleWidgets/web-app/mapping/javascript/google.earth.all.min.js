(function(){function k(){}function g(){}function h(){}function z(a,b){return a>b?b+360-a:b-a}function v(a){return null!==a&&("function"==typeof a||"object"==typeof a)&&"getType"in a}var d={isnamespace_:!0,ALTITUDE_CLAMP_TO_GROUND:0,ALTITUDE_RELATIVE_TO_GROUND:1,ALTITUDE_ABSOLUTE:2,ALTITUDE_CLAMP_TO_SEA_FLOOR:4,ALTITUDE_RELATIVE_TO_SEA_FLOOR:5};k.prototype={e:function(a){return 1>a||a>this.elements.length?null:this.elements[a-1]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},
eql:function(a){var b=this.elements.length;a=a.elements||a;if(b!=a.length)return!1;for(;b--;)if(1E-6<Math.abs(this.elements[b]-a[b]))return!1;return!0},dup:function(){return k.create(this.elements)},map:function(a){var b=[];this.each(function(c,f){b.push(a(c,f))});return k.create(b)},each:function(a){for(var b=this.elements.length,c=0;c<b;c++)a(this.elements[c],c+1)},toUnitVector:function(){var a=this.modulus();return 0===a?this.dup():this.map(function(b){return b/a})},angleFrom:function(a){var b=
a.elements||a;if(this.elements.length!=b.length)return null;var c=0,f=0,e=0;this.each(function(a,d){c+=a*b[d-1];f+=a*a;e+=b[d-1]*b[d-1]});f=Math.sqrt(f);e=Math.sqrt(e);if(0===f*e)return null;a=c/(f*e);-1>a&&(a=-1);1<a&&(a=1);return Math.acos(a)},isParallelTo:function(a){a=this.angleFrom(a);return null===a?null:1E-6>=a},isAntiparallelTo:function(a){a=this.angleFrom(a);return null===a?null:1E-6>=Math.abs(a-Math.PI)},isPerpendicularTo:function(a){a=this.dot(a);return null===a?null:1E-6>=Math.abs(a)},
add:function(a){var b=a.elements||a;return this.elements.length!=b.length?null:this.map(function(a,f){return a+b[f-1]})},subtract:function(a){var b=a.elements||a;return this.elements.length!=b.length?null:this.map(function(a,f){return a-b[f-1]})},multiply:function(a){return this.map(function(b){return b*a})},x:function(a){return this.multiply(a)},dot:function(a){a=a.elements||a;var b=0,c=this.elements.length;if(c!=a.length)return null;for(;c--;)b+=this.elements[c]*a[c];return b},cross:function(a){a=
a.elements||a;if(3!=this.elements.length||3!=a.length)return null;var b=this.elements;return k.create([b[1]*a[2]-b[2]*a[1],b[2]*a[0]-b[0]*a[2],b[0]*a[1]-b[1]*a[0]])},max:function(){for(var a=0,b=this.elements.length;b--;)Math.abs(this.elements[b])>Math.abs(a)&&(a=this.elements[b]);return a},indexOf:function(a){for(var b=null,c=this.elements.length,f=0;f<c;f++)null===b&&this.elements[f]==a&&(b=f+1);return b},toDiagonalMatrix:function(){return g.Diagonal(this.elements)},round:function(){return this.map(function(a){return Math.round(a)})},
snapTo:function(a){return this.map(function(b){return 1E-6>=Math.abs(b-a)?a:b})},distanceFrom:function(a){if(a.anchor||a.start&&a.end)return a.distanceFrom(this);var b=a.elements||a;if(b.length!=this.elements.length)return null;var c=0,f;this.each(function(a,d){f=a-b[d-1];c+=f*f});return Math.sqrt(c)},liesOn:function(a){return a.contains(this)},liesIn:function(a){return a.contains(this)},rotate:function(a,b){var c,f=null,e,d;a.determinant&&(f=a.elements);switch(this.elements.length){case 2:c=b.elements||
b;if(2!=c.length)return null;f||(f=g.Rotation(a).elements);e=this.elements[0]-c[0];d=this.elements[1]-c[1];return k.create([c[0]+f[0][0]*e+f[0][1]*d,c[1]+f[1][0]*e+f[1][1]*d]);case 3:if(!b.direction)return null;var t=b.pointClosestTo(this).elements;f||(f=g.Rotation(a,b.direction).elements);e=this.elements[0]-t[0];d=this.elements[1]-t[1];c=this.elements[2]-t[2];return k.create([t[0]+f[0][0]*e+f[0][1]*d+f[0][2]*c,t[1]+f[1][0]*e+f[1][1]*d+f[1][2]*c,t[2]+f[2][0]*e+f[2][1]*d+f[2][2]*c]);default:return null}},
reflectionIn:function(a){if(a.anchor){var b=this.elements.slice();a=a.pointClosestTo(b).elements;return k.create([a[0]+(a[0]-b[0]),a[1]+(a[1]-b[1]),a[2]+(a[2]-(b[2]||0))])}var c=a.elements||a;return this.elements.length!=c.length?null:this.map(function(a,b){return c[b-1]+(c[b-1]-a)})},to3D:function(){var a=this.dup();switch(a.elements.length){case 3:break;case 2:a.elements.push(0);break;default:return null}return a},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(a){this.elements=
(a.elements||a).slice();return this}};k.create=function(a){return(new k).setElements(a)};k.i=k.create([1,0,0]);k.j=k.create([0,1,0]);k.k=k.create([0,0,1]);k.Random=function(a){for(var b=[];a--;)b.push(Math.random());return k.create(b)};k.Zero=function(a){for(var b=[];a--;)b.push(0);return k.create(b)};g.prototype={e:function(a,b){return 1>a||a>this.elements.length||1>b||b>this.elements[0].length?null:this.elements[a-1][b-1]},row:function(a){return a>this.elements.length?null:k.create(this.elements[a-
1])},col:function(a){if(a>this.elements[0].length)return null;for(var b=[],c=this.elements.length,f=0;f<c;f++)b.push(this.elements[f][a-1]);return k.create(b)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(a){a=a.elements||a;"undefined"==typeof a[0][0]&&(a=g.create(a).elements);if(this.elements.length!=a.length||this.elements[0].length!=a[0].length)return!1;
for(var b=this.elements.length,c=this.elements[0].length,f;b--;)for(f=c;f--;)if(1E-6<Math.abs(this.elements[b][f]-a[b][f]))return!1;return!0},dup:function(){return g.create(this.elements)},map:function(a){for(var b=[],c=this.elements.length,f=this.elements[0].length,e;c--;)for(e=f,b[c]=[];e--;)b[c][e]=a(this.elements[c][e],c+1,e+1);return g.create(b)},isSameSizeAs:function(a){a=a.elements||a;"undefined"==typeof a[0][0]&&(a=g.create(a).elements);return this.elements.length==a.length&&this.elements[0].length==
a[0].length},add:function(a){var b=a.elements||a;"undefined"==typeof b[0][0]&&(b=g.create(b).elements);return this.isSameSizeAs(b)?this.map(function(a,f,e){return a+b[f-1][e-1]}):null},subtract:function(a){var b=a.elements||a;"undefined"==typeof b[0][0]&&(b=g.create(b).elements);return this.isSameSizeAs(b)?this.map(function(a,f,e){return a-b[f-1][e-1]}):null},canMultiplyFromLeft:function(a){a=a.elements||a;"undefined"==typeof a[0][0]&&(a=g.create(a).elements);return this.elements[0].length==a.length},
multiply:function(a){if(!a.elements)return this.map(function(b){return b*a});var b=a.modulus?!0:!1,c=a.elements||a;"undefined"==typeof c[0][0]&&(c=g.create(c).elements);if(!this.canMultiplyFromLeft(c))return null;for(var f=this.elements.length,e=c[0].length,d,t=this.elements[0].length,k,h=[],p;f--;)for(d=e,h[f]=[];d--;){k=t;for(p=0;k--;)p+=this.elements[f][k]*c[k][d];h[f][d]=p}c=g.create(h);return b?c.col(1):c},x:function(a){return this.multiply(a)},minor:function(a,b,c,f){for(var e=[],d=c,t,k,h,
p=this.elements.length,v=this.elements[0].length;d--;)for(t=c-d-1,e[t]=[],k=f;k--;)h=f-k-1,e[t][h]=this.elements[(a+t-1)%p][(b+h-1)%v];return g.create(e)},transpose:function(){var a=this.elements.length,b,c,f=[];for(b=this.elements[0].length;b--;)for(c=a,f[b]=[];c--;)f[b][c]=this.elements[c][b];return g.create(f)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){for(var a=0,b=this.elements.length,c=this.elements[0].length,f;b--;)for(f=c;f--;)Math.abs(this.elements[b][f])>
Math.abs(a)&&(a=this.elements[b][f]);return a},indexOf:function(a){var b=this.elements.length,c,f=this.elements[0].length,d;for(c=0;c<b;c++)for(d=0;d<f;d++)if(this.elements[c][d]==a)return{i:c+1,j:d+1};return null},diagonal:function(){if(!this.isSquare)return null;for(var a=[],b=this.elements.length,c=0;c<b;c++)a.push(this.elements[c][c]);return k.create(a)},toRightTriangular:function(){var a=this.dup(),b,c=this.elements.length,f,d,l=this.elements[0].length,g;for(f=0;f<c;f++){if(0==a.elements[f][f])for(d=
f+1;d<c;d++)if(0!=a.elements[d][f]){b=[];for(g=0;g<l;g++)b.push(a.elements[f][g]+a.elements[d][g]);a.elements[f]=b;break}if(0!=a.elements[f][f])for(d=f+1;d<c;d++){var k=a.elements[d][f]/a.elements[f][f];b=[];for(g=0;g<l;g++)b.push(g<=f?0:a.elements[d][g]-a.elements[f][g]*k);a.elements[d]=b}}return a},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;for(var a=this.toRightTriangular(),b=a.elements[0][0],c=a.elements.length,f=1;f<c;f++)b*=
a.elements[f][f];return b},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;for(var a=this.elements[0][0],b=this.elements.length,c=1;c<b;c++)a+=this.elements[c][c];return a},tr:function(){return this.trace()},rank:function(){for(var a=this.toRightTriangular(),b=0,c=this.elements.length,f=this.elements[0].length,d;c--;)for(d=f;d--;)if(1E-6<Math.abs(a.elements[c][d])){b++;break}return b},
rk:function(){return this.rank()},augment:function(a){a=a.elements||a;"undefined"==typeof a[0][0]&&(a=g.create(a).elements);var b=this.dup(),c=b.elements[0].length,d=b.elements.length,e=a[0].length,l;if(d!=a.length)return null;for(;d--;)for(l=e;l--;)b.elements[d][c+l]=a[d][l];return b},inverse:function(){if(!this.isSquare()||this.isSingular())return null;for(var a=this.elements.length,b=a,c,d=this.augment(g.I(a)).toRightTriangular(),e=d.elements[0].length,l,k,h=[],r;b--;){k=[];h[b]=[];c=d.elements[b][b];
for(l=0;l<e;l++)r=d.elements[b][l]/c,k.push(r),l>=a&&h[b].push(r);d.elements[b]=k;for(c=b;c--;){k=[];for(l=0;l<e;l++)k.push(d.elements[c][l]-d.elements[b][l]*d.elements[c][b]);d.elements[c]=k}}return g.create(h)},inv:function(){return this.inverse()},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(b){return 1E-6>=Math.abs(b-a)?a:b})},inspect:function(){for(var a=[],b=this.elements.length,c=0;c<b;c++)a.push(k.create(this.elements[c]).inspect());
return a.join("\n")},setElements:function(a){var b,c=a.elements||a;if("undefined"!=typeof c[0][0]){a=c.length;for(this.elements=[];a--;)for(b=c[a].length,this.elements[a]=[];b--;)this.elements[a][b]=c[a][b];return this}b=c.length;this.elements=[];for(a=0;a<b;a++)this.elements.push([c[a]]);return this}};g.create=function(a){return(new g).setElements(a)};g.I=function(a){for(var b=[],c=a,d;c--;)for(d=a,b[c]=[];d--;)b[c][d]=c==d?1:0;return g.create(b)};g.Diagonal=function(a){for(var b=a.length,c=g.I(b);b--;)c.elements[b][b]=
a[b];return c};g.Rotation=function(a,b){if(!b)return g.create([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]]);var c=b.dup();if(3!=c.elements.length)return null;var d=c.modulus(),e=c.elements[0]/d,l=c.elements[1]/d,c=c.elements[2]/d,d=Math.sin(a),k=Math.cos(a),h=1-k;return g.create([[h*e*e+k,h*e*l-d*c,h*e*c+d*l],[h*e*l+d*c,h*l*l+k,h*l*c-d*e],[h*e*c-d*l,h*l*c+d*e,h*c*c+k]])};g.RotationX=function(a){var b=Math.cos(a);a=Math.sin(a);return g.create([[1,0,0],[0,b,-a],[0,a,b]])};g.RotationY=function(a){var b=
Math.cos(a);a=Math.sin(a);return g.create([[b,0,a],[0,1,0],[-a,0,b]])};g.RotationZ=function(a){var b=Math.cos(a);a=Math.sin(a);return g.create([[b,-a,0],[a,b,0],[0,0,1]])};g.Random=function(a,b){return g.Zero(a,b).map(function(){return Math.random()})};g.Zero=function(a,b){for(var c=[],d=a,e;d--;)for(e=b,c[d]=[];e--;)c[d][e]=0;return g.create(c)};h.prototype={eql:function(a){return this.isParallelTo(a)&&this.contains(a.anchor)},dup:function(){return h.create(this.anchor,this.direction)},translate:function(a){a=
a.elements||a;return h.create([this.anchor.elements[0]+a[0],this.anchor.elements[1]+a[1],this.anchor.elements[2]+(a[2]||0)],this.direction)},isParallelTo:function(a){if(a.normal||a.start&&a.end)return a.isParallelTo(this);a=this.direction.angleFrom(a.direction);return 1E-6>=Math.abs(a)||1E-6>=Math.abs(a-Math.PI)},distanceFrom:function(a){if(a.normal||a.start&&a.end)return a.distanceFrom(this);if(a.direction){if(this.isParallelTo(a))return this.distanceFrom(a.anchor);var b=this.direction.cross(a.direction).toUnitVector().elements,
c=this.anchor.elements;a=a.anchor.elements;return Math.abs((c[0]-a[0])*b[0]+(c[1]-a[1])*b[1]+(c[2]-a[2])*b[2])}var d=a.elements||a,c=this.anchor.elements,b=this.direction.elements;a=d[0]-c[0];var e=d[1]-c[1],d=(d[2]||0)-c[2],c=Math.sqrt(a*a+e*e+d*d);if(0===c)return 0;b=(a*b[0]+e*b[1]+d*b[2])/c;b=1-b*b;return Math.abs(c*Math.sqrt(0>b?0:b))},contains:function(a){if(a.start&&a.end)return this.contains(a.start)&&this.contains(a.end);a=this.distanceFrom(a);return null!==a&&1E-6>=a},positionOf:function(a){if(!this.contains(a))return null;
a=a.elements||a;var b=this.anchor.elements,c=this.direction.elements;return(a[0]-b[0])*c[0]+(a[1]-b[1])*c[1]+((a[2]||0)-b[2])*c[2]},liesIn:function(a){return a.contains(this)},intersects:function(a){return a.normal?a.intersects(this):!this.isParallelTo(a)&&1E-6>=this.distanceFrom(a)},intersectionWith:function(a){if(a.normal||a.start&&a.end)return a.intersectionWith(this);if(!this.intersects(a))return null;var b=this.anchor.elements,c=this.direction.elements,d=a.anchor.elements,e=a.direction.elements;
a=c[0];var g=c[1],c=c[2],h=e[0],q=e[1],e=e[2],r=b[0]-d[0],p=b[1]-d[1],d=b[2]-d[2],v=h*h+q*q+e*e,x=a*h+g*q+c*e,h=((-a*r-g*p-c*d)*v/(a*a+g*g+c*c)+x*(h*r+q*p+e*d))/(v-x*x);return k.create([b[0]+h*a,b[1]+h*g,b[2]+h*c])},pointClosestTo:function(a){if(a.start&&a.end)return a=a.pointClosestTo(this),null===a?null:this.pointClosestTo(a);if(a.direction){if(this.intersects(a))return this.intersectionWith(a);if(this.isParallelTo(a))return null;var b=this.direction.elements,c=a.direction.elements,d=b[0],e=b[1],
b=b[2],g=c[0],h=c[1],q=c[2],c=b*g-d*q,r=d*h-e*g,p=e*q-b*h;a=Plane.create(a.anchor,[c*q-r*h,r*g-p*q,p*h-c*g]);return a.intersectionWith(this)}a=a.elements||a;if(this.contains(a))return k.create(a);c=this.anchor.elements;b=this.direction.elements;d=b[0];e=b[1];b=b[2];g=c[0];r=c[1];h=c[2];c=d*(a[1]-r)-e*(a[0]-g);r=e*((a[2]||0)-h)-b*(a[1]-r);p=b*(a[0]-g)-d*((a[2]||0)-h);d=k.create([e*c-b*p,b*r-d*c,d*p-e*r]);e=this.distanceFrom(a)/d.modulus();return k.create([a[0]+d.elements[0]*e,a[1]+d.elements[1]*e,
(a[2]||0)+d.elements[2]*e])},rotate:function(a,b){"undefined"==typeof b.direction&&(b=h.create(b.to3D(),k.k));var c=g.Rotation(a,b.direction).elements,d=b.pointClosestTo(this.anchor).elements,e=this.anchor.elements,l=this.direction.elements,t=d[0],q=d[1],d=d[2],r=e[0]-t,p=e[1]-q,e=e[2]-d;return h.create([t+c[0][0]*r+c[0][1]*p+c[0][2]*e,q+c[1][0]*r+c[1][1]*p+c[1][2]*e,d+c[2][0]*r+c[2][1]*p+c[2][2]*e],[c[0][0]*l[0]+c[0][1]*l[1]+c[0][2]*l[2],c[1][0]*l[0]+c[1][1]*l[1]+c[1][2]*l[2],c[2][0]*l[0]+c[2][1]*
l[1]+c[2][2]*l[2]])},reverse:function(){return h.create(this.anchor,this.direction.x(-1))},reflectionIn:function(a){if(a.normal){var b=this.anchor.elements,c=this.direction.elements,d=b[0],e=b[1],b=b[2],g=c[0],k=c[1],q=c[2],c=this.anchor.reflectionIn(a).elements,d=d+g,e=e+k,b=b+q;a=a.pointClosestTo([d,e,b]).elements;return h.create(c,[a[0]+(a[0]-d)-c[0],a[1]+(a[1]-e)-c[1],a[2]+(a[2]-b)-c[2]])}if(a.direction)return this.rotate(Math.PI,a);a=a.elements||a;return h.create(this.anchor.reflectionIn([a[0],
a[1],a[2]||0]),this.direction)},setVectors:function(a,b){a=k.create(a);b=k.create(b);2==a.elements.length&&a.elements.push(0);2==b.elements.length&&b.elements.push(0);if(3<a.elements.length||3<b.elements.length)return null;var c=b.modulus();if(0===c)return null;this.anchor=a;this.direction=k.create([b.elements[0]/c,b.elements[1]/c,b.elements[2]/c]);return this}};h.create=function(a,b){return(new h).setVectors(a,b)};h.X=h.create(k.Zero(3),k.i);h.Y=h.create(k.Zero(3),k.j);h.Z=h.create(k.Zero(3),k.k);
d.linalg={};d.linalg.Vector=function(){return k.create.apply(null,arguments)};d.linalg.Vector.create=k.create;d.linalg.Vector.i=k.i;d.linalg.Vector.j=k.j;d.linalg.Vector.k=k.k;d.linalg.Vector.Random=k.Random;d.linalg.Vector.Zero=k.Zero;d.linalg.Matrix=function(){return g.create.apply(null,arguments)};d.linalg.Matrix.create=g.create;d.linalg.Matrix.I=g.I;d.linalg.Matrix.Random=g.Random;d.linalg.Matrix.Rotation=g.Rotation;d.linalg.Matrix.RotationX=g.RotationX;d.linalg.Matrix.RotationY=g.RotationY;d.linalg.Matrix.RotationZ=
g.RotationZ;d.linalg.Matrix.Zero=g.Zero;d.linalg.Line=function(){return h.create.apply(null,arguments)};d.linalg.Line.create=h.create;d.linalg.Line.X=h.X;d.linalg.Line.Y=h.Y;d.linalg.Line.Z=h.Z;d.math={isnamespace_:!0};"toDegrees"in Number.prototype||(Number.prototype.toDegrees=function(){return 180*this/Math.PI});"toRadians"in Number.prototype||(Number.prototype.toRadians=function(){return this*Math.PI/180});d.math.normalizeAngle=function(a){a%=2*Math.PI;return 0<=a?a:a+2*Math.PI};d.math.normalizeLat=
function(a){return Math.max(-90,Math.min(90,a))};d.math.normalizeLng=function(a){if(180==a%360)return 180;a%=360;return-180>a?a+360:180<a?a-360:a};d.math.reverseAngle=function(a){return d.math.normalizeAngle(a+Math.PI)};d.math.wrapValue=function(a,b,c){if(!b||!d.util.isArray(b)||2!=b.length)throw new TypeError("The range parameter must be an array of 2 numbers.");if(a===b[0])return b[0];a-=b[0];a%=b[1]-b[0];0>a&&(a+=b[1]-b[0]);a+=b[0];return a===b[0]?c?b[0]:b[1]:a};d.math.constrainValue=function(a,
b){if(!b||!d.util.isArray(b)||2!=b.length)throw new TypeError("The range parameter must be an array of 2 numbers.");return Math.max(b[0],Math.min(b[1],a))};d.math.EARTH_RADIUS=6378135;d.math.EARTH_RADIUS_CURVATURE_AVG=6372795;d.math.distance=function(a,b){return d.math.EARTH_RADIUS*d.math.angularDistance(a,b)};d.math.angularDistance=function(a,b){var c=a.lat().toRadians(),d=b.lat().toRadians(),e=(b.lat()-a.lat()).toRadians(),g=(b.lng()-a.lng()).toRadians(),c=Math.pow(Math.sin(e/2),2)+Math.cos(c)*
Math.cos(d)*Math.pow(Math.sin(g/2),2);return 2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c))};d.math.heading=function(a,b){var c=a.lat().toRadians(),f=b.lat().toRadians(),e=Math.cos(f),g=(b.lng()-a.lng()).toRadians();return d.math.normalizeAngle(Math.atan2(Math.sin(g)*e,Math.cos(c)*Math.sin(f)-Math.sin(c)*e*Math.cos(g))).toDegrees()};d.math.bearing=d.math.heading;d.math.midpoint=function(a,b,c){if(d.util.isUndefined(c)||null===c)c=0.5;if(a.equals(b))return new d.Point(a);var f=a.lat().toRadians(),e=b.lat().toRadians(),
g=a.lng().toRadians(),k=b.lng().toRadians(),h=Math.cos(f),r=Math.cos(e);b=d.math.angularDistance(a,b);var p=Math.sin(b);a=Math.sin((1-c)*b)/p;b=Math.sin(c*b)/p;c=a*h*Math.cos(g)+b*r*Math.cos(k);g=a*h*Math.sin(g)+b*r*Math.sin(k);f=a*Math.sin(f)+b*Math.sin(e);return new d.Point(Math.atan2(f,Math.sqrt(Math.pow(c,2)+Math.pow(g,2))).toDegrees(),Math.atan2(g,c).toDegrees())};d.math.destination=function(a,b){if(!("heading"in b&&"distance"in b))throw new TypeError("destination() requres both heading and distance options.");
var c=a.lat().toRadians(),f=Math.sin(c),e=b.distance/d.math.EARTH_RADIUS,g=b.heading.toRadians(),k=Math.sin(e),e=Math.cos(e),c=Math.asin(f*e+Math.cos(c)*k*Math.cos(g));return new d.Point(c.toDegrees(),Math.atan2(Math.sin(g)*k*Math.cos(c),e-f*Math.sin(c)).toDegrees()+a.lng())};d.Point=function(){var a=null;if(1==arguments.length){var b=arguments[0];if(b.constructor===d.Point)this.lat_=b.lat(),this.lng_=b.lng(),this.altitude_=b.altitude(),this.altitudeMode_=b.altitudeMode();else if(d.util.isArray(b))a=
b;else if(v(b)){var c=b.getType();if("KmlPoint"==c||"KmlLookAt"==c)this.lat_=b.getLatitude(),this.lng_=b.getLongitude(),this.altitude_=b.getAltitude(),this.altitudeMode_=b.getAltitudeMode();else if("KmlCoord"==c||"KmlLocation"==c)this.lat_=b.getLatitude(),this.lng_=b.getLongitude(),this.altitude_=b.getAltitude();else throw new TypeError("Could not create a point from the given Earth object");}else if(window.google&&window.google.maps&&window.google.maps.LatLng&&b.constructor===window.google.maps.LatLng)this.lat_=
b.lat(),this.lng_=b.lng();else throw new TypeError("Could not create a point from the given arguments");}else a=arguments;if(a){for(b=0;b<a.length;b++)if("number"!=typeof a[b])throw new TypeError("Coordinates must be numerical");this.lat_=a[0];this.lng_=a[1];3<=a.length&&(this.altitude_=a[2],4<=a.length&&(this.altitudeMode_=a[3]))}this.lat_=d.math.normalizeLat(this.lat_);this.lng_=d.math.normalizeLng(this.lng_)};d.Point.prototype.lat=function(){return this.lat_};d.Point.prototype.lat_=0;d.Point.prototype.lng=
function(){return this.lng_};d.Point.prototype.lng_=0;d.Point.prototype.altitude=function(){return this.altitude_};d.Point.prototype.altitude_=0;d.Point.prototype.altitudeMode=function(){return this.altitudeMode_};d.Point.prototype.altitudeMode_=d.ALTITUDE_RELATIVE_TO_GROUND;d.Point.prototype.toString=function(){return"("+this.lat().toString()+", "+this.lng().toString()+", "+this.altitude().toString()+")"};d.Point.prototype.flatten=function(){return new d.Point(this.lat(),this.lng())};d.Point.prototype.is3D=
function(){return 0!==this.altitude_};d.Point.prototype.equals=function(a){return this.lat()==a.lat()&&this.lng()==a.lng()&&this.altitude()==a.altitude()&&this.altitudeMode()==a.altitudeMode()};d.Point.prototype.angularDistance=function(a){return d.math.angularDistance(this,a)};d.Point.prototype.distance=function(a){return d.math.distance(this,a)};d.Point.prototype.heading=function(a){return d.math.heading(this,a)};d.Point.prototype.midpoint=function(a,b){return d.math.midpoint(this,a,b)};d.Point.prototype.destination=
function(a){return d.math.destination(this,a)};d.Point.prototype.toCartesian=function(){var a=Math.sin(this.lng().toRadians()),b=Math.cos(this.lng().toRadians()),c=Math.sin(this.lat().toRadians()),f=Math.cos(this.lat().toRadians()),e=d.math.EARTH_RADIUS+this.altitude();return new d.linalg.Vector([e*b*f,e*c,e*-a*f])};d.Point.fromCartesian=function(a){var b=a.distanceFrom(d.linalg.Vector.Zero(3));a=a.toUnitVector();var b=b-d.math.EARTH_RADIUS,c=Math.asin(a.e(2)).toDegrees();90<c&&(c-=180);var f=0;90>
Math.abs(c)&&(f=-Math.atan2(a.e(3),a.e(1)).toDegrees());return new d.Point(c,f,b)};d.Bounds=function(){if(1==arguments.length)if(arguments[0].constructor===d.Bounds){var a=arguments[0];this.sw_=new d.Point(a.southWestBottom());this.ne_=new d.Point(a.northEastTop())}else this.sw_=this.ne_=new d.Point(arguments[0]);else if(2==arguments.length){var a=new d.Point(arguments[0]),b=new d.Point(arguments[1]);if(a||b){a?b||(b=a):a=b;if(a.lat()>b.lat())throw new RangeError("Bounds southwest coordinate cannot be north of the northeast coordinate");
if(a.altitude()>b.altitude())throw new RangeError("Bounds southwest coordinate cannot be north of the northeast coordinate");this.sw_=a;this.ne_=b}}};d.Bounds.prototype.southWestBottom=function(){return this.sw_};d.Bounds.prototype.sw_=null;d.Bounds.prototype.south=function(){return this.isEmpty()?null:this.sw_.lat()};d.Bounds.prototype.west=function(){return this.isEmpty()?null:this.sw_.lng()};d.Bounds.prototype.bottom=function(){return this.isEmpty()?null:this.sw_.altitude()};d.Bounds.prototype.northEastTop=
function(){return this.ne_};d.Bounds.prototype.ne_=null;d.Bounds.prototype.north=function(){return this.isEmpty()?null:this.ne_.lat()};d.Bounds.prototype.east=function(){return this.isEmpty()?null:this.ne_.lng()};d.Bounds.prototype.top=function(){return this.isEmpty()?null:this.ne_.altitude()};d.Bounds.prototype.crossesAntimeridian=function(){return!this.isEmpty()&&this.sw_.lng()>this.ne_.lng()};d.Bounds.prototype.is3D=function(){return!this.isEmpty()&&(this.sw_.is3D()||this.ne_.is3D())};d.Bounds.prototype.containsPoint=
function(a){a=new d.Point(a);return!this.isEmpty()&&(this.south()<=a.lat()&&a.lat()<=this.north())&&(!this.is3D()||this.bottom()<=a.altitude()&&a.altitude()<=this.top())?this.containsLng_(a.lng()):!1};d.Bounds.prototype.containsLng_=function(a){return this.crossesAntimeridian()?a<=this.east()||a>=this.west():this.west()<=a&&a<=this.east()};d.Bounds.prototype.extend=function(a){a=new d.Point(a);if(!this.containsPoint(a))if(this.isEmpty())this.sw_=this.ne_=a;else{var b=this.bottom(),c=this.top();this.is3D()&&
(b=Math.min(b,a.altitude()),c=Math.max(c,a.altitude()));var f=Math.min(this.south(),a.lat()),e=Math.max(this.north(),a.lat()),g=this.west(),k=this.east();if(!this.containsLng_(a.lng())){var h=z(g,a.lng()),r=z(a.lng(),k);h<=r?k=a.lng():g=a.lng()}this.sw_=new d.Point(f,g,b);this.ne_=new d.Point(e,k,c)}};d.Bounds.prototype.span=function(){return this.isEmpty()?{lat:0,lng:0,altitude:0}:{lat:this.ne_.lat()-this.sw_.lat(),lng:z(this.sw_.lng(),this.ne_.lng()),altitude:this.is3D()?this.ne_.altitude()-this.sw_.altitude():
null}};d.Bounds.prototype.isEmpty=function(){return null===this.sw_&&null===this.sw_};d.Bounds.prototype.center=function(){return this.isEmpty()?null:new d.Point((this.sw_.lat()+this.ne_.lat())/2,this.crossesAntimeridian()?d.math.normalizeLng(this.sw_.lng()+z(this.sw_.lng(),this.ne_.lng())/2):(this.sw_.lng()+this.ne_.lng())/2,(this.sw_.altitude()+this.ne_.altitude())/2)};d.Bounds.prototype.getCenter=d.Bounds.prototype.center;d.Bounds.prototype.isFullLat=function(){return!this.isEmpty()&&-90==this.south()&&
90==this.north()};d.Bounds.prototype.isFullLng=function(){return!this.isEmpty()&&-180==this.west()&&180==this.east()};d.Path=function(){this.coords_=[];var a=null,b,c;if(1==arguments.length){var f=arguments[0];if(f.constructor===d.Path)for(b=0;b<f.numCoords();b++)this.coords_.push(new d.Point(f.coord(b)));else if(d.util.isArray(f))a=f;else if(v(f))if(b=f.getType(),"KmlLineString"==b||"KmlLinearRing"==b)for(c=f.getCoordinates().getLength(),b=0;b<c;b++)this.coords_.push(new d.Point(f.getCoordinates().get(b)));
else throw new TypeError("Could not create a path from the given arguments");else if("getVertex"in f&&"getVertexCount"in f)for(c=f.getVertexCount(),b=0;b<c;b++)this.coords_.push(new d.Point(f.getVertex(b)));else throw new TypeError("Could not create a path from the given arguments");}else a=arguments;if(a)for(b=0;b<a.length;b++)this.coords_.push(new d.Point(a[b]))};d.Path.prototype.coords_=null;d.Path.prototype.toString=function(){return"["+d.util.arrayMap(this.coords_,function(a){return a.toString()}).join(", ")+
"]"};d.Path.prototype.equals=function(a){for(var b=0;b<a.numCoords();b++)if(!this.coord(b).equals(a.coord(b)))return!1;return!0};d.Path.prototype.numCoords=function(){return this.coords_.length};d.Path.prototype.coord=function(a){return this.coords_[a]};d.Path.prototype.prepend=function(a){this.coords_.unshift(new d.Point(a))};d.Path.prototype.append=function(a){this.coords_.push(new d.Point(a))};d.Path.prototype.insert=function(a,b){this.coords_.splice(a,0,new d.Point(b))};d.Path.prototype.remove=
function(a){this.coords_.splice(a,1)};d.Path.prototype.subPath=function(a,b){return this.coords_.slice(a,b)};d.Path.prototype.reverse=function(){this.coords_.reverse()};d.Path.prototype.distance=function(){for(var a=0,b=0;b<this.coords_.length-1;b++)a+=this.coords_[b].distance(this.coords_[b+1]);return a};d.Path.prototype.containsPoint=function(a){var b=!1,c=a.lat();a=a.lng();for(var d=0;d<this.coords_.length;d++){var e=(d+1)%this.coords_.length;(this.coords_[d].lat()<c&&this.coords_[e].lat()>=c||
this.coords_[e].lat()<c&&this.coords_[d].lat()>=c)&&this.coords_[d].lng()+(c-this.coords_[d].lat())/(this.coords_[e].lat()-this.coords_[d].lat())*(this.coords_[e].lng()-this.coords_[d].lng())<a&&(b=!b)}return b};d.Path.prototype.bounds=function(){if(!this.numCoords())return new d.Bounds;for(var a=new d.Bounds(this.coord(0)),b=this.numCoords(),c=1;c<b;c++)a.extend(this.coord(c));return a};d.Path.prototype.signedArea_=function(){for(var a=0,b=this.bounds(),c=b.west(),b=b.south(),f=this.numCoords(),
e=0;e<f;e++)var g=(e+1)%f,k=this.coord(e).distance(new d.Point(this.coord(e).lat(),c)),h=this.coord(g).distance(new d.Point(this.coord(g).lat(),c)),r=this.coord(e).distance(new d.Point(b,this.coord(e).lng())),g=this.coord(g).distance(new d.Point(b,this.coord(g).lng())),a=a+(k*g-h*r);return 0.5*a};d.Path.prototype.area=function(){return Math.abs(this.signedArea_())};d.Path.prototype.isCounterClockwise_=function(){return Boolean(0<=this.signedArea_())};d.Polygon=function(){this.outerBoundary_=new d.Path;
this.innerBoundaries_=[];var a;if(0!==arguments.length)if(1==arguments.length){var b=arguments[0];if(b.constructor===d.Polygon)for(this.outerBoundary_=new d.Path(b.outerBoundary()),a=0;a<b.innerBoundaries().length;a++)this.innerBoundaries_.push(new d.Path(b.innerBoundaries()[a]));else if(v(b))if(a=b.getType(),"KmlLineString"==a||"KmlLinearRing"==a)this.outerBoundary_=new d.Path(b);else if("KmlPolygon"==a){this.outerBoundary_=new d.Path(b.getOuterBoundary());var b=b.getInnerBoundaries().getChildNodes(),
c=b.getLength();for(a=0;a<c;a++)this.innerBoundaries_.push(new d.Path(b.item(a)))}else throw new TypeError("Could not create a polygon from the given arguments");else this.outerBoundary_=new d.Path(arguments[0])}else if(arguments[0].length&&"number"==typeof arguments[0][0])this.outerBoundary_=new d.Path(arguments);else if(arguments[1]){this.outerBoundary_=new d.Path(arguments[0]);if(!d.util.isArray(arguments[1]))throw new TypeError("Second argument to geo.Polygon constructor must be an array of paths.");
for(a=0;a<arguments[1].length;a++)this.innerBoundaries_.push(new d.Path(arguments[1][a]))}else throw new TypeError("Cannot create a path from the given arguments.");};d.Polygon.prototype.outerBoundary_=null;d.Polygon.prototype.innerBoundaries_=null;d.Polygon.prototype.toString=function(){return"Polygon: "+this.outerBoundary().toString()+(this.innerBoundaries().length?", ("+this.innerBoundaries().length+" inner boundaries)":"")};d.Polygon.prototype.outerBoundary=function(){return this.outerBoundary_};
d.Polygon.prototype.innerBoundaries=function(){return this.innerBoundaries_};d.Polygon.prototype.containsPoint=function(a){if(!this.outerBoundary_.containsPoint(a))return!1;for(var b=0;b<this.innerBoundaries_.length;b++)if(this.innerBoundaries_[b].containsPoint(a))return!1;return!0};d.Polygon.prototype.bounds=function(){return this.outerBoundary_.bounds()};d.Polygon.prototype.area=function(){for(var a=this.outerBoundary_.area(),b=0;b<this.innerBoundaries_.length;b++)a-=this.innerBoundaries_[b].area();
return a};d.Polygon.prototype.isCounterClockwise=function(){return this.outerBoundary_.isCounterClockwise_()};d.Polygon.prototype.makeCounterClockwise=function(){this.isCounterClockwise()&&this.outerBoundary_.reverse()};d.util={isnamespace_:!0};d.util.arrayMap=function(){function a(a,b,d){return a.map(b,d)}function b(a,b,d){if("function"!=typeof b)throw new TypeError("map() requires a mapping function.");for(var g=a.length,k=Array(g),h=0;h<g;h++)h in a&&(k[h]=b.call(d,a[h],h,a));return k}return"map"in
Array.prototype?a:b}();d.util.isUndefined=function(a){return"undefined"==typeof a};d.util.isArray=function(a){return null!==a&&"object"==typeof a&&"splice"in a&&"join"in a};d.util.isFunction=function(a){return null!==a&&"function"==typeof a&&"call"in a&&"apply"in a};d.util.isObjectLiteral=function(a){return null!==a&&"object"==typeof a&&a.constructor===Object&&!v(a)};window.geo=d})();
(function(){function k(a,m,b){var c={};a=a||{};b=b||{};for(var d in a){if(!(m||d in b)){a=[];for(var g in b)a.push(g);throw Error("Unexpected parameter '"+d+"'. Allowed parameters are: "+a.join(", ")+".");}c[d]=a[d]}for(d in b)if(!(d in c)){if(b[d]===l)throw Error("Required parameter '"+d+"' was not passed.");b[d]!=e&&b[d]!=f&&(c[d]=b[d])}return c}function g(a,m){var b=[],c=null;geo.util.isArray(a)?(b=a,c=m):c=a;c.isclass_=!0;for(var d=0;d<b.length;d++)for(var e in b[d].prototype)c.prototype[e]=b[d].prototype[e];
return c}function h(a){a.apiInterface&&!geo.util.isArray(a.apiInterface)&&(a.apiInterface=[a.apiInterface]);for(var m=a.base;m;){if("propertySpec"in m.builderParams){"propertySpec"in a||(a.propertySpec=[]);for(var b in m.builderParams.propertySpec)b in a.propertySpec||(a.propertySpec[b]=m.builderParams.propertySpec[b])}a.apiInterface||(a.apiInterface=m.builderParams.apiInterface);a.apiFactoryFn||(a.apiFactoryFn=m.builderParams.apiFactoryFn);m=m.builderParams.base}var d={id:""};for(b in d)b in a.propertySpec||
(a.propertySpec[b]=d[b]);b=function(){var b={},d;if(0===arguments.length)throw new TypeError("Cannot create object without any arguments!");if(1==arguments.length){for(d=0;d<a.apiInterface.length;d++)if(c.isInstanceOfEarthInterface(arguments[0],a.apiInterface[d]))return arguments[0];d=arguments[0];if(geo.util.isObjectLiteral(d))b=d;else if("defaultProperty"in a)b[a.defaultProperty]=d;else throw new TypeError("Expected options object");}else if(2==arguments.length)if("defaultProperty"in a)b=arguments[1],
b[a.defaultProperty]=arguments[0];else throw Error("No default property for the DOM builder");b=k(b,!1,a.propertySpec);d=this.pluginInstance[a.apiFactoryFn](b.id);geo.util.isUndefined(a.constructor)||a.constructor.call(this,d,b);for(m=a.base;m;)"constructor"in m.builderParams&&m.builderParams.constructor.call(this,d,b),m=m.builderParams.base;for(var J in a.propertySpec)if(a.propertySpec[J]===f&&J in b)d["set"+J.charAt(0).toUpperCase()+J.substr(1)](b[J]);return d};b.builderParams=a;return b}function z(a,
m){var b=a.util.getJsDataValue(m,r)||{};p={placemark:m,startAltitude:m.getGeometry().getAltitude(),draggableOptions:b.draggableOptions,dragged:!1}}function v(a){return function(m){if(p&&(m.preventDefault(),m.getDidHitGlobe())){if(!p.dragged&&(p.dragged=!0,p.draggableOptions.draggingStyle&&(p.oldStyle=p.placemark.getStyleSelector(),p.placemark.setStyleSelector(a.dom.buildStyle(p.draggableOptions.draggingStyle))),p.draggableOptions.bounce&&(a.fx.cancel(p.placemark),a.fx.bounce(p.placemark,{phase:1})),
p.draggableOptions.targetScreenOverlay)){var b=a.dom.buildScreenOverlay(p.draggableOptions.targetScreenOverlay);a.pluginInstance.getFeatures().appendChild(b);p.activeTargetScreenOverlay=b}p.activeTargetScreenOverlay&&a.dom.setVec2(p.activeTargetScreenOverlay.getOverlayXY(),{left:m.getClientX(),top:m.getClientY()});b=p.placemark.getGeometry();b.setLatitude(m.getLatitude());b.setLongitude(m.getLongitude());p.placemark.setVisibility(!0);p.draggableOptions.dragCallback&&p.draggableOptions.dragCallback.call(p.placemark)}}}
function d(a,m){if(p){p.dragged&&(p.oldStyle&&(p.placemark.setStyleSelector(p.oldStyle),delete p.oldStyle),p.activeTargetScreenOverlay&&(a.pluginInstance.getFeatures().removeChild(p.activeTargetScreenOverlay),delete p.activeTargetScreenOverlay),p.draggableOptions.bounce&&(a.fx.cancel(p.placemark),a.fx.bounce(p.placemark,{startAltitude:p.startAltitude,phase:2,repeat:1,dampen:0.3})));var b=p;p=null;b.dragged&&(b.draggableOptions.dropCallback&&!m)&&b.draggableOptions.dropCallback.call(b.placemark)}}
function a(a,m){return a.getLatitude()==m.getLatitude()&&a.getLongitude()==m.getLongitude()&&a.getAltitude()==m.getAltitude()}function b(a){for(var m in x)if(x[m].object.equals(a))return m;return null}var c=function(a){function m(a){return function(){return a.apply(c,arguments)}}function b(a){for(var d in a){var F=a[d];geo.util.isFunction(F)&&(F.isclass_?F.extInstance_=c:a[d]=m(F));if(null!==F&&"object"==typeof F&&"isnamespace_"in F&&F.isnamespace_){var e={},f;for(f in F)e[f]=F[f];b(e);a[d]=e}}}var c=
this;this.pluginInstance=a;b(this)},f=Infinity,e=null,l=void 0;c.isInstanceOfEarthInterface=function(a,m){return null!==a&&("object"==typeof a||"function"==typeof a)&&"getType"in a&&a.getType()==m};c.prototype.dom={isnamespace_:!0};c.prototype.dom.buildFeature_=h({propertySpec:{name:f,visibility:f,description:f,snippet:f,region:e},constructor:function(a,m){m.region&&a.setRegion(this.dom.buildRegion(m.region))}});c.prototype.dom.buildPlacemark=h({apiInterface:"KmlPlacemark",base:c.prototype.dom.buildFeature_,
apiFactoryFn:"createPlacemark",propertySpec:{point:e,lineString:e,linearRing:e,polygon:e,model:e,geometries:e,altitudeMode:e,stockIcon:e,icon:e,style:e,highlightStyle:e},constructor:function(a,m){var b=[];m.point&&b.push(this.dom.buildPoint(m.point));m.lineString&&b.push(this.dom.buildLineString(m.lineString));m.linearRing&&b.push(this.dom.buildLinearRing(m.linearRing));m.polygon&&b.push(this.dom.buildPolygon(m.polygon));m.model&&b.push(this.dom.buildModel(m.model));m.multiGeometry&&b.push(this.dom.buildMultiGeometry(m.multiGeometry));
m.geometries&&(b=b.concat(m.geometries));1<b.length?a.setGeometry(this.dom.buildMultiGeometry(b)):1==b.length&&a.setGeometry(b[0]);m.stockIcon&&(m.icon=m.icon||{},m.icon.stockIcon=m.stockIcon);m.icon&&(m.style||(m.style={}),m.style.icon=m.icon);"altitudeMode"in m&&a.getGeometry().setAltitudeMode(m.altitudeMode);m.style&&(m.highlightStyle?(b=this.pluginInstance.createStyleMap(""),"string"==typeof m.style?b.setNormalStyleUrl(m.style):b.setNormalStyle(this.dom.buildStyle(m.style)),"string"==typeof m.highlightStyle?
b.setHighlightStyleUrl(m.highlightStyle):b.setHighlightStyle(this.dom.buildStyle(m.highlightStyle)),a.setStyleSelector(b)):"string"==typeof m.style?a.setStyleUrl(m.style):a.setStyleSelector(this.dom.buildStyle(m.style)))}});c.prototype.dom.buildPointPlacemark=h({base:c.prototype.dom.buildPlacemark,defaultProperty:"point"});c.prototype.dom.buildLineStringPlacemark=h({base:c.prototype.dom.buildPlacemark,defaultProperty:"lineString"});c.prototype.dom.buildPolygonPlacemark=h({base:c.prototype.dom.buildPlacemark,
defaultProperty:"polygon"});c.prototype.dom.buildNetworkLink=h({apiInterface:"KmlNetworkLink",base:c.prototype.dom.buildFeature_,apiFactoryFn:"createNetworkLink",defaultProperty:"link",propertySpec:{link:e,flyToView:f,refreshVisibility:f},constructor:function(a,m){m.link&&a.setLink(this.dom.buildLink(m.link))}});c.prototype.dom.buildContainer_=h({base:c.prototype.dom.buildFeature_,propertySpec:{children:e},constructor:function(a,m){if(m.children)for(var b=0;b<m.children.length;b++)a.getFeatures().appendChild(m.children[b])}});
c.prototype.dom.buildFolder=h({apiInterface:"KmlFolder",base:c.prototype.dom.buildContainer_,apiFactoryFn:"createFolder",defaultProperty:"children"});c.prototype.dom.buildDocument=h({apiInterface:"KmlDocument",base:c.prototype.dom.buildContainer_,apiFactoryFn:"createDocument",defaultProperty:"children"});c.prototype.dom.buildOverlay_=h({base:c.prototype.dom.buildFeature_,propertySpec:{color:e,icon:e,drawOrder:f},constructor:function(a,m){m.color&&a.getColor().set(this.util.parseColor(m.color));if(m.icon){var b=
this.pluginInstance.createIcon("");a.setIcon(b);"string"==typeof m.icon&&b.setHref(m.icon)}}});c.prototype.dom.buildGroundOverlay=h({apiInterface:"KmlGroundOverlay",base:c.prototype.dom.buildOverlay_,apiFactoryFn:"createGroundOverlay",defaultProperty:"icon",propertySpec:{box:l,altitude:f,altitudeMode:f},constructor:function(a,b){if(b.box){var c=this.pluginInstance.createLatLonBox("");c.setBox(b.box.north,b.box.south,b.box.east,b.box.west,b.box.rotation?b.box.rotation:0);a.setLatLonBox(c)}}});c.prototype.dom.buildScreenOverlay=
h({apiInterface:"KmlScreenOverlay",base:c.prototype.dom.buildOverlay_,apiFactoryFn:"createScreenOverlay",defaultProperty:"icon",propertySpec:{screenXY:l,size:l,rotation:f,overlayXY:{left:0,top:0},rotationXY:e},constructor:function(a,b){this.dom.setVec2(a.getScreenXY(),b.overlayXY);this.dom.setVec2(a.getOverlayXY(),b.screenXY);this.dom.setVec2(a.getSize(),b.size);"rotationXY"in b&&this.dom.setVec2(a.getRotationXY(),b.rotationXY)}});for(var t="Placemark PointPlacemark LineStringPlacemark PolygonPlacemark Folder NetworkLink GroundOverlay ScreenOverlay Style".split(" "),
q=0;q<t.length;q++)c.prototype.dom["add"+t[q]]=function(a){return function(){var b=this.dom["build"+a].apply(null,arguments);this.pluginInstance.getFeatures().appendChild(b);return b}}(t[q]);c.prototype.dom.buildExtrudableGeometry_=h({propertySpec:{altitudeMode:f,extrude:f,tessellate:f}});c.prototype.dom.buildPoint=h({apiInterface:"KmlPoint",base:c.prototype.dom.buildExtrudableGeometry_,apiFactoryFn:"createPoint",defaultProperty:"point",propertySpec:{point:l},constructor:function(a,b){var c=new geo.Point(b.point);
a.set(c.lat(),c.lng(),c.altitude(),"altitudeMode"in b?b.altitudeMode:c.altitudeMode(),!1,!1)}});c.prototype.dom.buildLineString=h({apiInterface:"KmlLineString",base:c.prototype.dom.buildExtrudableGeometry_,apiFactoryFn:"createLineString",defaultProperty:"path",propertySpec:{path:l},constructor:function(a,b){for(var c=a.getCoordinates(),d=new geo.Path(b.path),e=d.numCoords(),f=0;f<e;f++)c.pushLatLngAlt(d.coord(f).lat(),d.coord(f).lng(),d.coord(f).altitude())}});c.prototype.dom.buildLinearRing=h({apiInterface:"KmlLinearRing",
base:c.prototype.dom.buildLineString,apiFactoryFn:"createLinearRing",defaultProperty:"path",constructor:function(a,b){}});c.prototype.dom.buildPolygon=h({apiInterface:"KmlPolygon",base:c.prototype.dom.buildExtrudableGeometry_,apiFactoryFn:"createPolygon",defaultProperty:"polygon",propertySpec:{polygon:l},constructor:function(a,b){var c=new geo.Polygon(b.polygon);a.setOuterBoundary(this.dom.buildLinearRing(c.outerBoundary()));if(c.innerBoundaries().length)for(var c=c.innerBoundaries(),d=0;d<c.length;d++)a.getInnerBoundaries().appendChild(this.dom.buildLinearRing(c[d]))}});
c.prototype.dom.buildModel=h({apiInterface:"KmlModel",apiFactoryFn:"createModel",defaultProperty:"link",propertySpec:{altitudeMode:f,link:e,location:e,scale:e,orientation:e},constructor:function(a,b){b.link&&a.setLink(this.dom.buildLink(b.link));if(b.location){var c=new geo.Point(b.location),d=this.pluginInstance.createLocation("");d.setLatLngAlt(c.lat(),c.lng(),c.altitude());a.setLocation(d);a.setAltitudeMode(c.altitudeMode())}b.scale&&(c=this.pluginInstance.createScale(""),"number"==typeof b.scale?
c.set(b.scale,b.scale,b.scale):geo.util.isArray(b.scale)&&c.set(b.scale[0],b.scale[1],b.scale[2]),a.setScale(c));b.orientation&&(c=this.pluginInstance.createOrientation(""),"heading"in b.orientation&&("tilt"in b.orientation&&"roll"in b.orientation)&&c.set(b.orientation.heading,b.orientation.tilt,b.orientation.roll),a.setOrientation(c))}});c.prototype.dom.buildMultiGeometry=h({apiInterface:"KmlMultiGeometry",apiFactoryFn:"createMultiGeometry",defaultProperty:"geometries",propertySpec:{geometries:e},
constructor:function(a,b){var c=a.getGeometries();if(geo.util.isArray(b.geometries))for(var d=0;d<b.geometries.length;d++)c.appendChild(b.geometries[d])}});c.prototype.dom.buildLink=h({apiInterface:"KmlLink",apiFactoryFn:"createLink",defaultProperty:"href",propertySpec:{href:f,refreshMode:f,refreshInterval:f,viewRefreshMode:f,viewBoundScale:f}});c.prototype.dom.buildRegion=h({apiInterface:"KmlRegion",apiFactoryFn:"createRegion",propertySpec:{box:l,lod:e},constructor:function(a,b){var c=this.pluginInstance.createLatLonAltBox("");
if(b.box.center&&b.box.span){geo.util.isArray(b.box.span)||"number"!==typeof b.box.span||(b.box.span=[b.box.span,b.box.span]);var d=new geo.Point(b.box.center);b.box.north=d.lat()+b.box.span[0]/2;b.box.south=d.lat()-b.box.span[0]/2;b.box.east=d.lng()+b.box.span[1]/2;b.box.west=d.lng()-b.box.span[1]/2}c.setAltBox(b.box.north,b.box.south,b.box.east,b.box.west,b.box.rotation||0,b.box.minAltitude||0,b.box.maxAltitude||0,b.box.altitudeMode||this.pluginInstance.ALTITUDE_CLAMP_TO_GROUND);d=this.pluginInstance.createLod("");
d.set(-1,-1,0,0);b.lod&&geo.util.isArray(b.lod)&&(2==b.lod.length?d.set(b.lod[0],b.lod[1],0,0):4==b.lod.length&&d.set(b.lod[0],b.lod[3],b.lod[1],b.lod[2]));a.setLatLonAltBox(c);a.setLod(d)}});c.prototype.dom.buildStyle=h({apiInterface:["KmlStyle","KmlStyleMap"],apiFactoryFn:"createStyle",propertySpec:{icon:e,label:e,line:e,poly:e,balloon:e},constructor:function(a,b){var c=function(a){return(2>a.length?"0":"")+a},d=this,e=function(a,b){a=a?d.util.parseColor(a):"ffffffff";geo.util.isUndefined(b)||(a=
c(Math.floor(255*b).toString(16))+a.substring(2));return a};if(b.icon){var f=a.getIconStyle();"string"==typeof b.icon&&(b.icon={href:b.icon});var g=this.pluginInstance.createIcon("");f.setIcon(g);"href"in b.icon?g.setHref(b.icon.href):"stockIcon"in b.icon?g.setHref(document.location.href.replace(/\/[^\/]*$/,"/")+"images/"+b.icon.stockIcon+".png"):(g.setHref(document.location.href.replace(/\/[^\/]*$/,"/")+"images/wht-blank.png"),f.getHotSpot().set(0.5,this.pluginInstance.UNITS_FRACTION,0,this.pluginInstance.UNITS_FRACTION));
"scale"in b.icon&&f.setScale(b.icon.scale);"heading"in b.icon&&f.setHeading(b.icon.heading);if("color"in b.icon||"opacity"in b.icon)b.icon.color=e(b.icon.color,b.icon.opacity),f.getColor().set(b.icon.color);"opacity"in b.icon&&("color"in b.icon||(b.icon.color="ffffffff"),b.icon.color=c(b.icon.opacity.toString(16))+b.icon.color.substring(2));"hotSpot"in b.icon&&this.dom.setVec2(f.getHotSpot(),b.icon.hotSpot)}b.label&&(f=a.getLabelStyle(),"string"==typeof b.label&&(b.label={color:b.label}),"scale"in
b.label&&f.setScale(b.label.scale),"color"in b.label||"opacity"in b.label)&&(b.label.color=e(b.label.color,b.label.opacity),f.getColor().set(b.label.color));b.line&&(f=a.getLineStyle(),"string"==typeof b.line&&(b.line={color:b.line}),"width"in b.line&&f.setWidth(b.line.width),"color"in b.line||"opacity"in b.line)&&(b.line.color=e(b.line.color,b.line.opacity),f.getColor().set(b.line.color));b.poly&&(f=a.getPolyStyle(),"string"==typeof b.poly&&(b.poly={color:b.poly}),"fill"in b.poly&&f.setFill(b.poly.fill),
"outline"in b.poly&&f.setOutline(b.poly.outline),"color"in b.poly||"opacity"in b.poly)&&(b.poly.color=e(b.poly.color,b.poly.opacity),f.getColor().set(b.poly.color));b.balloon&&(e=a.getBalloonStyle(),"string"==typeof b.balloon&&(b.balloon={bgColor:b.balloon}),"bgColor"in b.balloon&&e.getBgColor().set(d.util.parseColor(b.balloon.bgColor)),"textColor"in b.balloon&&e.getTextColor().set(d.util.parseColor(b.balloon.textColor)),"text"in b.balloon&&e.setText(b.balloon.text))}});c.prototype.dom.clearFeatures=
function(){for(var a=this.pluginInstance.getFeatures(),b;null!==(b=a.getLastChild());)a.removeChild(b)};c.prototype.dom.walk=function(){var a;if(1==arguments.length)if(geo.util.isObjectLiteral(arguments[0]))a=arguments[0];else if(geo.util.isFunction(arguments[0]))a={visitCallback:arguments[0]};else throw new TypeError("walk requires a visit callback function or options literal as a first parameter");else throw Error("walk takes at most 1 arguments");a=k(a,!1,{visitCallback:l,features:!0,geometries:!1,
rootObject:this.pluginInstance,rootContext:e});var b=function(c,d){var e={current:d,child:d,walkChildren:!0},f=a.visitCallback.call(c,e);if(!f&&!geo.util.isUndefined(f))return!1;if(!e.walkChildren)return!0;f=null;"getFeatures"in c?a.features&&(f=c.getFeatures()):"getGeometry"in c?a.geometries&&c.getGeometry()&&b(c.getGeometry(),e.child):"getGeometries"in c?a.geometries&&(f=c.getGeometries()):"getOuterBoundary"in c&&(a.geometries&&c.getOuterBoundary())&&(b(c.getOuterBoundary(),e.child),f=c.getInnerBoundaries());
if(f&&f.hasChildNodes())for(var f=f.getChildNodes(),g=f.getLength(),k=0;k<g;k++){var h=f.item(k);if(!b(h,e.child))return!1}return!0};a.rootObject&&b(a.rootObject,a.rootContext)};c.prototype.dom.getObjectById=function(a,b){b=k(b,!1,{recursive:!0,rootObject:this.pluginInstance});if("getId"in b.rootObject&&b.rootObject.getId()==a)return b.rootObject;var c=null;this.dom.walk({rootObject:b.rootObject,features:!0,geometries:!0,visitCallback:function(){if("getId"in this&&this.getId()==a)return c=this,!1}});
return c};c.prototype.dom.removeObject=function(a){if(a){var b=a.getParentNode();if(!b)throw Error("Cannot remove an object without a parent.");var c=null;"getFeatures"in b?c=b.getFeatures():"getGeometries"in b?c=b.getGeometries():"getInnerBoundaries"in b&&(c=b.getInnerBoundaries());c.removeChild(a)}};c.prototype.dom.setVec2=function(a,b){if("getType"in b&&"KmlVec2"==b.getType())a.set(b.getX(),b.getXUnits(),b.getY(),b.getYUnits());else{b=k(b,!1,{left:e,top:e,right:e,bottom:e,width:e,height:e});"width"in
b&&(b.left=b.width);"height"in b&&(b.bottom=b.height);var c=0,d=this.pluginInstance.UNITS_PIXELS,f=0,g=this.pluginInstance.UNITS_PIXELS;if("left"in b)if("number"==typeof b.left)c=b.left;else if("string"==typeof b.left&&"%"==b.left.charAt(b.left.length-1))c=parseFloat(b.left)/100,d=this.pluginInstance.UNITS_FRACTION;else throw new TypeError("left must be a number or string indicating a percentage");else if("right"in b)if("number"==typeof b.right)c=b.right,d=this.pluginInstance.UNITS_INSET_PIXELS;else if("string"==
typeof b.right&&"%"==b.right.charAt(b.right.length-1))c=1-parseFloat(b.right)/100,d=this.pluginInstance.UNITS_FRACTION;else throw new TypeError("right must be a number or string indicating a percentage");if("bottom"in b)if("number"==typeof b.bottom)f=b.bottom;else if("string"==typeof b.bottom&&"%"==b.bottom.charAt(b.bottom.length-1))f=parseFloat(b.bottom)/100,g=this.pluginInstance.UNITS_FRACTION;else throw new TypeError("bottom must be a number or string indicating a percentage");else if("top"in b)if("number"==
typeof b.top)f=b.top,g=this.pluginInstance.UNITS_INSET_PIXELS;else if("string"==typeof b.top&&"%"==b.top.charAt(b.top.length-1))f=1-parseFloat(b.top)/100,g=this.pluginInstance.UNITS_FRACTION;else throw new TypeError("top must be a number or string indicating a percentage");a.set(c,d,f,g)}};c.prototype.dom.computeBounds=function(a){var b=new geo.Bounds;this.dom.walk({rootObject:a,features:!0,geometries:!0,visitCallback:function(){if("getType"in this)switch(this.getType()){case "KmlGroundOverlay":var a=
this.getLatLonBox();if(a){var c=this.getAltitude();b.extend(new geo.Point(a.getNorth(),a.getEast(),c));b.extend(new geo.Point(a.getNorth(),a.getWest(),c));b.extend(new geo.Point(a.getSouth(),a.getEast(),c));b.extend(new geo.Point(a.getSouth(),a.getWest(),c))}break;case "KmlModel":b.extend(new geo.Point(this.getLocation()));break;case "KmlLinearRing":case "KmlLineString":if(a=this.getCoordinates())for(var c=a.getLength(),d=0;d<c;d++)b.extend(new geo.Point(a.get(d)));break;case "KmlCoord":case "KmlLocation":case "KmlPoint":b.extend(new geo.Point(this))}}});
return b};c.prototype.dom.buildLookAt=h({apiInterface:"KmlLookAt",apiFactoryFn:"createLookAt",defaultProperty:"point",propertySpec:{copy:!1,point:l,heading:e,tilt:e,range:e},constructor:function(a,b){var c=new geo.Point(b.point),d={heading:0,tilt:0,range:1E3};if(b.copy){var e=this.util.getLookAt(d.altitudeMode);d.heading=e.getHeading();d.tilt=e.getTilt();d.range=e.getRange()}b=k(b,!0,d);a.set(c.lat(),c.lng(),c.altitude(),c.altitudeMode(),b.heading,b.tilt,b.range)}});c.prototype.dom.buildCamera=h({apiInterface:"KmlCamera",
apiFactoryFn:"createCamera",defaultProperty:"point",propertySpec:{copy:!1,point:l,heading:e,tilt:e,roll:e},constructor:function(a,b){var c=new geo.Point(b.point),d={heading:0,tilt:0,roll:0};if(b.copy){var e=this.util.getCamera(d.altitudeMode);d.heading=e.getHeading();d.tilt=e.getTilt();d.roll=e.getRoll()}b=k(b,!0,d);a.set(c.lat(),c.lng(),c.altitude(),c.altitudeMode(),b.heading,b.tilt,b.roll)}});c.prototype.edit={isnamespace_:!0};var r="_GEarthExtensions_dragData",p=null;c.prototype.edit.makeDraggable=
function(a,b){this.edit.endDraggable(a);b=k(b,!1,{bounce:!0,dragCallback:e,dropCallback:e,draggingStyle:e,targetScreenOverlay:e});var c=this,f=v(c),g;g=function(a){p&&0===a.getButton()&&(google.earth.removeEventListener(c.pluginInstance.getWindow(),"mousemove",f),google.earth.removeEventListener(c.pluginInstance.getWindow(),"mouseup",g),p.dragged&&a.preventDefault(),d(c))};var h=function(a){0===a.getButton()&&(z(c,a.getTarget()),google.earth.addEventListener(c.pluginInstance.getWindow(),"mousemove",
f),google.earth.addEventListener(c.pluginInstance.getWindow(),"mouseup",g))};this.util.setJsDataValue(a,r,{draggableOptions:b,abortAndEndFn:function(){p&&p.placemark.equals(a)&&(google.earth.removeEventListener(c.pluginInstance.getWindow(),"mousemove",f),google.earth.removeEventListener(c.pluginInstance.getWindow(),"mouseup",g),d(c,!0));google.earth.removeEventListener(a,"mousedown",h)}});google.earth.addEventListener(a,"mousedown",h)};c.prototype.edit.endDraggable=function(a){var b=this.util.getJsDataValue(a,
r);b&&(b.abortAndEndFn.call(null),this.util.clearJsDataValue(a,r))};c.prototype.edit.place=function(a,b){b=k(b,!1,{bounce:!0,dragCallback:e,dropCallback:e,draggingStyle:e,targetScreenOverlay:e});var c=this,f=v(c);a.setVisibility(!1);var g;g=function(a){p&&0===a.getButton()&&(a.preventDefault(),a.stopPropagation(),google.earth.removeEventListener(c.pluginInstance.getWindow(),"mousemove",f),google.earth.removeEventListener(c.pluginInstance.getWindow(),"mousedown",g),d(c))};this.util.setJsDataValue(a,
r,{draggableOptions:b,abortAndEndFn:function(){p&&p.placemark.equals(a)&&(google.earth.removeEventListener(c.pluginInstance.getWindow(),"mousemove",f),google.earth.removeEventListener(c.pluginInstance.getWindow(),"mousedown",g),d(c,!0))}});z(c,a);google.earth.addEventListener(c.pluginInstance.getWindow(),"mousemove",f);google.earth.addEventListener(c.pluginInstance.getWindow(),"mousedown",g)};var L=document.location.href.replace(/\/[^\/]*$/,"/")+"images/placemark_circle.png";c.prototype.edit.drawLineString=
function(b,c){c=k(c,!1,{bounce:!0,drawCallback:e,finishCallback:e,ensureCounterClockwise:!0});(this.util.getJsDataValue(b,"_GEarthExtensions_lineStringEditData")||1)&&this.edit.endEditLineString(b);var d=this,f=!1,g=new geo.Polygon,h=!1,l=[],p=b.getAltitudeMode(),C=null,t="KmlLinearRing"==b.getType(),q=b.getCoordinates(),r=this.pluginInstance.parseKml(['<Document><Style id="_GEarthExtensions_regularCoordinate"><IconStyle><Icon><href>',L,'</href></Icon><scale>0.85</scale></IconStyle></Style><Style id="_GEarthExtensions_firstCoordinateHighlight"><IconStyle><Icon><href>',
L,'</href></Icon><scale>1.105</scale><color>ff00ff00</color></IconStyle></Style><StyleMap id="_GEarthExtensions_firstCoordinate"><Pair><key>normal</key><styleUrl>#_GEarthExtensions_regularCoordinate</styleUrl></Pair><Pair><key>highlight</key><styleUrl>#_GEarthExtensions_firstCoordinateHighlight</styleUrl></Pair></StyleMap></Document>'].join("")),x,v=function(e){google.earth.removeEventListener(d.pluginInstance.getWindow(),"dblclick",x);var f=q.getLength();if(f&&t){var g=q.get(0),f=q.get(f-1);a(g,
f)||q.pushLatLngAlt(g.getLatitude(),g.getLongitude(),g.getAltitude())}d.edit.endDraggable(C);d.dom.removeObject(r);d.util.clearJsDataValue(b,"_GEarthExtensions_lineStringEditData");l=[];h=!0;c.finishCallback&&!e&&c.finishCallback.call(null)};x=function(a){a.preventDefault();v.call(null)};var z;z=function(){C=d.dom.buildPointPlacemark([0,0],{altitudeMode:p,style:"#_GEarthExtensions_regularCoordinate",visibility:!1});r.getFeatures().appendChild(C);f?l.unshift(C):l.push(C);d.edit.place(C,{bounce:c.bounce,
dropCallback:function(){if(!h){var a=[C.getGeometry().getLatitude(),C.getGeometry().getLongitude(),0];f?q.unshiftLatLngAlt(a[0],a[1],a[2]):q.pushLatLngAlt(a[0],a[1],a[2]);c.ensureCounterClockwise&&(f?g.outerBoundary().prepend(a):g.outerBoundary().append(a),g.isCounterClockwise()||(g.outerBoundary().reverse(),q.reverse(),f=!f));c.drawCallback&&c.drawCallback.call(null,f?0:q.getLength()-1);1==l.length&&(l[0].setStyleUrl("#_GEarthExtensions_firstCoordinate"),google.earth.addEventListener(l[0],"mousedown",
function(a){return function(b){f?q.unshiftLatLngAlt(a[0],a[1],a[2]):q.pushLatLngAlt(a[0],a[1],a[2]);x(b)}}(a)));z()}}})};z.call(null);google.earth.addEventListener(d.pluginInstance.getWindow(),"dblclick",x);this.pluginInstance.getFeatures().appendChild(r);this.util.setJsDataValue(b,"_GEarthExtensions_lineStringEditData",{abortAndEndFn:function(){v.call(null,!0)}})};c.prototype.edit.editLineString=function(b,c){c=k(c,!1,{editCallback:e});(this.util.getJsDataValue(b,"_GEarthExtensions_lineStringEditData")||
1)&&this.edit.endEditLineString(b);var d=this,f="KmlLinearRing"==b.getType(),g=b.getAltitudeMode(),h=b.getCoordinates(),l=h.getLength();if(l&&f){var p=h.get(0),C=h.get(l-1);a(p,C)||(h.pushLatLngAlt(p.getLatitude(),p.getLongitude(),p.getAltitude()),l++)}var t=this.pluginInstance.parseKml(['<Document><Style id="_GEarthExtensions_regularCoordinate"><IconStyle><Icon><href>',L,'</href></Icon><color>ffffffff</color><scale>0.85</scale></IconStyle></Style><StyleMap id="_GEarthExtensions_midCoordinate"><Pair><key>normal</key><Style><IconStyle><Icon><href>',
L,"</href></Icon><color>60ffffff</color><scale>0.6</scale></IconStyle></Style></Pair><Pair><key>highlight</key><styleUrl>#_GEarthExtensions_regularCoordinate</styleUrl></Pair></StyleMap></Document>"].join("")),r=[],x=function(){f&&(3==l?r[1].rightMidPlacemark.setVisibility(!1):4<=l&&r[l-2].rightMidPlacemark.setVisibility(!0))},v=function(a){return function(b){b.preventDefault();b=null;if(0<a.index||f)b=a.index-1,0>b&&(b+=l),f&&0===a.index&&b--,b=r[b];for(q=a.index;q<l-1;q++)h.set(q,h.get(q+1));h.pop();
f&&0===a.index&&h.set(l-2,h.get(0));l--;!a.rightMidPlacemark&&b&&(d.edit.endDraggable(b.rightMidPlacemark),d.dom.removeObject(b.rightMidPlacemark),b.rightMidPlacemark=null);a.rightMidPlacemark&&(d.edit.endDraggable(a.rightMidPlacemark),d.dom.removeObject(a.rightMidPlacemark));d.edit.endDraggable(a.regularPlacemark);google.earth.removeEventListener(a.regularPlacemark,"dblclick",a.deleteEventListener);d.dom.removeObject(a.regularPlacemark);r.splice(a.index,1);for(q=0;q<l;q++)r[q].index=q;b&&b.regularDragCallback.call(b.regularPlacemark,
b);x();c.editCallback&&c.editCallback(null)}},z=function(a){return function(){h.setLatLngAlt(a.index,this.getGeometry().getLatitude(),this.getGeometry().getLongitude(),this.getGeometry().getAltitude());f&&(2<=l&&0===a.index)&&(h.get(0),h.get(l-1),h.setLatLngAlt(0,this.getGeometry().getLatitude(),this.getGeometry().getLongitude(),this.getGeometry().getAltitude()),h.setLatLngAlt(l-1,this.getGeometry().getLatitude(),this.getGeometry().getLongitude(),this.getGeometry().getAltitude()));var b=h.get(a.index);
if(0<a.index||f){var d=a.index-1;0>d&&(d+=l);f&&0===a.index&&d--;var e=(new geo.Point(h.get(d))).midpoint(new geo.Point(b));r[d].rightMidPlacemark.getGeometry().setLatitude(e.lat());r[d].rightMidPlacemark.getGeometry().setLongitude(e.lng());r[d].rightMidPlacemark.getGeometry().setAltitude(e.altitude())}if(a.index<l-1||f)d=f&&a.index==l-2||!f&&a.index==l-1?h.get(0):h.get(a.index+1),b=(new geo.Point(b)).midpoint(new geo.Point(d)),a.rightMidPlacemark.getGeometry().setLatitude(b.lat()),a.rightMidPlacemark.getGeometry().setLongitude(b.lng()),
a.rightMidPlacemark.getGeometry().setAltitude(b.altitude());x();c.editCallback&&c.editCallback(null)}},O=function(a){var b=!1,c=null;return function(){if(!b){b=!0;var f;this.setStyleUrl("#_GEarthExtensions_regularCoordinate");h.push(h.get(l-1));for(f=l-1;f>a.index+1;f--)h.set(f,h.get(f-1));l++;c={};c.index=a.index+1;c.regularPlacemark=this;a.rightMidPlacemark=d.dom.buildPointPlacemark({point:h.get(a.index),altitudeMode:g,style:"#_GEarthExtensions_midCoordinate"});t.getFeatures().appendChild(a.rightMidPlacemark);
d.edit.makeDraggable(a.rightMidPlacemark,{bounce:!1,dragCallback:O(a)});c.rightMidPlacemark=d.dom.buildPointPlacemark({point:h.get(a.index),altitudeMode:g,style:"#_GEarthExtensions_midCoordinate"});t.getFeatures().appendChild(c.rightMidPlacemark);d.edit.makeDraggable(c.rightMidPlacemark,{bounce:!1,dragCallback:O(c)});c.deleteEventListener=v(c);google.earth.addEventListener(this,"dblclick",c.deleteEventListener);c.regularDragCallback=z(c);r.splice(c.index,0,c);for(f=0;f<l;f++)r[f].index=f}c.regularDragCallback.call(this,
c)}};d.util.batchExecute(function(){for(var a=0;a<l;a++){var b=h.get(a),c=h.get((a+1)%l),e={};r.push(e);e.index=a;if(!f||a!=l-1)if(e.regularPlacemark=d.dom.buildPointPlacemark(b,{altitudeMode:g,style:"#_GEarthExtensions_regularCoordinate"}),t.getFeatures().appendChild(e.regularPlacemark),e.regularDragCallback=z(e),d.edit.makeDraggable(e.regularPlacemark,{bounce:!1,dragCallback:e.regularDragCallback}),e.deleteEventListener=v(e),google.earth.addEventListener(e.regularPlacemark,"dblclick",e.deleteEventListener),
a<l-1||f)e.rightMidPlacemark=d.dom.buildPointPlacemark({point:(new geo.Point(b)).midpoint(new geo.Point(c)),altitudeMode:g,style:"#_GEarthExtensions_midCoordinate"}),t.getFeatures().appendChild(e.rightMidPlacemark),d.edit.makeDraggable(e.rightMidPlacemark,{bounce:!1,dragCallback:O(e)})}x();d.pluginInstance.getFeatures().appendChild(t)});d.util.setJsDataValue(b,"_GEarthExtensions_lineStringEditData",{innerDoc:t,abortAndEndFn:function(){d.util.batchExecute(function(){var b=h.getLength();if(b&&f){var c=
h.get(0),b=h.get(b-1);a(c,b)||h.pushLatLngAlt(c.getLatitude(),c.getLongitude(),c.getAltitude())}for(c=0;c<r.length;c++)r[c].regularPlacemark&&(google.earth.removeEventListener(r[c].regularPlacemark,"dblclick",r[c].deleteEventListener),d.edit.endDraggable(r[c].regularPlacemark),r[c].rightMidPlacemark&&d.edit.endDraggable(r[c].rightMidPlacemark));d.dom.removeObject(t)})}})};c.prototype.edit.endEditLineString=function(a){var b=this.util.getJsDataValue(a,"_GEarthExtensions_lineStringEditData");b&&(b.abortAndEndFn.call(null),
this.util.clearJsDataValue(a,"_GEarthExtensions_lineStringEditData"))};c.prototype.fx={isnamespace_:!0};c.prototype.fx.AnimationManager_=g(function(){this.extInstance=arguments.callee.extInstance_;this.animations_=[];this.running_=!1;this.globalTime_=0});c.prototype.fx.AnimationManager_.prototype.startAnimation=function(a){this.animations_.push({obj:a,startGlobalTime:this.globalTime_});this.start_()};c.prototype.fx.AnimationManager_.prototype.stopAnimation=function(a){for(var b=0;b<this.animations_.length;b++)if(this.animations_[b].obj==
a){this.animations_.splice(b,1);break}};c.prototype.fx.AnimationManager_.prototype.start_=function(){if(!this.running_){this.startTimeStamp_=Number(new Date);this.tick_();for(var a=0;a<this.animations_.length;a++)this.animations_[a].obj.renderFrame(0);var b=this;this.frameendListener_=function(){b.tick_()};this.tickInterval_=window.setInterval(this.frameendListener_,100);google.earth.addEventListener(this.extInstance.pluginInstance,"frameend",this.frameendListener_);this.running_=!0}};c.prototype.fx.AnimationManager_.prototype.stop_=
function(){this.running_&&(google.earth.removeEventListener(this.extInstance.pluginInstance,"frameend",this.frameendListener_),this.frameendListener_=null,window.clearInterval(this.tickInterval_),this.tickInterval_=null,this.running_=!1,this.globalTime_=0)};c.prototype.fx.AnimationManager_.prototype.tick_=function(){this.running_&&(this.globalTime_=Number(new Date)-this.startTimeStamp_,this.renderCurrentFrame_())};c.prototype.fx.AnimationManager_.prototype.renderCurrentFrame_=function(){for(var a=
this.animations_.length-1;0<=a;a--){var b=this.animations_[a];b&&b.obj?b.obj.renderFrame(this.globalTime_-b.startGlobalTime):console.log("bad animation obj?")}0===this.animations_.length&&this.stop_()};c.prototype.fx.getAnimationManager_=function(){this.fx.animationManager_||(this.fx.animationManager_=new this.fx.AnimationManager_);return this.fx.animationManager_};c.prototype.fx.Animation=g(function(a,b){this.extInstance=arguments.callee.extInstance_;this.renderFn=a;this.completionFn=b||function(){}});
c.prototype.fx.Animation.prototype.start=function(){this.extInstance.fx.getAnimationManager_().startAnimation(this)};c.prototype.fx.Animation.prototype.stop=function(a){this.extInstance.fx.getAnimationManager_().stopAnimation(this);this.completionFn({cancelled:!Boolean(a||geo.util.isUndefined(a))})};c.prototype.fx.Animation.prototype.rewind=function(){this.renderFrame(0);this.stop(!1)};c.prototype.fx.Animation.prototype.renderFrame=function(a){this.renderFn.call(this,a)};c.prototype.fx.TimedAnimation=
g([c.prototype.fx.Animation],function(a,b,c){this.extInstance=arguments.callee.extInstance_;this.duration=a;this.renderFn=b;this.complete=!1;this.completionFn=c||function(){}});c.prototype.fx.TimedAnimation.prototype.renderFrame=function(a){this.complete||(a>this.duration?(this.renderFn.call(this,this.duration),this.stop(),this.complete=!0):this.renderFn.call(this,a))};c.prototype.fx.bounce=function(a,b){b=k(b,!1,{duration:300,startAltitude:e,altitude:this.util.getCamera().getAltitude()/5,phase:e,
repeat:0,dampen:0.3,callback:function(){}});var c=this;this.fx.rewind(a);if(!1 in a||!a.getGeometry()||"KmlPoint"!=a.getGeometry().getType())throw new TypeError("Placemark must be a KmlPoint geometry");var d=a.getGeometry(),f=d.getAltitudeMode();f==this.pluginInstance.ALTITUDE_CLAMP_TO_GROUND&&(d.setAltitude(0),d.setAltitudeMode(this.pluginInstance.ALTITUDE_RELATIVE_TO_GROUND));f==this.pluginInstance.ALTITUDE_CLAMP_TO_SEA_FLOOR&&(d.setAltitude(0),d.setAltitudeMode(this.pluginInstance.ALTITUDE_RELATIVE_TO_SEA_FLOOR));
"number"!=typeof b.startAltitude&&(b.startAltitude=d.getAltitude());var g,h;g=function(){c.fx.animateProperty(d,"altitude",{duration:b.duration/2,end:b.startAltitude+b.altitude,easing:"out",featureProxy:a,callback:h||function(){}})};h=function(e){e&&e.cancelled||c.fx.animateProperty(d,"altitude",{duration:b.duration/2,start:b.startAltitude+b.altitude,end:b.startAltitude,easing:"in",featureProxy:a,callback:function(e){d.setAltitudeMode(f);e.cancelled?(d.setAltitude(b.startAltitude),b.callback.call(a,
e)):1<=b.repeat?(--b.repeat,b.altitude*=b.dampen,b.duration*=Math.sqrt(b.dampen),b.phase=0,c.fx.bounce(a,b)):b.callback.call(a,e)}})};1===b.phase?(h=null,g.call()):2===b.phase?h.call():g.call()};c.prototype.fx.cancel=function(a){a=this.util.getJsDataValue(a,"_GEarthExtensions_anim")||[];for(var b=0;b<a.length;b++)a[b].stop(!1)};c.prototype.fx.rewind=function(a){a=this.util.getJsDataValue(a,"_GEarthExtensions_anim")||[];for(var b=0;b<a.length;b++)a[b].rewind()};c.prototype.fx.animateProperty=function(a,
b,c){c=k(c,!1,{duration:500,start:e,end:e,delta:e,easing:"none",callback:e,featureProxy:e});"string"==typeof c.easing&&(c.easing={none:function(a){return a},"in":function(a){return a*a*a},out:function(a){var b=a*a;return b*a-3*b+3*a},both:function(a){var b=a*a;a*=b;return 6*a*b-15*b*b+10*a}}[c.easing]);var d=b.charAt(0).toUpperCase()+b.substr(1),f=this,g;if("color"==b){if(c.delta)throw Error("Cannot use delta with color animations.");var h=a.getColor()||{get:function(){return""}};c.start||(c.start=
h.get());c.end||(c.end=h.get());g=function(a){h.set(f.util.blendColors(c.start,c.end,c.easing.call(null,a)))}}else b=function(){return a["get"+d]()},isFinite(c.start)||isFinite(c.end)?(isFinite(c.start)||(c.start=b()),isFinite(c.end)||(c.end=b())):(isFinite(c.delta)||(c.delta=0),c.start=b(),c.end=b()+c.delta),g=function(b){b=c.start+(c.end-c.start)*c.easing.call(null,b);a["set"+d](b)};b=new this.fx.TimedAnimation(c.duration,function(a){g(1*a/c.duration)},function(b){var d=f.util.getJsDataValue(c.featureProxy||
a,"_GEarthExtensions_anim");if(d){for(var e=0;e<d.length;e++)if(d[e]==this){d.splice(e,1);break}d.length||f.util.clearJsDataValue(c.featureProxy||a,"_GEarthExtensions_anim")}c.callback&&c.callback.call(a,b)});var l=this.util.getJsDataValue(c.featureProxy||a,"_GEarthExtensions_anim");l?l.push(b):this.util.setJsDataValue(c.featureProxy||a,"_GEarthExtensions_anim",[b]);b.start();return b};c.prototype.math3d={isnamespace_:!0};c.prototype.math3d.htrToLocalFrame=function(a){var b=[a[0].toRadians(),a[1].toRadians(),
a[2].toRadians()];a=[[0,0,0],[0,0,0],[0,0,0]];var c=Math.cos(b[0]),d=Math.cos(b[1]),e=Math.cos(b[2]),f=Math.sin(b[0]),g=Math.sin(b[1]),b=Math.sin(b[2]),h=c*e,k=c*b,l=f*e,p=f*b;a[2][2]=d*e;a[2][0]=g*l-k;a[2][1]=g*h+p;a[0][2]=d*b;a[0][0]=g*p+h;a[0][1]=g*k-l;a[1][2]=-g;a[1][0]=d*f;a[1][1]=d*c;return new geo.linalg.Matrix(a)};c.prototype.math3d.localFrameToHtr=function(a){var b=Math.sqrt(a.e(3,3)*a.e(3,3)+a.e(1,3)*a.e(1,3));a=1.6E-5>=b?[Math.atan2(-a.e(1,2),a.e(1,1)),Math.atan2(-a.e(2,3),b),0]:[Math.atan2(a.e(2,
1),a.e(2,2)),Math.atan2(-a.e(2,3),b),Math.atan2(a.e(1,3),a.e(3,3))];return[a[0].toDegrees(),a[1].toDegrees(),a[2].toDegrees()]};c.prototype.math3d.makeOrthonormalFrame=function(a,b){var c=a.cross(b).toUnitVector();if(c.eql(geo.linalg.Vector.Zero(3)))return null;var d=b.cross(c).toUnitVector(),e=c.cross(d);return new geo.linalg.Matrix([c.elements,d.elements,e.elements])};c.prototype.math3d.makeLocalToGlobalFrame=function(a){a=a.toCartesian().toUnitVector();var b=(new geo.linalg.Vector([0,1,0])).cross(a).toUnitVector(),
c=a.cross(b).toUnitVector();return new geo.linalg.Matrix([b.elements,c.elements,a.elements])};c.prototype.util={isnamespace_:!0};c.NAMED_COLORS={aqua:"ffffff00",black:"ff000000",blue:"ffff0000",fuchsia:"ffff00ff",gray:"ff808080",green:"ff008000",lime:"ff00ff00",maroon:"ff000080",navy:"ff800000",olive:"ff008080",purple:"ff800080",red:"ff0000ff",silver:"ffc0c0c0",teal:"ff808000",white:"ffffffff",yellow:"ff00ffff"};c.prototype.util.parseColor=function(a,b){var d=function(a){return(2>a.length?"0":"")+
a};if(geo.util.isArray(a))return d(4<=a.length?a[3].toString(16):"ff")+d(a[2].toString(16))+d(a[1].toString(16))+d(a[0].toString(16));if("string"==typeof a){if(a.toLowerCase()in c.NAMED_COLORS)return c.NAMED_COLORS[a.toLowerCase()];if(7<a.length)return a.match(/^[0-9a-f]{8}$/i)?a:null;var e=null,e=4<a.length?a.replace(/#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})/i,"ff$3$2$1").toLowerCase():a.replace(/#?([0-9a-f])([0-9a-f])([0-9a-f])/i,"ff$3$3$2$2$1$1").toLowerCase();if(e==a)return null;geo.util.isUndefined(b)||
(e=d(Math.floor(255*b).toString(16))+e.substring(2));return e}return null};c.prototype.util.blendColors=function(a,b,c){if(geo.util.isUndefined(c)||null===c)c=0.5;a=this.util.parseColor(a);b=this.util.parseColor(b);var d=function(a,b){a=parseInt(a,16);b=parseInt(b,16);var d=Math.floor((b-a)*c+a).toString(16);return(2>d.length?"0":"")+d};return d(a.substr(0,2),b.substr(0,2))+d(a.substr(2,2),b.substr(2,2))+d(a.substr(4,2),b.substr(4,2))+d(a.substr(6,2),b.substr(6,2))};var x={};c.prototype.util.hasJsData=
function(a){return b(a)?!0:!1};c.prototype.util.clearAllJsData=function(a){(a=b(a))&&delete x[a]};c.prototype.util.getJsDataValue=function(a,c){var d=b(a);if(d&&c in x[d].data)return x[d].data[c]};c.prototype.util.setJsDataValue=function(a,c,d){var e=b(a);if(!e){for(e=null;!e||e in x;){for(var e=[],f=0,f=0;36>f;f++)e[f]=Math.floor(16*Math.random());e[14]=4;e[19]=e[19]&3|8;for(f=0;36>f;f++)e[f]="0123456789ABCDEF".charAt(e[f]);e[8]=e[13]=e[18]=e[23]="-";e=e.join("")}x[e]={object:a,data:{}}}x[e].data[c]=
d};c.prototype.util.clearJsDataValue=function(a,c){var d=b(a);if(d&&c in x[d].data){delete x[d].data[c];for(var e in x[d].data)return;this.util.clearAllJsData(a)}};c.prototype.util.displayKml=function(a,b){b=k(b,!1,{cacheBuster:!1,flyToView:!1,flyToBoundsFallback:!0,aspectRatio:1});b.cacheBuster&&(a+=(a.match(/\?/)?"&":"?")+"_cacheBuster="+Number(new Date).toString());var c=this;google.earth.fetchKml(c.pluginInstance,a,function(a){a&&(c.pluginInstance.getFeatures().appendChild(a),b.flyToView&&c.util.flyToObject(a,
{boundsFallback:b.flyToBoundsFallback,aspectRatio:b.aspectRatio}))})};c.prototype.util.displayKmlString=function(a,b){b=k(b,!1,{flyToView:!1,flyToBoundsFallback:!0,aspectRatio:1});var c=this.pluginInstance.parseKml(a);c&&(this.pluginInstance.getFeatures().appendChild(c),b.flyToView&&this.util.flyToObject(c,{boundsFallback:b.flyToBoundsFallback,aspectRatio:b.aspectRatio}));return c};c.prototype.util.lookAt=function(){this.pluginInstance.getView().setAbstractView(this.dom.buildLookAt.apply(null,arguments))};
c.prototype.util.getLookAt=function(a){geo.util.isUndefined(a)&&(a=this.pluginInstance.ALTITUDE_ABSOLUTE);return this.pluginInstance.getView().copyAsLookAt(a)};c.prototype.util.getCamera=function(a){geo.util.isUndefined(a)&&(a=this.pluginInstance.ALTITUDE_ABSOLUTE);return this.pluginInstance.getView().copyAsCamera(a)};c.prototype.util.flyToObject=function(a,b){b=k(b,!1,{boundsFallback:!0,aspectRatio:1});if(!a)throw Error("flyToObject was given an invalid object.");if("getAbstractView"in a&&a.getAbstractView())this.pluginInstance.getView().setAbstractView(a.getAbstractView());
else if(b.boundsFallback){var c=this.dom.computeBounds(a);c&&!c.isEmpty()&&this.view.setToBoundsView(c,{aspectRatio:b.aspectRatio})}};c.prototype.util.batchExecute=function(a,b){var c=this;google.earth.executeBatch(this.pluginInstance,function(){a.call(c,b)})};c.prototype.util.takeOverCamera=function(a){a||geo.util.isUndefined(a)?this.cameraControlOldProps_||(this.cameraControlOldProps_={flyToSpeed:this.pluginInstance.getOptions().getFlyToSpeed(),mouseNavEnabled:this.pluginInstance.getOptions().getMouseNavigationEnabled(),
navControlVis:this.pluginInstance.getNavigationControl().getVisibility()},this.pluginInstance.getOptions().setFlyToSpeed(this.pluginInstance.SPEED_TELEPORT),this.pluginInstance.getOptions().setMouseNavigationEnabled(!1),this.pluginInstance.getNavigationControl().setVisibility(this.pluginInstance.VISIBILITY_HIDE)):this.cameraControlOldProps_&&(this.pluginInstance.getOptions().setFlyToSpeed(this.cameraControlOldProps_.flyToSpeed),this.pluginInstance.getOptions().setMouseNavigationEnabled(this.cameraControlOldProps_.mouseNavEnabled),
this.pluginInstance.getNavigationControl().setVisibility(this.cameraControlOldProps_.navControlVis),delete this.cameraControlOldProps_)};c.prototype.util.encodeArray=function(a){for(var b="",c=0;c<a.length;c++){for(var d=a[c]<<1,d=0>a[c]?~d:d;32<=d;)b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(32|d&31),d>>=5;b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(d)}return b};c.prototype.util.decodeArray=function(a){for(var b=a.length,c=0,d=[];c<
b;){var e,f=0,g=0;do e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".indexOf(a.charAt(c++)),g|=(e&31)<<f,f+=5;while(32<=e);d.push(g&1?~(g>>1):g>>1)}return d};c.prototype.view={isnamespace_:!0};c.prototype.view.createBoundsView=function(a,b){b=k(b,!1,{aspectRatio:l,defaultRange:1E3,scaleRange:1.5});var c=a.center(),d=b.defaultRange,e=a.span();if(e.lat||e.lng)var e=(new geo.Point(c.lat(),a.east())).distance(new geo.Point(c.lat(),a.west())),f=(new geo.Point(a.north(),c.lng())).distance(new geo.Point(a.south(),
c.lng())),d=(45/(Math.min(Math.max(b.aspectRatio,e/f),1)+0.4)-2).toRadians(),e=Math.max(f,e),e=Math.min((90).toRadians(),d+e/(2*geo.math.EARTH_RADIUS)),d=b.scaleRange*geo.math.EARTH_RADIUS*(Math.sin(e)*Math.sqrt(1+1/Math.pow(Math.tan(d),2))-1);return this.dom.buildLookAt(new geo.Point(c.lat(),c.lng(),a.top(),a.northEastTop().altitudeMode()),{range:d})};c.prototype.view.setToBoundsView=function(){this.pluginInstance.getView().setAbstractView(this.view.createBoundsView.apply(this,arguments))};c.prototype.view.serialize=
function(){var a=this.pluginInstance.getView().copyAsCamera(this.pluginInstance.ALTITUDE_ABSOLUTE),b=a.getLatitude(),c=a.getLongitude(),d=a.getAltitude(),e=a.getHeading(),f=a.getTilt(),a=a.getRoll(),d=Math.floor(10*d);return"0"+this.util.encodeArray([Math.floor(1E5*geo.math.constrainValue(b,[-90,90])),Math.floor(1E5*geo.math.wrapValue(c,[-180,180])),Math.floor(d/1073741824),0<=d?d%1073741824:1073741824-Math.abs(d)%1073741824,Math.floor(10*geo.math.wrapValue(e,[0,360])),Math.floor(10*geo.math.wrapValue(f,
[0,180])),Math.floor(10*geo.math.wrapValue(a,[-180,180]))])};c.prototype.view.deserialize=function(a){var b,c,d,e,f;if("0"!=a.charAt(0))throw Error("Invalid serialized view string.");a=a.substr(1);f=this.util.decodeArray(a);a=geo.math.constrainValue(1E-5*f[0],[-90,90]);b=geo.math.wrapValue(1E-5*f[1],[-180,180]);c=0.1*(1073741824*f[2]+f[3]);d=geo.math.wrapValue(0.1*f[4],[0,360]);e=geo.math.wrapValue(0.1*f[5],[0,180]);f=geo.math.wrapValue(0.1*f[6],[-180,180]);var g=this.pluginInstance.createCamera("");
g.set(a,b,c,this.pluginInstance.ALTITUDE_ABSOLUTE,d,e,f);this.pluginInstance.getView().setAbstractView(g)};c.prototype.util.serializeView=c.prototype.view.serialize;c.prototype.util.deserializeView=c.prototype.view.deserialize;c.prototype.view.createVantageView=function(a,b){a=new geo.Point(a);b=new geo.Point(b);var c=a.heading(b),d=a.toCartesian(),e=b.toCartesian(),f=this.math3d.makeLocalToGlobalFrame(a),d=e.subtract(d).toUnitVector(),f=(new geo.linalg.Vector(f.elements[2])).multiply(-1),f=Math.acos(f.dot(d)).toDegrees();
return this.dom.buildCamera(a,{heading:c,tilt:f})};window.GEarthExtensions=c})();
(function(k){var g={},h,z=function(a){if(a.match(/[0-9a-fA-F]{3}$/)||a.match(/[0-9a-fA-F]{6}$/))a="#"===a.charAt(0)?a:"#"+a;else if(a.match(/^rgb\(([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5])\)$/)){var b=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],c,d=function(a){var b,c;if(2>a.length)for(b=0,c=2-a.length;b<c;b++)a="0"+a;return a};
3===b.length&&(a=d(b[0].toString(16)),c=d(b[1].toString(16)),b=d(b[2].toString(16)),a="#"+a+c+b)}else a=null;return a},v=function(a){g.control=k("<div class='color-picker'></div>");var b=function(a){a.bind({click:function(b){b=a.css("background-color");b=(b=z(b))||"transparent";g.selector.css("background-color",b);h(!0,b)},mouseover:function(b){a.css("border-color","#598FEF")},mouseout:function(b){a.css("border-color","#000")}});g.control.append(a)};k.each(k.fn.colorPicker.defaultColors,function(a){a=
k("<div class='color_swatch'>&nbsp;</div>");a.css("background-color","#"+this);b(a)});b(k("<div class='nocolor'>transparent</div>"));k("body").append(g.control);a&&(g.iframeShim=document.createElement("iframe"),g.iframeShim.frameBorder=0,g.iframeShim.scrolling="no",g.iframeShim.src="javascript:false;",g.iframeShim.style.position="absolute",g.iframeShim.style.width=g.control.width()+"px",g.iframeShim.style.height=g.control.height()+"px",k("body").append(g.iframeShim))},d=function(a){a.target!==g.control&&
k(a.target).parent()[0]!==g.control[0]&&h()};h=function(a,b){g.control.stop(!0);a?g.control.slideUp("slow",function(){g.control.css("height","")}):(g.control.hide(),g.control.css("height",""));k("body").unbind("mousedown",d);g.iframeShim&&(g.iframeShim.style.zIndex=-500);g.callback&&(g.callback(b),delete g.callback)};k.fn.colorPicker=function(a,b,c){var f=this;return this.css("background-color",a).bind("mouseover",function(a){f.css("border-color","#598FEF")}).bind("mouseout",function(a){f.css("border-color",
"#000")}).click(function(){g.selector=f;g.control||v(c);h();var a=f.offset(),l=Math.max(0,a.top-g.control.height()),t=k(window),a=Math.max(0,a.left),l=Math.min(l,t.height()-g.control.height()),a=Math.min(a,t.width()-g.control.width());g.control.css({left:a+"px",top:l+"px"});g.iframeShim&&(g.iframeShim.style.left=a+"px",g.iframeShim.style.top=l+"px",g.iframeShim.style.zIndex=g.control.css("z-index")-1);g.control.slideDown("slow");g.callback=b;k("body").bind("mousedown",d)})};k.fn.colorPicker.hide=
function(a){h(a)};k.fn.colorPicker.defaultColors="000000 993300 333300 000080 333399 333333 800000 FF6600 808000 008000 008080 0000FF 666699 808080 FF0000 FF9900 99CC00 339966 33CCCC 3366FF 800080 999999 FF00FF FFCC00 FFFF00 00FF00 00FFFF 00CCFF 993366 C0C0C0 FF99CC FFCC99 FFFF99 CCFFFF 99CCFF FFFFFF 15428B DFE8F6".split(" ")})(jQuery);util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.featureEditor=function(){function k(c){var f=$('<div id="marker-icons">').appendTo(c),e,g,h=function(a){return function(b){d.iconUrl=a;$("#characteristicsButton",c.parent()).attr("src",d.iconUrl);$(".marker-icon",f).removeClass("selected");$(this).addClass("selected")}};for(e=0;e<b.length;e++)g=[32*-(e%a),32*-Math.floor(e/a)],$('<a class="marker-icon" tabindex="1"></a>').css("background-position",g[0]+"px "+g[1]+"px").appendTo(f).click(h(b[e]))}function g(a){var b=$('<div><label>line color <input id="strokeColor" type="text"></label><label>line width (pixels) <input id="strokeWeight" type="text"></label><label>line opacity <input id="strokeOpacity" type="text"></label></div>').appendTo(a);
$("#strokeColor",b).colorPicker(d.strokeColor,function(b){d.strokeColor=b;$("#mask",a.parent()).css({"background-color":"line"===d.type?d.strokeColor:d.fillColor,"border-color":d.strokeColor})},v);$("#strokeWeight",b).val(d.strokeWeight).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(d.strokeWeight=a)});$("#strokeOpacity",b).val(Math.floor(100*d.strokeOpacity)).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(a=Math.max(0,Math.min(100,a))/100,d.strokeOpacity=a)})}function h(a){var b=
$('<div><label>fill color <input id="fillColor" type="text"></label><label>fill opacity <input id="fillOpacity" type="text"></label></div>').appendTo(a);$("#fillColor",b).colorPicker(d.fillColor,function(b){d.fillColor=b;$("#mask",a.parent()).css({"background-color":"line"===d.type?d.strokeColor:d.fillColor})},v);$("#fillOpacity",b).val(Math.floor(100*d.fillOpacity)).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(a=Math.max(0,Math.min(100,a))/100,d.fillOpacity=a)})}function z(a,b){var d=
$('<div id="characteristics""><div id="back">back</div></div>').appendTo(b);switch(a){case "marker":k(d);break;case "line":g(d);break;case "shape":g(d),h(d)}return d}var v,d,a=7,b=function(){var a=[],b=["-circle.png","-blank.png","-pushpin.png"],d="blu red grn ltblu ylw purple pink".split(" "),g="dining coffee bars snack_bar tram lodging wheel_chair_accessible shopping movies convenience grocery arts homegardenbusiness electronics mechanic partly_cloudy realestate salon dollar parking_lot gas_stations cabs bus truck rail airports ferry heliport subway info flag earthquake webcam post_office police firedept hospitals info_circle phone caution falling_rocks camera parks campfire picnic campground ranger_station toilets poi hiker cycling motorcycling horsebackriding play golf trail water snowflake_simple marina fishing sailing swimming ski woman man rainy volcano sunny euro yen".split(" "),
h,k,r;for(h=0;h<b.length;h++)for(k=0;k<d.length;k++)r=d[k],a.push([jc2cui.mapWidget.getAppPath(),"images/",r,b[h]].join(""));for(h=0;h<g.length;h++)a.push([jc2cui.mapWidget.getAppPath(),"images/",g[h],".png"].join(""));return a}();return{useShim:function(a){v=a},getEditFeatureHtml:function(a,b){d=a;var e=$(['<div class="editFeature"><div id="outer"><div id="basic"><div class="bold top">Title <input id="title" type="text" id="title" /><div id="mask"><img id="characteristicsButton" src="',d.iconUrl,
'" title="Click to set ',d.type,' characteristics"></div></div><div class="bold section">Description</div><textarea id="description"></textarea></div></div><div class="buttons"><span id="delete" class="button">delete</span><span id="cancel" class="button">cancel</span><span id="ok" class="button">ok</span></div></div>'].join("")),g,h;$("#title",e).val(d.title||"");$("#description",e).val(d.description||"");$("#characteristicsButton",e).click(function(){g||(g=$("#basic",e));h||(h=z(d.type,$("#outer",
e)));$("#back",h).click(function(){h.hide();g.show()});g.hide();h.show()});$("#mask",e).css({"background-color":"marker"===d.type?"transparent":"line"===d.type?d.strokeColor:d.fillColor,"border-color":"marker"===d.type?"transparent":d.strokeColor});$("#delete",e).click(function(){b&&b.deleted&&b.deleted()});$("#ok",e).click(function(){b&&b.updated&&(d.title=$("#title",e).val(),d.description=$("#description",e).val(),b.updated(d))});$("#cancel",e).click(function(){b&&b.canceled&&b.canceled()});return e[0]}}}();
var OWF;function googleLoaded(){jc2cui.mapWidget.renderer.googleReady()}function earthLoaded(){jc2cui.mapWidget.renderer.earthReady()}util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.renderer=function(){function k(a){var b=ra[a];2<b&&(a+=--b);return a}function g(a,b){return(b||ba).getElementById(k(a))}function h(a,b,c){var d=a,e,f,k=!0;f=c?h(c):ba;e=g(d,f);if(!e){for(;Aa[d];)e=ra[a]||1,1<e&&(d+=e.toString(10)),e++,ra[a]=e;X[d]=a;Aa[d]=!0;e=n.createFolder(d);e.setName(b||a);c&&(k=ia[c]);k||e.setVisibility(!1);ia[a]=k;f.getFeatures().appendChild(e)}return e}function z(a){var b=a.replace(/^(..)(..)(..)(..)$/,"#$4$3$2");return b===a?"transparent":b}function v(a){var b=
a.replace(/^(..)(..)(..)(..)$/,"$1");return b===a?1:parseInt(b,16)/255}function d(a){for(;a&&"GEGlobe"!==a.getType();){if(!a.getVisibility())return!1;a=a.getParentNode()}return!0}function a(a){var b={title:a.title,description:a.description,type:a.type},c,e;c=a.earthObject.getStyleSelector()||n.createStyle("");if("marker"===a.type)b.iconUrl=c.getIconStyle().getIcon().getHref();else{b.iconUrl=jc2cui.mapWidget.getAppPath()+("line"===a.type?"images/lineMask.png":"images/polyMask.png");if(e=c.getLineStyle())b.strokeWeight=
e.getWidth(),b.strokeColor=z(e.getColor().get()),b.strokeOpacity=v(e.getColor().get());"shape"===a.type&&(e=c.getPolyStyle())&&(b.fillColor=z(e.getColor().get()),b.fillOpacity=v(e.getColor().get()))}b=jc2cui.mapWidget.featureEditor.getEditFeatureHtml(b,{deleted:function(){ca(a,!1);delete P[a.id];jc2cui.mapWidget.deleteDrawing(a.id);n.setBalloon(null)},updated:function(b){a.title=b.title;a.description=b.description;a.earthObject.setName(a.title);a.earthObject.setDescription(a.description);if("marker"===
a.type)a.earthObject.setStyleSelector(B.dom.buildStyle({icon:{href:b.iconUrl,hotSpot:ja.icon.hotSpot}}));else{var c=a.earthObject.getStyleSelector();c||(c=n.createStyle(""),a.earthObject.setStyleSelector(c));c.getLineStyle().getColor().set(B.util.parseColor(b.strokeColor,b.strokeOpacity));c.getLineStyle().setWidth(b.strokeWeight);"shape"===a.type&&c.getPolyStyle().getColor().set(B.util.parseColor(b.fillColor,b.fillOpacity))}n.setBalloon(null);setTimeout(function(){jc2cui.mapWidget.publishDrawing(a.earthObject.getKml(),
a.id,a.title,d(a.earthObject))},1)},canceled:function(){n.setBalloon(null)}});c=n.createHtmlDivBalloon("");c.setFeature(a.earthObject);c.setContentDiv(b);c.setMinHeight(224);c.setMinWidth(256);c.setMaxWidth(256);n.setBalloon(c)}function b(){var b=y.featureFolder,c;b&&(b.setVisibility(!0),(b=b.getParentNode())&&b.setVisibility(!0));jc2cui.mapWidget.publishDrawing(y.earthObject.getKml(),y.id,y.title,d(y.earthObject));ca(y,!0);c=P[y.id]=y;window.setTimeout(function(){a(c)},1E3);y=null;da("hand")}function c(a,
b,c,d,e){var f=function(f,g,h){var k=n.createIcon(""),M=n.createScreenOverlay("");k.setHref(jc2cui.mapWidget.getAppPath()+"images/"+a+f+".png");M.setDrawOrder(g||0);M.setVisibility(h||!1);M.setIcon(k);M.getOverlayXY().set(b,n.UNITS_PIXELS,c,n.UNITS_INSET_PIXELS);M.getScreenXY().set(0,n.UNITS_FRACTION,1,n.UNITS_FRACTION);M.getSize().set(d,n.UNITS_PIXELS,e,n.UNITS_PIXELS);n.getFeatures().appendChild(M);return M},g=f("u",1,!0),h=f("d",2,!1),k=!1;return{isMouseOnButton:function(a,s){return b<=a&&a<=b+
d&&c<=s&&s<=c+e},getVisibility:function(){return g.getVisibility()},setVisibility:function(a){g.setVisibility(a);h.setVisibility(a?k:!1)},setSelected:function(a){k=a;h.setVisibility(k)}}}function f(a){a?(E?(E.setVisibility(!0),Q.setVisibility(!0),R.setVisibility(!0),S.setVisibility(!0)):(E=c("Bs",100,10,31,31),Q=c("Bm",131,10,31,31),R=c("Bl",162,10,31,31),S=c("Bp",193,10,31,31)),da("hand")):(da("hand"),E.setVisibility(!1),Q.setVisibility(!1),R.setVisibility(!1),S.setVisibility(!1));$.each(P,function(b,
c){ca(c,a)})}function e(){var a=n.getView();return{lookAt:a.copyAsLookAt(n.ALTITUDE_RELATIVE_TO_GROUND),bounds:a.getViewportGlobeBounds(),camera:a.copyAsCamera(n.ALTITUDE_RELATIVE_TO_GROUND)}}function l(){u||(u=e());return jc2cui.mapWidget.createViewStatus(u.bounds.getSouth(),u.bounds.getWest(),u.bounds.getNorth(),u.bounds.getEast(),u.lookAt.getLatitude(),u.lookAt.getLongitude(),u.lookAt.getRange())}function t(a){for(var b=a.getParentNode(),c,d;"GEGlobe"!==b.getType();){c=b;d=c.getId();if(X[d])break;
b=b.getParentNode()}if(c&&(b=X[c.getId()],b=b.substr(3),c=c.getParentNode()))return{selectedId:a.getId()||"",selectedName:a.getName()||"",featureId:b,overlayId:X[c.getId()]}}function q(a,b,c){return b>=a.south-1E-6&&b<=a.north+1E-6&&c>=a.west-1E-6&&c<=a.east+1E-6}function r(a,b,c,d){var e=a.toRadians(),f=c.toRadians();a=(c-a).toRadians();b=(d-b).toRadians();e=Math.pow(Math.sin(a/2),2)+Math.cos(e)*Math.cos(f)*Math.pow(Math.sin(b/2),2);return 2*geo.math.EARTH_RADIUS*Math.atan2(Math.sqrt(e),Math.sqrt(1-
e))}function p(){var a=H.width()/2,b=H.height()/2,c=n.getView(),d=c.hitTest(a-15,n.UNITS_PIXELS,b,n.UNITS_PIXELS,n.HIT_TEST_GLOBE),a=c.hitTest(a+15,n.UNITS_PIXELS,b,n.UNITS_PIXELS,n.HIT_TEST_GLOBE);return d&&a?r(d.getLatitude(),d.getLongitude(),a.getLatitude(),a.getLongitude())/30:(console.log("Unable to determine scale"),0)}function L(a,b){if(!a)return!1;var c,d;if(!(q(b,a.south,a.west)||q(b,a.north,a.west)||q(b,a.north,a.east)||q(b,a.south,a.east)||q(a,b.south,b.west)||q(a,b.north,b.west)||q(a,
b.north,b.east)||q(a,b.south,b.east)))return!1;c=r(a.south,a.west,a.south,a.east);d=r(a.south,a.west,a.north,a.west);c=Math.round(Math.sqrt(c/ta*(d/ta))).toFixed(0);return a.lod&&(c<a.lod.minLodPixels||0<=a.lod.maxLodPixels&&c>a.lod.maxLodPixels)?!1:!0}function x(a){var b,c,d;if(n&&n.getBalloon()&&n.getBalloon().getFeature())if(c=n.getBalloon().getFeature(),c===a)n.setBalloon(null);else{for(b=n.getBalloon().getFeature().getParentNode();b&&"GEGlobe"!==b.getType();){if(b===a){n.setBalloon(null);break}b=
b.getParentNode()}if(n.getBalloon()&&c&&(a=a.getElementsByType("KmlLink"))&&(c=c.getUrl(),b=c.lastIndexOf("#"),c=c.slice(0,b),-1!==b))for(b=0;b<a.getLength();b++)if(d=a.item(b).getHref(),d===c){n.setBalloon(null);break}}}function F(a,b){var c;if(a&&b&&(b.push(a),a.children))for(c=0;c<a.children.length;++c)F(a.children[c],b)}function m(a,b,c){var d;b.push(a);c||(c=g(a));if(c)for(c=c.getElementsByType("KmlFolder"),a=0;a<c.getLength();a++)d=c.item(a).getId(),d.length&&(X[d]&&(d=X[d]),b.push(d))}function J(a){var b=
a.getHref()||"";if((a=a.getViewFormat())&&a.length){b=0>b.indexOf("?")?b+"?":b+"&";u||(u=e());a=a.replace("[bboxWest]",u.bounds.getWest());a=a.replace("[bboxSouth]",u.bounds.getSouth());a=a.replace("[bboxEast]",u.bounds.getEast());a=a.replace("[bboxNorth]",u.bounds.getNorth());a=a.replace("[lookatLon]",u.lookAt.getLongitude());a=a.replace("[lookatLat]",u.lookAt.getLatitude());a=a.replace("[lookatRange]",u.lookAt.getRange());a=a.replace("[lookatTilt]",u.lookAt.getTilt());a=a.replace("[lookatHeading]",
u.lookAt.getHeading());a=a.replace("[lookatTerrainLon]",u.lookAt.getLongitude());a=a.replace("[lookatTerrainLat]",u.lookAt.getLatitude());a=a.replace("[lookatTerrainAlt]",u.lookAt.getAltitude());a=a.replace("[cameraLon]",u.camera.getLongitude());a=a.replace("[cameraLat]",u.camera.getLatitude());a=a.replace("[cameraAlt]",u.camera.getAltitude());a=a.replace("[horizFov]",60);a=a.replace("[vertFov]",60);a=a.replace("[horizPixels]",H.width());a=a.replace("[vertPixels]",H.height());var c=n.getLayerRoot().getLayerById(n.LAYER_TERRAIN);
a=a.replace("[terrainEnabled]",c&&c.getVisibility()?"1":"0");b+=a}return b}function oa(a,b){var c,d,e,f;if("KmlFolder"===a.getType()||"KmlDocument"===a.getType()||"KmlNetworkLink"===a.getType())for(f=a.getFeatures().getChildNodes(),b.idMap={},b.nameMap={},d=0;d<f.getLength();d++)e=f.item(d),c={select:e.getVisibility()&&b.select,expand:e.getOpen()},e.getId()&&0<e.getId().length?b.idMap[e.getId()]=c:e.getName()&&0<e.getName().length?b.nameMap[e.getName()]=c:c=b,oa(e,c)}function xa(a,b,c){c=a.getId()||
c+"_"+jc2cui.mapWidget.getNewId();var d=a.getName(),e=a.getType(),d={name:d,id:c,type:e,visibility:!1,children:[],mapObject:a};b.children.push(d);A.idMap[c]=d;if("KmlFolder"===e)for(a=a.getFeatures(),a=a.getChildNodes(),b=a.getLength(),e=0;e<b;++e)xa(a.item(e),d,c)}function Ia(a){OWF.Preferences.getUserPreference({namespace:"jc2cui.mapWidget",name:"defaultLayers",onSuccess:function(b){var c;b&&b.value&&(c=JSON.parse(b.value));a(c)},onFailure:function(b,c){void 0!==c&&"undefined : undefined"!==b?jc2cui.mapWidget.showError("Got an error getting preferences! Status Code: "+
c+" . Error message: "+b):a()}})}function Ja(){clearTimeout(Ba);Ba=setTimeout(function(){var a={};$.each(A.idMap,function(b,c){c.visibility&&(a[c.id]=!0)});OWF.Preferences.setUserPreference({namespace:"jc2cui.mapWidget",name:"defaultLayers",value:JSON.stringify(a),onFailure:function(a,b){jc2cui.mapWidget.showError("Error updating preferences. Status Code: "+b+" . Error message: "+a)}})},100)}function G(a,b,c){var d;if("KmlDocument"===a.type)a.mapObject.setVisibility(b);else if("KmlNetworkLink"===
a.type){if(b&&(d=a.mapObject.getLink(),d=d.getHref(),!a.loading)){a.loading=!0;try{google.earth.fetchKml(n,d,function(b){b&&(n.getFeatures().appendChild(b),b.setVisibility(a.visibility),a.mapObject=b,a.type=b.getType(),a.name!==b.getName()&&console.log("need to rename "+a.name+" to "+b.getName()));a.loading=!1})}catch(e){a.loading=!1,console.log("Failed to load kml from "+d+": "+e)}}}else n.getLayerRoot().enableLayerById(a.id,b);a.visibility=b;for(d=0;d<a.children.length;d++)G(a.children[d],b,c);
c||Ja()}function C(a){a=a||ba;var b="KmlDocument KmlFolder KmlNetworkLink KmlGroundOverlay KmlScreenOverlay KmlPlacemark".split(" "),c,d=0;google.earth.executeBatch(n,function(){for(c=0;c<b.length;c++)d+=a.getElementsByType(b[c]).getLength()});return d}function pa(a,b,c){if(void 0!==Y)c(Y);else if(ua)setTimeout(function(){pa(a,b,c)},1E3);else{ua=!0;"function"===typeof a&&(a=a());var d=$("<div>"+a+'<br><br><div><input type="checkbox" id="global">Dont show again, apply to all overlays<br></div>');jc2cui.mapWidget.showDialog(d,
b,220,300,{Yes:function(){d.dialog("close");c(!0,$("#global",d).is(":checked"))},No:function(){d.dialog("close");c(!1,$("#global",d).is(":checked"))}},function(){ua=!1})}}function aa(a,b,c){var d=function(){google.earth.fetchKml(n,a,function(a){if(ea&&!Z[c]&&!Y){var d=C(),s=C(a)||1;if(d+s>ea){pa(function(){var a=["Overlay contains approximately "];a.push(s);a.push(" entities. There are currently approximately ");a.push(d);a.push(" entities already loaded. ");a.push("Loading the additional entities may cause the browser to become unresponsive. Continue loading anyway?");
return a.join("")},"Warning - Large Number Of Entities",function(d,s){s&&(Y=d);Z[c]=d;b(d?a:void 0)});return}}b(a)})},e;if(ea&&(!Z[c]&&!Y)&&(e=C(),e>ea)){pa(function(){var a=["There are currently approximately "];a.push(e);a.push(" entities already loaded. ");a.push("Loading additional entities may cause the browser to become unresponsive. Continue loading anyway?");return a.join("")},"Warning - Large Number Of Entities",function(a,s){s&&(Y=a);(Z[c]=a)?d():b()});return}d()}function qa(){try{google.earth.createInstance("map",
function(b){var c,s;n=b;n.getOptions().setScaleLegendVisibility(!0);B=new GEarthExtensions(n);b=n.getNavigationControl();b.setVisibility(n.VISIBILITY_AUTO);b.getScreenXY().setXUnits(n.UNITS_PIXELS);b.getScreenXY().setYUnits(n.UNITS_INSET_PIXELS);n.getWindow().setVisibility(!0);google.earth.addEventListener(n.getWindow(),"mousedown",function(a){var b=a.getTarget(),c,d,s;if("KmlPlacemark"===b.getType())c=t(b),setTimeout(function(){jc2cui.mapWidget.itemSelected(c)},1E3);else if(0===a.getButton()&&(E&&
E.getVisibility())&&(d=a.getClientX(),s=a.getClientY(),(b=E.isMouseOnButton(d,s)?"hand":null)||(b=Q.isMouseOnButton(d,s)?"marker":null),b||(b=R.isMouseOnButton(d,s)?"line":null),b||(b=S.isMouseOnButton(d,s)?"shape":null),b))return da(b),a.preventDefault(),a.stopPropagation(),!1});google.earth.addEventListener(n.getWindow(),"click",function(b){var c=!1,d=b.getTarget(),s;if(b.getDidHitGlobe()){0===b.getButton()&&(E&&E.getVisibility())&&(c=b.getClientX(),s=b.getClientY(),c=E.isMouseOnButton(c,s)||Q.isMouseOnButton(c,
s)||R.isMouseOnButton(c,s)||S.isMouseOnButton(c,s));if(c){b.preventDefault();return}jc2cui.mapWidget.mapClicked(b.getLatitude(),b.getLongitude(),1,b.getButton(),b.getShiftKey(),b.getCtrlKey(),b.getAltKey())}y||"KmlPlacemark"!==d.getType()||(P[d.getId()]&&P[d.getId()].editable?(b.preventDefault(),a(d)):(c=d.getBalloonHtmlUnsafe(),c.length&&(b.preventDefault(),b=n.createHtmlDivBalloon(""),s=document.createElement("DIV"),b.setFeature(d),b.setContentDiv(s),n.setBalloon(b),$(s).css("font-size","0.75em").append($.parseHTML(c,
!0)).find("script").each(function(){$.globalEval(this.text||this.textContent||this.innerHTML||"")}))))});google.earth.addEventListener(n.getWindow(),"dblclick",function(a){var b=!1,c;a.getDidHitGlobe()&&(0===a.getButton()&&(E&&E.getVisibility())&&(b=a.getClientX(),c=a.getClientY(),b=E.isMouseOnButton(b,c)||Q.isMouseOnButton(b,c)||R.isMouseOnButton(b,c)||S.isMouseOnButton(b,c)),b?a.preventDefault():jc2cui.mapWidget.mapClicked(a.getLatitude(),a.getLongitude(),2,a.getButton()))});google.earth.addEventListener(n.getView(),
"viewchangeend",function(a){clearTimeout(Ca);Ca=setTimeout(function(){var a,b,c=e();u&&u.bounds.getSouth()===c.bounds.getSouth()&&u.bounds.getWest()===c.bounds.getWest()&&u.bounds.getNorth()===c.bounds.getNorth()&&u.bounds.getEast()===c.bounds.getEast()&&u.lookAt.getLatitude()===c.lookAt.getLatitude()&&u.lookAt.getLongitude()===c.lookAt.getLongitude()&&u.lookAt.getRange()===c.lookAt.getRange()||(u=c,ta=p(),jc2cui.mapWidget.publishView(l()),b={north:c.bounds.getNorth(),south:c.bounds.getSouth(),east:c.bounds.getEast(),
west:c.bounds.getWest()},$.each(w,function(c,s){$.each(s,function(c,s){$.each(s,function(c,s){var e=[];F(s,e);$.each(e,function(c,s){if(s.loaded)return!0;s.kmlObject&&s.link&&((a=s.link.getViewRefreshMode()===n.VIEW_REFRESH_ON_STOP)&&x(s.kmlObject),!s.loaded&&L(s.region,b)||a&&1>=s.link.getViewRefreshTime()?(s.region&&(s.loaded=!0),aa(J(s.link),fa(s.kmlObject,s.overlayId,s.featureId,s.hierarchy.slice(0),s.link),s.featureId)):a&&1<s.link.getViewRefreshTime()&&setTimeout(function(){var a={};s.kmlObject.getRefreshVisibility()||
(a.select=d(s.kmlObject),oa(s.kmlObject,a));aa(J(s.link),fa(s.kmlObject,s.overlayId,s.featureId,s.hierarchy.slice(0),s.link,!1,a),s.featureId)},1E3*(s.link.getViewRefreshTime()-1)))})})})}))},1E3)});b=document.location.href;b=b.substring(0,b.lastIndexOf("/")+1);$('<link rel="stylesheet" type="text/css" href="'+(b+"css/google.earth.all.min.css")+'" >').appendTo("head");n.getOptions().setStatusBarVisibility(!0);jc2cui.mapWidget.featureEditor.useShim(!0);ba=n.createFolder("api_root");n.getFeatures().appendChild(ba);
b=n.getLayerRoot().getFeatures().getChildNodes();if(c=b.getLength()){A.layers.push({id:"defaultLayers",name:"Map Layers",children:[]});for(s=0;s<c;s++)xa(b.item(s),A.layers[0],"root");for(s=0;s<A.layers[0].children.length;s++)G(A.layers[0].children[s],!1,!0);Ia(function(a){a?$.each(a,function(a,b){G(A.idMap[a],!0,!0)}):A.idMap[n.LAYER_TERRAIN]?G(A.idMap[n.LAYER_TERRAIN],!0):A.idMap.imagery&&G(A.idMap.imagery,!0);jc2cui.mapWidget.rendererReady(A.layers)})}else jc2cui.mapWidget.rendererReady();console.log("Plugin version "+
n.getPluginVersion());console.log("API version "+n.getApiVersion())},function(a){jc2cui.mapWidget.showError("Failed to create Google Earth instance. Error Code: "+a)},D.earthApiUrl?{database:D.earthApiUrl.database}:{})}catch(b){jc2cui.mapWidget.showError("Failed to create Google Earth instance. Error: "+b)}}function Ka(){google.load("earth","1",{callback:function(){qa()}})}function ya(a){a.setVisibility(!0);if("KmlFolder"===a.getType()||"KmlDocument"===a.getType()||"KmlNetworkLink"===a.getType()){a=
a.getFeatures().getChildNodes();var b;for(b=0;b<a.getLength();b++)ya(a.item(b))}}function O(a,b){var c=a.getFeatures().getChildNodes(),d,e;for(d=0;d<c.getLength();d++)e=c.item(d),e!==b&&e.setVisibility(!1);a.setVisibility(!0)}function W(a,b){google.earth.executeBatch(n,function(){if(b){if(ya(a),b){for(var c=a.getParentNode(),d=[],e=-1;c&&"GEGlobe"!==c.getType();)c.getVisibility()||(e=d.length),d.push(c),c=c.getParentNode();if(-1<e)for(c=0;c<=e;c++)O(d[c],0<c?d[c-1]:a)}}else a.setVisibility(!1)})}
function La(a){return"onChange"===a?n.REFRESH_ON_CHANGE:"onInterval"===a?n.REFRESH_ON_INTERVAL:"onExpire"===a?n.REFRESH_ON_EXPIRE:n.REFRESH_ON_CHANGE}function Ma(a){return"never"===a?n.VIEW_REFRESH_NEVER:"onStop"===a?n.VIEW_REFRESH_ON_STOP:"onRequest"===a?n.VIEW_REFRESH_ON_REQUEST:"onRegion"===a?n.VIEW_REFRESH_ON_REGION:n.VIEW_REFRESH_NEVER}function za(a,b){var c;c=a;c=/(ftp|http|https):/.test(c)?!0:0===c.indexOf("\\")?!0:!1;!c&&b&&(c=b.lastIndexOf("/"),-1===c&&(c=b.lastIndexOf("\\")),c=b.substring(0,
c+1),a=c+a);return a}function va(a){var b="",c;if(a)if(2===a.nodeType||3===a.nodeType||4===a.nodeType)b=a.nodeValue;else if(1===a.nodeType||9===a.nodeType||11===a.nodeType)for(c=0;c<a.childNodes.length;++c)b+=va(a.childNodes[c]);return $.trim(b)}function N(a,b){if(a){var c=a.getElementsByTagName(b);if(c.length)return va(c[0])}return""}function ka(a,b){var c;b||clearInterval(a.timer);if(a.children)for(c=0;c<a.children.length;++c)ka(a.children[c],!1)}function Da(a,b,c){var d;if(a.kmlObject===b)return ka(a,
c),!0;if(!a.children)return!1;for(d=0;d<a.children.length;++d)if(Da(a.children[d],b,c)){c?delete a.children[d].children:a.children.splice(d,1);break}return!1}function Ea(a,b,c,d){var e,f;for(e=0;e<w[b][c].length;++e)if(f=w[b][c][e],Da(f,a,d))return d?delete f.children:w[b][c].splice(e,1),!0;return!1}function la(a,b,c){var d,e;if("KmlNetworkLink"!==a.getType()||!Ea(a,b,c,!1))if("KmlFolder"===a.getType()||"KmlDocument"===a.getType()||"KmlNetworkLink"===a.getType())for(a=a.getFeatures().getChildNodes(),
e=0;e<a.getLength();e++)d=a.item(e),la(d,b,c)}function Fa(a,b,c,d){var e,f;if(a===b.kmlObject)return b;if(!b.children)return null;for(e=0;e<b.children.length;++e)if(f=Fa(a,b.children[e],c,d),null!==f)return f;return null}function Ga(a,b,c){var d;if(a.kmlObject===c)return a.children||(a.children=[]),a.children.push(b),!0;if(!a.children)return!1;for(d=0;d<a.children.length;++d)if(Ga(a.children[d],b,c))return!0;return!1}function Na(a){/[A-Za-z]/.test(a)||(a="a"+a);return a=a.replace(/[^\-A-Za-z0-9_:.]/g,
"_")}function ma(a,b,c,e,f,g){var h,k,l,m=I[c]||{},p=m[e]||{},r=!0,q,t,u,v=!1;t=g;w[c]=w[c]||{};w[c][e]=w[c][e]||[];T[c]=T[c]||0;if("KmlDocument"!==a.getType()||a.getName()&&0<a.getName().length){l={title:a.getName()||"[no name]",key:Na(c+T[c])};switch(a.getType()){case "KmlDocument":case "KmlFolder":case "KmlNetworkLink":l.tooltip="click to zoom to",l.isFolder=!0}g&&(a.getId()&&0<a.getId().length?g.idMap&&g.idMap[a.getId()]&&(t=g.idMap[a.getId()]):a.getName()&&0<a.getName().length&&g.nameMap&&g.nameMap[a.getName()]&&
(t=g.nameMap[a.getName()]),t!==g&&(l.select=t.select,l.expand=t.expand,l.select!==(a.getVisibility()&&b.select)&&W(a,l.select),l.expand!==a.getOpen()&&a.setOpen(l.expand)));void 0===l.select&&(l.select=a.getVisibility()&&b.select);if("KmlFolder"===a.getType()||"KmlDocument"===a.getType()||"KmlNetworkLink"===a.getType())void 0===l.expand&&(l.expand=a.getOpen()?!0:!1),f.push(l.key);p[l.key]=a;T[c]++;m[e]=p;I[c]=m;b.children||(b.children=[]);b.children.push(l)}else l=b;if("KmlFolder"===a.getType()||
"KmlDocument"===a.getType())for(a=a.getFeatures().getChildNodes(),h=0;h<a.getLength();h++)k=a.item(h),ma(k,l,c,e,f.slice(0),t);else if("KmlNetworkLink"===a.getType()){fa=function(a,b,c,e,s,f,g){var h;return function(sa){var k,ha,l,m,K;try{if(w[b]&&w[b][c])if(sa){Ea(a,b,c,!0);for(m=0;m<w[b][c].length&&!(K=Fa(a,w[b][c][m],b,c));++m);if(K)if(K.hierarchy.length!==e.length)console.log("Mismatched hierarchy length! Not loading !!!");else{for(m=0;m<K.hierarchy.length;++m)if(K.hierarchy[m]!==e[m]){console.log("Mismatched hierarchies! Not loading !!!");
return}ha=a.getFeatures().getChildNodes();ha.getLength()&&(x(ha.item(0)),a.getFeatures().removeChild(ha.item(0)));a.getFeatures().appendChild(sa);k={title:a.getName()||"[no name]",select:d(a),expand:a.getOpen()?!0:!1,isFolder:!0,key:e[e.length-1],tooltip:"click to zoom to"};ma(sa,k,b,c,e.slice(0),g);jc2cui.mapWidget.addTreeItems(k,b,c,e[e.length-1]);h=function(a,b,c,e,s){return function(){var f={};w[c]&&w[c][e]&&(b.getRefreshVisibility()||(f.select=d(b),oa(b,f)),aa(J(a),fa(b,c,e,s.slice(0),a,!0,f),
e))}};!f&&(s&&s.getRefreshMode()===n.REFRESH_ON_INTERVAL&&0<s.getRefreshInterval())&&(K&&w[b]&&w[b][c])&&(l=setInterval(h(s,a,b,c,e.slice(0)),1E3*s.getRefreshInterval()),K.timer=l)}}else console.log("In else. Failed to create KML object."),k={title:(a.getName()||"[no name]")+" - LOAD FAILED",select:d(a),expand:a.getOpen()?!0:!1,isFolder:!0,key:e[e.length-1]},jc2cui.mapWidget.addTreeItems(k,b,c,e[e.length-1]);else console.log("In else. Overlay or feature no longer loaded...")}catch(p){console.log("In catch. Failed to create KML object: "+
p),k={title:(a.getName()||"[no name]")+" - LOAD FAILED",select:d(a),expand:a.getOpen()?!0:!1,isFolder:!0,key:e[e.length-1]},jc2cui.mapWidget.addTreeItems(k,b,c,e[e.length-1])}}};if(t=a.getRegion())if(b=t.getLatLonAltBox())if(h={north:b.getNorth(),south:b.getSouth(),east:b.getEast(),west:b.getWest(),minAltitude:b.getMinAltitude(),altitudeMode:b.getAltitudeMode()},b=t.getLod())h.lod={minLodPixels:b.getMinLodPixels(),maxLodPixels:b.getMaxLodPixels()};if(a.getLink())k=B.dom.buildLink({href:za(a.getLink().getHref(),
a.getUrl()),refreshMode:a.getLink().getRefreshMode(),refreshInterval:a.getLink().getRefreshInterval(),viewRefreshMode:a.getLink().getViewRefreshMode(),viewBoundScale:a.getLink().getViewBoundScale()}),k.setViewRefreshTime(a.getLink().getViewRefreshTime()),k.setViewFormat(a.getLink().getViewFormat()),h&&(q||(q=n.getView().getViewportGlobeBounds())&&(u={north:q.getNorth(),south:q.getSouth(),east:q.getEast(),west:q.getWest()}),L(h,u)||(r=!1)),a.setLink(null);else if(q=a.getKml(),q=$.parseXML(q),q=q.getElementsByTagName("Url"),
q.length&&(q=q[0]))if(k=B.dom.buildLink({href:za(N(q,"href"),a.getUrl()),refreshMode:La(N(q,"refreshMode")),viewRefreshMode:Ma(N(q,"viewRefreshMode"))}),isNaN(parseFloat(N(q,"refreshInterval")))?k.setRefreshInterval(4):k.setRefreshInterval(parseFloat(N(q,"refreshInterval"))),isNaN(parseFloat(N(q,"viewRefreshTime")))?k.setViewRefreshTime(4):k.setViewRefreshTime(parseFloat(N(q,"viewRefreshTime"))),k.setViewFormat(N(q,"viewFormat")),h&&(q=n.getView().getViewportGlobeBounds(),u={north:q.getNorth(),south:q.getSouth(),
east:q.getEast(),west:q.getWest()},L(h,u)||(r=!1)),q=B.dom.buildNetworkLink({name:a.getName(),visibility:d(a),description:a.getDescription(),link:null,flyToView:a.getFlyToView(),refreshVisibility:a.getRefreshVisibility(),id:a.getId()}),q.setRegion(t),q.setOpen(a.getOpen()),t=a.getParentNode())t.getFeatures().removeChild(a),t.getFeatures().appendChild(q),a=q,p[l.key]=a,m[e]=p,I[c]=m;if(k){k.getViewRefreshMode()!==n.VIEW_REFRESH_ON_STOP||k.getViewFormat()&&k.getViewFormat().length||k.setViewFormat("BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]");
k.getViewRefreshMode()===n.VIEW_REFRESH_ON_REQUEST&&(k.setViewRefreshMode(n.VIEW_REFRESH_ON_STOP),k.setViewRefreshTime(4));l={kmlObject:a,link:k,hierarchy:f.slice(0),overlayId:c,featureId:e,region:h};r&&h&&(l.loaded=!0);for(m=a.getParentNode();m&&"GEGlobe"!==m.getType();){for(h=0;h<w[c][e].length;++h)if(Ga(w[c][e][h],l,m)){v=!0;break}if(v)break;m=m.getParentNode()}v||w[c][e].push(l);r&&aa(J(k),fa(a,c,e,f.slice(0),k),e)}}}function U(a,b){var c,d,e,f,g,h,k,l,n;if("KmlFolder"===a.getType()||"KmlDocument"===
a.getType()||"KmlNetworkLink"===a.getType())for(c=a.getFeatures().getChildNodes(),d=0;d<c.getLength();d++)e=c.item(d),U(e,b);else if("KmlGroundOverlay"===a.getType()){if(c=a.getLatLonBox())n=a.getAltitude(),b.extend(new geo.Point(c.getNorth(),c.getEast(),n)),b.extend(new geo.Point(c.getNorth(),c.getWest(),n)),b.extend(new geo.Point(c.getSouth(),c.getEast(),n)),b.extend(new geo.Point(c.getSouth(),c.getWest(),n))}else c=a.getKml(),c=$.parseXML(c),c=c.getElementsByTagName("coordinates"),$.each(c,function(a,
c){f=va(c);f=f.replace(/,\s+/g,",");g=f.split(/\s+/g);for(d=0;d<g.length;d++)h=g[d].split(","),1<h.length&&(k=parseFloat(h[0]),l=parseFloat(h[1]),n=parseFloat(h[2]),b.extend(new geo.Point(l,k,n)))})}function Oa(a,b,c,e,f,g,k,l){k=n.getView().copyAsLookAt(n.ALTITUDE_RELATIVE_TO_GROUND);var m=k.getLatitude()+0.35,p=k.getLatitude()-0.35,q=k.getLongitude()+0.55,r=k.getLongitude()-0.55;l=n.createGroundOverlay("");var t=n.createLatLonBox(""),u=!0,v;h(a);k=h("_f."+b,"",a);w[a]=w[a]||{};w[a][b]=w[a][b]||
[];f=f||{};f.service=f.service||"WMS";f.version=f.version||"1.1.1";"1.1.1"===f.version||"1.1.0"===f.version||"1.0.0"===f.version?f.srs="EPSG:4326":f.crs="EPSG:4326";f.format=f.format||"image%2Fpng";f.request=f.request||"GetMap";f.exceptions=f.exceptions||"INIMAGE";f.transparent=f.transparent||"TRUE";f.width="256";f.height="256";$.each(f,function(a,b){u?(v="?",u=!1):v+="&";v+=a.toUpperCase();v+="=";v+=b});t.setBox(m,p,q,r,0);l.setIcon(n.createIcon(""));l.getIcon().setHref(e+v);l.setLatLonBox(t);l.getIcon().setViewRefreshMode(n.VIEW_REFRESH_ON_STOP);
g&&l.setDrawOrder(Pa++);e=k.getFeatures().getChildNodes();e.getLength()&&(e=e.item(0),la(e,a,b),x(e),k.getFeatures().removeChild(e));k.getFeatures().appendChild(l);b={key:b,title:c,isFeature:!0,select:d(k)};jc2cui.mapWidget.addTreeItems(b,a)}function Qa(a,b,c,e,f,k,l){var m=h(a),p,q;try{aa(e,function(e){try{if(e){var K=g(a),r=h("_f."+b,"",a),t,u,v,w,y,A,z,D=[a,b];if(K===m){t=r.getFeatures().getChildNodes();t.getLength()&&(u=t.item(0),la(u,a,b),x(u),r.getFeatures().removeChild(u));r.getFeatures().appendChild(e);
q={title:c||"[no name]",tooltip:"click to zoom to",isFolder:!0,expand:r.getOpen()?!0:!1,select:d(r),isFeature:!0,key:b};a!==jc2cui.mapWidget.USER_DRAWN_OVERLAY&&ma(e,q,a,b,D);jc2cui.mapWidget.addTreeItems(q,a,b);y=r.getElementsByType("KmlLink");for(v=0;v<y.getLength();v++)A=y.item(v),A.getViewRefreshMode()===n.VIEW_REFRESH_ON_REQUEST&&(A.setViewRefreshMode(n.VIEW_REFRESH_ON_STOP),A.setViewRefreshTime(4));f&&d(m)&&(y=r.getElementsByType("KmlNetworkLink"),z=function(){e.getAbstractView()?n.getView().setAbstractView(e.getAbstractView()):
google.earth.executeBatch(n,function(){w=new geo.Bounds;U(e,w);w.isEmpty()||B.view.setToBoundsView(w,{aspectRatio:H.width()/H.height()})})},0<y.getLength()?setTimeout(z,5E3):z())}}else q={title:c+" - LOAD FAILED",isFolder:!0,key:b,select:d(g(a))},jc2cui.mapWidget.addTreeItems(q,a,b),jc2cui.mapWidget.error({sender:k?k.id:"",type:"map.feature.plot",msg:l,error:"Failed to create KML object."})}catch(C){p="Failed to create KML object",C&&(p+=": "+C),q={title:c+" - LOAD FAILED",isFolder:!0,key:b,select:d(g(a))},
jc2cui.mapWidget.addTreeItems(q,a,b),jc2cui.mapWidget.error({sender:k?k.id:"",type:"map.feature.plot",msg:l,error:p})}},b)}catch(r){q={title:c+" - LOAD FAILED",isFolder:!0,key:b,select:d(g(a))},jc2cui.mapWidget.addTreeItems(q,a,b),p="Failed to load KML",r&&(p+=": "+r),jc2cui.mapWidget.error({sender:k?k.id:"",type:"map.feature.plot",msg:l,error:p})}}function Ra(a,b,c,e,f,g,k){var l,m,p,q,r,t,u,v,w=[a,b],y,A=h(a),z=h("_f."+b,"",a);try{l=n.parseKml(c);m=z.getFeatures().getChildNodes();m.getLength()&&
(p=m.item(0),la(p,a,b),x(p),z.getFeatures().removeChild(p));z.getFeatures().appendChild(l);y={key:b,title:e||"[no name]",isFeature:!0,isFolder:!0,tooltip:"click to zoom to",select:d(z),expand:z.getOpen()?!0:!1};a!==jc2cui.mapWidget.USER_DRAWN_OVERLAY&&ma(l,y,a,b,w);jc2cui.mapWidget.addTreeItems(y,a,b);t=z.getElementsByType("KmlLink");for(q=0;q<t.getLength();q++)u=t.item(q),u.getViewRefreshMode()===n.VIEW_REFRESH_ON_REQUEST&&(u.setViewRefreshMode(n.VIEW_REFRESH_ON_STOP),u.setViewRefreshTime(4));f&&
d(A)&&(t=z.getElementsByType("KmlNetworkLink"),v=function(){l.getAbstractView()?n.getView().setAbstractView(l.getAbstractView()):google.earth.executeBatch(n,function(){r=new geo.Bounds;U(l,r);r.isEmpty()||B.view.setToBoundsView(r,{aspectRatio:H.width()/H.height()})})},0<t.getLength()?setTimeout(v,4E3):v())}catch(C){a="Failed to plot KML.",C&&(a+=": "+C),jc2cui.mapWidget.error({sender:g?g.id:"",type:"map.feature.plot",msg:k,error:a})}}function na(a,b){var c=I[a],d;c&&$.each(c,function(a,c){$.each(c,
function(a,c){if(a.toString()===b.toString())return d=c,!1});return!d});return d}function Sa(a,b,c){var d=g(a.overlayId),e;d?(e=d.getElementById(k("_f."+a.featureId)))?(delete Z[a.featureId],x(e),d.getFeatures().removeChild(e),e.release(),I[a.overlayId]&&delete I[a.overlayId][a.featureId],T[a.overlayId]&&delete T[a.overlayId],w[a.overlayId]&&($.each(w[a.overlayId][a.featureId],function(a,b){ka(b)}),delete w[a.overlayId][a.featureId])):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.unplot",
msg:c,error:"Unable to find feature with featureId "+a.featureId}):(d=A.idMap[a.featureId])?G(d,!1):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.unplot",msg:c,error:"Unable to find overlay "+a.overlayId})}function Ta(a,b,c){var d=g(a),e=[];if(d)x(d),a===jc2cui.mapWidget.USER_DRAWN_OVERLAY&&($.each(P,function(a,b){ca(b,!1)}),P={}),m(a,e,d),$.each(e,function(a,b){3<b.length&&delete Z[b.substr(3)];w[b]&&($.each(w[b],function(a,b){$.each(b,function(a,b){ka(b)})}),delete w[b])}),d.getParentNode().getFeatures().removeChild(d),
d.release(),delete I[a],delete T[a];else if(d=A.idMap[a])G(d,!1);else if("defaultLayers"===a)for(a=0;a<A.layers[0].children.length;a++)G(A.layers[0].children[a],!1);else jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.overlay.remove",msg:c,error:"No overlay with id "+a+" found to remove."})}function wa(a,b){var c=n.getView().copyAsLookAt(n.ALTITUDE_RELATIVE_TO_GROUND),d;a&&(c.setLatitude(a.lat),c.setLongitude(a.lon));void 0!==b&&null!==b&&(d="auto"===b?0:b);void 0!==d&&c.setRange(d);n.getView().setAbstractView(c)}
function ga(a,b){if("auto"===b)B.view.setToBoundsView(a,{aspectRatio:H.width()/H.height()});else{var c=a.center();wa({lat:c.lat(),lon:c.lng()},b)}}function Ua(a,b){var c=g(a),d,e,f;c?(e=c.getAbstractView())?("auto"!==b&&(f=n.getView().copyAsLookAt(n.ALTITUDE_RELATIVE_TO_GROUND),f.setLatitude(e.getLatitude()),f.setLongitude(e.getLongitude()),e=f,void 0!==b&&null!==b&&e.setRange(b)),n.getView().setAbstractView(e)):google.earth.executeBatch(n,function(){d=new geo.Bounds;U(c,d);ga(d,b)}):console.log("earth configured map widget. No overlay with id "+
a+" found to zoom to.")}function Va(a,b,c){var d=g(a.overlayId),e,f;if(d)if(e=d.getElementById(k("_f."+a.featureId))){if((b=e.getAbstractView())?("auto"!==a.zoom&&(c=n.getView().copyAsLookAt(n.ALTITUDE_RELATIVE_TO_GROUND),c.setLatitude(b.getLatitude()),c.setLongitude(b.getLongitude()),b=c,void 0!==a.zoom&&null!==a.zoom&&b.setRange(a.zoom)),n.getView().setAbstractView(b)):google.earth.executeBatch(n,function(){f=new geo.Bounds;U(e,f);ga(f,a.zoom)}),a.select&&(e=e.getElementById(a.featureId)))b={selectedId:a.featureId||
"",selectedName:e.getName()||"",featureId:a.featureId,overlayId:a.overlayId},jc2cui.mapWidget.itemSelected(b)}else jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.view.center.feature",msg:c,error:"Unable to find feature with featureId "+a.featureId});else jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.view.center.feature",msg:c,error:"Unable to find overlay "+a.overlayId})}function Wa(a){var b=na(a.overlayId,a.itemId),c,d,e;b&&((d=b.getAbstractView())?("auto"!==a.zoom&&(e=n.getView().copyAsLookAt(n.ALTITUDE_RELATIVE_TO_GROUND),
e.setLatitude(d.getLatitude()),e.setLongitude(d.getLongitude()),d=e,void 0!==a.zoom&&null!==a.zoom&&d.setRange(a.zoom)),n.getView().setAbstractView(d)):google.earth.executeBatch(n,function(){c=new geo.Bounds;U(b,c);ga(c,a.zoom)}),a.select&&(d=t(b),jc2cui.mapWidget.itemSelected(d)))}function Xa(a){var b=g(a.overlayId),c,d,e,f,h,k,l,m,p=["KmlGroundOverlay","KmlPlacemark"];if(b){if(a.selectedId&&0<a.selectedId.length)for(k=0;k<p.length;k++){e=b.getElementsByType(p[k]);f=e.getLength();for(h=0;h<f;h++)if(e.item(h).getId()===
a.selectedId){c=e.item(h);break}if(c)break}if(!c&&a.selectedName&&0<a.selectedName.length)for(k=0;k<p.length;k++){e=b.getElementsByType(p[k]);f=e.getLength();for(h=0;h<f;h++)if(e.item(h).getName()===a.selectedName){c=e.item(h);break}if(c)break}c?google.earth.executeBatch(n,function(){d=new geo.Bounds;U(c,d);d.isEmpty()||(m=d.getCenter(),l=n.getView().copyAsLookAt(n.ALTITUDE_RELATIVE_TO_GROUND),l.setLatitude(m.lat()),l.setLongitude(m.lng()),n.getView().setAbstractView(l))}):console.log("earth configured map widget unable to find selected item with id "+
a.selectedId+" and name "+a.selectedName)}else console.log("earth configured map widget unable to find overlay "+a.overlayId+" for selected item with id "+a.selectedId+" and name "+a.selectedName)}var D,n,H=$("#map"),ra={},X={},Aa={},B,Ca,E,Q,R,S,V,P={},y,Ha={icon:jc2cui.mapWidget.getAppPath()+"images/cross-hairs.png",overlayXY:{left:"50%",top:"50%"},screenXY:{left:0,top:0},size:{left:32,bottom:32}},ja={icon:{href:jc2cui.mapWidget.getDefaultDrawingIcon(),hotSpot:{bottom:0,left:"50%"}},line:{width:3,
color:"CC8B4215"},poly:{color:"99F6E8DF"}},da,Ya={marker:0,shape:0,line:0},ca,ia={},I={},T={},w={},fa,Pa=-1E4,u,A={layers:[],idMap:{}},Ba,ta,ba,Y,Z={},ua,ea;ca=function(b,c){if(b.editable!==c){var e=function(){b.editTimeout&&window.clearTimeout(b.editTimeout);b.editTimeout=window.setTimeout(function(){delete b.editTimeout;jc2cui.mapWidget.publishDrawing(b.earthObject.getKml(),b.id,b.title,d(b.earthObject))},500)};c&&!b.clickFeatureCallback&&(b.clickFeatureCallback=function(c){0===c.getButton()&&(c.preventDefault(),
a(b))});c?google.earth.addEventListener(b.earthObject,"click",b.clickFeatureCallback):google.earth.removeEventListener(b.earthObject,"click",b.clickFeatureCallback);switch(b.type){case "marker":c?B.edit.makeDraggable(b.earthObject,{targetScreenOverlay:Ha,dropCallback:e}):B.edit.endDraggable(b.earthObject);break;case "line":c?B.edit.editLineString(b.earthObject.getGeometry(),{editCallback:e}):B.edit.endEditLineString(b.earthObject.getGeometry());break;case "shape":c?B.edit.editLineString(b.earthObject.getGeometry().getOuterBoundary(),
{editCallback:e}):B.edit.endEditLineString(b.earthObject.getGeometry().getOuterBoundary())}b.editable=c}};da=function(a){var c=jc2cui.mapWidget.getNewId(),d;h(jc2cui.mapWidget.USER_DRAWN_OVERLAY,jc2cui.mapWidget.USER_DRAWN_OVERLAY);d=h("_f."+c,"",jc2cui.mapWidget.USER_DRAWN_OVERLAY);if(y){switch(V){case "marker":B.edit.endDraggable(y.earthObject);break;case "line":B.edit.endEditLineString(y.earthObject.getGeometry());break;case "shape":B.edit.endEditLineString(y.earthObject.getGeometry().getOuterBoundary())}B.dom.removeObject(y.featureFolder);
y.featureFolder.release();y=null}V=a;E.setSelected("hand"===V);Q.setSelected("marker"===V);R.setSelected("line"===V);S.setSelected("shape"===V);if("hand"!==V)switch(y={id:c,title:a+" "+ ++Ya[a],kml:null,earthObject:null,featureFolder:d,type:a,dirty:!0},a){case "marker":c=B.dom.buildPointPlacemark([0,0,0,n.ALTITUDE_CLAMP_TO_SEA_FLOOR],{name:y.title,style:{icon:ja.icon},id:y.id});d.getFeatures().appendChild(c);y.earthObject=c;B.edit.place(c,{targetScreenOverlay:Ha,dropCallback:function(){window.setTimeout(b,
100)},bounce:!1});break;case "line":case "shape":c=B.dom.buildPlacemark({lineString:"line"===a?[]:void 0,polygon:"shape"===a?[]:void 0,name:y.title,style:{line:ja.line,poly:ja.poly},id:y.id}),d.getFeatures().appendChild(c),y.earthObject=c,a="line"===a?c.getGeometry():c.getGeometry().getOuterBoundary(),c.getGeometry().setAltitudeMode(n.ALTITUDE_CLAMP_TO_GROUND),a.setAltitudeMode(n.ALTITUDE_CLAMP_TO_GROUND),a.setTessellate(!0),B.edit.drawLineString(a,{finishCallback:function(){window.setTimeout(b,100)},
bounce:!1})}};return{init:function(a){if(D=a){if(D.ajaxLoadUrl)a=D.ajaxLoadUrl+"?",D.key?a+="key="+D.key+"&":console.log("No Earth API key provided!"),$.ajax({url:a+"callback=googleLoaded",dataType:"script",timeout:2E4,error:function(a,b,c){a="Error initializing Google Earth";b&&"error"!==b&&(a+=": "+b);jc2cui.mapWidget.showError(a)}});else if(D.earthApiUrl)$.ajax({url:D.earthApiUrl.url,dataType:"script",timeout:2E4,success:function(a,b){window.google=window.google||{};window.google.loader=window.google.loader||
{};window.google.earth=window.google.earth||{};D.key?window.google.loader.ApiKey=D.key:console.log("No Earth API key provided!");window.google.loader.KeyVerified=!0;D.earthApiUrl.errorUrl?window.google.earth.setErrorUrl(D.earthApiUrl.errorUrl):console.log("No config.earthApiUrl.errorUrl provided!");D.earthApiUrl.database||console.log("No config.earthApiUrl.database provided!");var c=document.location.href,c=c.substring(0,c.lastIndexOf("/")+1);window.google.earth.setLoadingImageUrl(c+"images/loading.gif");
qa()},error:function(a,b,c){a="Error initializing Google Earth";b&&"error"!==b&&(a+=": "+b);jc2cui.mapWidget.showError(a)}});else{jc2cui.mapWidget.showError("Config file includes neither a ajax load url or a direct Google Earth API url. Unable to load Google Earth API");return}ea=D.constraints?D.constraints.maxPlacemarks:void 0}else jc2cui.mapWidget.showError("Missing config file. Unable to load Google Earth API")},createOverlay:function(a,b,c){h(a.overlayId,a.name,a.parentId)},removeOverlay:function(a,
b,c){Ta(a,b,c)},setOverlayVisibility:function(a,b,c,d){var e=g(a);if(e){if(b||x(e),W(e,b),ia[a]=b)for(b=e.getParentNode();b&&"GEGlobe"!==b.getType();)b.setVisibility(!0),b=b.getParentNode()}else if(e=A.idMap[a])G(e,b);else if("defaultLayers"===a)for(a=0;a<A.layers[0].children.length;a++)G(A.layers[0].children[a],b);else jc2cui.mapWidget.error({sender:c?c.id:"",type:"map.overlay."+(b?"show":"hide"),msg:d,error:"No overlay with id "+a+" found to "+(b?"show.":"hide.")})},isOverlayVisible:function(a){return ia[a]||
A.idMap[a]&&A.idMap[a].visibility},updateOverlay:function(a,b,c){b=g(a.overlayId);var e;if(!b)return!1;if(a.parentId){a=g(a.parentId);if(!a)return!1;a!==b.getParentNode()&&(c=d(b),b.getParentNode().getFeatures().removeChild(b),a.getFeatures().appendChild(b),e=d(a),c!==e&&(c?O(a,b):b.setVisibility(!1)))}return!0},loadKml:function(a,b,c){Qa(a.overlayId,a.featureId,a.name||a.featureName||a.url,a.url,a.zoom,b,c)},loadWms:function(a,b,c){Oa(a.overlayId,a.featureId,a.name||a.featureName||a.url,a.url,a.params,
a.background,b,c)},parseKml:function(a,b,c){Ra(a.overlayId,a.featureId,a.feature,a.name||a.featureName||"kml",a.zoom,b,c)},removeFeature:function(a,b,c){Sa(a,b,c)},updateFeature:function(a,b,c,e){if(a.newOverlayId){c=g(a.overlayId);if(!c)return b.push("Unable to find overlay "+a.overlayId),!1;c=c.getElementById(k("_f."+a.featureId));if(!c)return b.push("Unable to find feature "+a.featureId+" in overlay "+a.overlayId),!1;e=g(a.newOverlayId);if(!e)return b.push("Unable to find overlay "+a.newOverlayId),
!1;e!==c.getParentNode()&&(b=d(c),c.getParentNode().getFeatures().removeChild(c),e.getFeatures().appendChild(c),w[a.newOverlayId]=w[a.newOverlayId]||{},w[a.newOverlayId][a.featureId]=w[a.overlayId][a.featureId],delete w[a.overlayId][a.featureId],I[a.newOverlayId]=I[a.newOverlayId]||{},I[a.newOverlayId][a.featureId]=I[a.overlayId][a.featureId],delete I[a.overlayId][a.featureId],a=d(e),b!==a&&(b?O(e,c):c.setVisibility(!1)))}return!0},showFeature:function(a,b,c){var d=g(a.overlayId),e=d;if(d)if(d=d.getElementById(k("_f."+
a.featureId)))for(W(d,!0);e&&"GEGlobe"!==e.getType();)e.setVisibility(!0),e=e.getParentNode();else jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.show",msg:c,error:"Unable to find feature with featureId "+a.featureId});else(d=A.idMap[a.featureId])?G(d,!0):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.show",msg:c,error:"Unable to find overlay "+a.overlayId})},hideFeature:function(a,b,c){var d=g(a.overlayId);d?(d=d.getElementById(k("_f."+a.featureId)))?(x(d),W(d,!1)):jc2cui.mapWidget.error({sender:b?
b.id:"",type:"map.feature.hide",msg:c,error:"Unable to find feature with featureId "+a.featureId}):(d=A.idMap[a.featureId])?G(d,!1):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.hide",msg:c,error:"Unable to find overlay "+a.overlayId})},showItem:function(a){var b=na(a.overlayId,a.itemId);b&&(W(b,!0),a.zoom&&(a=B.dom.computeBounds(b),a.isEmpty()||B.view.setToBoundsView(a,{aspectRatio:H.width()/H.height()})))},hideItem:function(a){if(a=na(a.overlayId,a.itemId))x(a),W(a,!1)},centerOnOverlay:function(a,
b,c){Ua(a.overlayId,a.zoom)},centerOnFeature:function(a,b,c){Va(a,b,c)},centerOnItem:function(a){Wa(a)},centerOnLocation:function(a,b,c){wa(a.location,a.zoom)},fitToBounds:function(a){ga(a,"auto")},centerOnBounds:function(a,b,c){b=new geo.Bounds([a.bounds.southWest.lat,a.bounds.southWest.lon],[a.bounds.northEast.lat,a.bounds.northEast.lon]);ga(b,a.zoom)},zoomToRange:function(a,b,c){wa(null,a.range)},selected:function(a,b,c){Xa(a)},getViewStatus:function(a,b,c){return l(a,b,c)},getDropLocation:function(){console.log("earth drop not yet supported by OWF");
return{lat:0,lon:0}},checkResize:function(){n.getWindow().setVisibility(!1);n.getWindow().setVisibility(!0)},setDrawingToolsVisibility:function(a){f(a)},setExpanded:function(a,b,c){(a=na(a,b))&&a.setOpen(c)},optionChanged:function(a,b){},googleReady:function(){Ka()},earthReady:function(){qa()},info:function(){return{name:"Google Earth Plugin "+n.getPluginVersion(),type:"3D",entities:"Approximately "+C()+" entities loaded"}}}}();
