util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.kmlParser=function(){function s(){if(void 0===R){var k=document.createElement("x"),a=document.documentElement,d=window.getComputedStyle;void 0===k.style.pointerEvents?R=!1:(k.style.pointerEvents="auto",k.style.pointerEvents="x",a.appendChild(k),d=d&&"auto"===d(k,"").pointerEvents,a.removeChild(k),R=!!d)}return R}function g(k,a,d,m){if(0===k&&void 0!==U)m(U);else if(1===k&&void 0!==M)m(M);else if(V)setTimeout(function(){g(k,a,d,m)},1E3);else{V=!0;"function"===typeof a&&(a=a());var C=
$("<div>"+a+'<br><br><div><input type="checkbox" id="global">Dont show again, apply to all overlays<br></div>'),e=$(window),f=e.innerHeight(),e=e.innerWidth();C.dialog({preferredHeight:220,preferredWidth:300,height:Math.min(220,f-20),width:Math.min(300,e-20),modal:!1,title:d,buttons:{Yes:function(){C.dialog("close");m(!0,$("#global",C).is(":checked"))},No:function(){C.dialog("close");m(!1,$("#global",C).is(":checked"))}},close:function(k,a){V=!1;C.remove()}})}}function a(k){var a=$(u.container),d=
$('<img class="screenOverlay" src='+k.href+">"),m,C=!1,e=this;this.visibility=k.visibility;this.visible=k.visible;this.name=k.name;this.placer=function(){return function(){var f={},b=0,c=0,u,q,B=d[0].height,K=d[0].width,I=k.overlayXY.x,p=k.overlayXY.y;k.screenXY&&(q=a.height(),u=a.width(),b=k.screenXY.x,c=k.screenXY.y,"insetPixels"===k.screenXY.xunits?b=u-b-K:"fraction"===k.screenXY.xunits&&(b*=u),"pixels"===k.screenXY.yunits?c=q-c:"fraction"===k.screenXY.yunits&&(c=q*(1-c)));k.sizeXY&&(0<k.sizeXY.x&&
("pixels"===k.sizeXY.xunits?K=k.sizeXY.x:"fraction"===k.sizeXY.xunits&&(u=u||a.width(),K=u*k.sizeXY.x)),0<k.sizeXY.y&&("pixels"===k.sizeXY.yunits?B=k.sizeXY.y:"fraction"===k.sizeXY.yunits&&(q=q||a.height(),B=q*k.sizeXY.y)),0===k.sizeXY.x&&0!==k.sizeXY.y&&(u=d[0].width/d[0].height,K=B*u),0===k.sizeXY.y&&0!==k.sizeXY.x&&(u=d[0].width/d[0].height,B=K/u),K&&(f.width=K),B&&(f.height=B));k.overlayXY&&("pixels"===k.overlayXY.xunits?I=-I:"insetPixels"===k.overlayXY.xunits?I=-(K-I):"fraction"===k.overlayXY.xunits&&
(I*=-K),"pixels"===k.overlayXY.yunits?p=-B+p:"insetPixels"===k.overlayXY.yunits?p=-p:"fraction"===k.overlayXY.yunits&&(p=-B*(1-p)),b+=I,c+=p);0!==b&&(f.left=b+"px");0!==c&&(f.top=c+"px");d.css(f);m&&m.css(f);k.rotation&&!C&&(C=!0,k.rotation=0>k.rotation?-k.rotation:360-k.rotation,d.rotate(k.rotation));e.visible||e.setVisible(!1);d.css("opacity",1)}}();d.css("opacity",0);d.load(this.placer);this.image=d.appendTo(a);s()||(m=$('<span class="screenOverlay"></span>'),m.css({"background-color":"#F5F5F5",
opacity:0.3,"z-index":0}),this.mask=m.appendTo(a));this.internalId="a"+(++ga).toString()}function c(k){this.internalId="a"+(++ga).toString();this.parent=k;this.features=[]}function b(k,a){a||++J;this.internalId="a"+(++ga).toString();this.containers=[];this.features=[];this.screenOverlays=[];this.viewSensitiveFeatures=[];this.visibility=!0;k&&(this.parent=k,k.containers.push(this),k.maintainState&&(this.maintainState=!0,this.idMap={},this.nameMap={}),this.loadMorePlacemarks=k.loadMorePlacemarks)}function h(k){return setTimeout(function(){k.features.length&&
k.features[0].refreshIcon(k)},k.icon.viewRefreshTime)}function e(){b.apply(this,arguments);this.intervals=[];this.loaded=!1}function l(k){var a="",d;if(k)if(2===k.nodeType||3===k.nodeType||4===k.nodeType)a=k.nodeValue;else if(1===k.nodeType||9===k.nodeType||11===k.nodeType)for(d=0;d<k.childNodes.length;++d)a+=l(k.childNodes[d]);return $.trim(a)}function f(k,a){if(k){var d=k.getElementsByTagName(a);if(d.length)return l(d[0])}}function t(k,a){var d=l(k);return d.length?0!==parseInt(d,10):a||!1}function p(k,
a,d){return k&&(k=k.getElementsByTagName(a),k.length)?t(k[0],d):d}function n(k){var a={},d,m,C;if(1===k.nodeType||9===k.nodeType||11===k.nodeType){if(0<k.attributes.length)for(m=0;m<k.attributes.length;m++)d=k.attributes.item(m),a[d.nodeName]=l(d)}else if(2===k.nodeType||3===k.nodeType||4===k.nodeType)a=l(k);if(k.hasChildNodes())if(1!==k.childNodes.length||2!==k.childNodes[0].nodeType&&3!==k.childNodes[0].nodeType&&4!==k.childNodes[0].nodeType)for(m=0;m<k.childNodes.length;m++)C=k.childNodes.item(m),
3!==C.nodeType&&8!==C.nodeType&&(d=C.nodeName,C=n(C),a[d]?($.isArray(a[d])||(a[d]=[a[d]]),a[d].push(C)):a[d]=C);else a=l(k.childNodes[0]);return a}function E(k){return{x:parseFloat(k.getAttribute("x")),y:parseFloat(k.getAttribute("y")),xunits:k.getAttribute("xunits"),yunits:k.getAttribute("yunits")}}function A(k){var a=parseFloat(f(k,"altitude")),d=f(k,"altitudeMode"),m=parseFloat(f(k,"range"));isNaN(m)?isNaN(a)&&(a=0):a=m;d&&d.length||(d="relativeToGround");return{latitude:parseFloat(f(k,"latitude")),
longitude:parseFloat(f(k,"longitude")),altitude:a,altitudeMode:d,range:m}}function v(k){if(k.childNodes.length)return k={latLonAltBox:{north:parseFloat(f(k,"north")),south:parseFloat(f(k,"south")),east:parseFloat(f(k,"east")),west:parseFloat(f(k,"west"))},lod:{minLodPixels:parseFloat(f(k,"minLodPixels")),maxLodPixels:parseFloat(f(k,"maxLodPixels"))||-1}},u.region?u.region(k):k}function x(k){k&&(this.href=f(k,"href"),this.refreshMode=f(k,"refreshMode"),this.viewRefreshMode=f(k,"viewRefreshMode"),this.viewFormat=
f(k,"viewFormat"),"onInterval"===this.refreshMode&&(this.interval=parseFloat(f(k,"refreshInterval"))),"onStop"===this.viewRefreshMode&&(this.viewRefreshTime=parseFloat(f(k,"viewRefreshTime")),isNaN(this.viewRefreshTime)&&(this.viewRefreshTime=4),this.viewRefreshTime*=1E3,this.viewFormat&&this.viewFormat.length||(this.viewFormat="BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]")))}function D(k,a){var d={},m,C,e,f;k=k||"ffffffff";m=k.substr(0,2);f=k.substr(2,2);e=k.substr(4,2);C=k.substr(6,2);d.opacity=
parseInt(m,16)/256;if("random"===a){m=[C,e,f];for(e=0;2>e;e++)f=Math.round(Math.random()*parseInt(C,16)).toString(16),1===f.length&&(f="0"+f),m[e]=f;C="#"+m[0]+m[1]+m[2]}else C="#"+C+e+f;d.color=C;return d}function y(k){var a={},d,m,C,e,b;m=k.getElementsByTagName("Style");for(d=0;d<m.length;d++)C=m[d],(e=C.getAttribute("id"))&&(a["#"+e]=n(C));m=k.getElementsByTagName("StyleMap");for(d=0;d<m.length;d++)if(C=m[d],e=C.getAttribute("id"))k=f(m[d],"key"),"normal"===k&&((k=f(m[d],"styleUrl"))?(C=k.indexOf("#"),
0<C?(b=k.substring(0,C),k=k.substring(C),r[b]&&(k=r[b][k])):(0>C&&(k="#"+k),k=a[k]),k?a["#"+e]=k:console.log("styleMap styleUrl of #"+e+" not found")):(k=m[d].getElementsByTagName("Style"),k.childNodes.length&&(a["#"+e]=n(k.childNodes[0]))));$.each(a,function(k,a){a.LineStyle&&a.LineStyle.color&&"string"===typeof a.LineStyle.color&&(a.LineStyle.color=D(a.LineStyle.color,a.LineStyle.colorMode));a.PolyStyle&&a.PolyStyle.color&&"string"===typeof a.PolyStyle.color&&(a.PolyStyle.color=D(a.PolyStyle.color,
a.PolyStyle.colorMode))});return a}function F(k){var a=[];k=k.getElementsByTagName("Schema");var d;for(d=0;d<k.length;d++)"Placemark"===k[d].getAttribute("parent")&&a.push(k[d].getAttribute("name"));return a}function H(k,a,d,m){return function(e){r[a]=e.doc?e.doc.styles:{};L(k,d+1,m)}}function L(k,a,d){for(var e=k.getElementsByTagName("styleUrl"),C,f,b;a<e.length;a++)if(C=l(e[a]),f=C.indexOf("#"),0<f&&0===C.indexOf("http")&&(C=C.substring(0,f),!r[C])){b=m(C,!1,null,H(k,C,a,d),null,null,!0);break}b||
d()}function O(k){var a,d=[],m;k=k.replace(/,\s+/g,",");k=k.split(/\s+/g);for(m=0;m<k.length;m++)a=k[m].split(","),1<a.length&&d.push({lon:parseFloat(a[0]),lat:parseFloat(a[1]),alt:parseFloat(a[2])});return d}function G(k,a,d,m){var e=new c(a),b,h=[],g=[],t=[],z,q,B,K,I,aa;e.id=k.getAttribute("id");e.name=f(k,"name");e.description=f(k,"description");e.styleUrl=f(k,"styleUrl");b=k.getElementsByTagName("Style");b.length&&(e.style=n(b[0]),e.style.LineStyle&&e.style.LineStyle.color&&"string"===typeof e.style.LineStyle.color&&
(e.style.LineStyle.color=D(e.style.LineStyle.color,e.style.LineStyle.colorMode)),e.style.PolyStyle&&e.style.PolyStyle.color&&"string"===typeof e.style.PolyStyle.color&&(e.style.PolyStyle.color=D(e.style.PolyStyle.color,e.style.PolyStyle.colorMode)));e.styleUrl&&(b=e.styleUrl.indexOf("#"),0<b?(q=e.styleUrl.substring(0,b),b=e.styleUrl.substring(b),r[q]&&(b=r[q][b])):(0>b&&(e.styleUrl="#"+e.styleUrl),b=m.styles[e.styleUrl]),e.style=e.style?$.extend(!0,{},b,e.style):b);b=k.getElementsByTagName("Region");
b.length&&(e.region=v(b[0]));b=k.getElementsByTagName("Point");for(z=0;z<b.length;z++){if(m.removed)return;(B=f(b[z],"coordinates"))&&h.push(O(B))}b=k.getElementsByTagName("LineString");for(z=0;z<b.length;z++){if(m.removed)return;(B=f(b[z],"coordinates"))&&g.push(O(B))}b=k.getElementsByTagName("LinearRing");for(z=0;z<b.length;z++){if(m.removed)return;"outerBoundaryIs"!==b[z].parentNode.nodeName&&"innerBoundaryIs"!==b[z].parentNode.nodeName&&(B=f(b[z],"coordinates"))&&(B[B.length-1].lat===B[0].lat&&
B[B.length-1].lon===B[0].lon||B.push(B[0]),g.push(O(B)))}b=k.getElementsByTagName("Polygon");for(z=0;z<b.length;z++){if(m.removed)return;I=[];K=b[z].getElementsByTagName("outerBoundaryIs");B=f(K[0],"coordinates");I.push(O(B));K=b[z].getElementsByTagName("innerBoundaryIs");for(q=0;q<K.length;q++)B=f(K[q],"coordinates"),I.push(O(B));t.push(I)}q=k.getElementsByTagName("Camera");q.length?q=A(q[0]):(q=k.getElementsByTagName("LookAt"),q=q.length?A(q[0]):void 0);e.viewer=q;a&&(a.features.push(e),e.region&&
a.viewSensitiveFeatures.push(e),a.maintainState&&(e.id?(d&&(aa=d.idMap[e.id]),a.idMap[e.id]=e):e.name&&(d&&(aa=d.nameMap[e.name]),a.nameMap[e.name]=e)));b=k.getElementsByTagName("ExtendedData");if(b.length){d=b[0].getElementsByTagName("Data");b={};if(d.length)for(q=0;q<d.length;q++)z=d[q].getAttribute("name"),B=l(d[q].getElementsByTagName("value")[0]),b[z]=B;e.extendedData=b}aa&&(e.visibility=aa.visibility);void 0===e.visibility&&(e.visibility=p(k,"visibility",!0));e.visibility=e.visibility&&a.visibility;
e.visible=e.visibility&&(!e.region||u.isRegionActive&&u.isRegionActive(e.region));if(u.marker)for(q=0;q<h.length;q++){if(m.removed)return;(k=u.marker(e,h[q][0],m))&&e.features.push(k)}if(u.polyline)for(q=0;q<g.length;q++){if(m.removed)return;(k=u.polyline(e,g[q],m))&&e.features.push(k)}if(u.polygon)for(q=0;q<t.length;q++){if(m.removed)return;(k=u.polygon(e,t[q],m))&&($.isArray(k)?$.merge(e.features,k):e.features.push(k))}aa&&jc2cui.mapWidget.infoWindow&&jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().internalId===
aa.internalId&&u.refreshInfoWindow&&u.refreshInfoWindow(e);J+=Math.max(1,e.features.length)}function P(k,d,e,m){var b={name:f(k,"name"),id:k.getAttribute("id"),parent:d},c=k.getElementsByTagName("Icon"),z=k.getElementsByTagName("screenXY"),h=k.getElementsByTagName("overlayXY"),r=k.getElementsByTagName("size"),n=k.getElementsByTagName("rotation");z&&z.length&&(b.screenXY=E(z[0]));h&&h.length&&(b.overlayXY=E(h[0]));r&&r.length&&(b.sizeXY=E(r[0]));c&&c.length&&(b.href=f(c[0],"href"));n&&n.length&&(b.rotation=
parseFloat(l(n[0])));d&&d.maintainState&&(b.id?e&&e.idMap[b.id]&&(b.visibility=e.idMap[b.id].visibility):b.name&&(e&&e.nameMap[b.name])&&(b.visibility=e.nameMap[b.name].visibility));void 0===b.visibility&&(b.visibility=p(k,"visibility",!0));b.visible=b.visibility&&(!d||d.visibility);b=u.screenOverlay?u.screenOverlay(b,m):new a(b);++J;d&&(d.screenOverlays.push(b),d.maintainState&&(b.id?d.idMap[b.id]=b:b.name&&(d.nameMap[b.name]=b)))}function ba(k,a,d,e){var m=new c(a),b=f(k,"color"),l;m.latLonBox=
{north:parseFloat(f(k,"north")),east:parseFloat(f(k,"east")),south:parseFloat(f(k,"south")),west:parseFloat(f(k,"west"))};m.opacity=0.5;m.id=k.getAttribute("id");m.name=f(k,"name");l=k.getElementsByTagName("Icon");m.icon=l.length?new x(l[0]):new x;b&&(m.opacity=D(b).opacity);b=k.getElementsByTagName("Region");b.length&&(m.region=v(b[0]));a&&(a.features.push(m),(m.region||"onStop"===m.icon.viewRefreshMode||"onRequest"===m.icon.viewRefreshMode)&&a.viewSensitiveFeatures.push(m),a.maintainState&&(m.id?
(d&&d.idMap[m.id]&&(m.visibility=d.idMap[m.id].visibility),a.idMap[m.id]=m):m.name&&(d&&d.nameMap[m.name]&&(m.visibility=d.nameMap[m.name].visibility),a.nameMap[m.name]=m)));void 0===m.visibility&&(m.visibility=p(k,"visibility",!0));m.visible=m.visibility&&(!a||a.visibility)&&(!m.region||u.isRegionActive&&u.isRegionActive(m.region));u.groundOverlay&&m.features.push(u.groundOverlay(m,e));++J;return m}function ca(a,d,b,c){var l=new e(d),z=a.getElementsByTagName("Link"),h;z.length?l.link=new x(z[0]):
(z=a.getElementsByTagName("Url"),z.length&&(l.link=new x(z[0])));l.link||(l.link=new x);l.maintainState=!p(a,"refreshVisibility",!1);l.visibility=d.visibility&&p(a,"visibility",!0);l.visible=l.visibility&&d.visibility;l.open=p(a,"open",!1);l.id=a.getAttribute("id");l.name=f(a,"name");l.name&&l.name.length||(l.name=l.link.href);d.maintainState&&(b&&(h=b.containers[0]),h&&(l.visibility=h.visibility,l.open=h.open));z=a.getElementsByTagName("Region");z.length&&(l.region=v(z[0]));!l.region||u.isRegionActive&&
u.isRegionActive(l.region)?(++c.remaining,l.loaded=!0,l.loading=!0,l.loadedDoc=m(l.link.getHref(),l.visible,l,function(a){--c.remaining;!c.remaining&&c.initialParseCompleteCallback&&c.initialParseCompleteCallback({doc:c});a=l.loadedDoc||a.doc;l.loadLargeFile=a.loadLargeFile;l.loadMorePlacemarks=a.loadMorePlacemarks;l.loading=!1}),l.loadedDoc.visibility=l.visibility,"onInterval"===l.link.refreshMode&&l.link.interval&&l.intervals.push(setInterval(function(){if(!l.loading){l.loading=!0;var a=m(l.link.getHref(),
l.loadedDoc.visible,l,function(k){var d=a||k.doc;l.loading=!1;l.loadedDoc.remove();for(k=0;k<l.containers.length;k++)if(l.containers[k]===l.loadedDoc){l.containers.splice(k,1);l.loadedDoc=d;break}l.loadLargeFile=d.loadLargeFile;l.loadMorePlacemarks=d.loadMorePlacemarks},null,l.loadedDoc);a.visibility=l.loadedDoc.visibility}},1E3*l.link.interval))):l.visible=!1}function da(a,d,m,e,b,f){return function(){w(a,d,m,e,b,f)}}function w(a,d,m,e,f,c){++Q;if(X)setTimeout(function(){--Q;w(a,d,m,e,f,c)},10*Q);
else{--Q;X=!0;var p,z,h,r,q,B,K,I;c=c||0;try{for(p=c;p<a.childNodes.length&&p<c+100;p++){if(e.removed){X=!1;return}h=a.childNodes.item(p);r=h.nodeName;if("kml"===r){B=!0;w(h,d,m,e,f);break}if("Document"===r||"Folder"===r){q=new b(d);q.type=r;q.visible=d.visibility;q.visibility=d.visibility;q.id=h.getAttribute("id");if(d.maintainState){if("Document"===q.type)m&&(I=m.containers[0]);else if(q.id)m&&m.idMap[q.id]&&(I=m.idMap[q.id]),d.idMap[q.id]=q;else for(z=0;z<h.childNodes.length;z++)if(K=h.childNodes.item(z),
"name"===K.nodeName){q.name=l(K);m&&m.nameMap[q.name]&&(I=m.nameMap[q.name]);d.nameMap[q.name]=q;break}I&&(q.visibility=I.visibility,q.open=I.open)}B=!0;w(h,q,I,e,da(a,d,m,e,f,p+1));break}if("NetworkLink"===r)ca(h,d,m,e);else if("Placemark"===r||-1<$.inArray(r,e.placemarkNames))G(h,d,m,e);else if("ScreenOverlay"===r)P(h,d,m,e);else if("GroundOverlay"===r)ba(h,d,m,e);else if("Region"===r){if(q=v(h,e))d.region=q,d.visible=d.visible&&d.visibility&&u.isRegionActive(d.region)}else if("visibility"===r)d.visibility=
d.visibility&&t(h,!0),d.visible=d.visible&&d.visibility&&(!d.region||u.isRegionActive(d.region));else if("name"===r)d.name=l(h);else if("open"===r)void 0===d.open&&(d.open=t(h,!1));else if("LookAt"===r||"Camera"===r)d.viewer=A(h),d.parent&&(d.parent.overlayId&&!d.parent.viewer)&&(d.parent.viewer=d.viewer)}}catch(n){console.log(n)}X=!1;B||(p<a.childNodes.length?setTimeout(function(){w(a,d,m,e,f,p)},1):(f&&f({doc:e}),d===e&&(e.parseCompleteCallback&&e.parseCompleteCallback({doc:e}),u.parseCallback&&
u.parseCallback(e),--e.remaining,!e.remaining&&e.initialParseCompleteCallback&&e.initialParseCompleteCallback({doc:e}))))}}function S(a,d,m,e,b){d.fileSize&&(T+=d.fileSize);b&&(r[b]=r[b]||{});L(a,0,function(){d.styles=y(a);if(e)d.parseCompleteCallback({doc:d});else{d.placemarkNames=F(a);if(!d.loadMorePlacemarks&&!M){var b=0,f,c,l;c=d.placemarkNames.slice();c.push("Placemark");c.push("ScreenOverlay");c.push("GroundOverlay");c.push("NetworkLink");c.push("Document");c.push("Folder");for(f=0;f<c.length;f++)b+=
a.getElementsByTagName(c[f]).length;if(b+J>u.maxPlacemarks){f=[];for(c=d;c;)c.name&&c.name.length&&f.push(c.name),c=c.parent;f.reverse();l=f.join("/");g(1,function(){var d=["Overlay "];d.push(l);d.push(" contains approximately ");d.push(b);d.push(" entities. There are currently approximately ");d.push(J);d.push(" entities already loaded. ");d.push("Loading the additional entities may cause the browser to become unresponsive. Continue loading anyway?");return d.join("")},"Warning - Large Number Of Entities",
function(b,q){q&&(M=b);(d.loadMorePlacemarks=b)?w(a,d,m,d):(T-=d.fileSize,d.fileSize=0,--J,d.name=d.name||"",d.name+=" - LOAD CANCELED",d.parseCompleteCallback&&d.parseCompleteCallback({error:"canceled",doc:d}),!e&&u.parseCallback&&u.parseCallback(d))});return}}w(a,d,m,d)}})}function W(d){return 1048576>d?(d/1024).toFixed(2)+"kB":(d/1048576).toFixed(2)+"MB"}function m(d,a,e,f,c,l,p,h,r){var z;z=u.proxy.length?encodeURIComponent(d):d;var q=J,B;r=r||new b(e);r.remaining=1;r.parseCompleteCallback=f;
r.initialParseCompleteCallback=c;r.visibility=r.visible=a;r.clustering=h;l&&(r.open=l.open,r.loadLargeFile=r.loadLargeFile||l.loadLargeFile,r.loadMorePlacemarks=r.loadMorePlacemarks||l.loadMorePlacemarks);if(u.maxPlacemarks<q&&(!M&&!r.loadMorePlacemarks)&&(l&&(q-=l.getAllFeatures().length),u.maxPlacemarks<q)){if(void 0===r.loadMorePlacemarks){z=[];for(q=r;q;)q.name&&q.name.length&&z.push(q.name),q=q.parent;z.reverse();B=z.join("/");g(1,function(){var q=["There are currently approximately "];q.push(J);
q.push(" entities loaded. ");l?q.push("Reloading overlay "):q.push("Loading additional entities included in overlay ");q.push(B);q.push(" may cause the browser to become unresponsive. Continue loading anyway?");return q.join("")},"Warning - Large Number Of Entities",function(q,B){B&&(M=q);(r.loadMorePlacemarks=q)?m(d,a,e,f,c,l,p,h,r):(r.name=r.name||"",r.name+=" - LOAD CANCELED",f&&f({error:"canceled",doc:r}),!p&&u.parseCallback&&u.parseCallback(r))})}else r.parseCompleteCallback({error:"canceled",
doc:r}),!p&&u.parseCallback&&u.parseCallback(r);return r}if(Y>=N)return++ea,setTimeout(function(){--ea;r.removed||m(d,a,e,f,c,l,p,h,r)},500+10*ea),r;++Y;z=$.ajax({dataType:"xml",url:u.proxy+z});z.done(function(q,a,m){var e,B,b,c;--Y;if(!r.removed){r.fileSize=m.responseText.length;a=l?l.loadLargeFile:U;if(!a){b=T+m.responseText.length;if(l)for(B=[l],l.getAllContainers(B),c=0;c<B.length;c++)B[c].fileSize&&(b-=B[c].fileSize);if(b>1048576*u.maxFileSize){if(void 0===a){a=[];for(B=r;B;)B.name&&B.name.length&&
a.push(B.name),B=B.parent;a.reverse();e=a.join("/");g(0,function(){var q=["Overlay "];q.push(e);q.push(" is ");q.push(W(m.responseText.length));q.push(". After loading it, total loaded data will be ");q.push(W(b));q.push(". Loading so much data may cause the browser to become unresponsive. Load it anyway?");return q.join("")},"Warning - Large File Size",function(a,m){m&&(U=a);(r.loadLargeFile=a)?S(q,r,l,p,d):(r.fileSize=0,--J,r.name=r.name||"",r.name+=" - LOAD CANCELED",f&&f({error:"canceled",doc:r}),
!p&&u.parseCallback&&u.parseCallback(r))});return}if(!a){r.fileSize=0;--J;f&&f({error:"canceled",doc:r});!p&&u.parseCallback&&u.parseCallback(r);return}}}S(q,r,l,p,d)}});z.fail(function(q,a,m){--Y;r.name=r.name||"";r.name+=" - LOAD FAILED";console.log("Failed to load "+d+" - "+a);f&&f({error:a,doc:r});!p&&u.parseCallback&&u.parseCallback(r)});return r}function d(a,m,e,b){var f,c,l,r;if((!a.name||!a.name.length)&&1>=a.containers.length&&!a.features.length&&!a.screenOverlays.length){f=[];for(c=0;c<
a.containers.length;c++)if(r=d(a.containers[0],m,e,b))if($.isArray(r))for(l=0;l<r.length;l++)f.push(r[l]);else f.push(r);return f}f={title:a.name||"[no name]",tooltip:"click to zoom to",key:a.parent?a.internalId:b,isFolder:!0,expand:a.open,select:a.visibility&&m,children:[]};a.parent||(f.isFeature=!0);for(c=0;c<a.containers.length;c++)if(r=d(a.containers[c],f.select,e))if($.isArray(r))for(l=0;l<r.length;l++)f.children.push(r[l]);else f.children.push(r);for(c=0;c<a.features.length;c++)m={title:a.features[c].name||
"[no name]",tooltip:"click to zoom to",key:a.features[c].internalId,select:a.features[c].visibility&&f.select},f.children.push(m);for(c=0;c<a.screenOverlays.length;c++)m={title:a.screenOverlays[c].name||"[no name]",tooltip:"click to zoom to",key:a.screenOverlays[c].internalId,select:a.screenOverlays[c].visibility&&f.select},f.children.push(m);return f}var z={proxy:"",maxFileSize:25,maxPlacemarks:75E3},u,r={},R,N=5,Y=0,ea=0,X,Q=0,U,M,V,J=0,T=0,ga=0;a.prototype.remove=function(){this.image.remove();
this.mask&&this.mask.remove()};a.prototype.setVisible=function(a,d){var m;this.visible=a;if(d&&(this.visibility=a))for(m=this.parent;m&&!m.visibility;)m.visibility=!0,m=m.parent;a?(this.image.show(),this.mask&&this.mask.show()):(this.image.hide(),this.mask&&this.mask.hide())};a.prototype.extendBounds=function(a){};c.prototype.remove=function(){var a;this.removed=!0;for(a=0;a<this.features.length;a++)this.features[a].removeFromMap();jc2cui.mapWidget.infoWindow&&(jc2cui.mapWidget.infoWindow.getMapItem()&&
jc2cui.mapWidget.infoWindow.getMapItem().internalId===this.internalId)&&jc2cui.mapWidget.infoWindow.close();J-=Math.max(1,this.features.length)};c.prototype.setVisible=function(a,d){var m;this.visible=a;if(d&&(this.visibility=a))for(m=this.parent;m&&!m.visibility;)m.visibility=!0,m=m.parent;for(m=0;m<this.features.length;m++)this.features[m].setVisible(a);!a&&(jc2cui.mapWidget.infoWindow&&jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().internalId===this.internalId)&&
jc2cui.mapWidget.infoWindow.close()};c.prototype.getBounds=function(){var a;u.bounds&&(a=u.bounds(),this.extendBounds(a));return a};c.prototype.extendBounds=function(a){var d;for(d=0;d<this.features.length;d++)this.features[d].extendBounds(a)};c.prototype.getAllVisiblePlacemarks=function(a){a=a||[];$.each(this.features,function(d,m){m.getVisible&&m.getVisible()&&a.push(m)});return a};b.prototype.getAllPlacemarks=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllPlacemarks(a);
for(d=0;d<this.features.length;d++)$.merge(a,this.features[d].features);return a};b.prototype.getAllVisiblePlacemarks=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllVisiblePlacemarks(a);for(d=0;d<this.features.length;d++)this.features[d].getAllVisiblePlacemarks(a);return a};b.prototype.remove=function(){var a;--J;this.removed=!0;this.fileSize&&(T-=this.fileSize);for(a=0;a<this.containers.length;a++)this.containers[a].remove();for(a=0;a<this.features.length;a++)this.features[a].remove();
for(a=0;a<this.screenOverlays.length;a++)this.screenOverlays[a].remove(),--J;u.containerRemoved&&u.containerRemoved(this)};b.prototype.setVisible=function(a,d){var m;this.visible=a;if(d&&(this.visibility=a))for(m=this.parent;m&&!m.visibility;)m.visibility=!0,m=m.parent;for(m=0;m<this.containers.length;m++)this.containers[m].setVisible(a,d);for(m=0;m<this.features.length;m++)this.features[m].setVisible(a,d);for(m=0;m<this.screenOverlays.length;m++)this.screenOverlays[m].setVisible(a,d)};b.prototype.extendBounds=
function(a){var d;for(d=0;d<this.containers.length;d++)this.containers[d].extendBounds(a);for(d=0;d<this.features.length;d++)this.features[d].extendBounds(a)};b.prototype.onViewUpdate=function(a){var d,m;this.region&&u.isRegionActive&&(m=u.isRegionActive(this.region),this.visibility&&m!==this.visible&&this.setVisible(m));for(d=0;d<this.containers.length;d++)this.containers[d].onViewUpdate(a);if(u.isRegionActive)for(d=0;d<this.viewSensitiveFeatures.length;d++)a=this.viewSensitiveFeatures[d],a.region&&
(m=u.isRegionActive(a.region),a.visibility&&m!==a.visible&&a.setVisible(m)),!a.icon||"onStop"!==a.icon.viewRefreshMode&&"onRequest"!==a.icon.viewRefreshMode||(clearTimeout(a.stopRefresh),a.stopRefresh=h(a))};b.prototype.getAllContainers=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllContainers(a);$.merge(a,this.containers);return a};b.prototype.getAllFeatures=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllFeatures(a);
$.merge(a,this.features);return a};b.prototype.getAllScreenOverlays=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllScreenOverlays(a);$.merge(a,this.screenOverlays);return a};e.prototype=new b(null,!0);e.prototype.remove=function(){var a;b.prototype.remove.call(this);for(a=0;a<this.intervals.length;a++)clearInterval(this.intervals[a])};e.prototype.onViewUpdate=function(a){var d=this,e;if(!(this.link.viewRefreshMode&&"never"!==this.link.viewRefreshMode||this.region&&
!this.loaded)||"onRegion"===this.link.viewRefreshMode&&this.loaded)b.prototype.onViewUpdate.apply(this,arguments);else if(this.region&&u.isRegionActive&&("onRegion"===this.link.viewRefreshMode||!this.loaded))u.isRegionActive(this.region)&&(this.setVisible(this.visibility),this.loaded=!0,this.loadedDoc=m(this.link.getHref(),this.visible,this,function(a){a=a.doc||this.loadedDoc;d.loadLargeFile=a.loadLargeFile;d.loadMorePlacemarks=a.loadMorePlacemarks}),this.loadedDoc.visibility=this.visibility);else if("onStop"===
this.link.viewRefreshMode||"onRequest"===this.link.viewRefreshMode)clearTimeout(this.stopRefresh),d=this,e="onRequest"===this.link.viewRefreshMode?3E3:Math.max(0,this.link.viewRefreshTime-1E3),this.stopRefresh=setTimeout(function(){if(!this.region||u.isRegionActive&&u.isRegionActive(this.region)){var a=m(d.link.getHref(),d.loadedDoc.visible,d,function(m){var e=a||m.doc;d.loadedDoc.remove();for(m=0;m<d.containers.length;m++)if(d.containers[m]===d.loadedDoc){d.containers.splice(m,1);d.loadedDoc=e;break}d.loadLargeFile=
e.loadLargeFile;d.loadMorePlacemarks=e.loadMorePlacemarks},null,d.loadedDoc);a.visibility=d.loadedDoc.visibility}},e)};x.prototype.getHref=function(){var a=this.href||"";this.viewFormat&&(this.viewFormat.length&&u.formatView)&&(a=0>a.indexOf("?")?a+"?":a+"&",a+=u.formatView(this.viewFormat));return a};return{init:function(a){u=$.extend(!0,{},z,a)},loadKml:function(a,d,e,b,f,c,l,r){return m(a,d,e,function(a){!a.doc&&b&&b(a)},b,f,c,l,r)},parseKmlString:function(a,d,m,e,f){var c=new b(m),l;c.remaining=
1;c.parseCompleteCallback=function(a){!a.doc&&e&&e(a)};c.initialParseCompleteCallback=e;c.visibility=c.visible=d;c.clustering=f;setTimeout(function(){l=$.parseXML(a);S(l,c)},1);return c},Container:b,totalEntities:function(){return J},getEntitiesString:function(a){return"Approximately "+W(T)+" of data containing approximately "+(J+(a||0))+" entities loaded."},getTreeData:d}}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.infoWindow=function(){function s(){var f;!c.containment||c.containment instanceof jQuery||(c.containment=$(c.containment));a=$('<div id="infoWindow" class="infoWindow"><span class="closeInfoWindow"></span><div id="infoWindowContent" class="infoWindowContent"></div></div>').appendTo(c.containment||$("body")).draggable({cancel:"#infoWindowContent",containment:c.containment,cursor:"move"}).resizable({containment:c.containment,stop:function(a,b){e=!0}});f=$(".closeInfoWindow",a).hover(function(){f.addClass("closeInfoWindowOver")},
function(){f.removeClass("closeInfoWindowOver")}).click(function(){jc2cui.mapWidget.infoWindow.close()});b=$("#infoWindowContent");c.zIndex&&a.css("z-index",c.zIndex)}function g(){if(c.containment){var b=e?Math.min(c.containment.innerHeight()-(a.outerHeight()-a.innerHeight())-18,a.height()):Math.min(500,0.6*c.containment.height()),l=e?Math.min(c.containment.innerWidth()-(a.outerWidth()-a.innerWidth())-12,a.width()):Math.min(542,0.6*c.containment.width());a.css("height",Math.max(10,b)+"px");a.css("width",
Math.max(10,l)+"px");if(c.containment){var b=parseInt(a.css("top").replace("px",""),10),l=parseInt(a.css("left").replace("px",""),10),p=c.containment.position();b+a.outerHeight()>c.containment.height()+p.top&&a.css("top",Math.max(p.top,c.containment.height()-a.outerHeight()+p.top)+"px");l+a.outerWidth()>=c.containment.width()&&a.css("left",Math.max(0,c.containment.width()-a.outerWidth())+"px")}}}var a,c,b,h=!0,e=!1,l;return{init:function(a){c=a||{}},open:function(f,t){a||s();f.content&&("string"===
typeof f.content?b.html(f.content):(b.empty(),b.append(f.content)),$("a",b).addClass("external").attr({target:"_blank"}));b.text().length&&(f.width&&(a.css("width",f.width),e=!0),f.height&&(a.css("height",f.height),e=!0),f.bgColor&&(a.css("background-color",f.bgColor),e=!0),f.textColor&&(a.css("color",f.textColor),e=!0),l=t,a.show(),b.scrollTop(0),h&&(h=!1,g(),c.containment&&(a.css("left",Math.max(0,(c.containment.width()-a.outerWidth())/2+c.containment.scrollLeft())+"px"),a.css("top",Math.max(0,
(c.containment.height()-a.outerHeight())/2+c.containment.scrollTop())+"px"))))},close:function(){l=null;a&&a.hide()},setPosition:function(){},checkResize:function(){a&&g()},getMapItem:function(){return l}}}();
(function(s){var g={},a,c=function(a){if(a.match(/[0-9a-fA-F]{3}$/)||a.match(/[0-9a-fA-F]{6}$/))a="#"===a.charAt(0)?a:"#"+a;else if(a.match(/^rgb\(([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5])\)$/)){var b=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],f,c=function(a){var e,b;if(2>a.length)for(e=0,b=2-a.length;e<b;e++)a="0"+a;return a};
3===b.length&&(a=c(b[0].toString(16)),f=c(b[1].toString(16)),b=c(b[2].toString(16)),a="#"+a+f+b)}else a=null;return a},b=function(e){g.control=s("<div class='color-picker'></div>");var b=function(e){e.bind({click:function(b){b=e.css("background-color");b=(b=c(b))||"transparent";g.selector.css("background-color",b);a(!0,b)},mouseover:function(a){e.css("border-color","#598FEF")},mouseout:function(a){e.css("border-color","#000")}});g.control.append(e)};s.each(s.fn.colorPicker.defaultColors,function(a){a=
s("<div class='color_swatch'>&nbsp;</div>");a.css("background-color","#"+this);b(a)});b(s("<div class='nocolor'>transparent</div>"));s("body").append(g.control);e&&(g.iframeShim=document.createElement("iframe"),g.iframeShim.frameBorder=0,g.iframeShim.scrolling="no",g.iframeShim.src="javascript:false;",g.iframeShim.style.position="absolute",g.iframeShim.style.width=g.control.width()+"px",g.iframeShim.style.height=g.control.height()+"px",s("body").append(g.iframeShim))},h=function(e){e.target!==g.control&&
s(e.target).parent()[0]!==g.control[0]&&a()};a=function(a,b){g.control.stop(!0);a?g.control.slideUp("slow",function(){g.control.css("height","")}):(g.control.hide(),g.control.css("height",""));s("body").unbind("mousedown",h);g.iframeShim&&(g.iframeShim.style.zIndex=-500);g.callback&&(g.callback(b),delete g.callback)};s.fn.colorPicker=function(e,c,f){var t=this;return this.css("background-color",e).bind("mouseover",function(a){t.css("border-color","#598FEF")}).bind("mouseout",function(a){t.css("border-color",
"#000")}).click(function(){g.selector=t;g.control||b(f);a();var e=t.offset(),n=Math.max(0,e.top-g.control.height()),E=s(window),e=Math.max(0,e.left),n=Math.min(n,E.height()-g.control.height()),e=Math.min(e,E.width()-g.control.width());g.control.css({left:e+"px",top:n+"px"});g.iframeShim&&(g.iframeShim.style.left=e+"px",g.iframeShim.style.top=n+"px",g.iframeShim.style.zIndex=g.control.css("z-index")-1);g.control.slideDown("slow");g.callback=c;s("body").bind("mousedown",h)})};s.fn.colorPicker.hide=
function(e){a(e)};s.fn.colorPicker.defaultColors="000000 993300 333300 000080 333399 333333 800000 FF6600 808000 008000 008080 0000FF 666699 808080 FF0000 FF9900 99CC00 339966 33CCCC 3366FF 800080 999999 FF00FF FFCC00 FFFF00 00FF00 00FFFF 00CCFF 993366 C0C0C0 FF99CC FFCC99 FFFF99 CCFFFF 99CCFF FFFFFF 15428B DFE8F6".split(" ")})(jQuery);util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.featureEditor=function(){function s(a){var b=$('<div id="marker-icons">').appendTo(a),c,n,g=function(e){return function(c){h.iconUrl=e;$("#characteristicsButton",a.parent()).attr("src",h.iconUrl);$(".marker-icon",b).removeClass("selected");$(this).addClass("selected")}};for(c=0;c<l.length;c++)n=[32*-(c%e),32*-Math.floor(c/e)],$('<a class="marker-icon" tabindex="1"></a>').css("background-position",n[0]+"px "+n[1]+"px").appendTo(b).click(g(l[c]))}function g(a){var e=$('<div><label>line color <input id="strokeColor" type="text"></label><label>line width (pixels) <input id="strokeWeight" type="text"></label><label>line opacity <input id="strokeOpacity" type="text"></label></div>').appendTo(a);
$("#strokeColor",e).colorPicker(h.strokeColor,function(e){h.strokeColor=e;$("#mask",a.parent()).css({"background-color":"line"===h.type?h.strokeColor:h.fillColor,"border-color":h.strokeColor})},b);$("#strokeWeight",e).val(h.strokeWeight).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(h.strokeWeight=a)});$("#strokeOpacity",e).val(Math.floor(100*h.strokeOpacity)).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(a=Math.max(0,Math.min(100,a))/100,h.strokeOpacity=a)})}function a(a){var e=
$('<div><label>fill color <input id="fillColor" type="text"></label><label>fill opacity <input id="fillOpacity" type="text"></label></div>').appendTo(a);$("#fillColor",e).colorPicker(h.fillColor,function(e){h.fillColor=e;$("#mask",a.parent()).css({"background-color":"line"===h.type?h.strokeColor:h.fillColor})},b);$("#fillOpacity",e).val(Math.floor(100*h.fillOpacity)).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(a=Math.max(0,Math.min(100,a))/100,h.fillOpacity=a)})}function c(e,b){var c=
$('<div id="characteristics""><div id="back">back</div></div>').appendTo(b);switch(e){case "marker":s(c);break;case "line":g(c);break;case "shape":g(c),a(c)}return c}var b,h,e=7,l=function(){var a=[],e=["-circle.png","-blank.png","-pushpin.png"],b="blu red grn ltblu ylw purple pink".split(" "),c="dining coffee bars snack_bar tram lodging wheel_chair_accessible shopping movies convenience grocery arts homegardenbusiness electronics mechanic partly_cloudy realestate salon dollar parking_lot gas_stations cabs bus truck rail airports ferry heliport subway info flag earthquake webcam post_office police firedept hospitals info_circle phone caution falling_rocks camera parks campfire picnic campground ranger_station toilets poi hiker cycling motorcycling horsebackriding play golf trail water snowflake_simple marina fishing sailing swimming ski woman man rainy volcano sunny euro yen".split(" "),
l,h,g;for(l=0;l<e.length;l++)for(h=0;h<b.length;h++)g=b[h],a.push([jc2cui.mapWidget.getAppPath(),"images/",g,e[l]].join(""));for(l=0;l<c.length;l++)a.push([jc2cui.mapWidget.getAppPath(),"images/",c[l],".png"].join(""));return a}();return{useShim:function(a){b=a},getEditFeatureHtml:function(a,e){h=a;var b=$(['<div class="editFeature"><div id="outer"><div id="basic"><div class="bold top">Title <input id="title" type="text" id="title" /><div id="mask"><img id="characteristicsButton" src="',h.iconUrl,
'" title="Click to set ',h.type,' characteristics"></div></div><div class="bold section">Description</div><textarea id="description"></textarea></div></div><div class="buttons"><span id="delete" class="button">delete</span><span id="cancel" class="button">cancel</span><span id="ok" class="button">ok</span></div></div>'].join("")),l,g;$("#title",b).val(h.title||"");$("#description",b).val(h.description||"");$("#characteristicsButton",b).click(function(){l||(l=$("#basic",b));g||(g=c(h.type,$("#outer",
b)));$("#back",g).click(function(){g.hide();l.show()});l.hide();g.show()});$("#mask",b).css({"background-color":"marker"===h.type?"transparent":"line"===h.type?h.strokeColor:h.fillColor,"border-color":"marker"===h.type?"transparent":h.strokeColor});$("#delete",b).click(function(){e&&e.deleted&&e.deleted()});$("#ok",b).click(function(){e&&e.updated&&(h.title=$("#title",b).val(),h.description=$("#description",b).val(),e.updated(h))});$("#cancel",b).click(function(){e&&e.canceled&&e.canceled()});return b[0]}}}();
(function(s){for(var g,a=document.getElementsByTagName("head")[0].style,c=["transformProperty","WebkitTransform","OTransform","msTransform","MozTransform"],b=0;b<c.length;b++)void 0!==a[c[b]]&&(g=c[b]);var h=eval('"v"=="\v"');jQuery.fn.extend({rotate:function(a){if(0!==this.length&&"undefined"!=typeof a){"number"==typeof a&&(a={angle:a});for(var b=[],c=0,h=this.length;c<h;c++){var g=this.get(c);if(g.Wilq32&&g.Wilq32.PhotoEffect)g.Wilq32.PhotoEffect._handleRotation(a);else{var n=s.extend(!0,{},a),
g=(new Wilq32.PhotoEffect(g,n))._rootObj;b.push(s(g))}}return b}},getRotateAngle:function(){for(var a=[],b=0,c=this.length;b<c;b++){var h=this.get(b);h.Wilq32&&h.Wilq32.PhotoEffect&&(a[b]=h.Wilq32.PhotoEffect._angle)}return a},stopRotate:function(){for(var a=0,b=this.length;a<b;a++){var c=this.get(a);c.Wilq32&&c.Wilq32.PhotoEffect&&clearTimeout(c.Wilq32.PhotoEffect._timer)}}});Wilq32=window.Wilq32||{};Wilq32.PhotoEffect=function(){return g?function(a,b){a.Wilq32={PhotoEffect:this};this._img=this._rootObj=
this._eventObj=a;this._handleRotation(b)}:h?function(a,b){this._img=a;this._rootObj=document.createElement("span");this._rootObj.style.display="inline-block";this._rootObj.Wilq32={PhotoEffect:this};a.parentNode.insertBefore(this._rootObj,a);this._Loader(b)}:function(a,b){this._rootObj=a}}();Wilq32.PhotoEffect.prototype={_setupParameters:function(a){this._parameters=this._parameters||{};"number"!==typeof this._angle&&(this._angle=0);"number"===typeof a.angle&&(this._angle=a.angle);this._parameters.animateTo=
"number"===typeof a.animateTo?a.animateTo:this._angle;this._parameters.step=a.step||this._parameters.step||null;this._parameters.easing=a.easing||this._parameters.easing||function(a,b,e,c,h){return-c*((b=b/h-1)*b*b*b-1)+e};this._parameters.duration=a.duration||this._parameters.duration||1E3;this._parameters.callback=a.callback||this._parameters.callback||function(){};a.bind&&a.bind!=this._parameters.bind&&this._BindEvents(a.bind)},_handleRotation:function(a){this._setupParameters(a);this._angle==
this._parameters.animateTo?this._rotate(this._angle):this._animateStart()},_BindEvents:function(a){if(a&&this._eventObj){if(this._parameters.bind){var b=this._parameters.bind,c;for(c in b)b.hasOwnProperty(c)&&jQuery(this._eventObj).unbind(c,b[c])}this._parameters.bind=a;for(c in a)a.hasOwnProperty(c)&&jQuery(this._eventObj).bind(c,a[c])}},_Loader:function(a){this._rootObj.appendChild(this._img);this._rootObj.style.width=this._img.offsetWidth;this._rootObj.style.height=this._img.offsetHeight;this._img.style.position=
"absolute";this._rootObj=this._img;this._rootObj.Wilq32={PhotoEffect:this};this._rootObj.style.filter+="progid:DXImageTransform.Microsoft.Matrix(M11=1,M12=1,M21=1,M22=1,sizingMethod='auto expand')";this._eventObj=this._rootObj;this._handleRotation(a)},_animateStart:function(){this._timer&&clearTimeout(this._timer);this._animateStartTime=+new Date;this._animateStartAngle=this._angle;this._animate()},_animate:function(){var a=+new Date,b=a-this._animateStartTime>this._parameters.duration;if(b&&!this._parameters.animatedGif)clearTimeout(this._timer);
else{if(this._canvas||this._vimage||this._img)a=this._parameters.easing(0,a-this._animateStartTime,this._animateStartAngle,this._parameters.animateTo-this._animateStartAngle,this._parameters.duration),this._rotate(~~(10*a)/10);this._parameters.step&&this._parameters.step(this._angle);var c=this;this._timer=setTimeout(function(){c._animate.call(c)},10)}this._parameters.callback&&b&&(this._angle=this._parameters.animateTo,this._rotate(this._angle),this._parameters.callback.call(this._rootObj))},_rotate:function(){var a=
Math.PI/180;if(h)return function(b){this._angle=b;b*=a;costheta=Math.cos(b);sintheta=Math.sin(b);b=this._rootObj.filters.item("DXImageTransform.Microsoft.Matrix");b.M11=costheta;b.M12=-sintheta;b.M21=sintheta;b.M22=costheta;this._rootObj.style.marginLeft=-(this._rootObj.offsetWidth-this._rootObj.clientWidth)/2+"px";this._rootObj.style.marginTop=-(this._rootObj.offsetHeight-this._rootObj.clientHeight)/2+"px"};if(g)return function(a){this._angle=a;this._img.style[g]="rotate("+a%360+"deg)"}}()}})(jQuery);
document.createElement("canvas").getContext||function(){function s(){return this.context_||(this.context_=new t(this))}function g(a,d,b){var e=ba.call(arguments,2);return function(){return a.apply(d,e.concat(ba.call(arguments)))}}function a(a){var d=a.srcElement;switch(a.propertyName){case "width":d.style.width=d.attributes.width.nodeValue+"px";d.getContext().clearRect();break;case "height":d.style.height=d.attributes.height.nodeValue+"px",d.getContext().clearRect()}}function c(a){a=a.srcElement;
a.firstChild&&(a.firstChild.style.width=a.clientWidth+"px",a.firstChild.style.height=a.clientHeight+"px")}function b(){return[[1,0,0],[0,1,0],[0,0,1]]}function h(a,d){for(var e=b(),c=0;3>c;c++)for(var f=0;3>f;f++){for(var l=0,h=0;3>h;h++)l+=a[c][h]*d[h][f];e[c][f]=l}return e}function e(a,d){d.fillStyle=a.fillStyle;d.lineCap=a.lineCap;d.lineJoin=a.lineJoin;d.lineWidth=a.lineWidth;d.miterLimit=a.miterLimit;d.shadowBlur=a.shadowBlur;d.shadowColor=a.shadowColor;d.shadowOffsetX=a.shadowOffsetX;d.shadowOffsetY=
a.shadowOffsetY;d.strokeStyle=a.strokeStyle;d.globalAlpha=a.globalAlpha;d.font=a.font;d.textAlign=a.textAlign;d.textBaseline=a.textBaseline;d.arcScaleX_=a.arcScaleX_;d.arcScaleY_=a.arcScaleY_;d.lineScale_=a.lineScale_;d.rotation_=a.rotation_}function l(a){var d,b=1;a=String(a);if("rgb"==a.substring(0,3)){d=a.indexOf("(",3);var e=a.indexOf(")",d+1),e=a.substring(d+1,e).split(",");d="#";for(var c=0;3>c;c++)d+=da[Number(e[c])];4==e.length&&"a"==a.substr(3,1)&&(b=e[3])}else d=a;return{color:d,alpha:b}}
function f(a){switch(a){case "butt":return"flat";case "round":return"round";default:return"square"}}function t(a){this.m_=b();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=1*G;this.globalAlpha=1;this.font="10px sans-serif";this.textAlign="left";this.textBaseline="alphabetic";this.canvas=a;var d=a.ownerDocument.createElement("div");d.style.width=a.clientWidth+"px";d.style.height=
a.clientHeight+"px";d.style.overflow="hidden";d.style.position="absolute";a.appendChild(d);this.element_=d;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1;this.rotation_=0}function p(a,d,b,e){a.currentPath_.push({type:"bezierCurveTo",cp1x:d.x,cp1y:d.y,cp2x:b.x,cp2y:b.y,x:e.x,y:e.y});a.currentX_=e.x;a.currentY_=e.y}function n(a,d,b){var e;a:{for(e=0;3>e;e++)for(var c=0;2>c;c++)if(!isFinite(d[e][c])||isNaN(d[e][c])){e=!1;break a}e=!0}e&&(a.m_=d,b&&(a.lineScale_=O(L(d[0][0]*d[1][1]-d[0][1]*d[1][0]))))}
function E(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;")}function A(a,d,b,e){var c=a.fillStyle,f=a.arcScaleX_,h=a.arcScaleY_,g=e.x-b.x,n=e.y-b.y;if(c instanceof v){var p=0,y=e=0,t=0,A=1;if("gradient"==c.type_){p=c.x1_/f;b=c.y1_/h;var E=getCoords(a,c.x0_/f,c.y0_/h),p=getCoords(a,p,b),p=180*Math.atan2(p.x-E.x,p.y-E.y)/Math.PI;0>p&&(p+=360);1E-6>p&&(p=0)}else E=getCoords(a,c.x0_,c.y0_),e=(E.x-b.x)/g,y=(E.y-b.y)/n,g/=f*G,n/=h*G,A=D.max(g,n),t=2*c.r0_/A,A=2*c.r1_/A-t;f=c.colors_;f.sort(function(a,
d){return a.offset-d.offset});h=f.length;E=f[0].color;b=f[h-1].color;g=f[0].alpha*a.globalAlpha;a=f[h-1].alpha*a.globalAlpha;for(var n=[],s=0;s<h;s++){var w=f[s];n.push(w.offset*A+t+" "+w.color)}d.push('<g_vml_:fill type="',c.type_,'"',' method="none" focus="100%"',' color="',E,'"',' color2="',b,'"',' colors="',n.join(","),'"',' opacity="',a,'"',' g_o_:opacity2="',g,'"',' angle="',p,'"',' focusposition="',e,",",y,'" />')}else c instanceof x?g&&n&&d.push("<g_vml_:fill",' position="',-b.x/g*f*f,",",
-b.y/n*h*h,'"',' type="tile"',' src="',c.src_,'" />'):(c=l(a.fillStyle),d.push('<g_vml_:fill color="',c.color,'" opacity="',c.alpha*a.globalAlpha,'" />'))}function v(a){this.type_=a;this.r1_=this.y1_=this.x1_=this.r0_=this.y0_=this.x0_=0;this.colors_=[]}function x(){}var D=Math,y=D.round,F=D.sin,H=D.cos,L=D.abs,O=D.sqrt,G=10,P=G/2,ba=Array.prototype.slice,ca={init:function(a){/MSIE/.test(navigator.userAgent)&&!window.opera&&(a=a||document,a.createElement("canvas"),"complete"!==a.readyState?a.attachEvent("onreadystatechange",
g(this.init_,this,a)):this.init_(a))},init_:function(a){a.namespaces.g_vml_||a.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");a.namespaces.g_o_||a.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!a.styleSheets.ex_canvas_){var d=a.createStyleSheet();d.owningElement.id="ex_canvas_";d.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}a=
a.getElementsByTagName("canvas");for(d=0;d<a.length;d++)this.initElement(a[d])},initElement:function(b){if(!b.getContext){b.getContext=s;b.innerHTML="";b.attachEvent("onpropertychange",a);b.attachEvent("onresize",c);var d=b.attributes;d.width&&d.width.specified?b.style.width=d.width.nodeValue+"px":b.width=b.clientWidth;d.height&&d.height.specified?b.style.height=d.height.nodeValue+"px":b.height=b.clientHeight}return b}};ca.init();for(var da=[],w=0;16>w;w++)for(var S=0;16>S;S++)da[16*w+S]=w.toString(16)+
S.toString(16);w=t.prototype;w.clearRect=function(){this.element_.innerHTML=""};w.beginPath=function(){this.currentPath_=[]};w.moveTo=function(a,d){var b=this.getCoords_(a,d);this.currentPath_.push({type:"moveTo",x:b.x,y:b.y});this.currentX_=b.x;this.currentY_=b.y};w.lineTo=function(a,d){var b=this.getCoords_(a,d);this.currentPath_.push({type:"lineTo",x:b.x,y:b.y});this.currentX_=b.x;this.currentY_=b.y};w.bezierCurveTo=function(a,d,b,e,c,f){c=this.getCoords_(c,f);a=this.getCoords_(a,d);b=this.getCoords_(b,
e);p(this,a,b,c)};w.quadraticCurveTo=function(a,d,b,e){a=this.getCoords_(a,d);b=this.getCoords_(b,e);e={x:this.currentX_+2/3*(a.x-this.currentX_),y:this.currentY_+2/3*(a.y-this.currentY_)};p(this,e,{x:e.x+(b.x-this.currentX_)/3,y:e.y+(b.y-this.currentY_)/3},b)};w.arc=function(a,d,b,e,c,f){b*=G;var l=f?"at":"wa",h=a+H(e)*b-P,g=d+F(e)*b-P;e=a+H(c)*b-P;c=d+F(c)*b-P;h!=e||f||(h+=0.125);a=this.getCoords_(a,d);h=this.getCoords_(h,g);e=this.getCoords_(e,c);this.currentPath_.push({type:l,x:a.x,y:a.y,radius:b,
xStart:h.x,yStart:h.y,xEnd:e.x,yEnd:e.y})};w.rect=function(a,d,b,e){this.moveTo(a,d);this.lineTo(a+b,d);this.lineTo(a+b,d+e);this.lineTo(a,d+e);this.closePath()};w.strokeRect=function(a,d,b,e){var c=this.currentPath_;this.beginPath();this.moveTo(a,d);this.lineTo(a+b,d);this.lineTo(a+b,d+e);this.lineTo(a,d+e);this.closePath();this.stroke();this.currentPath_=c};w.fillRect=function(a,d,b,e){var c=this.currentPath_;this.beginPath();this.moveTo(a,d);this.lineTo(a+b,d);this.lineTo(a+b,d+e);this.lineTo(a,
d+e);this.closePath();this.fill();this.currentPath_=c};w.createLinearGradient=function(a,d,b,e){var c=new v("gradient");c.x0_=a;c.y0_=d;c.x1_=b;c.y1_=e;return c};w.createRadialGradient=function(a,d,b,e,c,f){var l=new v("gradientradial");l.x0_=a;l.y0_=d;l.r0_=b;l.x1_=e;l.y1_=c;l.r1_=f;return l};getTheDistanceTo=function(a,d){var b=a.y,e=d.y;return Math.sqrt(Math.pow(a.x-d.x,2)+Math.pow(b-e,2))};doRotate=function(a,d,b){a*=Math.PI/180;var e=getTheDistanceTo(b,d);a+=Math.atan2(b.y-d.y,b.x-d.x);b.x=d.x+
e*Math.cos(a);b.y=d.y+e*Math.sin(a)};getAdjustedBounds=function(a,d){if(a&&d){if(null==a.left||d.left<a.left)a.left=d.left;if(null==a.bottom||d.bottom<a.bottom)a.bottom=d.bottom;if(null==a.right||d.right>a.right)a.right=d.right;if(null==a.top||d.top>a.top)a.top=d.top}};getAdjustedTopLeft=function(a,d,b,e,c,f,l){var h={x:-b,y:-e},g={x:0,y:0},n={x:c,y:0};c={x:c,y:f};f={x:0,y:f};var p={left:null,bottom:null,right:null,top:null};a+=b;d+=e;doRotate(l,h,g);doRotate(l,h,n);doRotate(l,h,c);doRotate(l,h,f);
getAdjustedBounds(p,{left:g.x,bottom:g.y,right:g.x,top:g.y});getAdjustedBounds(p,{left:n.x,bottom:n.y,right:n.x,top:n.y});getAdjustedBounds(p,{left:c.x,bottom:c.y,right:c.x,top:c.y});getAdjustedBounds(p,{left:f.x,bottom:f.y,right:f.x,top:f.y});return{top:Math.round(d+p.bottom),left:Math.round(a+p.left)}};w.drawImageWithRotate=function(a,d,b,e,c,f,l,g){var n=a.runtimeStyle.width;if(n){var p=a.runtimeStyle.width,x=a.runtimeStyle.height;a.runtimeStyle.width="auto";a.runtimeStyle.height="auto"}var v=
a.width,y=a.height;n&&(a.runtimeStyle.width=p,a.runtimeStyle.height=x);sx=sy=0;sw=v;sh=y;this.getCoords_(e,c);n=[];x=scaleY=1;n.push(' <div style="position:absolute;');var p=[],x=H(this.rotation_),t=F(this.rotation_),t=h([[x,-t,0],[t,x,0],[0,0,1]],this.m_),x=t[0][0];scaleY=t[1][1];var A=g*(Math.PI/180),t=Math.cos(A),A=Math.sin(A);p.push("M11=",t,",","M12=",-A,",","M21=",A,",","M22=",t);d=getAdjustedTopLeft(d,b,e,c,f,l,g);n.push("top:",d.top,"px;left:",d.left,"px;filter:progid:DXImageTransform.Microsoft.Matrix(",
p.join(""),", sizingmethod='auto expand');");n.push(' ">');n.push('<div style="width:',Math.round(x*v*f/sw),"px;"," height:",Math.round(scaleY*y*l/sh),"px;"," filter:");1>this.globalAlpha&&n.push(" progid:DXImageTransform.Microsoft.Alpha(opacity="+100*this.globalAlpha+")");n.push(" progid:DXImageTransform.Microsoft.AlphaImageLoader(src=",a.src,',sizingMethod=scale)">');n.push("</div></div>");this.element_.insertAdjacentHTML("beforeEnd",n.join(""))};w.drawImage=function(a){var d,b,e,c,f,l,g,n;if(e=
a.runtimeStyle.width)c=a.runtimeStyle.width,f=a.runtimeStyle.height,a.runtimeStyle.width="auto",a.runtimeStyle.height="auto";var p=a.width,x=a.height;e&&(a.runtimeStyle.width=c,a.runtimeStyle.height=f);if(3==arguments.length)d=arguments[1],b=arguments[2],f=l=0,g=e=p,n=c=x;else if(5==arguments.length)d=arguments[1],b=arguments[2],e=arguments[3],c=arguments[4],f=l=0,g=p,n=x;else if(9==arguments.length)f=arguments[1],l=arguments[2],g=arguments[3],n=arguments[4],d=arguments[5],b=arguments[6],e=arguments[7],
c=arguments[8];else throw Error("Invalid number of arguments");var v=this.getCoords_(d,b),t=[],A=scaleY=1;t.push(' <div style="position:absolute;');if(1!=this.m_[0][0]||this.m_[0][1]||1!=this.m_[1][1]||this.m_[1][0]){var E=[],s=H(this.rotation_),w=F(this.rotation_),k=h([[s,-w,0],[w,s,0],[0,0,1]],this.m_),A=k[0][0];scaleY=k[1][1];E.push("M11=",s,",","M12=",-w,",","M21=",w,",","M22=",s,",","Dx=",v.x/G,",","Dy=",v.y/G);s=this.getCoords_(d+e,b);w=this.getCoords_(d,b+c);d=this.getCoords_(d+e,b+c);v.x=
D.max(v.x,s.x,w.x,d.x);v.y=D.max(v.y,s.y,w.y,d.y);t.push("padding:0 ",y(v.x/G),"px ",y(v.y/G),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",E.join(""),", sizingmethod='clip');")}else t.push("top:",y(v.y/G),"px;left:",y(v.x/G),"px;");t.push(' ">');(f||l)&&t.push('<div style="overflow: hidden; width:',Math.ceil((e+f*e/g)*A),"px;"," height:",Math.ceil((c+l*c/n)*scaleY),"px;"," filter:progid:DxImageTransform.Microsoft.Matrix(Dx=",-f*e/g*A,",Dy=",-l*c/n*scaleY,');">');t.push('<div style="width:',
Math.round(A*p*e/g),"px;"," height:",Math.round(scaleY*x*c/n),"px;"," filter:");1>this.globalAlpha&&t.push(" progid:DXImageTransform.Microsoft.Alpha(opacity="+100*this.globalAlpha+")");t.push(" progid:DXImageTransform.Microsoft.AlphaImageLoader(src=",a.src,',sizingMethod=scale)">');(f||l)&&t.push("</div>");t.push("</div></div>");this.element_.insertAdjacentHTML("beforeEnd",t.join(""))};w.stroke=function(a){var d=[],b=l(a?this.fillStyle:this.strokeStyle),e=b.color,b=b.alpha*this.globalAlpha;d.push("<g_vml_:shape",
' filled="',!!a,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0 0" coordsize="',10*G," ",10*G,'"',' stroked="',!a,'"',' path="');for(var c=null,h=null,g=null,n=null,p=0;p<this.currentPath_.length;p++){var t=this.currentPath_[p];switch(t.type){case "moveTo":d.push(" m ",y(t.x),",",y(t.y));break;case "lineTo":d.push(" l ",y(t.x),",",y(t.y));break;case "close":d.push(" x ");t=null;break;case "bezierCurveTo":d.push(" c ",y(t.cp1x),",",y(t.cp1y),",",y(t.cp2x),",",y(t.cp2y),
",",y(t.x),",",y(t.y));break;case "at":case "wa":d.push(" ",t.type," ",y(t.x-this.arcScaleX_*t.radius),",",y(t.y-this.arcScaleY_*t.radius)," ",y(t.x+this.arcScaleX_*t.radius),",",y(t.y+this.arcScaleY_*t.radius)," ",y(t.xStart),",",y(t.yStart)," ",y(t.xEnd),",",y(t.yEnd))}if(t){if(null==c||t.x<c)c=t.x;if(null==g||t.x>g)g=t.x;if(null==h||t.y<h)h=t.y;if(null==n||t.y>n)n=t.y}}d.push(' ">');if(a)if("object"==typeof this.fillStyle){var e=this.fillStyle,v=0,t=b=a=0,x=1;"gradient"==e.type_?(v=e.x1_/this.arcScaleX_,
c=e.y1_/this.arcScaleY_,p=this.getCoords_(e.x0_/this.arcScaleX_,e.y0_/this.arcScaleY_),v=this.getCoords_(v,c),v=180*Math.atan2(v.x-p.x,v.y-p.y)/Math.PI,0>v&&(v+=360),1E-6>v&&(v=0)):(p=this.getCoords_(e.x0_,e.y0_),t=g-c,x=n-h,a=(p.x-c)/t,b=(p.y-h)/x,t/=this.arcScaleX_*G,x/=this.arcScaleY_*G,p=D.max(t,x),t=2*e.r0_/p,x=2*e.r1_/p-t);c=e.colors_;c.sort(function(a,d){return a.offset-d.offset});for(var h=c.length,n=c[0].color,g=c[h-1].color,A=c[0].alpha*this.globalAlpha,E=c[h-1].alpha*this.globalAlpha,s=
[],p=0;p<h;p++){var w=c[p];s.push(w.offset*x+t+" "+w.color)}d.push('<g_vml_:fill type="',e.type_,'"',' method="none" focus="100%"',' color="',n,'"',' color2="',g,'"',' colors="',s.join(","),'"',' opacity="',E,'"',' g_o_:opacity2="',A,'"',' angle="',v,'"',' focusposition="',a,",",b,'" />')}else d.push('<g_vml_:fill color="',e,'" opacity="',b,'" />');else a=this.lineScale_*this.lineWidth,1>a&&(b*=a),d.push("<g_vml_:stroke",' opacity="',b,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,
'"',' endcap="',f(this.lineCap),'"',' weight="',a,'px"',' color="',e,'" />');d.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",d.join(""))};w.fill=function(){this.stroke(!0)};w.closePath=function(){this.currentPath_.push({type:"close"})};w.getCoords_=function(a,d){var b=this.m_;return{x:G*(a*b[0][0]+d*b[1][0]+b[2][0])-P,y:G*(a*b[0][1]+d*b[1][1]+b[2][1])-P}};w.save=function(){var a={};e(this,a);this.aStack_.push(a);this.mStack_.push(this.m_);this.m_=h(b(),this.m_)};w.restore=function(){e(this.aStack_.pop(),
this);this.m_=this.mStack_.pop()};w.translate=function(a,d){n(this,h([[1,0,0],[0,1,0],[a,d,1]],this.m_),!1)};w.rotate=function(a){var d=H(a),b=F(a);this.rotation_+=a;n(this,h([[d,b,0],[-b,d,0],[0,0,1]],this.m_),!1)};w.scale=function(a,d){this.arcScaleX_*=a;this.arcScaleY_*=d;n(this,h([[a,0,0],[0,d,0],[0,0,1]],this.m_),!0)};w.transform=function(a,d,b,e,c,f){n(this,h([[a,d,0],[b,e,0],[c,f,1]],this.m_),!0)};w.setTransform=function(a,d,b,e,c,f){n(this,[[a,d,0],[b,e,0],[c,f,1]],!0)};var W={};w.drawText_=
function(a,d,b,e,c){var f=this.m_;e=0;var l=1E3,h=0,g=[],n;n=this.font;if(W[n])n=W[n];else{var p=document.createElement("div").style;try{p.font=n}catch(t){}n=W[n]={style:p.fontStyle||"normal",variant:p.fontVariant||"normal",weight:p.fontWeight||"normal",size:p.fontSize||10,family:p.fontFamily||"sans-serif"}}var p=n,v=this.element_;n={};for(var x in p)n[x]=p[x];x=parseFloat(v.currentStyle.fontSize);v=parseFloat(p.size);"number"==typeof p.size?n.size=p.size:-1!=p.size.indexOf("px")?n.size=v:-1!=p.size.indexOf("em")?
n.size=x*v:-1!=p.size.indexOf("%")?n.size=x/100*v:-1!=p.size.indexOf("pt")?n.size=v/0.75:n.size=x;n.size*=0.981;x=n.style+" "+n.variant+" "+n.weight+" "+n.size+"px "+n.family;v=this.element_.currentStyle;p=this.textAlign.toLowerCase();switch(p){case "left":case "center":case "right":break;case "end":p="ltr"==v.direction?"right":"left";break;case "start":p="rtl"==v.direction?"right":"left";break;default:p="left"}switch(this.textBaseline){case "hanging":case "top":h=n.size/1.75;break;case "middle":break;
default:case null:case "alphabetic":case "ideographic":case "bottom":h=-n.size/2.25}switch(p){case "right":e=1E3;l=0.05;break;case "center":e=l=500}d=this.getCoords_(d+0,b+h);g.push('<g_vml_:line from="',-e,' 0" to="',l,' 0.05" ',' coordsize="100 100" coordorigin="0 0"',' filled="',!c,'" stroked="',!!c,'" style="position:absolute;width:1px;height:1px;">');c?appendStroke(this,g):A(this,g,{x:-e,y:0},{x:l,y:n.size});c=f[0][0].toFixed(3)+","+f[1][0].toFixed(3)+","+f[0][1].toFixed(3)+","+f[1][1].toFixed(3)+
",0,0";d=y(d.x/G)+","+y(d.y/G);g.push('<g_vml_:skew on="t" matrix="',c,'" ',' offset="',d,'" origin="',e,' 0" />','<g_vml_:path textpathok="true" />','<g_vml_:textpath on="true" string="',E(a),'" style="v-text-align:',p,";font:",E(x),'" /></g_vml_:line>');this.element_.insertAdjacentHTML("beforeEnd",g.join(""))};w.fillText=function(a,d,b,e){this.drawText_(a,d,b,e,!1)};w.strokeText=function(a,d,b,e){this.drawText_(a,d,b,e,!0)};w.measureText=function(a){this.textMeasureEl_||(this.element_.insertAdjacentHTML("beforeEnd",
'<span style="position:absolute;top:-20000px;left:0;padding:0;margin:0;border:none;white-space:pre;"></span>'),this.textMeasureEl_=this.element_.lastChild);var d=this.element_.ownerDocument;this.textMeasureEl_.innerHTML="";this.textMeasureEl_.style.font=this.font;this.textMeasureEl_.appendChild(d.createTextNode(a));return{width:this.textMeasureEl_.offsetWidth}};w.clip=function(){};w.arcTo=function(){};w.createPattern=function(){return new x};v.prototype.addColorStop=function(a,d){d=l(d);this.colors_.push({offset:a,
color:d.color,alpha:d.alpha})};G_vmlCanvasManager=ca;CanvasRenderingContext2D=t;CanvasGradient=v;CanvasPattern=x}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.markerOverlay=function(){function s(a,b,c){for(var h,g,n;b;){if(b.overlayId){h=b.overlayId;g=b.featureId;break}b=b.parent}n={selectedId:a.id||void 0,selectedName:a.name||void 0,featureId:g,overlayId:h};setTimeout(function(){jc2cui.mapWidget.showPlacemarkInfoWindow(a);jc2cui.mapWidget.itemSelected(n)},1)}function g(a,b){google.maps.Overlay.call(this);this.map=a;this.placemarks=[];this.doc=b;this.markerLayer=$('<div class="marker-overlay"/>');this.mouseOverTimeout=0;this.toolTip=null;
this.topCanvas=this.leftCanvas=0;this.needsSorting=!0;this.lastSize=a.getSize();var c=this;this.dragEndListener=google.maps.Event.addListener(this.map,"dragend",function(){c.doRedraw()});this.resizeMapListener=google.maps.Event.addListener(this.map,"resize",function(){var b=a.getSize();if(2<Math.abs(c.lastSize.width-b.width)||2<Math.abs(c.lastSize.height-b.height))c.lastSize=b,c.doRedraw()});this.mouseOutMapListener=google.maps.Event.addListener(this.map,"mouseout",function(a){clearTimeout(c.mouseOverTimeout);
null!==c.toolTip&&($(".markerCanvas",c.map.getContainer()).css("cursor","inherit"),c.toolTip.remove())});this.clickMapListener=google.maps.Event.addListener(this.map,"click",function(a,e,h){a=e||h;var g;clearTimeout(c.mouseOverTimeout);null!==c.toolTip&&($(".markerCanvas",c.map.getContainer()).css("cursor","inherit"),c.toolTip.remove());if(a&&!a.mouseClickHandled)for(e=c.map.fromLatLngToDivPixel(a),e.x-=c.leftCanvas,e.y-=c.topCanvas,h=c.placemarks.length-1;0<=h;h--)if(g=c.placemarks[h].placemark,
g.visible&&g.hitRegion&&g.hitRegion.minX<=e.x&&g.hitRegion.maxX>=e.x&&g.hitRegion.minY<=e.y&&g.hitRegion.maxY>=e.y){s(g,b);a.mouseClickHandled=!0;break}});this.mouseMoveMapListener=google.maps.Event.addListener(this.map,"mousemove",function(a){var b,e,h;a.equals(this.lastMouseMove)||(this.lastMouseMove=a,null!==c.toolTip&&($(".markerCanvas",c.map.getContainer()).css("cursor","inherit"),c.toolTip.remove()),clearTimeout(c.mouseOverTimeout),c.mouseOverTimeout=setTimeout(function(){if(!a.mouseMoveHandled)for(b=
c.map.fromLatLngToDivPixel(a),b.x-=c.leftCanvas,b.y-=c.topCanvas,e=c.placemarks.length-1;0<=e;e--)if(h=c.placemarks[e].placemark,h.visible&&h.hitRegion&&h.name&&h.hitRegion.minX<=b.x&&h.hitRegion.maxX>=b.x&&h.hitRegion.minY<=b.y&&h.hitRegion.maxY>=b.y){$(".markerCanvas",c.map.getContainer()).css("cursor","pointer");c.toolTip=$('<span class="placeMarkTooltip">'+h.name+"</span>").appendTo(c.map.getContainer()).css({left:(b.x+18).toString()+"px",top:(b.y-9).toString()+"px"});a.mouseMoveHandled=!0;break}},
500))});this.map.addOverlay(this)}function a(){g.prototype=new google.maps.Overlay;g.prototype.initialize=function(a){a.getPane(G_MAP_MARKER_SHADOW_PANE).appendChild(this.markerLayer[0])};g.prototype.removeFromMap=function(){this.ieMarkerOverlay?this.ieMarkerOverlay.remove():this.map.removeOverlay(this)};g.prototype.remove=function(){clearTimeout(this.mouseOverTimeout);this.toolTip&&($(".markerCanvas",this.map.getContainer()).css("cursor","inherit"),this.toolTip.remove());this.killCurrentDraw();google.maps.Event.removeListener(this.dragEndListener);
google.maps.Event.removeListener(this.resizeMapListener);google.maps.Event.removeListener(this.mouseOutMapListener);google.maps.Event.removeListener(this.clickMapListener);google.maps.Event.removeListener(this.mouseMoveMapListener);this.markerLayer.remove();delete this.markerLayer};g.prototype.hide=function(){this.ieMarkerOverlay?this.ieMarkerOverlay.hide():this.markerLayer.hide()};g.prototype.show=function(){this.ieMarkerOverlay?this.ieMarkerOverlay.show():this.markerLayer.show()};g.prototype.copy=
function(){var a=new g(this.doc,this.doc);a.placemarks=this.placemarks.slice();return a};g.prototype.addMarker=function(a,h){a.addedToMarkerOverlay=!0;if(this.ieMarkerOverlay)this.ieMarkerOverlay.addMarker(a,h);else{var f=this,g,p;this.placemarks.push({placemark:a,latLng:h});b&&100<=this.placemarks.length&&(p=new jc2cui.mapWidget.markerOverlayIE.MarkerOverlay(this.map,this.doc,this.placemarks),this.map.removeOverlay(this),this.ieMarkerOverlay=p);this.needsSorting=!0;a.visible&&(this.redrawNeeded=
!0);g=a.style&&a.style.IconStyle&&a.style.IconStyle.Icon&&a.style.IconStyle.Icon.href?a.style.IconStyle.Icon.href:jc2cui.mapWidget.getDefaultIcon();c[g]||(c[g]=new Image,this.imagesLoading=this.imagesLoading?this.imagesLoading+1:1,c[g].onload=function(){f.imagesLoading--;f.needsDraw&&(f.needsDraw=!1,f.doRedraw())},c[g].onerror=function(){console.log("Error thrown, image "+c[g].src+" didn't load, probably a 404.");c[g].src=jc2cui.mapWidget.getErrorIcon()},c[g].src=g)}};g.prototype.removeMarker=function(a){a.addedToMarkerOverlay=
!1;if(this.ieMarkerOverlay)this.ieMarkerOverlay.removeMarker(a);else{var b=-1;$.each(this.placemarks,function(c,h){if(a===h.placemark)return b=c,!1});-1<b&&this.placemarks.splice(b,1)}};g.prototype.killCurrentDraw=function(a){clearTimeout(this.redrawTimeout);clearTimeout(this.doDrawTimeout);this.canvas=null};g.prototype.doRedraw=function(){if(this.ieMarkerOverlay)this.ieMarkerOverlay.doRedraw();else if(this.markerLayer){var a=this;this.killCurrentDraw();this.redrawNeeded=!0;a.redrawTimeout=setTimeout(function(){a.redrawNeeded&&
a.redraw(!0)},b?100:10)}};g.prototype.placemarkVisibilityChanged=function(a){if(this.ieMarkerOverlay)return this.ieMarkerOverlay.placemarkVisibilityChanged(a);this.doRedraw()};g.prototype.drawPlacemarks=function(a,l,f,g){var p,n,s,A,v,x,D,y,F,H,L=jc2cui.mapWidget.options().labels&&jc2cui.mapWidget.options().labels.value;g=g||0;for(p=0;p<this.placemarks.length&&p<g+500;p++){if(this.doc.removed||this.canvas!==a)return;n=this.placemarks[p].placemark;!n.visible||n.style&&n.style.IconStyle&&n.style.IconStyle.Icon&&
void 0!==n.style.IconStyle.Icon.href&&!n.style.IconStyle.Icon.href||(s=this.map.fromLatLngToDivPixel(this.placemarks[p].latLng),A=n.style&&n.style.IconStyle&&n.style.IconStyle.scale?n.style.IconStyle.scale:1,n.style&&n.style.IconStyle&&n.style.IconStyle.Icon&&n.style.IconStyle.Icon.href&&0<=n.style.IconStyle.Icon.href.indexOf("http://maps.google.com/mapfiles/kml")?(x=v=64,A/=2):x=v=32,0!==A&&(v*=A,x*=A,n.style&&n.style.IconStyle&&n.style.IconStyle.hotSpot?(D=n.style.IconStyle.hotSpot.x,y=n.style.IconStyle.hotSpot.y,
"pixels"===n.style.IconStyle.hotSpot.xunits&&(D=-D*A),"insetPixels"===n.style.IconStyle.hotSpot.xunits&&(D=-v+D*A),"fraction"===n.style.IconStyle.hotSpot.xunits&&(D*=-v),"pixels"===n.style.IconStyle.hotSpot.yunits&&(y=-x+y*A+1),"insetPixels"===n.style.IconStyle.hotSpot.yunits&&(y=-(y*A)+1),"fraction"===n.style.IconStyle.hotSpot.yunits&&(y=-x*(1-y)+1)):(D=n.style&&n.style.IconStyle&&n.style.IconStyle.Icon&&n.style.IconStyle.Icon.href?-v/2:0.625*-v,y=-x/2),A=s.x-this.leftCanvas,s=s.y-this.topCanvas,
n.hitRegion=n.hitRegion||{},n.hitRegion.minX=A+D,n.hitRegion.minY=s+y,n.hitRegion.maxX=A+D+v,n.hitRegion.maxY=s+y+x,F=n.style&&n.style.IconStyle&&n.style.IconStyle.Icon&&n.style.IconStyle.Icon.href?n.style.IconStyle.Icon.href:jc2cui.mapWidget.getDefaultIcon(),n.style&&n.style.IconStyle&&n.style.IconStyle.Icon&&n.style.IconStyle.Icon.w?l.drawImage(c[F],n.style.IconStyle.Icon.x,c[F].height-n.style.IconStyle.Icon.y-n.style.IconStyle.Icon.h,n.style.IconStyle.Icon.w,n.style.IconStyle.Icon.h,A+D,s+y,v,
x):(n.style&&n.style.IconStyle&&n.style.IconStyle.heading?(l.save(),l.translate(A,s),l.rotate(n.style.IconStyle.heading*Math.PI/180),b?l.drawImageWithRotate(c[F],A,s,D,y,v,x,n.style.IconStyle.heading):l.drawImage(c[F],D,y,v,x),l.restore()):l.drawImage(c[F],A+D,s+y,v,x),n.name&&(n.name.length&&L)&&(!b||f.containsLatLng(this.placemarks[p].latLng))&&(l.font='10pt Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif',l.fillStyle="rgba(255, 255, 255, 0.5)",F=void 0!==h[n.name]?h[n.name]:l.measureText(n.name).width,
b&&(h[n.name]=F),l.fillRect(A+D-F/2+v/2-1,s+y+x-(b?3:1)-1,F+(b?0.07*F:0)+1,(b?1:0)+11),l.fillStyle="blue",l.fillText(n.name,A+D-F/2+v/2,s+y+x+8)))))}p<this.placemarks.length?(H=this,this.doDrawTimeout=setTimeout(function(){H.drawPlacemarks(a,l,f,p)},10)):$(this.canvas).css("z-index",0).siblings().remove()};g.prototype.redraw=function(a){var c,f,h,g=this;a?this.imagesLoading&&0<this.imagesLoading?this.needsDraw=!0:(this.redrawNeeded=!1,this.killCurrentDraw(),b&&(c=this.map.getBounds()),this.lastZoom!==
this.map.getZoom()&&(this.markerLayer.empty(),this.lastZoom=this.map.getZoom()),this.canvas=document.createElement("canvas"),this.markerLayer.append(this.canvas),b&&(this.canvas=G_vmlCanvasManager.initElement(this.canvas)),f=this.canvas.getContext("2d"),this.canvas.width=this.map.getSize().width,this.canvas.height=this.map.getSize().height,this.canvas.className="markerCanvas",this.leftCanvas=this.topCanvas=0,this.needsSorting&&(this.placemarks.sort(function(a,b){return b.latLng.lat()-a.latLng.lat()}),
this.needsSorting=!1),this.placemarks.length&&(a=this.map.fromLatLngToContainerPixel(this.placemarks[0].latLng),h=this.map.fromLatLngToDivPixel(this.placemarks[0].latLng),this.topCanvas=h.y-a.y,this.leftCanvas=h.x-a.x,this.canvas.style.top=this.topCanvas+"px",this.canvas.style.left=this.leftCanvas+"px",this.canvas.style.zIndex=-1),this.doDrawTimeout=setTimeout(function(){g.drawPlacemarks(g.canvas,f,c)},10)):this.doRedraw()}}var c={},b=!document.createElement("canvas").getContext,h={};return{init:function(){a();
b&&jc2cui.mapWidget.markerOverlayIE.init()},MarkerOverlay:g}}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.markerOverlayIE=function(){function s(a){return a.style&&a.style.IconStyle&&a.style.IconStyle.Icon&&a.style.IconStyle.Icon.href&&"https://sageearth.northcom.mil/TrackService/icons/white_outlined_arrow.png"===a.style.IconStyle.Icon.href}function g(a,c,e){google.maps.Overlay.call(this);this.map=a;this.placemarks=[];this.doc=c;var l=this,f,g;if(e)for(a=0;a<e.length;a++)s(e[a].placemark)?e[a].placemark.visible=e[a].placemark.visibility=!1:(e[a].placemark.latLng=e[a].latLng,this.placemarks.push(e[a].placemark));
for(;c;){if(c.overlayId){f=c.overlayId;g=c.featureId;break}c=c.parent}this.container=$("<div />").click(function(a){a=l.placemarks[parseInt(a.target.id.substr(1),10)];var b={selectedId:a.id||void 0,selectedName:a.name||void 0,featureId:g,overlayId:f};jc2cui.mapWidget.showPlacemarkInfoWindow(a);jc2cui.mapWidget.itemSelected(b)});this.map.addOverlay(this)}function a(){g.prototype=new google.maps.Overlay;g.prototype.initialize=function(a){a.getPane(G_MAP_MARKER_PANE).appendChild(this.container[0])};
g.prototype.remove=function(){this.container.remove()};g.prototype.hide=function(){this.container.hide()};g.prototype.show=function(){this.container.show()};g.prototype.copy=function(){var a=new g(this.map,this.doc);a.placemarks=this.placemarks.slice();return a};g.prototype.addMarker=function(a,h){if(s(a))a.visible=a.visibility=!1;else if(a.latLng=h,a.visible&&(this.forceRefresh=!0),this.placemarks.push(a),a.style&&(a.style.IconStyle&&a.style.IconStyle.Icon&&a.style.IconStyle.Icon.w)&&!c[a.style.IconStyle.Icon.href]){c[a.style.IconStyle.Icon.href]=
{};var e=$('<img src="'+a.style.IconStyle.Icon.href+'"/></img>').appendTo("body"),l=this;this.paletteLoading=this.paletteLoading?this.paletteLoading+1:1;e.load(function(){c[a.style.IconStyle.Icon.href]={height:e.height(),width:e.width()};e.remove();l.paletteLoading--;l.needsDraw&&(l.needsDraw=!1,l.redraw())})}};g.prototype.removeMarker=function(a){var c=-1;$.each(this.placemarks,function(e,l){if(a===l)return c=e,!1});-1<c&&this.placemarks.splice(c,1)};g.prototype.killCurrentDraw=function(a){clearTimeout(this.redrawTimeout);
clearTimeout(this.drawPlacemarksTimer);this.markerLayer=null};g.prototype.doRedraw=function(){var a=this;this.forceRefresh=!0;this.killCurrentDraw();this.redrawTimeout=setTimeout(function(){a.forceRefresh&&a.redraw(!0)},100)};g.prototype.placemarkVisibilityChanged=function(a){if(s(a))return!1;this.doRedraw()};g.prototype.drawPlacemarks=function(a,h){var e=[],l,f,g,p,n,s,A=1,v=1,x,D,y,F,H,L,O=this,G=jc2cui.mapWidget.options().labels&&jc2cui.mapWidget.options().labels.value;for(l=h=h||0;l<this.placemarks.length&&
l<h+200;l++){if(this.doc.removed||a!==this.markerLayer)return;f=this.placemarks[l];if(f.visible&&(!f.style||!f.style.IconStyle||!f.style.IconStyle.Icon||void 0===f.style.IconStyle.Icon.href||f.style.IconStyle.Icon.href)){g=this.map.fromLatLngToDivPixel(this.placemarks[l].latLng);e.push('<img id="t');e.push(l);e.push('" class="marker"');f.name&&0<f.name.length&&(e.push(' title="'),e.push(f.name),e.push('"'));e.push(' style="z-index:');e.push(-Math.round(1E3*(this.placemarks[l].latLng.lat()+90))+18E4);
s=f.style&&f.style.IconStyle&&f.style.IconStyle.scale?f.style.IconStyle.scale:1;f.style&&f.style.IconStyle&&f.style.IconStyle.Icon&&f.style.IconStyle.Icon.href&&0<=f.style.IconStyle.Icon.href.indexOf("http://maps.google.com/mapfiles/kml")?(n=p=64,s/=2):n=p=32;p*=s;n*=s;f.style&&f.style.IconStyle&&f.style.IconStyle.hotSpot?(H=f.style.IconStyle.hotSpot.x,L=f.style.IconStyle.hotSpot.y,"pixels"===f.style.IconStyle.hotSpot.xunits&&(H=-H*s),"insetPixels"===f.style.IconStyle.hotSpot.xunits&&(H=-p+H*s),"fraction"===
f.style.IconStyle.hotSpot.xunits&&(H*=-p),"pixels"===f.style.IconStyle.hotSpot.yunits&&(L=-n+L*s+1),"insetPixels"===f.style.IconStyle.hotSpot.yunits&&(L=-(L*s)+1),"fraction"===f.style.IconStyle.hotSpot.yunits&&(L=-n*(1-L)+1)):(H=f.style&&f.style.IconStyle&&f.style.IconStyle.Icon&&f.style.IconStyle.Icon.href?-p/2:0.625*-p,L=-n/2);e.push("; left:");e.push(g.x+H);e.push("px; top:");e.push(g.y+L);e.push("px;");if(f.style&&f.style.IconStyle&&f.style.IconStyle.Icon&&f.style.IconStyle.Icon.w){s=c[f.style.IconStyle.Icon.href];
if(f.style.IconStyle.Icon.h&&32!==f.style.IconStyle.Icon.h||32!==n)A=(f.style.IconStyle.Icon.h||32)/n,e.push("height:"),e.push(s.height/A),e.push("px;");if(f.style.IconStyle.Icon.w&&32!==f.style.IconStyle.Icon.w||32!==p)v=(f.style.IconStyle.Icon.w||32)/p,e.push("width:"),e.push(s.width/v),e.push("px;");x=(s.height-f.style.IconStyle.Icon.y)/A-n;D=f.style.IconStyle.Icon.x/v+p;y=x+n;F=D-p;e.push("clip: rect(");e.push(x);e.push("px,");e.push(D);e.push("px,");e.push(y);e.push("px,");e.push(F);e.push("px);");
e.push("margin-left:");e.push(-(f.style.IconStyle.Icon.x/v));e.push("px;");e.push("margin-top:");e.push(-(s.height/A)+f.style.IconStyle.Icon.y/A+n);e.push("px;")}else 32!==n&&(e.push("height:"),e.push(n),e.push("px;")),32!==p&&(e.push("width:"),e.push(p),e.push("px;"));e.push('" src="');e.push(f.style&&f.style.IconStyle&&f.style.IconStyle.Icon&&f.style.IconStyle.Icon.href?f.style.IconStyle.Icon.href:jc2cui.mapWidget.getDefaultIcon());e.push('">');f.name&&(f.name.length&&G)&&(e.push('<div class="markerLabelOuter"'),
e.push('style="left:'),e.push(g.x+H+p/2),e.push("px; top:"),e.push(g.y+L+n/2+8),e.push("px;"),e.push('"><span class="markerLabelInner">'),e.push(f.name),e.push("</span>"),e.push("</div>"))}}e=a.append(e.join(""));$("img",e).one("error",function(){this.src=jc2cui.mapWidget.getErrorIcon()});l<this.placemarks.length?this.drawPlacemarksTimer=setTimeout(function(){O.drawPlacemarks(a,l)},10):(a.detach().css("z-index",0),this.container.empty().append(a))};g.prototype.redraw=function(a){if(a){var c,e,g=this;
if(this.paletteLoading&&0<this.paletteLoading)this.needsDraw=!0;else{if(this.placemarks.length&&(c=this.map.fromLatLngToDivPixel(this.placemarks[0].latLng),e=this.map.getZoom(),this.lastZoom===e&&!this.forceRefresh&&c.equals(this.lastFirstLoc)))return;this.forceRefresh=!1;this.killCurrentDraw();this.lastFirstLoc=c;this.lastZoom=e;this.markerLayer=$('<div class="marker-overlay"/>').click(this.click);this.container.append(this.markerLayer);this.drawPlacemarksTimer=setTimeout(function(){g.drawPlacemarks(g.markerLayer)},
10)}}else this.doRedraw()}}var c={};return{init:function(){a()},MarkerOverlay:g}}();
function clusterInit(){function s(a,c){google.maps.Overlay.call(this);this.cluster_=a;this.className_=a.getMarkerClusterer().getClusterClass();this.styles_=c;this.sums_=this.div_=this.center_=null;this.visible_=!1;this.activeMap_=null}function g(a){this.markerClusterer_=a;this.map_=a.activeMap_;this.gridSize_=a.getGridSize();this.minClusterSize_=a.getMinimumClusterSize();this.averageCenter_=a.getAverageCenter();this.printable_=a.getPrintable();this.markers_=[];this.bounds_=this.center_=null;this.clusterIcon_=
new s(this,a.getStyles());this.map_.addOverlay(this.clusterIcon_)}s.prototype=new google.maps.Overlay;s.prototype.initialize=function(a){this.activeMap_=a;var c=this,b,h;this.div_=document.createElement("div");this.div_.className=this.className_;this.visible_&&this.show();this.activeMap_.getPane(G_MAP_MARKER_PANE).appendChild(this.div_);google.maps.Event.addListener(this.activeMap_,"bounds_changed",function(){h=b});google.maps.Event.addDomListener(this.div_,"mousedown",function(){b=!0;h=!1});google.maps.Event.addDomListener(this.div_,
"click",function(a){b=!1;if(!h){var g,f=c.cluster_.getMarkerClusterer();google.maps.Event.trigger(f,"clusterclick",c.cluster_);f.getZoomOnClick()&&(g=c.cluster_.getBounds(),jc2cui.mapWidget.renderer.fitToBounds(g),setTimeout(function(){jc2cui.mapWidget.renderer.fitToBounds(g);void 0<f.activeMap_.getZoom()&&f.activeMap_.setZoom(NaN)},100));a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()}});google.maps.Event.addDomListener(this.div_,"mouseover",function(){var a=c.cluster_.getMarkerClusterer();
google.maps.Event.trigger(a,"mouseover",c.cluster_)});google.maps.Event.addDomListener(this.div_,"mouseout",function(){var a=c.cluster_.getMarkerClusterer();google.maps.Event.trigger(a,"mouseout",c.cluster_)})};s.prototype.remove=function(){this.activeMap_=null;this.div_&&this.div_.parentNode&&(this.hide(),google.maps.Event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)};s.prototype.redraw=function(a){this.visible_&&(a=this.getPosFromLatLng_(this.center_),
this.div_.style.top=a.y+"px",this.div_.style.left=a.x+"px")};s.prototype.hide=function(){this.div_&&(this.div_.style.display="none");this.visible_=!1};s.prototype.show=function(a){if(this.div_){if(a||!this.div_.style.cssText.length||"none"===this.div_.style.display)a=this.getPosFromLatLng_(this.center_),this.div_.style.cssText=this.createCss(a);this.div_.innerHTML=this.cluster_.printable_?"<img src='"+this.url_+"'><div style='position: absolute; top: 0px; left: 0px; width: "+this.width_+"px;'>"+this.sums_.text+
"</div>":this.sums_.text;this.div_.title="undefined"===typeof this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title;this.div_.style.display=""}this.visible_=!0};s.prototype.useStyle=function(a){this.sums_=a;a=Math.max(0,a.index-1);a=Math.min(this.styles_.length-1,a);a=this.styles_[a];this.url_=a.url;this.height_=a.height;this.width_=a.width;this.anchor_=a.anchor;this.anchorIcon_=a.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)];
this.textColor_=a.textColor||"black";this.textSize_=a.textSize||11;this.textDecoration_=a.textDecoration||"none";this.fontWeight_=a.fontWeight||"bold";this.fontStyle_=a.fontStyle||"normal";this.fontFamily_=a.fontFamily||"Arial,sans-serif";this.backgroundPosition_=a.backgroundPosition||"0 0"};s.prototype.setCenter=function(a){this.center_=a};s.prototype.createCss=function(a){var c=[];this.cluster_.printable_||(c.push("background-image:url("+this.url_+");"),c.push("background-position:"+this.backgroundPosition_+
";"));"object"===typeof this.anchor_?("number"===typeof this.anchor_[0]&&0<this.anchor_[0]&&this.anchor_[0]<this.height_?c.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):c.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"===typeof this.anchor_[1]&&0<this.anchor_[1]&&this.anchor_[1]<this.width_?c.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):c.push("width:"+this.width_+"px; text-align:center;")):
c.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");c.push("cursor:pointer; top:"+a.y+"px; left:"+a.x+"px; color:"+this.textColor_+"; position:absolute; font-size:"+this.textSize_+"px; font-family:"+this.fontFamily_+"; font-weight:"+this.fontWeight_+"; font-style:"+this.fontStyle_+"; text-decoration:"+this.textDecoration_+";");return c.join("")};s.prototype.getPosFromLatLng_=function(a){a=this.activeMap_.fromLatLngToDivPixel(a);a.x-=this.anchorIcon_[1];
a.y-=this.anchorIcon_[0];return a};g.prototype.getAttributes=function(){return this.attributes_};g.prototype.getSize=function(){return this.markers_.length};g.prototype.getMarkers=function(){return this.markers_};g.prototype.getCenter=function(){return this.center_};g.prototype.getMarkerClusterer=function(){return this.markerClusterer_};g.prototype.getBounds=function(){var a,c=new google.maps.LatLngBounds(this.center_,this.center_),b=this.getMarkers();for(a=0;a<b.length;a++)c.extend(b[a].getPosition());
return c};g.prototype.remove=function(){this.map_.removeOverlay(this.clusterIcon_);delete this.markers_};g.prototype.addMarker=function(a){var c,b;if(this===a.cluster)return!1;this.center_?this.averageCenter_&&(b=this.markers_.length+1,c=(this.center_.lat()*(b-1)+a.getPosition().lat())/b,b=(this.center_.lng()*(b-1)+a.getPosition().lng())/b,this.center_=new google.maps.LatLng(c,b),this.calculateBounds_()):(this.center_=a.getPosition(),this.calculateBounds_());a.cluster=this;this.markers_.push(a);c=
this.markers_.length;1===c&&this.configureAttributesAndRollups_(a);this.performRollup_(a);b=this.markerClusterer_.getMaxZoom();if(null!==b&&this.map_.getZoom()>b)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c<this.minClusterSize_)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c===this.minClusterSize_)for(a=0;a<c;a++)this.markers_[a].setMap(null);else a.setMap(null);this.updateIcon_(this.averageCenter_);return!0};g.prototype.configureAttributesAndRollups_=function(a){var c=this.markerClusterer_.getAttributes(),
b=this.markerClusterer_.getRollups(),h;if(c&&c.length)for(this.attributes_={},h=0;h<c.length;h++)this.attributes_[c[h]]=a.placemark.extendedData?a.placemark.extendedData[c[h]]:void 0;if(b&&b.length)for(this.attributes_=this.attributes_||{},h=0;h<b.length;h++)if(attribute=b[h].attribute)if(rollup=this.attributes_[attribute],!rollup&&(rollup=this.attributes_[attribute]={},(vals=b[h].values)&&vals.length))for(j=0;j<vals.length;j++)rollup[vals[j]]=0};g.prototype.doMarkerAttributesMatch=function(a){var c=
this.markerClusterer_.getAttributes(),b;if(!c)return!0;for(b=0;b<c.length;b++)if(this.attributes_[c[b]]!==(a.placemark.extendedData?a.placemark.extendedData[c[b]]:void 0))return!1;return!0};g.prototype.performRollup_=function(a){var c=this.markerClusterer_.getRollups(),b,h,e;if(c&&c.length)for(e=0;e<c.length;e++)if(b=c[e].attribute)h=this.attributes_[b],(b=a.placemark.extendedData?a.placemark.extendedData[b]:void 0)&&b.length||(b="_other_"),h[b]="undefined"===typeof h[b]?1:h[b]+1};g.prototype.isMarkerInClusterBounds=
function(a){return this.markerClusterer_.isMarkerInBounds_(a,this.bounds_)};g.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)};g.prototype.updateIcon_=function(a){var c=this.markers_.length,b=this.markerClusterer_.getMaxZoom();null!==b&&this.map_.getZoom()>b?this.clusterIcon_.hide():c<this.minClusterSize_?this.clusterIcon_.hide():(c=this.markerClusterer_.getStyles().length,c=this.markerClusterer_.getCalculator()(this,
c),this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(c),this.clusterIcon_.show(a))};MarkerClusterer.prototype=new google.maps.Overlay;MarkerClusterer.prototype.setMap=function(a){this.activeMap_!==a&&(this.activeMap_&&this.activeMap_.removeOverlay(this),a&&a.addOverlay(this))};MarkerClusterer.prototype.regenerate=function(){clearTimeout(this.regenerateTimeout);var a=this;this.regenerateTimeout=setTimeout(function(){a.resetViewport_(!1);a.redraw_();for(i=0;i<a.markers_.length;i++)marker=
a.markers_[i],marker.cluster||marker.setMap(null)},100)};MarkerClusterer.prototype.initialize=function(a){this.activeMap_=a;var c=this;this.ready_=!0;this.repaint();this.listeners_=[google.maps.Event.addListener(this.activeMap_,"zoomend",function(a,h){c.regenerate()}),google.maps.Event.addListener(this.activeMap_,"moveend",function(){var a=c.activeMap_.getCenter();a.equals(c.lastCenter)||(c.lastCenter=a,c.regenerate())})]};MarkerClusterer.prototype.remove=function(){var a,c;for(a in this.markers_)this.markers_.hasOwnProperty(a)&&
(c=this.markers_[a],c.getMap()!==this.activeMap_&&c.setMap(this.activeMap_),delete c.cluster);this.markers_={};for(i=0;i<this.clusters_.length;i++)this.clusters_[i].remove();this.clusters_=[];for(i=0;i<this.listeners_.length;i++)google.maps.Event.removeListener(this.listeners_[i]);this.listeners_=[];this.activeMap_=null;this.ready_=!1};MarkerClusterer.prototype.redraw=function(a){};MarkerClusterer.prototype.setupStyles_=function(){var a,c;if(!(0<this.styles_.length))for(a=0;a<this.imageSizes_.length;a++)c=
this.imageSizes_[a],this.styles_.push({url:this.imagePath_+(a+1)+"."+this.imageExtension_,height:c,width:c})};MarkerClusterer.prototype.fitMapToMarkers=function(){var a,c=this.getMarkers(),b=new google.maps.LatLngBounds;for(a=0;a<c.length;a++)b.extend(c[a].getPosition());jc2cui.mapWidget.fitToBounds(b)};MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a};MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_};
MarkerClusterer.prototype.setMinimumClusterSize=function(a){this.minClusterSize_=a};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_};MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a};MarkerClusterer.prototype.getStyles=function(){return this.styles_};MarkerClusterer.prototype.setStyles=function(a){this.styles_=a};MarkerClusterer.prototype.getTitle=function(){return this.title_};MarkerClusterer.prototype.setTitle=function(a){this.title_=a};MarkerClusterer.prototype.getZoomOnClick=
function(){return this.zoomOnClick_};MarkerClusterer.prototype.setZoomOnClick=function(a){this.zoomOnClick_=a};MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_};MarkerClusterer.prototype.setAverageCenter=function(a){this.averageCenter_=a};MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_};MarkerClusterer.prototype.setIgnoreHidden=function(a){this.ignoreHidden_=a};MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_};
MarkerClusterer.prototype.setImageExtension=function(a){this.imageExtension_=a};MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_};MarkerClusterer.prototype.setImagePath=function(a){this.imagePath_=a};MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_};MarkerClusterer.prototype.setImageSizes=function(a){this.imageSizes_=a};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=
a};MarkerClusterer.prototype.getPrintable=function(){return this.printable_};MarkerClusterer.prototype.setPrintable=function(a){this.printable_=a};MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_};MarkerClusterer.prototype.setBatchSizeIE=function(a){this.batchSizeIE_=a};MarkerClusterer.prototype.getClusterClass=function(){return this.clusterClass_};MarkerClusterer.prototype.setClusterClass=function(a){this.clusterClass_=a};MarkerClusterer.prototype.getAttributes=function(){return this.attributes_};
MarkerClusterer.prototype.setAttributes=function(a){this.attributes_=a};MarkerClusterer.prototype.getRollups=function(){return this.rollups_};MarkerClusterer.prototype.setRollups=function(a){this.rollups_=a};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length};MarkerClusterer.prototype.getClusters=function(){return this.clusters_};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length};
MarkerClusterer.prototype.addMarker=function(a,c){this.pushMarkerTo_(a);c||this.redraw_()};MarkerClusterer.prototype.addMarkers=function(a,c){var b;for(b=0;b<a.length;b++)this.pushMarkerTo_(a[b]);c||this.redraw_()};MarkerClusterer.prototype.pushMarkerTo_=function(a){var c=this;a.getDraggable()&&google.maps.Event.addListener(a,"dragend",function(){c.ready_&&(delete this.cluster,c.repaint())});this.markers_[a.placemark.internalId]=a;a.cluster&&(delete a.cluster,clearTimeout(this.repaintTimer),this.repaintTimer=
setTimeout(function(){c.repaint()},200))};MarkerClusterer.prototype.removeMarker=function(a,c){var b=this.removeMarker_(a);!c&&b&&this.repaint();return b};MarkerClusterer.prototype.removeMarkers=function(a,c){var b,h,e=!1;for(b=0;b<a.length;b++)h=this.removeMarker_(a[b]),e=e||h;!c&&e&&this.repaint();return e};MarkerClusterer.prototype.removeMarker_=function(a){var c=this.markers_[a.placemark.internalId];c&&(a.setMap(null),delete this.markers_[a.placemark.internalId]);return void 0!==c};MarkerClusterer.prototype.clearMarkers=
function(){this.resetViewport_(!0);this.markers_={}};MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_=[];this.resetViewport_(!1);this.redraw_();setTimeout(function(){var c;for(c=0;c<a.length;c++)a[c].remove()},0)};MarkerClusterer.prototype.getExtendedBounds=function(a){var c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng());a=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng());c=this.activeMap_.fromLatLngToDivPixel(c);c.x+=
this.gridSize_;c.y-=this.gridSize_;a=this.activeMap_.fromLatLngToDivPixel(a);a.x-=this.gridSize_;a.y+=this.gridSize_;return{sw:a,ne:c}};MarkerClusterer.prototype.redraw_=function(){this.createClusters()};MarkerClusterer.prototype.resetViewport_=function(a){var c,b;for(c=0;c<this.clusters_.length;c++)this.clusters_[c].remove();this.clusters_=[];for(c in this.markers_)this.markers_.hasOwnProperty(c)&&(b=this.markers_[c],delete b.cluster,a&&b.setMap(null))};MarkerClusterer.prototype.distanceBetweenPoints_=
function(a,c,b,h){var e=a*Math.PI/180,g=b*Math.PI/180;c=(h-c)*Math.PI/180;a=Math.pow(Math.sin((b-a)*Math.PI/180/2),2)+Math.cos(e)*Math.cos(g)*Math.pow(Math.sin(c/2),2);return 12756*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))};MarkerClusterer.prototype.isMarkerInBounds_=function(a,c){var b=this.activeMap_.fromLatLngToDivPixel(a.getPosition());return b.x>c.sw.x&&b.x<c.ne.x&&b.y>c.ne.y&&b.y<c.sw.y};MarkerClusterer.prototype.addToClosestCluster_=function(a){var c,b,h;c=a.getPosition();var e=c.lat(),l=c.lng(),
f=4E4,s=null;for(c=0;c<this.clusters_.length;c++)if(h=this.clusters_[c],(!this.attributes_||h.doMarkerAttributesMatch(a))&&h.isMarkerInClusterBounds(a)&&(b=h.getCenter()))b=this.distanceBetweenPoints_(b.lat(),b.lng(),e,l),b<f&&(f=b,s=h);s?s.addMarker(a):(h=new g(this),h.addMarker(a),this.clusters_.push(h))};MarkerClusterer.prototype.createClusters=function(){var a;a:{var c=this.markers_;if(Object.keys)a=Object.keys(c);else{var b=Object.prototype.hasOwnProperty,h=!{toString:null}.propertyIsEnumerable("toString"),
e="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),g=e.length;if("object"!=typeof c&&"function"!=typeof c||null===c){a=void 0;break a}a=[];for(var f in c)b.call(c,f)&&a.push(f);if(h)for(c=0;c<g;c++)b.call(o,e[c])&&a.push(e[c])}}this.createClusters_(a,0)};MarkerClusterer.prototype.createClusters_=function(a,c){var b,g,e=this;if(this.ready_){0===c&&(google.maps.Event.trigger(this,"clusteringbegin",this),"undefined"!==typeof this.timerRefStatic&&
(clearTimeout(this.timerRefStatic),delete this.timerRefStatic));3<this.activeMap_.getZoom()&&(b=new google.maps.LatLngBounds(this.activeMap_.getBounds().getSouthWest(),this.activeMap_.getBounds().getNorthEast()));var l=b?this.getExtendedBounds(b):void 0,f=Math.min(c+this.batchSize_,a.length);for(b=c;b<f;b++)g=a[b],this.markers_.hasOwnProperty(g)&&(g=this.markers_[g],g.cluster||(!(!this.ignoreHidden_||this.ignoreHidden_&&g.getVisible())||l&&!this.isMarkerInBounds_(g,l))||this.addToClosestCluster_(g));
f<a.length?this.timerRefStatic=setTimeout(function(){e.createClusters_(a,f)},0):(delete this.timerRefStatic,google.maps.Event.trigger(this,"clusteringend",this))}};MarkerClusterer.prototype.extend=function(a,c){return function(a){for(var c in a.prototype)this.prototype[c]=a.prototype[c];return this}.apply(a,[c])};MarkerClusterer.CALCULATOR=function(a,c){for(var b=0,g=a.getMarkers().length.toString(),e=g;0!==e;)e=parseInt(e/10,10),b++;b=Math.min(b,c);return{text:g,index:b,title:""}};MarkerClusterer.BATCH_SIZE=
2E3;MarkerClusterer.BATCH_SIZE_IE=500;MarkerClusterer.IMAGE_PATH="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m";MarkerClusterer.IMAGE_EXTENSION="png";MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90]}
function MarkerClusterer(s,g,a){google.maps.Overlay.call(this);g=g||[];a=a||{};this.markers_={};this.clusters_=[];this.listeners_=[];this.activeMap_=null;this.ready_=!1;this.gridSize_=a.gridSize||60;this.minClusterSize_=a.minimumClusterSize||2;this.maxZoom_=a.maxZoom||null;this.styles_=a.styles||[];this.title_=a.title||"";this.zoomOnClick_=!0;void 0!==a.zoomOnClick&&(this.zoomOnClick_=a.zoomOnClick);this.averageCenter_=!1;void 0!==a.averageCenter&&(this.averageCenter_=a.averageCenter);this.ignoreHidden_=
!1;void 0!==a.ignoreHidden&&(this.ignoreHidden_=a.ignoreHidden);this.printable_=!1;void 0!==a.printable&&(this.printable_=a.printable);this.imagePath_=a.imagePath||MarkerClusterer.IMAGE_PATH;this.imageExtension_=a.imageExtension||MarkerClusterer.IMAGE_EXTENSION;this.imageSizes_=a.imageSizes||MarkerClusterer.IMAGE_SIZES;this.calculator_=a.calculator||MarkerClusterer.CALCULATOR;this.batchSize_=a.batchSize||MarkerClusterer.BATCH_SIZE;this.batchSizeIE_=a.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE;this.clusterClass_=
a.clusterClass||"cluster";this.attributes_=a.attributes;this.rollups_=a.rollups;-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_);this.setupStyles_();this.addMarkers(g,!0);s.addOverlay(this)}util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.clusterManager=function(){function s(a){var b=[];$.each(a,function(a,c){if("object"===typeof c)return b.push(s(c)),b.push(", "),!0;b.push(a);b.push(": ");b.push(c);b.push(", ")});b.length?(b.pop(),a=b.join("")):a="No data found";return a}function g(a,b){var c;"string"===typeof b&&-1!==b.indexOf("${")&&(b=b.replace(/\$\{([\w.]+?)\}/g,function(b,e){if("count"===e)return a.getSize();var f=e.split(/\.+/),g=a.getAttributes();for(c=0;c<f.length&&(g=g[f[c]],g);c++);"object"===typeof g&&
(g=s(g));return g}),b=isNaN(b)||!b?b:parseFloat(b));return b}function a(b){if(jc2cui.mapWidget.options().clustering&&jc2cui.mapWidget.options().clustering.value)return b.clustering?b:b.parent?a(b.parent):b.overlayId&&(b=p[b.overlayId])?a(b):n}function c(a,b,c){c=c.style||{};a={name:g(b,c.title)||a.getTitle()||"",description:g(b,c.description)||"",placemarks:b.getMarkers(),attributes:"placemark",bounds:b.getBounds()};jc2cui.mapWidget.showClusterInfoWindow(a)}function b(a,b){var e=$.extend(!0,{},f,
"object"===typeof b.clustering?b.clustering:{}),h=new MarkerClusterer(t,a,{zoomOnClick:!1,gridSize:e.distance,minimumClusterSize:e.threshold,maxZoom:e.maxZoom,styles:[{url:"/widgets/common/kml/icons/"+((e.style||{}).fillColor||"red")+".png",height:33,width:34}],calculator:function(a,b){var c=0,f,h=a.getMarkers().length,l=h.toString();for(e.style&&e.style.title&&(f=g(a,e.style.title));0!==h;)h=Math.floor(h/10),c++;c=Math.min(c,b);return{text:l,index:c,title:f}},attributes:e.attributes,rollups:e.rollups});
google.maps.event?google.maps.event.addListener(h,"click",function(a){c(h,a,e)}):google.maps.Event.addListener(h,"clusterclick",function(a){c(h,a,e)});return h}function h(a,c,e){c&&(a?c.markerClusterer?c.markerClusterer.addMarkers(e):(c.markerClusterer=b(e,c),E.push(c)):c.markerClusterer&&c.markerClusterer.removeMarkers(e))}function e(c,e){var f=a(e),g=[],h=[],l;if(f)if(c){e.getAllVisiblePlacemarks(g);for(l=0;l<g.length;l++)g[l].getPosition&&h.push(g[l]);f.markerClusterer?f.markerClusterer.addMarkers(h):
(f.markerClusterer=b(h,f),E.push(f))}else if(f.markerClusterer)if(e===f)f.markerClusterer.setMap(null),delete f.markerClusterer,E.splice($.inArray(f,E),1);else{e.getAllPlacemarks(g);for(l=0;l<g.length;l++)(g[l].getPosition||g[l].draggable)&&h.push(g[l]);f.markerClusterer.removeMarkers(h)}}function l(b,c){var e=a(c.placemark),f;e&&e.markerClusterer&&(e.markerClusterer.markersToAdd=e.markerClusterer.markersToAdd||[],e.markerClusterer.markersToRemove=e.markerClusterer.markersToRemove||[],b?e.markerClusterer.markersToAdd.push(c):
e.markerClusterer.markersToRemove.push(c),f=function(a){a.markerClusterer.markersToAdd.length&&(h(!0,a,a.markerClusterer.markersToAdd),a.markerClusterer.markersToAdd=[]);a.markerClusterer.markersToRemove.length&&(h(!1,a,a.markerClusterer.markersToRemove),a.markerClusterer.markersToRemove=[])},clearTimeout(e.markersTimeout),e.markersTimeout=setTimeout(function(){f(e)},100))}var f={distance:60,threshold:2,maxZoom:19,style:{label:"${count}",title:"${count} items"}},t,p,n={},E=[];return{init:function(a,
b){t=a;p=b},getClusterer:function(b){return a(b)},cluster:function(a,b){e(a,b)},setMarkerVisible:function(a,b){l(a,b)},setClustering:function(a){a?$.each(p,function(b,c){$.each(c.docs,function(b,c){e(a,c)})}):($.each(E,function(a,b){b.markerClusterer.setMap(null);delete b.markerClusterer}),E=[],n={})}}}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.latLonControl=function(){function s(){return this}return{init:function(){s.prototype=new google.maps.Control(!0,!1);s.prototype.printable=function(){return!0};s.prototype.selectable=function(){return!1};s.prototype.getDefaultPosition=function(){return new google.maps.ControlPosition(google.maps.ANCHOR_BOTTOM_RIGHT,new google.maps.Size(0,14))};s.prototype.initialize=function(g){var a=this,c=$('<div class="customMapControl"><span id="latLon-control"></span><div class="controlBack"></div></div>');
g.getContainer().appendChild(c[0]);$(".controlBack",c).css({opacity:0.3});this.control=$("#latLon-control",c)[0];google.maps.Event.addListener(g,"mousemove",function(b){a.updatePosition(b)});return c[0]};s.prototype.updatePosition=function(g){this.control.innerHTML=g.toUrlValue(4)}},Control:s}}();var OWF;function googleLoaded(){jc2cui.mapWidget.renderer.googleReady()}function mapsLoaded(){jc2cui.mapWidget.renderer.mapsReady()}util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.renderer=function(){function s(a,b){"marker"===a.data.type?b?a.mapObject.enableDragging():a.mapObject.disableDragging():b?a.mapObject.enableEditing():a.mapObject.disableEditing()}function g(a,b,d){this.id=a;this.clustering=d;this.children={};this.docs={};this.features={};b?(this.parent=b,b.children[this.id]=this,this.visible=b.visible):this.visible=!0;r[this.id]=this}function a(a){var b;switch(a.data.type){case "marker":b=new google.maps.LatLngBounds;b.extend(a.mapObject.getLatLng());
break;case "line":case "shape":b=a.mapObject.getBounds()}return b}function c(a,b){"transparent"===a&&(a="#ffffff",b=0);var d=a.replace(/#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})/i,"ff$3$2$1").toLowerCase(),c;void 0!==b&&(c=Math.floor(255*b).toString(16),2>c.length&&(c="0"+c),d=c+d.substring(2));return d}function b(a){var b=[];b.push('<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:gx="http://www.google.com/kml/ext/2.2" xmlns:kml="http://www.opengis.net/kml/2.2" xmlns:atom="http://www.w3.org/2005/Atom"><Placemark id="');
b.push(a.id);b.push('">');a.title&&(b.push("<name>"),b.push(a.title),b.push("</name>"));a.description&&(b.push("<description><![CDATA["),b.push(a.description),b.push("]]\x3e</description>"));b.push("<Style>");switch(a.type){case "marker":b.push("<IconStyle><Icon><href>");b.push(a.iconUrl);b.push('</href></Icon><hotSpot x="0.5" y="0" xunits="fraction" yunits="fraction"></hotSpot></IconStyle></Style><Point>');break;case "line":case "shape":b.push("<LineStyle><color>"),b.push(c(a.strokeColor,a.strokeOpacity)),
b.push("</color><width>"),b.push(a.strokeWeight),b.push("</width></LineStyle>"),"shape"===a.type&&(b.push("<PolyStyle><color>"),b.push(c(a.fillColor,a.fillOpacity)),b.push("</color></PolyStyle>")),b.push("</Style>"),"line"===a.type?b.push("<LineString><tessellate>1</tessellate>"):b.push("<Polygon><outerBoundaryIs><LinearRing>")}b.push("<coordinates>");"shape"===a.type&&0<a.coordinates.length&&a.coordinates.push(a.coordinates[0]);$.each(a.coordinates,function(a,d){b.push(d.lng());b.push(",");b.push(d.lat());
b.push(",0 ")});b.push("</coordinates>");switch(a.type){case "marker":b.push("</Point>");break;case "shape":b.push("</LinearRing></outerBoundaryIs></Polygon>");break;case "line":b.push("</LineString>")}b.push("</Placemark></kml>");return b.join("")}function h(a){jc2cui.mapWidget.showUserDrawnEditWindow(a.data,{deleted:function(){jc2cui.mapWidget.deleteDrawing(a.data.id)},updated:function(c){var e=b(c);switch(a.data.type){case "marker":c=new google.maps.Marker(c.coordinates[0],{icon:new google.maps.Icon(a.mapObject.getIcon(),
c.iconUrl),title:c.title,draggable:!0});google.maps.Event.addListener(c,"dragend",function(d){a.data.coordinates[0]=d;e=b(a.data);jc2cui.mapWidget.publishDrawing(e,a.data.id,a.data.title,!a.mapObject.isHidden())});d.addOverlay(c);d.removeOverlay(a.mapObject);a.mapObject=c;ha(a);break;case "line":a.mapObject.setStrokeStyle({color:c.strokeColor,weight:c.strokeWeight,opacity:c.strokeOpacity});break;case "shape":a.mapObject.setStrokeStyle({color:c.strokeColor,weight:c.strokeWeight,opacity:c.strokeOpacity}),
a.mapObject.setFillStyle({color:c.fillColor,opacity:c.fillOpacity})}jc2cui.mapWidget.publishDrawing(e,a.data.id,a.data.title,!a.mapObject.isHidden())}})}function e(a){var c=$("body"),e=$(d.getContainer()),f=$('<img class="placementmarker" src="'+jc2cui.mapWidget.getDefaultDrawingIcon()+'">').appendTo(c),g,l,m,n=jc2cui.mapWidget.getNewId();f.css({left:(a.pageX-f.width()/2).toString()+"px",top:(a.pageY-f.height()-1).toString()+"px"});3>J++&&(g=$('<span class="tooltip">Click to place me on the map</span>').appendTo(c).css({left:(a.pageX+
18).toString()+"px",top:(a.pageY-9).toString()+"px"}));l=function(a){a.pageX<e.position().left||(f.css({left:(a.pageX-f.width()/2).toString()+"px",top:(a.pageY-f.height()-1).toString()+"px"}),g&&g.css({left:(a.pageX+18).toString()+"px",top:(a.pageY-9).toString()+"px"}))};c.bind("mousemove",l);m=google.maps.Event.addListener(d,"click",function(a,c,e){a="marker "+ ++k.marker;var q={type:"marker",id:n,coordinates:[c||e],title:a,iconUrl:jc2cui.mapWidget.getDefaultDrawingIcon()},f={data:q},g;Z||(Z=new google.maps.Icon(null,
q.iconUrl),Z.iconAnchor=new google.maps.Point(16,32),Z.iconSize=new google.maps.Size(32,32),Z.shadow="");f.mapObject=new google.maps.Marker(q.coordinates[0],{icon:Z,title:q.title,draggable:!0});f.getBounds=function(){var a=new google.maps.LatLngBounds;f.mapObject.extendBounds(a);return a};q.getBounds=f.getBounds;d.addOverlay(f.mapObject);google.maps.Event.addListener(f.mapObject,"dragend",function(a){q.coordinates[0]=a;g=b(q);jc2cui.mapWidget.publishDrawing(g,f.data.id,f.data.title,!f.mapObject.isHidden())});
ha(f);s(f,!0);h(f);g=b(q);jc2cui.mapWidget.publishDrawing(g,f.data.id,f.data.title,!f.mapObject.isHidden());M(0)});V=function(){f.remove();g&&g.remove();c.unbind("mousemove",l);google.maps.Event.removeListener(m)}}function l(a,c){var e=$(d.getContainer()),f=$("body"),g,l=jc2cui.mapWidget.getNewId(),m,n,p,r,t;g=c?new google.maps.Polygon([],"#15428B",3,0.8,"#DFE8F6",0.5):new google.maps.Polyline([],"#15428B",3,0.8);d.addOverlay(g);g.enableDrawing();if(c&&3>ga++||!c&&3>T++)n="Click to start drawing a "+
(c?"shape":"line"),p=$('<span class="tooltip">'+n+"</span>").appendTo(f).css({left:(a.pageX+18).toString()+"px",top:(a.pageY-9).toString()+"px"});p&&(r=function(a){a.pageX<e.position().left||p.css({left:(a.pageX+18).toString()+"px",top:(a.pageY-9).toString()+"px"})},f.bind("mousemove",r),t=google.maps.Event.addListener(d,"click",function(a,b,d){n=1===g.getVertexCount()||c&&2===g.getVertexCount()?"Click to continue drawing a ":"Click first or last point to end this ";n+=c?"shape":"line";p.html(n)}));
google.maps.Event.addListener(g,"endline",function(){var a=(c?"shape ":"line ")+ ++k[c?"shape":"line"],d={type:c?"shape":"line",id:l,coordinates:[],title:a,iconUrl:[jc2cui.mapWidget.getAppPath(),"images/",c?"poly":"line",'Mask.png"'].join(""),strokeColor:"#15428B",strokeWeight:3,strokeOpacity:0.8},e,q;m=!0;for(e=0;e<g.getVertexCount();e++)d.coordinates.push(g.getVertex(e));c&&(d.fillColor="#DFE8F6",d.fillOpacity=0.5);q={data:d,mapObject:g,getBounds:function(){var a=new google.maps.LatLngBounds;q.mapObject.extendBounds(a);
return a}};d.getBounds=q.getBounds;ha(q);setTimeout(function(){s(q,!0)},500);google.maps.Event.addListener(g,"lineupdated",function(){d.coordinates=[];for(e=0;e<g.getVertexCount();e++)d.coordinates.push(g.getVertex(e));var a=b(d);jc2cui.mapWidget.publishDrawing(a,q.data.id,q.data.title,!q.mapObject.isHidden())});h(q);a=b(d);jc2cui.mapWidget.publishDrawing(a,q.data.id,q.data.title,!q.mapObject.isHidden());M(0)});google.maps.Event.addListener(g,"cancelline",function(){M(0)});V=function(){p&&(p.remove(),
f.unbind("mousemove",r),google.maps.Event.removeListener(t));m||(g.disableEditing(),d.removeOverlay(g))}}function f(a){a?N?N.show():(N=$('<div id="drawingtools"><img id="select" title="Select/edit map features"><img id="placemark" title="Add a placemark"><span><img id="poly"><span id="polydrop"></span></span><div id="polytype" class="menu"><div id="line" class="menuitem"><img src="images/Ml.png">&nbsp;Draw a line</div><div id="shape" class="menuitem"><img src="images/Mp.png">&nbsp;Draw a shape</div></div>').appendTo($(d.getContainer())),
Y=$("#select",N).click(function(a){M(0,a)}),ea=$("#placemark",N).click(function(a){M(1,a)}),X=$("#poly",N).click(function(a){M(U,a)}),Q=$("#polytype",N),$("#polydrop",N).click(function(a){Q.show()}),$("#line",Q).hover(function(){$(this).addClass("selectedmenuitem")},function(){$(this).removeClass("selectedmenuitem")}).click(function(a){U=2;M(2,a)}),$("#shape",Q).hover(function(){$(this).addClass("selectedmenuitem")},function(){$(this).removeClass("selectedmenuitem")}).click(function(a){U=3;M(3,a)}),
N.mouseleave(function(a){Q.hide()}),M(0)):N&&(N.hide(),M(0));$.each(r,function(b,c){$.each(c.features,function(b,c){s(c,a)})})}function t(){var a=d.getBounds(),b=d.getCenter(),c=d.getZoom(),c=352E5/Math.pow(2,c);return jc2cui.mapWidget.createViewStatus(a.getSouthWest().lat(),a.getSouthWest().lng(),a.getNorthEast().lat(),a.getNorthEast().lng(),b.lat(),b.lng(),c)}function p(a,b,c){d.addOverlay(a);b.visible||a.hide();google.maps.Event.addListener(a,"click",function(a){for(var d,e;c;){if(c.overlayId){d=
c.overlayId;e=c.featureId;break}c=c.parent}a={selectedId:b.id||void 0,selectedName:b.name||void 0,featureId:e,overlayId:d};jc2cui.mapWidget.showPlacemarkInfoWindow(b);jc2cui.mapWidget.itemSelected(a)})}function n(a){var b={strokeColor:a.style&&a.style.LineStyle&&a.style.LineStyle.color?a.style.LineStyle.color.color:"#ffffff",strokeOpacity:a.style&&a.style.LineStyle&&a.style.LineStyle.color?a.style.LineStyle.color.opacity:1,strokeWeight:a.style&&a.style.LineStyle&&a.style.LineStyle.width?a.style.LineStyle.width:
1,fillColor:a.style&&a.style.PolyStyle&&a.style.PolyStyle.color?a.style.PolyStyle.color.color:"#ffffff",fillOpacity:a.style&&a.style.PolyStyle&&a.style.PolyStyle.color?a.style.PolyStyle.color.opacity:1,map:d,visible:a.visible,title:a.name};a.style&&(a.style.PolyStyle&&"0"===a.style.PolyStyle.fill)&&(b.fillOpacity=0);return b}function E(a){var b=[],c;for(c=0;c<a.length;c++)b.push(new google.maps.LatLng(a[c].lat,a[c].lon));return b}function A(){function a(b,c,d){this.placemark=b;this.latLng=c;this.markerOverlay=
d;this.visible=b.visible}function b(a,c,d,e){this.url=a;this.bounds=c;this.map=d;this.opacity=e;this.groundOverlay=new google.maps.GroundOverlay(a,c);this.map.addOverlay(this.groundOverlay);this.trySetOpacityAttempts=0;this.setOpacity();var q=this;google.maps.Event.addListener(d,"zoomend",function(){q.isHidden()||(q.trySetOpacityAttempts=0,q.setOpacity())})}var c,e="",f,g,h;if(m.fusionMap)for(d=new GFusionMap(document.getElementById("map"),{isAuthenticated:!1,layers:m.fusionMap.layers,serverUrl:m.fusionMap.serverUrl,
useGoogleLayers:!1},{logoPassive:!0}),h=0;h<m.fusionMap.arcGISLayers;h++)addArcGISMapType(m.fusionMap.arcGISLayers[h].url,0,15,m.fusionMap.arcGISLayers[h].name,!0,1024,512,512,d);else d=new google.maps.Map2(document.getElementById("map"),{logoPassive:!0});d.setCenter(new google.maps.LatLng(39.5,-98.3),3);"function"===typeof d.getDefaultUI?(e=d.getDefaultUI(),e.controls.scalecontrol=!0,d.setUI(e)):(d.addControl(new GSmallMapControl),d.addControl(new GMapTypeControl),d.addControl(new GScaleControl),
new GKeyboardHandler(d),d.enableDoubleClickZoom(),d.enableScrollWheelZoom());ka=d.getMapTypes().slice();ia=d.getCurrentMapType();google.maps.Event.addListener(d,"mousemove",function(a){R=a});$(d.getPane(G_MAP_MAP_PANE)).parent().mousedown(function(a){fa={x:a.pageX,y:a.pageY}}).mouseup(function(a){if(!fa||2>Math.abs(a.pageX-fa.x)&&2>Math.abs(a.pageY-fa.y)){var b=(new Date).getTime(),c=1;la===a.which&&500>b-ja?(c=2,ja=1E3):ja=b;la=a.which;jc2cui.mapWidget.mapClicked(R.lat(),R.lng(),c,a.which,a.shiftKey,
a.ctrlKey,a.altKey)}fa=null});f=function(){clearTimeout(c);c=setTimeout(function(){jc2cui.mapWidget.publishView(t());$.each(r,function(a,b){$.each(b.docs,function(a,b){b.onViewUpdate()})})},1E3)};google.maps.Event.addListener(d,"moveend",function(){var a=d.getCenter();a.equals(C)||(C=a,f())});google.maps.Event.addListener(d,"zoomend",f);google.maps.Event.addListener(d,"maptypechanged",function(){var a=d.getCurrentMapType();$.each(z,function(b,c){c.features[0].mapType!==a?c.visible&&(jc2cui.mapWidget.sidebar?
jc2cui.mapWidget.sidebar.hideFeature(c.featureId,c.overlayId,!0):c.setVisible(!1,!0)):c.visible||(jc2cui.mapWidget.sidebar?jc2cui.mapWidget.sidebar.showFeature(c.featureId,c.overlayId,!0):c.setVisible(!0,!0))});-1<$.inArray(a,ka)&&(ia=a)});a.prototype.removeFromMap=function(){};a.prototype.extendBounds=function(a){a.extend(this.latLng)};a.prototype.setVisible=function(a){this.visible!==a&&(this.markerOverlay.placemarkVisibilityChanged(this.placemark),this.visible=a,jc2cui.mapWidget.clusterManager.setMarkerVisible(a,
this))};a.prototype.getLatLng=function(){return this.latLng};a.prototype.getPosition=function(){return this.getLatLng()};a.prototype.setMap=function(a){a?(this.placemark.addedToMarkerOverlay||this.markerOverlay.addMarker(this.placemark,this.getLatLng()),this.markerOverlay.placemarkVisibilityChanged(this.placemark)):this.placemark.addedToMarkerOverlay&&(this.markerOverlay.removeMarker(this.placemark),this.markerOverlay.placemarkVisibilityChanged(this.placemark))};a.prototype.getMap=function(){return this.placemark.addedToMarkerOverlay?
d:void 0};a.prototype.getDraggable=function(){return!1};a.prototype.getVisible=function(){return this.visible};b.prototype.extendBounds=function(a){this.bounds&&!this.bounds.isEmpty()&&(a.extend(this.bounds.getSouthWest()),a.extend(this.bounds.getNorthEast()))};b.prototype.setOpacity=function(){if(this.map&&!this.groundOverlay.isHidden()){var a=this,b=$("img[src$='"+this.url+"']");b.length?b.css("opacity",this.opacity):60>++this.trySetOpacityAttempts&&setTimeout(function(){a.setOpacity()},1E3)}};
b.prototype.removeFromMap=function(){this.map.removeOverlay(this.groundOverlay)};b.prototype.isHidden=function(){return this.groundOverlay.isHidden()};b.prototype.setVisible=function(a){a?(this.groundOverlay.show(),this.trySetOpacityAttempts=0,this.setOpacity()):this.groundOverlay.hide()};b.prototype.refreshIcon=function(a){this.remove();a.features=[g.groundOverlay(a)]};g={proxy:m.proxy,maxFileSize:m.constraints?m.constraints.maxFileSize:void 0,maxPlacemarks:m.constraints?m.constraints.maxPlacemarks:
void 0,container:"#map",refreshInfoWindow:function(a){jc2cui.mapWidget.showPlacemarkInfoWindow(a)},containerRemoved:function(a){a.markerOverlay&&a.markerOverlay.removeFromMap();jc2cui.mapWidget.clusterManager.cluster(!1,a)},parseCallback:function(a){var b,c;c=a;var d;for(jc2cui.mapWidget.totalMarkersLoaded(jc2cui.mapWidget.kmlParser.totalEntities());c.parent;)c=c.parent;b=c.overlayId;c=c.featureId;if(d=jc2cui.mapWidget.kmlParser.getTreeData(a,a.visible,b,c))if($.isArray(d))for(h=0;h<d.length;h++)jc2cui.mapWidget.addTreeItems(d[h],
b,c,a.parent?a.parent.internalId:void 0);else jc2cui.mapWidget.addTreeItems(d,b,c,a.parent?a.parent.internalId:void 0);jc2cui.mapWidget.clusterManager.getClusterer(a)?jc2cui.mapWidget.clusterManager.cluster(!0,a):a.markerOverlay&&a.markerOverlay.doRedraw()},region:function(a){a.latLonAltBox=new google.maps.LatLngBounds(new google.maps.LatLng(a.latLonAltBox.south,a.latLonAltBox.west),new google.maps.LatLng(a.latLonAltBox.north,a.latLonAltBox.east));return a},isRegionActive:function(a){var b,c,e;if(!d.getBounds().intersects(a.latLonAltBox))return!1;
b=d.fromLatLngToDivPixel(a.latLonAltBox.getSouthWest());c=d.fromLatLngToDivPixel(a.latLonAltBox.getNorthEast());e=Math.abs(c.x-b.x);b=Math.abs(c.y-b.y);e=Math.round(Math.sqrt(e*b)).toFixed(0);return e<a.lod.minLodPixels||0<=a.lod.maxLodPixels&&e>a.lod.maxLodPixels?!1:!0},formatView:function(a){var b=d.getBounds(),c=b.getSouthWest(),e=b.getNorthEast(),q=new google.maps.LatLng(e.lat(),c.lng()),b=b.getCenter(),f=d.getZoom(),f=352E5/Math.pow(2,f);a=a.replace("[bboxWest]",c.lng());a=a.replace("[bboxSouth]",
c.lat());a=a.replace("[bboxEast]",e.lng());a=a.replace("[bboxNorth]",e.lat());a=a.replace("[lookatLon]",b.lng());a=a.replace("[lookatLat]",b.lat());a=a.replace("[lookatRange]",f);a=a.replace("[lookatTilt]",0);a=a.replace("[lookatHeading]",0);a=a.replace("[horizFov]",e.distanceFrom(q)/2/f);a=a.replace("[vertFov]",c.distanceFrom(q)/2/f);a=a.replace("[horizPixels]",d.getSize().width);a=a.replace("[vertPixels]",d.getSize().height);return a=a.replace("[terrainEnabled]",0)},marker:function(b,c,e){e.markerOverlay||
(e.markerOverlay=new jc2cui.mapWidget.markerOverlay.MarkerOverlay(d,e));c=new google.maps.LatLng(c.lat,c.lon);jc2cui.mapWidget.clusterManager.getClusterer(e)||e.markerOverlay.addMarker(b,c);return new a(b,c,e.markerOverlay)},polyline:function(a,b,c){var d=n(a);d.path=E(b);b=new google.maps.Polyline(d.path,d.strokeColor,d.strokeWeight,d.strokeOpacity);p(b,a,c);return b},polygon:function(a,b,c){var d,e=n(a),q,f=[];for(d=0;d<b.length;d++)q=E(b[d]),q=new google.maps.Polygon(q,e.strokeColor,e.strokeWeight,
e.strokeOpacity,e.fillColor,e.fillOpacity),p(q,a,c),f.push(q);return f},groundOverlay:function(a,c){var e;e=a.icon.viewFormat&&a.icon.viewFormat.length&&0<=a.icon.viewFormat.indexOf("BBOX")?d.getBounds():new google.maps.LatLngBounds(new google.maps.LatLng(a.latLonBox.south,a.latLonBox.west),new google.maps.LatLng(a.latLonBox.north,a.latLonBox.east));e=new b(a.icon.getHref(),e,d,a.opacity);a.visible||e.setVisible(!1);return e},bounds:function(){return new google.maps.LatLngBounds}};google.maps.Marker.prototype.extendBounds=
function(a){a.extend(this.getLatLng())};google.maps.Marker.prototype.removeFromMap=function(){d.removeOverlay(this)};google.maps.Marker.prototype.setVisible=function(a){a?this.show():this.hide()};google.maps.Polyline.prototype.extendBounds=function(a){var b=this.getBounds();b&&!b.isEmpty()&&(a.extend(b.getSouthWest()),a.extend(b.getNorthEast()))};google.maps.Polyline.prototype.removeFromMap=google.maps.Marker.prototype.removeFromMap;google.maps.Polyline.prototype.setVisible=google.maps.Marker.prototype.setVisible;
google.maps.Polygon.prototype.extendBounds=google.maps.Polyline.prototype.extendBounds;google.maps.Polygon.prototype.removeFromMap=google.maps.Marker.prototype.removeFromMap;google.maps.Polygon.prototype.setVisible=google.maps.Marker.prototype.setVisible;jc2cui.mapWidget.kmlParser.init(g);jc2cui.mapWidget.clusterManager.init(d,r);jc2cui.mapWidget.markerOverlay.init();jc2cui.mapWidget.infoWindow.init({containment:"#map"});e=document.location.href;e=e.substring(0,e.lastIndexOf("/")+1);$('<link rel="stylesheet" type="text/css" href="'+
(e+"css/google.maps.v2.all.min.css")+'" >').appendTo("head");clusterInit();jc2cui.mapWidget.latLonControl.init();d.addControl(new jc2cui.mapWidget.latLonControl.Control);jc2cui.mapWidget.rendererReady()}function v(){google.load("maps","2",{callback:function(){A()}})}function x(a,b){var c=[b],d;b.getAllContainers(c);$.each(c,function(b,c){if(c.internalId===a)return d=c,!1});d||(c=b.getAllFeatures(),$.each(c,function(b,c){if(c.internalId===a)return d=c,!1}));d||(c=b.getAllScreenOverlays(),$.each(c,
function(b,c){if(c.internalId===a)return d=c,!1}));return d}function D(a){a=Math.round(Math.log(352E5/a)/Math.log(2));if(0>a)a=0;else if(21<a||Infinity===a)a=21;d.getZoom()!==a&&d.setZoom(a)}function y(a,b){void 0!==b&&null!==b&&D("auto"===b?0:b);d.getCenter().equals(a)||d.panTo(a)}function F(a,b){var c;a.isEmpty()||("auto"===b?(c=d.getBoundsZoomLevel(a),c!==d.getZoom()&&d.setZoom(c),y(a.getCenter())):y(a.getCenter(),b))}function H(a,b){var c;a.viewer?y(new google.maps.LatLng(a.viewer.latitude,a.viewer.longitude),
"auto"===b?a.viewer.altitude:b):(c=new google.maps.LatLngBounds,a.extendBounds(c),c.isEmpty()||d.getBounds().equals(c)||F(c,b))}function L(a,b,c){var d=new google.maps.TileLayer(new google.maps.CopyrightCollection(""),1,17);d.baseUrl=a;d.params=b;d.getTileUrl=function(d,e){var f=new google.maps.Point(256*d.x,256*(d.y+1)),g=new google.maps.Point(256*(d.x+1),256*d.y),f=google.maps.NORMAL_MAP.getProjection().fromPixelToLatLng(f,e),g=google.maps.NORMAL_MAP.getProjection().fromPixelToLatLng(g,e),h="",
k=0>a.indexOf("?");$.each(b,function(a,b){k?(h="?",k=!1):h+="&";h+=a;h+="=";h+=b});h+="&BBOX="+(c?f.y+","+f.x+","+g.y+","+g.x:f.x+","+f.y+","+g.x+","+g.y);return a+h};return d}function O(a){this.layer=a;this.features=[]}function G(a){this.mapType=a;this.features=[]}function P(a){jc2cui.mapWidget.kmlParser.Container.call(this);this.id=a;z[a]=this}function ba(a,b,c,e,f,h,k,l){k=r[a]||new g(a);var m=(l=k.docs[b])?l.visible:k.visible,n={},p=!1;f=f||{};$.each(f,function(a,b){n[a.toUpperCase()]=b});f=n;
f.SERVICE="WMS";f.REQUEST="GetMap";f.VERSION=f.VERSION||"1.1.1";"1.1.1"===f.VERSION||"1.1.0"===f.VERSION||"1.0.0"===f.VERSION?f.SRS="EPSG:4326":(p=!0,f.CRS="EPSG:4326");f.FORMAT=f.FORMAT||"image/png";f.TRANSPARENT=f.TRANSPARENT||"TRUE";f.STYLES=f.STYLES||"";f.BGCOLOR=f.BGCOLOR||"0xFFFFFF";f.WIDTH="256";f.HEIGHT="256";e=L(e,f,p);h?(e=new google.maps.MapType([e],google.maps.NORMAL_MAP.getProjection(),c),d.addMapType(e),"function"===typeof d.setUIToDefault?d.setUIToDefault():d.addControl(new GMapTypeControl),
h=new P(a+b),h.features.push(new G(e))):(e=new google.maps.TileLayerOverlay(e),d.addOverlay(e),h=new jc2cui.mapWidget.kmlParser.Container,h.features.push(new O(e)));h.setVisible(m,!0);l&&l.remove();h.featureId=b;h.internalId=b;h.overlayId=a;h.name=c;k.docs[b]=h;jc2cui.mapWidget.addTreeItems({title:h.name||h.featureId,key:h.featureId,isFeature:!0,select:m},a)}function ca(a,b,c,d,e,f,h,k,l){var m,n,p;try{m=r[a]||new g(a),p=m.docs[b],n=jc2cui.mapWidget.kmlParser.loadKml(e,p?p.visible:m.visible,null,
function(a){p&&p.remove();a.error||f&&H(n,"auto")},null,null,h),n.featureId=b,n.overlayId=a,n.name=c,m.docs[b]=n}catch(s){a="Failed to plot KML.",s&&(a+=": "+s),jc2cui.mapWidget.error({sender:k?k.id:"",type:"map.feature.plot",msg:l,error:a})}}function da(a,b,c,d,e,f,h,k){var l,m,n;try{l=r[a]||new g(a),n=l.docs[b],m=jc2cui.mapWidget.kmlParser.parseKmlString(d,n?n.visible:l.visible,null,function(a){n&&n.remove();a.error||e&&H(m,"auto")},f),m.featureId=b,m.overlayId=a,m.name=c,l.docs[b]=m}catch(p){a=
"Failed to plot KML.",p&&(a+=": "+p),jc2cui.mapWidget.error({sender:h?h.id:"",type:"map.feature.plot",msg:k,error:a})}}function w(a,b){var c=r[b],d;c&&$.each(c.docs,function(b,c){d=x(a,c);return!d});return d}function S(a){var b=r[a.overlayId],c,d;if(b){if(c=b.features[a.selectedId])switch(b=c.data.type,c=c.mapObject,b){case "marker":d=c.getLatLng();break;case "line":case "shape":b=c.getBounds(),d=b.getCenter()}else a.selectedId&&0<a.selectedId.length&&$.each(b.docs,function(b,d){var e=d.getAllFeatures();
$.each(e,function(b,d){if(d.id===a.selectedId)return c=d,!1});return!c}),!c&&(a.selectedName&&0<a.selectedName.length)&&$.each(b.docs,function(b,d){var e=d.getAllFeatures();$.each(e,function(b,d){if(d.name===a.selectedName)return c=d,!1});return!c}),c&&(b=new google.maps.LatLngBounds,c.extendBounds(b),b.isEmpty()||(d=b.getCenter()));c?d?y(d):console.log("maps V2 configured map widget unable to determine location of selected item with id "+a.selectedId+" and name "+a.selectedName):console.log("maps V2 configured map widget unable to find selected item with id "+
a.selectedId+" and name "+a.selectedName)}else console.log("maps V2 configured map widget unable to find overlay "+a.overlayId+" for selected item with id "+a.selectedId+" and name "+a.selectedName)}function W(a,b,c){a=r[a];var d=!1;a&&$.each(a.docs,function(a,e){var f=e.getAllContainers();$.each(f,function(a,e){if(e.internalId===b)return e.open=c,d=!0,!1});return!d})}var m,d,z={},u,r={},R,N,Y,ea,X,Q,U=2,M,V,J=0,T=0,ga=0,k={marker:0,shape:0,line:0},Z,ha,ma={},C,ka,ia,fa,la=-1,ja=1E3;g.prototype.setVisibility=
function(a){this.visible=a;$.each(this.docs,function(b,c){c.setVisible(a,!0)});$.each(this.features,function(b,c){a?(c.mapObject.show(),N.is(":visible")&&s(c,!0)):(c.mapObject.hide(),N.is(":visible")&&s(c,!1),jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===c.data.id&&jc2cui.mapWidget.infoWindow.close())});$.each(this.children,function(b,c){c.setVisibility(a)})};g.prototype.remove=function(){delete r[this.id];this.parent&&delete this.parent.children[this.id];
$.each(this.docs,function(a,b){b.remove()});$.each(this.features,function(a,b){d.removeOverlay(b.mapObject);jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===b.data.id&&jc2cui.mapWidget.infoWindow.close()});$.each(this.children,function(a,b){b.remove()})};g.prototype.bounds=function(){var b=new google.maps.LatLngBounds;$.each(this.features,function(c,d){var e=a(d);e&&!e.isEmpty()&&(b.isEmpty()?b=e:(b.extend(e.getSouthWest()),b.extend(e.getNorthEast())))});$.each(this.docs,
function(a,c){c.extendBounds(b)});$.each(this.children,function(a,c){var d=c.bounds();d&&!d.isEmpty()&&(b.isEmpty()?b=d:(b.extend(d.getSouthWest()),b.extend(d.getNorthEast())))});return b};ha=function(a){(r[jc2cui.mapWidget.USER_DRAWN_OVERLAY]||new g(jc2cui.mapWidget.USER_DRAWN_OVERLAY)).features[a.data.id]=a;google.maps.Event.addListener(a.mapObject,"click",function(b){N.is(":visible")?h(a):jc2cui.mapWidget.showPlacemarkInfoWindow(a.data);jc2cui.mapWidget.itemSelected({selectedId:a.data.id||void 0,
selectedName:a.data.title||void 0,featureId:a.data.id,overlayId:jc2cui.mapWidget.USER_DRAWN_OVERLAY})})};M=function(a,b){var c="images/";Y.attr("src",0===a?"images/Bsd.png":"images/Bsu.png");ea.attr("src",1===a?"images/Bmd.png":"images/Bmu.png");c=2===a?c+"Bldm.png":3===a?c+"Bpdm.png":c+(2===U?"Blum.png":"Bpum.png");X.attr("src",c);Q.hide();V&&(V(),V=null);if(b&&a)switch(a){case 1:e(b);break;case 2:l(b);break;case 3:l(b,!0)}};O.prototype.remove=function(){d.removeOverlay(this.layer)};O.prototype.extendBounds=
function(a){};O.prototype.getAllVisiblePlacemarks=function(a){return a||[]};O.prototype.setVisible=function(a){a?this.layer.show():this.layer.hide()};G.prototype.remove=function(){d.getCurrentMapType()===this.mapType&&d.setMapType(ia);d.removeMapType(this.mapType)};G.prototype.extendBounds=function(a){};G.prototype.getAllVisiblePlacemarks=function(a){return a||[]};G.prototype.setVisible=function(a){a?d.getCurrentMapType()!==this.mapType&&d.setMapType(this.mapType):d.getCurrentMapType()===this.mapType&&
d.setMapType(ia)};P.prototype=new jc2cui.mapWidget.kmlParser.Container(null,!0);u=P.prototype.remove;P.prototype.remove=function(){delete z[this.id];u.call(this)};return{init:function(a){(m=a)?m.ajaxLoadUrl?$.ajax({url:m.ajaxLoadUrl+"&callback=googleLoaded",dataType:"script",timeout:2E4,error:function(a,b,c){a="Error initializing Google Maps";b&&"error"!==b&&(a+=": "+b);jc2cui.mapWidget.showError(a)}}):m.mapsApiUrl?$.ajax({url:m.mapsApiUrl+"&async=2&callback=mapsLoaded",dataType:"script",timeout:2E4,
error:function(a,b,c){a="Error initializing Google Maps";b&&"error"!==b&&(a+=": "+b);jc2cui.mapWidget.showError(a)}}):jc2cui.mapWidget.showError("Config file includes neither a ajax load url or a direct Google Maps API url. Unable to load Google Maps API"):jc2cui.mapWidget.showError("Missing config file. Unable to load Google Maps API")},createOverlay:function(a,b,c){if(!r[a.overlayId]){var d;a.parentId&&((d=r[a.parentId])||console.log("maps V2 configured map widget unable to find parent overlay with id "+
a.parentId));return new g(a.overlayId,d,a.clustering)}},removeOverlay:function(a,b,c){var d=r[a];d?(d.remove(),delete ma[a]):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.overlay.remove",msg:c,error:"No overlay with id "+a+" found to remove."})},setOverlayVisibility:function(a,b,c,d){var e=r[a];e?e.setVisibility(b):jc2cui.mapWidget.error({sender:c?c.id:"",type:"map.overlay."+(b?"show":"hide"),msg:d,error:"No overlay with id "+a+" found to "+(b?"show.":"hide.")})},isOverlayVisible:function(a){a=
(a=r[a])?a.visible:!1;return a},updateOverlay:function(a,b,c){b=r[a.overlayId];var d,e;if(!b)return!1;a.clustering&&(b.clustering=a.clustering,e=!0);a.parentId&&((c=r[a.parentId])||console.log("maps V3 configured map widget unable to find parent overlay with id "+a.parentId),d=b.parent,d!==c&&(a=jc2cui.mapWidget.clusterManager.getClusterer(b),d&&delete d.children[b.id],b.parent=c,c.children[b.id]=b,b=jc2cui.mapWidget.clusterManager.getClusterer(b),a!==b&&(e=!0)));e&&(jc2cui.mapWidget.clusterManager.setClustering(!1),
jc2cui.mapWidget.clusterManager.setClustering(!0));return!0},loadKml:function(a,b,c){ca(a.overlayId,a.featureId,a.name||a.featureName||a.url,a.proxy,a.url,a.zoom,a.clustering,b,c)},loadWms:function(a,b,c){ba(a.overlayId,a.featureId,a.name||a.featureName||a.url,a.url,a.params,a.background,b,c)},parseKml:function(a,b,c){da(a.overlayId,a.featureId,a.name||a.featureName||"kml",a.feature,a.zoom,a.clustering,b,c)},removeFeature:function(a,b,c){var e=r[a.overlayId],f=!1,g;e?(e.features[a.featureId]&&(d.removeOverlay(e.features[a.featureId].mapObject),
delete e.features[a.featureId],f=!0,jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===a.featureId&&jc2cui.mapWidget.infoWindow.close()),!f&&(g=e.docs[a.featureId])&&(g.remove(),delete e.docs[a.featureId],f=!0),f||jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.unplot",msg:c,error:"Unable to find feature "+a.featureId+" in overlay "+a.overlayId})):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.unplot",msg:c,error:"Unable to find overlay "+
a.overlayId||a.url})},updateFeature:function(a,b,c,d){c=r[a.overlayId];var e,f,g;a.clustering&&(e=!0);if(!c)return b.push("Unable to find overlay "+a.overlayId),!1;f=c.docs[a.featureId];if(!f)return b.push("Unable to find feature "+a.featureId+" in overlay "+a.overlayId),!1;if(a.newOverlayId&&a.newOverlayId!==a.overlayId){e||(g=jc2cui.mapWidget.clusterManager.getClusterer(f));d=r[a.newOverlayId];if(!d)return b.push("Unable to find overlay "+a.newOverlayId),!1;f.overlayId=a.newOverlayId;d.docs[a.featureId]=
f;delete c.docs[a.featureId];f.clustering=a.clustering;e||(a=jc2cui.mapWidget.clusterManager.getClusterer(f),g!==a&&(e=!0))}else e&&(f.clustering=a.clustering);e&&(jc2cui.mapWidget.clusterManager.setClustering(!1),jc2cui.mapWidget.clusterManager.setClustering(!0));return!0},showFeature:function(a,b,c){var d=r[a.overlayId],e=!1;d?(d.features[a.featureId]&&(d.features[a.featureId].mapObject.show(),N.is(":visible")&&s(d.features[a.featureId],!0),e=!0),!e&&(d=d.docs[a.featureId])&&(d.setVisible(!0,!0),
e=!0),e||jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.show",msg:c,error:"Unable to find feature "+a.featureId+" in overlay "+a.overlayId})):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.show",msg:c,error:"Unable to find overlay "+a.overlayId||a.url})},hideFeature:function(a,b,c){var d=r[a.overlayId],e=!1;d?(d.features[a.featureId]&&(d.features[a.featureId].mapObject.hide(),N.is(":visible")&&s(d.features[a.featureId],!1),jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===
a.featureId&&jc2cui.mapWidget.infoWindow.close(),e=!0),!e&&(d=d.docs[a.featureId])&&(d.setVisible(!1,!0),e=!0),e||jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.hide",msg:c,error:"Unable to find feature "+a.featureId+" in overlay "+a.overlayId})):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.hide",msg:c,error:"Unable to find overlay "+a.overlayId||a.url})},showItem:function(a){var b=w(a.itemId,a.overlayId);b&&(b.setVisible(!0,!0),a.zoom&&(a=new google.maps.LatLngBounds,b.extendBounds(a),
F(a)))},hideItem:function(a){(a=w(a.itemId,a.overlayId))&&a.setVisible(!1,!0)},centerOnOverlay:function(a,b,c){var d=a.overlayId;a=a.zoom;var e=r[d];e?F(e.bounds(),a):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.view.center.overlay",msg:c,error:"Unable to find overlay "+d})},centerOnFeature:function(b,c,d){a:{var e=r[b.overlayId],f,g;if(e){if(f=e.features[b.featureId])c=a(f),F(c,b.zoom),b.select&&(g={selectedId:f.data.id||void 0,selectedName:f.data.title||void 0,featureId:b.featureId,overlayId:b.overlayId});
else{f=e.docs[b.featureId];if(!f){jc2cui.mapWidget.error({sender:c?c.id:"",type:"map.view.center.feature",msg:d,error:"Unable to find feature "+b.featureId});break a}H(f,b.zoom);b.select&&b.overlayId===jc2cui.mapWidget.USER_DRAWN_OVERLAY&&(g={selectedId:b.featureId||void 0,selectedName:f.features.length?f.features[0].name||void 0:void 0,featureId:b.featureId,overlayId:b.overlayId})}g&&jc2cui.mapWidget.itemSelected(g)}else jc2cui.mapWidget.error({sender:c?c.id:"",type:"map.view.center.feature",msg:d,
error:"Unable to find overlay "+b.overlayId})}},centerOnItem:function(a){var b=w(a.itemId,a.overlayId);if(b&&(H(b,a.zoom),a.select)){for(a=b.parent;a.parent;)a=a.parent;b={selectedId:b.id||void 0,selectedName:b.name||void 0,featureId:a.featureId,overlayId:a.overlayId};jc2cui.mapWidget.itemSelected(b)}},centerOnLocation:function(a,b,c){b=new google.maps.LatLng(a.location.lat,a.location.lon);y(b,a.zoom)},fitToBounds:function(a){F(a,"auto")},centerOnBounds:function(a,b,c){b=new google.maps.LatLng(a.bounds.southWest.lat,
a.bounds.southWest.lon);c=new google.maps.LatLng(a.bounds.northEast.lat,a.bounds.northEast.lon);b=new google.maps.LatLngBounds(b,c);F(b,a.zoom)},zoomToRange:function(a,b,c){D(a.range)},selected:function(a,b,c){S(a)},getViewStatus:function(a,b,c){return t(a,b,c)},getDropLocation:function(){return{lat:R.lat(),lon:R.lng()}},checkResize:function(){d&&d.checkResize();setTimeout(function(){jc2cui.mapWidget.infoWindow.checkResize();$.each(r,function(a,b){$.each(b.docs,function(a,b){var c=b.getAllScreenOverlays();
$.each(c,function(a,b){b.placer()})})})},250)},setDrawingToolsVisibility:function(a){f(a)},setExpanded:function(a,b,c){W(a,b,c)},optionChanged:function(a,b){"labels"===a?$.each(r,function(a,b){$.each(b.docs,function(a,b){var c=[b];b.getAllContainers(c);$.each(c,function(a,b){b.markerOverlay&&b.markerOverlay.doRedraw(!0)})})}):"clustering"===a&&jc2cui.mapWidget.clusterManager.setClustering(b)},googleReady:function(){v()},mapsReady:function(){A()},info:function(){var a=0;$.each(r,function(b,c){++a});
return{name:"Google Maps V2",type:"2D",entities:jc2cui.mapWidget.kmlParser.getEntitiesString(a)}}}}();
