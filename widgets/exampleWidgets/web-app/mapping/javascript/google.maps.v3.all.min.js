util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.kmlParser=function(){function a(){if(void 0===V){var h=document.createElement("x"),e=document.documentElement,C=window.getComputedStyle;void 0===h.style.pointerEvents?V=!1:(h.style.pointerEvents="auto",h.style.pointerEvents="x",e.appendChild(h),C=C&&"auto"===C(h,"").pointerEvents,e.removeChild(h),V=!!C)}return V}function c(h,e,C,a){if(0===h&&void 0!==W)a(W);else if(1===h&&void 0!==Q)a(Q);else if(X)setTimeout(function(){c(h,e,C,a)},1E3);else{X=!0;"function"===typeof e&&(e=e());var g=
$("<div>"+e+'<br><br><div><input type="checkbox" id="global">Dont show again, apply to all overlays<br></div>'),s=$(window),m=s.innerHeight(),s=s.innerWidth();g.dialog({preferredHeight:220,preferredWidth:300,height:Math.min(220,m-20),width:Math.min(300,s-20),modal:!1,title:C,buttons:{Yes:function(){g.dialog("close");a(!0,$("#global",g).is(":checked"))},No:function(){g.dialog("close");a(!1,$("#global",g).is(":checked"))}},close:function(h,e){X=!1;g.remove()}})}}function b(h){var e=$(w.container),C=
$('<img class="screenOverlay" src='+h.href+">"),z,g=!1,s=this;this.visibility=h.visibility;this.visible=h.visible;this.name=h.name;this.placer=function(){return function(){var a={},m=0,u=0,c,b,f=C[0].height,n=C[0].width,d=h.overlayXY.x,w=h.overlayXY.y;h.screenXY&&(b=e.height(),c=e.width(),m=h.screenXY.x,u=h.screenXY.y,"insetPixels"===h.screenXY.xunits?m=c-m-n:"fraction"===h.screenXY.xunits&&(m*=c),"pixels"===h.screenXY.yunits?u=b-u:"fraction"===h.screenXY.yunits&&(u=b*(1-u)));h.sizeXY&&(0<h.sizeXY.x&&
("pixels"===h.sizeXY.xunits?n=h.sizeXY.x:"fraction"===h.sizeXY.xunits&&(c=c||e.width(),n=c*h.sizeXY.x)),0<h.sizeXY.y&&("pixels"===h.sizeXY.yunits?f=h.sizeXY.y:"fraction"===h.sizeXY.yunits&&(b=b||e.height(),f=b*h.sizeXY.y)),0===h.sizeXY.x&&0!==h.sizeXY.y&&(c=C[0].width/C[0].height,n=f*c),0===h.sizeXY.y&&0!==h.sizeXY.x&&(c=C[0].width/C[0].height,f=n/c),n&&(a.width=n),f&&(a.height=f));h.overlayXY&&("pixels"===h.overlayXY.xunits?d=-d:"insetPixels"===h.overlayXY.xunits?d=-(n-d):"fraction"===h.overlayXY.xunits&&
(d*=-n),"pixels"===h.overlayXY.yunits?w=-f+w:"insetPixels"===h.overlayXY.yunits?w=-w:"fraction"===h.overlayXY.yunits&&(w=-f*(1-w)),m+=d,u+=w);0!==m&&(a.left=m+"px");0!==u&&(a.top=u+"px");C.css(a);z&&z.css(a);h.rotation&&!g&&(g=!0,h.rotation=0>h.rotation?-h.rotation:360-h.rotation,C.rotate(h.rotation));s.visible||s.setVisible(!1);C.css("opacity",1)}}();C.css("opacity",0);C.load(this.placer);this.image=C.appendTo(e);a()||(z=$('<span class="screenOverlay"></span>'),z.css({"background-color":"#F5F5F5",
opacity:0.3,"z-index":0}),this.mask=z.appendTo(e));this.internalId="a"+(++m).toString()}function k(h){this.internalId="a"+(++m).toString();this.parent=h;this.features=[]}function p(h,e){e||++H;this.internalId="a"+(++m).toString();this.containers=[];this.features=[];this.screenOverlays=[];this.viewSensitiveFeatures=[];this.visibility=!0;h&&(this.parent=h,h.containers.push(this),h.maintainState&&(this.maintainState=!0,this.idMap={},this.nameMap={}),this.loadMorePlacemarks=h.loadMorePlacemarks)}function q(h){return setTimeout(function(){h.features.length&&
h.features[0].refreshIcon(h)},h.icon.viewRefreshTime)}function d(){p.apply(this,arguments);this.intervals=[];this.loaded=!1}function f(h){var e="",C;if(h)if(2===h.nodeType||3===h.nodeType||4===h.nodeType)e=h.nodeValue;else if(1===h.nodeType||9===h.nodeType||11===h.nodeType)for(C=0;C<h.childNodes.length;++C)e+=f(h.childNodes[C]);return $.trim(e)}function r(h,e){if(h){var C=h.getElementsByTagName(e);if(C.length)return f(C[0])}}function l(h,e){var C=f(h);return C.length?0!==parseInt(C,10):e||!1}function n(h,
e,C){return h&&(h=h.getElementsByTagName(e),h.length)?l(h[0],C):C}function v(h){var e={},C,a,g;if(1===h.nodeType||9===h.nodeType||11===h.nodeType){if(0<h.attributes.length)for(a=0;a<h.attributes.length;a++)C=h.attributes.item(a),e[C.nodeName]=f(C)}else if(2===h.nodeType||3===h.nodeType||4===h.nodeType)e=f(h);if(h.hasChildNodes())if(1!==h.childNodes.length||2!==h.childNodes[0].nodeType&&3!==h.childNodes[0].nodeType&&4!==h.childNodes[0].nodeType)for(a=0;a<h.childNodes.length;a++)g=h.childNodes.item(a),
3!==g.nodeType&&8!==g.nodeType&&(C=g.nodeName,g=v(g),e[C]?($.isArray(e[C])||(e[C]=[e[C]]),e[C].push(g)):e[C]=g);else e=f(h.childNodes[0]);return e}function A(h){return{x:parseFloat(h.getAttribute("x")),y:parseFloat(h.getAttribute("y")),xunits:h.getAttribute("xunits"),yunits:h.getAttribute("yunits")}}function t(h){var e=parseFloat(r(h,"altitude")),a=r(h,"altitudeMode"),m=parseFloat(r(h,"range"));isNaN(m)?isNaN(e)&&(e=0):e=m;a&&a.length||(a="relativeToGround");return{latitude:parseFloat(r(h,"latitude")),
longitude:parseFloat(r(h,"longitude")),altitude:e,altitudeMode:a,range:m}}function y(h){if(h.childNodes.length)return h={latLonAltBox:{north:parseFloat(r(h,"north")),south:parseFloat(r(h,"south")),east:parseFloat(r(h,"east")),west:parseFloat(r(h,"west"))},lod:{minLodPixels:parseFloat(r(h,"minLodPixels")),maxLodPixels:parseFloat(r(h,"maxLodPixels"))||-1}},w.region?w.region(h):h}function x(h){h&&(this.href=r(h,"href"),this.refreshMode=r(h,"refreshMode"),this.viewRefreshMode=r(h,"viewRefreshMode"),this.viewFormat=
r(h,"viewFormat"),"onInterval"===this.refreshMode&&(this.interval=parseFloat(r(h,"refreshInterval"))),"onStop"===this.viewRefreshMode&&(this.viewRefreshTime=parseFloat(r(h,"viewRefreshTime")),isNaN(this.viewRefreshTime)&&(this.viewRefreshTime=4),this.viewRefreshTime*=1E3,this.viewFormat&&this.viewFormat.length||(this.viewFormat="BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]")))}function F(h,e){var a={},m,g,s,z;h=h||"ffffffff";m=h.substr(0,2);z=h.substr(2,2);s=h.substr(4,2);g=h.substr(6,2);a.opacity=
parseInt(m,16)/256;if("random"===e){m=[g,s,z];for(s=0;2>s;s++)z=Math.round(Math.random()*parseInt(g,16)).toString(16),1===z.length&&(z="0"+z),m[s]=z;g="#"+m[0]+m[1]+m[2]}else g="#"+g+s+z;a.color=g;return a}function B(h){var e={},a,m,g,s,z;m=h.getElementsByTagName("Style");for(a=0;a<m.length;a++)g=m[a],(s=g.getAttribute("id"))&&(e["#"+s]=v(g));m=h.getElementsByTagName("StyleMap");for(a=0;a<m.length;a++)if(g=m[a],s=g.getAttribute("id"))h=r(m[a],"key"),"normal"===h&&((h=r(m[a],"styleUrl"))?(g=h.indexOf("#"),
0<g?(z=h.substring(0,g),h=h.substring(g),R[z]&&(h=R[z][h])):(0>g&&(h="#"+h),h=e[h]),h?e["#"+s]=h:console.log("styleMap styleUrl of #"+s+" not found")):(h=m[a].getElementsByTagName("Style"),h.childNodes.length&&(e["#"+s]=v(h.childNodes[0]))));$.each(e,function(h,e){e.LineStyle&&e.LineStyle.color&&"string"===typeof e.LineStyle.color&&(e.LineStyle.color=F(e.LineStyle.color,e.LineStyle.colorMode));e.PolyStyle&&e.PolyStyle.color&&"string"===typeof e.PolyStyle.color&&(e.PolyStyle.color=F(e.PolyStyle.color,
e.PolyStyle.colorMode))});return e}function M(h){var e=[];h=h.getElementsByTagName("Schema");var a;for(a=0;a<h.length;a++)"Placemark"===h[a].getAttribute("parent")&&e.push(h[a].getAttribute("name"));return e}function L(h,e,a,m){return function(g){R[e]=g.doc?g.doc.styles:{};I(h,a+1,m)}}function I(h,e,a){for(var m=h.getElementsByTagName("styleUrl"),g,s,u;e<m.length;e++)if(g=f(m[e]),s=g.indexOf("#"),0<s&&0===g.indexOf("http")&&(g=g.substring(0,s),!R[g])){u=z(g,!1,null,L(h,g,e,a),null,null,!0);break}u||
a()}function J(h){var e,a=[],m;h=h.replace(/,\s+/g,",");h=h.split(/\s+/g);for(m=0;m<h.length;m++)e=h[m].split(","),1<e.length&&a.push({lon:parseFloat(e[0]),lat:parseFloat(e[1]),alt:parseFloat(e[2])});return a}function G(h,e,a,m){var g=new k(e),s,z=[],u=[],c=[],b,d,l,q,p,O;g.id=h.getAttribute("id");g.name=r(h,"name");g.description=r(h,"description");g.styleUrl=r(h,"styleUrl");s=h.getElementsByTagName("Style");s.length&&(g.style=v(s[0]),g.style.LineStyle&&g.style.LineStyle.color&&"string"===typeof g.style.LineStyle.color&&
(g.style.LineStyle.color=F(g.style.LineStyle.color,g.style.LineStyle.colorMode)),g.style.PolyStyle&&g.style.PolyStyle.color&&"string"===typeof g.style.PolyStyle.color&&(g.style.PolyStyle.color=F(g.style.PolyStyle.color,g.style.PolyStyle.colorMode)));g.styleUrl&&(s=g.styleUrl.indexOf("#"),0<s?(d=g.styleUrl.substring(0,s),s=g.styleUrl.substring(s),R[d]&&(s=R[d][s])):(0>s&&(g.styleUrl="#"+g.styleUrl),s=m.styles[g.styleUrl]),g.style=g.style?$.extend(!0,{},s,g.style):s);s=h.getElementsByTagName("Region");
s.length&&(g.region=y(s[0]));s=h.getElementsByTagName("Point");for(b=0;b<s.length;b++){if(m.removed)return;(l=r(s[b],"coordinates"))&&z.push(J(l))}s=h.getElementsByTagName("LineString");for(b=0;b<s.length;b++){if(m.removed)return;(l=r(s[b],"coordinates"))&&u.push(J(l))}s=h.getElementsByTagName("LinearRing");for(b=0;b<s.length;b++){if(m.removed)return;"outerBoundaryIs"!==s[b].parentNode.nodeName&&"innerBoundaryIs"!==s[b].parentNode.nodeName&&(l=r(s[b],"coordinates"))&&(l[l.length-1].lat===l[0].lat&&
l[l.length-1].lon===l[0].lon||l.push(l[0]),u.push(J(l)))}s=h.getElementsByTagName("Polygon");for(b=0;b<s.length;b++){if(m.removed)return;p=[];q=s[b].getElementsByTagName("outerBoundaryIs");l=r(q[0],"coordinates");p.push(J(l));q=s[b].getElementsByTagName("innerBoundaryIs");for(d=0;d<q.length;d++)l=r(q[d],"coordinates"),p.push(J(l));c.push(p)}d=h.getElementsByTagName("Camera");d.length?d=t(d[0]):(d=h.getElementsByTagName("LookAt"),d=d.length?t(d[0]):void 0);g.viewer=d;e&&(e.features.push(g),g.region&&
e.viewSensitiveFeatures.push(g),e.maintainState&&(g.id?(a&&(O=a.idMap[g.id]),e.idMap[g.id]=g):g.name&&(a&&(O=a.nameMap[g.name]),e.nameMap[g.name]=g)));s=h.getElementsByTagName("ExtendedData");if(s.length){a=s[0].getElementsByTagName("Data");s={};if(a.length)for(d=0;d<a.length;d++)b=a[d].getAttribute("name"),l=f(a[d].getElementsByTagName("value")[0]),s[b]=l;g.extendedData=s}O&&(g.visibility=O.visibility);void 0===g.visibility&&(g.visibility=n(h,"visibility",!0));g.visibility=g.visibility&&e.visibility;
g.visible=g.visibility&&(!g.region||w.isRegionActive&&w.isRegionActive(g.region));if(w.marker)for(d=0;d<z.length;d++){if(m.removed)return;(h=w.marker(g,z[d][0],m))&&g.features.push(h)}if(w.polyline)for(d=0;d<u.length;d++){if(m.removed)return;(h=w.polyline(g,u[d],m))&&g.features.push(h)}if(w.polygon)for(d=0;d<c.length;d++){if(m.removed)return;(h=w.polygon(g,c[d],m))&&($.isArray(h)?$.merge(g.features,h):g.features.push(h))}O&&jc2cui.mapWidget.infoWindow&&jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().internalId===
O.internalId&&w.refreshInfoWindow&&w.refreshInfoWindow(g);H+=Math.max(1,g.features.length)}function N(h,e,a,m){var g={name:r(h,"name"),id:h.getAttribute("id"),parent:e},s=h.getElementsByTagName("Icon"),z=h.getElementsByTagName("screenXY"),u=h.getElementsByTagName("overlayXY"),c=h.getElementsByTagName("size"),d=h.getElementsByTagName("rotation");z&&z.length&&(g.screenXY=A(z[0]));u&&u.length&&(g.overlayXY=A(u[0]));c&&c.length&&(g.sizeXY=A(c[0]));s&&s.length&&(g.href=r(s[0],"href"));d&&d.length&&(g.rotation=
parseFloat(f(d[0])));e&&e.maintainState&&(g.id?a&&a.idMap[g.id]&&(g.visibility=a.idMap[g.id].visibility):g.name&&(a&&a.nameMap[g.name])&&(g.visibility=a.nameMap[g.name].visibility));void 0===g.visibility&&(g.visibility=n(h,"visibility",!0));g.visible=g.visibility&&(!e||e.visibility);g=w.screenOverlay?w.screenOverlay(g,m):new b(g);++H;e&&(e.screenOverlays.push(g),e.maintainState&&(g.id?e.idMap[g.id]=g:g.name&&(e.nameMap[g.name]=g)))}function Y(h,e,a,m){var g=new k(e),s=r(h,"color"),z;g.latLonBox={north:parseFloat(r(h,
"north")),east:parseFloat(r(h,"east")),south:parseFloat(r(h,"south")),west:parseFloat(r(h,"west"))};g.opacity=0.5;g.id=h.getAttribute("id");g.name=r(h,"name");z=h.getElementsByTagName("Icon");g.icon=z.length?new x(z[0]):new x;s&&(g.opacity=F(s).opacity);s=h.getElementsByTagName("Region");s.length&&(g.region=y(s[0]));e&&(e.features.push(g),(g.region||"onStop"===g.icon.viewRefreshMode||"onRequest"===g.icon.viewRefreshMode)&&e.viewSensitiveFeatures.push(g),e.maintainState&&(g.id?(a&&a.idMap[g.id]&&(g.visibility=
a.idMap[g.id].visibility),e.idMap[g.id]=g):g.name&&(a&&a.nameMap[g.name]&&(g.visibility=a.nameMap[g.name].visibility),e.nameMap[g.name]=g)));void 0===g.visibility&&(g.visibility=n(h,"visibility",!0));g.visible=g.visibility&&(!e||e.visibility)&&(!g.region||w.isRegionActive&&w.isRegionActive(g.region));w.groundOverlay&&g.features.push(w.groundOverlay(g,m));++H;return g}function Z(h,e,a,m){var g=new d(e),s=h.getElementsByTagName("Link"),u;s.length?g.link=new x(s[0]):(s=h.getElementsByTagName("Url"),
s.length&&(g.link=new x(s[0])));g.link||(g.link=new x);g.maintainState=!n(h,"refreshVisibility",!1);g.visibility=e.visibility&&n(h,"visibility",!0);g.visible=g.visibility&&e.visibility;g.open=n(h,"open",!1);g.id=h.getAttribute("id");g.name=r(h,"name");g.name&&g.name.length||(g.name=g.link.href);e.maintainState&&(a&&(u=a.containers[0]),u&&(g.visibility=u.visibility,g.open=u.open));s=h.getElementsByTagName("Region");s.length&&(g.region=y(s[0]));!g.region||w.isRegionActive&&w.isRegionActive(g.region)?
(++m.remaining,g.loaded=!0,g.loading=!0,g.loadedDoc=z(g.link.getHref(),g.visible,g,function(h){--m.remaining;!m.remaining&&m.initialParseCompleteCallback&&m.initialParseCompleteCallback({doc:m});h=g.loadedDoc||h.doc;g.loadLargeFile=h.loadLargeFile;g.loadMorePlacemarks=h.loadMorePlacemarks;g.loading=!1}),g.loadedDoc.visibility=g.visibility,"onInterval"===g.link.refreshMode&&g.link.interval&&g.intervals.push(setInterval(function(){if(!g.loading){g.loading=!0;var h=z(g.link.getHref(),g.loadedDoc.visible,
g,function(e){var a=h||e.doc;g.loading=!1;g.loadedDoc.remove();for(e=0;e<g.containers.length;e++)if(g.containers[e]===g.loadedDoc){g.containers.splice(e,1);g.loadedDoc=a;break}g.loadLargeFile=a.loadLargeFile;g.loadMorePlacemarks=a.loadMorePlacemarks},null,g.loadedDoc);h.visibility=g.loadedDoc.visibility}},1E3*g.link.interval))):g.visible=!1}function D(h,e,a,m,g,s){return function(){E(h,e,a,m,g,s)}}function E(h,e,a,m,g,s){++U;if(K)setTimeout(function(){--U;E(h,e,a,m,g,s)},10*U);else{--U;K=!0;var z,
u,c,b,d,n,r,q;s=s||0;try{for(z=s;z<h.childNodes.length&&z<s+100;z++){if(m.removed){K=!1;return}c=h.childNodes.item(z);b=c.nodeName;if("kml"===b){n=!0;E(c,e,a,m,g);break}if("Document"===b||"Folder"===b){d=new p(e);d.type=b;d.visible=e.visibility;d.visibility=e.visibility;d.id=c.getAttribute("id");if(e.maintainState){if("Document"===d.type)a&&(q=a.containers[0]);else if(d.id)a&&a.idMap[d.id]&&(q=a.idMap[d.id]),e.idMap[d.id]=d;else for(u=0;u<c.childNodes.length;u++)if(r=c.childNodes.item(u),"name"===
r.nodeName){d.name=f(r);a&&a.nameMap[d.name]&&(q=a.nameMap[d.name]);e.nameMap[d.name]=d;break}q&&(d.visibility=q.visibility,d.open=q.open)}n=!0;E(c,d,q,m,D(h,e,a,m,g,z+1));break}if("NetworkLink"===b)Z(c,e,a,m);else if("Placemark"===b||-1<$.inArray(b,m.placemarkNames))G(c,e,a,m);else if("ScreenOverlay"===b)N(c,e,a,m);else if("GroundOverlay"===b)Y(c,e,a,m);else if("Region"===b){if(d=y(c,m))e.region=d,e.visible=e.visible&&e.visibility&&w.isRegionActive(e.region)}else if("visibility"===b)e.visibility=
e.visibility&&l(c,!0),e.visible=e.visible&&e.visibility&&(!e.region||w.isRegionActive(e.region));else if("name"===b)e.name=f(c);else if("open"===b)void 0===e.open&&(e.open=l(c,!1));else if("LookAt"===b||"Camera"===b)e.viewer=t(c),e.parent&&(e.parent.overlayId&&!e.parent.viewer)&&(e.parent.viewer=e.viewer)}}catch(k){console.log(k)}K=!1;n||(z<h.childNodes.length?setTimeout(function(){E(h,e,a,m,g,z)},1):(g&&g({doc:m}),e===m&&(m.parseCompleteCallback&&m.parseCompleteCallback({doc:m}),w.parseCallback&&
w.parseCallback(m),--m.remaining,!m.remaining&&m.initialParseCompleteCallback&&m.initialParseCompleteCallback({doc:m}))))}}function S(h,a,m,z,g){a.fileSize&&(e+=a.fileSize);g&&(R[g]=R[g]||{});I(h,0,function(){a.styles=B(h);if(z)a.parseCompleteCallback({doc:a});else{a.placemarkNames=M(h);if(!a.loadMorePlacemarks&&!Q){var g=0,u,b,d;b=a.placemarkNames.slice();b.push("Placemark");b.push("ScreenOverlay");b.push("GroundOverlay");b.push("NetworkLink");b.push("Document");b.push("Folder");for(u=0;u<b.length;u++)g+=
h.getElementsByTagName(b[u]).length;if(g+H>w.maxPlacemarks){u=[];for(b=a;b;)b.name&&b.name.length&&u.push(b.name),b=b.parent;u.reverse();d=u.join("/");c(1,function(){var e=["Overlay "];e.push(d);e.push(" contains approximately ");e.push(g);e.push(" entities. There are currently approximately ");e.push(H);e.push(" entities already loaded. ");e.push("Loading the additional entities may cause the browser to become unresponsive. Continue loading anyway?");return e.join("")},"Warning - Large Number Of Entities",
function(g,s){s&&(Q=g);(a.loadMorePlacemarks=g)?E(h,a,m,a):(e-=a.fileSize,a.fileSize=0,--H,a.name=a.name||"",a.name+=" - LOAD CANCELED",a.parseCompleteCallback&&a.parseCompleteCallback({error:"canceled",doc:a}),!z&&w.parseCallback&&w.parseCallback(a))});return}}E(h,a,m,a)}})}function P(e){return 1048576>e?(e/1024).toFixed(2)+"kB":(e/1048576).toFixed(2)+"MB"}function z(h,a,m,b,g,s,u,d,f){var n;n=w.proxy.length?encodeURIComponent(h):h;var l=H,r;f=f||new p(m);f.remaining=1;f.parseCompleteCallback=b;
f.initialParseCompleteCallback=g;f.visibility=f.visible=a;f.clustering=d;s&&(f.open=s.open,f.loadLargeFile=f.loadLargeFile||s.loadLargeFile,f.loadMorePlacemarks=f.loadMorePlacemarks||s.loadMorePlacemarks);if(w.maxPlacemarks<l&&(!Q&&!f.loadMorePlacemarks)&&(s&&(l-=s.getAllFeatures().length),w.maxPlacemarks<l)){if(void 0===f.loadMorePlacemarks){n=[];for(l=f;l;)l.name&&l.name.length&&n.push(l.name),l=l.parent;n.reverse();r=n.join("/");c(1,function(){var e=["There are currently approximately "];e.push(H);
e.push(" entities loaded. ");s?e.push("Reloading overlay "):e.push("Loading additional entities included in overlay ");e.push(r);e.push(" may cause the browser to become unresponsive. Continue loading anyway?");return e.join("")},"Warning - Large Number Of Entities",function(e,c){c&&(Q=e);(f.loadMorePlacemarks=e)?z(h,a,m,b,g,s,u,d,f):(f.name=f.name||"",f.name+=" - LOAD CANCELED",b&&b({error:"canceled",doc:f}),!u&&w.parseCallback&&w.parseCallback(f))})}else f.parseCompleteCallback({error:"canceled",
doc:f}),!u&&w.parseCallback&&w.parseCallback(f);return f}if(T>=ca)return++aa,setTimeout(function(){--aa;f.removed||z(h,a,m,b,g,s,u,d,f)},500+10*aa),f;++T;n=$.ajax({dataType:"xml",url:w.proxy+n});n.done(function(a,m,g){var z,d,ba,C;--T;if(!f.removed){f.fileSize=g.responseText.length;m=s?s.loadLargeFile:W;if(!m){ba=e+g.responseText.length;if(s)for(d=[s],s.getAllContainers(d),C=0;C<d.length;C++)d[C].fileSize&&(ba-=d[C].fileSize);if(ba>1048576*w.maxFileSize){if(void 0===m){m=[];for(d=f;d;)d.name&&d.name.length&&
m.push(d.name),d=d.parent;m.reverse();z=m.join("/");c(0,function(){var e=["Overlay "];e.push(z);e.push(" is ");e.push(P(g.responseText.length));e.push(". After loading it, total loaded data will be ");e.push(P(ba));e.push(". Loading so much data may cause the browser to become unresponsive. Load it anyway?");return e.join("")},"Warning - Large File Size",function(e,m){m&&(W=e);(f.loadLargeFile=e)?S(a,f,s,u,h):(f.fileSize=0,--H,f.name=f.name||"",f.name+=" - LOAD CANCELED",b&&b({error:"canceled",doc:f}),
!u&&w.parseCallback&&w.parseCallback(f))});return}if(!m){f.fileSize=0;--H;b&&b({error:"canceled",doc:f});!u&&w.parseCallback&&w.parseCallback(f);return}}}S(a,f,s,u,h)}});n.fail(function(e,a,m){--T;f.name=f.name||"";f.name+=" - LOAD FAILED";console.log("Failed to load "+h+" - "+a);b&&b({error:a,doc:f});!u&&w.parseCallback&&w.parseCallback(f)});return f}function u(e,a,m,z){var g,s,b,d;if((!e.name||!e.name.length)&&1>=e.containers.length&&!e.features.length&&!e.screenOverlays.length){g=[];for(s=0;s<
e.containers.length;s++)if(d=u(e.containers[0],a,m,z))if($.isArray(d))for(b=0;b<d.length;b++)g.push(d[b]);else g.push(d);return g}g={title:e.name||"[no name]",tooltip:"click to zoom to",key:e.parent?e.internalId:z,isFolder:!0,expand:e.open,select:e.visibility&&a,children:[]};e.parent||(g.isFeature=!0);for(s=0;s<e.containers.length;s++)if(d=u(e.containers[s],g.select,m))if($.isArray(d))for(b=0;b<d.length;b++)g.children.push(d[b]);else g.children.push(d);for(s=0;s<e.features.length;s++)a={title:e.features[s].name||
"[no name]",tooltip:"click to zoom to",key:e.features[s].internalId,select:e.features[s].visibility&&g.select},g.children.push(a);for(s=0;s<e.screenOverlays.length;s++)a={title:e.screenOverlays[s].name||"[no name]",tooltip:"click to zoom to",key:e.screenOverlays[s].internalId,select:e.screenOverlays[s].visibility&&g.select},g.children.push(a);return g}var O={proxy:"",maxFileSize:25,maxPlacemarks:75E3},w,R={},V,ca=5,T=0,aa=0,K,U=0,W,Q,X,H=0,e=0,m=0;b.prototype.remove=function(){this.image.remove();
this.mask&&this.mask.remove()};b.prototype.setVisible=function(e,a){var m;this.visible=e;if(a&&(this.visibility=e))for(m=this.parent;m&&!m.visibility;)m.visibility=!0,m=m.parent;e?(this.image.show(),this.mask&&this.mask.show()):(this.image.hide(),this.mask&&this.mask.hide())};b.prototype.extendBounds=function(e){};k.prototype.remove=function(){var e;this.removed=!0;for(e=0;e<this.features.length;e++)this.features[e].removeFromMap();jc2cui.mapWidget.infoWindow&&(jc2cui.mapWidget.infoWindow.getMapItem()&&
jc2cui.mapWidget.infoWindow.getMapItem().internalId===this.internalId)&&jc2cui.mapWidget.infoWindow.close();H-=Math.max(1,this.features.length)};k.prototype.setVisible=function(e,a){var m;this.visible=e;if(a&&(this.visibility=e))for(m=this.parent;m&&!m.visibility;)m.visibility=!0,m=m.parent;for(m=0;m<this.features.length;m++)this.features[m].setVisible(e);!e&&(jc2cui.mapWidget.infoWindow&&jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().internalId===this.internalId)&&
jc2cui.mapWidget.infoWindow.close()};k.prototype.getBounds=function(){var e;w.bounds&&(e=w.bounds(),this.extendBounds(e));return e};k.prototype.extendBounds=function(e){var a;for(a=0;a<this.features.length;a++)this.features[a].extendBounds(e)};k.prototype.getAllVisiblePlacemarks=function(e){e=e||[];$.each(this.features,function(a,m){m.getVisible&&m.getVisible()&&e.push(m)});return e};p.prototype.getAllPlacemarks=function(e){var a;e=e||[];for(a=0;a<this.containers.length;a++)this.containers[a].getAllPlacemarks(e);
for(a=0;a<this.features.length;a++)$.merge(e,this.features[a].features);return e};p.prototype.getAllVisiblePlacemarks=function(e){var a;e=e||[];for(a=0;a<this.containers.length;a++)this.containers[a].getAllVisiblePlacemarks(e);for(a=0;a<this.features.length;a++)this.features[a].getAllVisiblePlacemarks(e);return e};p.prototype.remove=function(){var h;--H;this.removed=!0;this.fileSize&&(e-=this.fileSize);for(h=0;h<this.containers.length;h++)this.containers[h].remove();for(h=0;h<this.features.length;h++)this.features[h].remove();
for(h=0;h<this.screenOverlays.length;h++)this.screenOverlays[h].remove(),--H;w.containerRemoved&&w.containerRemoved(this)};p.prototype.setVisible=function(e,a){var m;this.visible=e;if(a&&(this.visibility=e))for(m=this.parent;m&&!m.visibility;)m.visibility=!0,m=m.parent;for(m=0;m<this.containers.length;m++)this.containers[m].setVisible(e,a);for(m=0;m<this.features.length;m++)this.features[m].setVisible(e,a);for(m=0;m<this.screenOverlays.length;m++)this.screenOverlays[m].setVisible(e,a)};p.prototype.extendBounds=
function(e){var a;for(a=0;a<this.containers.length;a++)this.containers[a].extendBounds(e);for(a=0;a<this.features.length;a++)this.features[a].extendBounds(e)};p.prototype.onViewUpdate=function(e){var a,m;this.region&&w.isRegionActive&&(m=w.isRegionActive(this.region),this.visibility&&m!==this.visible&&this.setVisible(m));for(a=0;a<this.containers.length;a++)this.containers[a].onViewUpdate(e);if(w.isRegionActive)for(a=0;a<this.viewSensitiveFeatures.length;a++)e=this.viewSensitiveFeatures[a],e.region&&
(m=w.isRegionActive(e.region),e.visibility&&m!==e.visible&&e.setVisible(m)),!e.icon||"onStop"!==e.icon.viewRefreshMode&&"onRequest"!==e.icon.viewRefreshMode||(clearTimeout(e.stopRefresh),e.stopRefresh=q(e))};p.prototype.getAllContainers=function(e){var a;e=e||[];for(a=0;a<this.containers.length;a++)this.containers[a].getAllContainers(e);$.merge(e,this.containers);return e};p.prototype.getAllFeatures=function(e){var a;e=e||[];for(a=0;a<this.containers.length;a++)this.containers[a].getAllFeatures(e);
$.merge(e,this.features);return e};p.prototype.getAllScreenOverlays=function(e){var a;e=e||[];for(a=0;a<this.containers.length;a++)this.containers[a].getAllScreenOverlays(e);$.merge(e,this.screenOverlays);return e};d.prototype=new p(null,!0);d.prototype.remove=function(){var e;p.prototype.remove.call(this);for(e=0;e<this.intervals.length;e++)clearInterval(this.intervals[e])};d.prototype.onViewUpdate=function(e){var a=this,m;if(!(this.link.viewRefreshMode&&"never"!==this.link.viewRefreshMode||this.region&&
!this.loaded)||"onRegion"===this.link.viewRefreshMode&&this.loaded)p.prototype.onViewUpdate.apply(this,arguments);else if(this.region&&w.isRegionActive&&("onRegion"===this.link.viewRefreshMode||!this.loaded))w.isRegionActive(this.region)&&(this.setVisible(this.visibility),this.loaded=!0,this.loadedDoc=z(this.link.getHref(),this.visible,this,function(e){e=e.doc||this.loadedDoc;a.loadLargeFile=e.loadLargeFile;a.loadMorePlacemarks=e.loadMorePlacemarks}),this.loadedDoc.visibility=this.visibility);else if("onStop"===
this.link.viewRefreshMode||"onRequest"===this.link.viewRefreshMode)clearTimeout(this.stopRefresh),a=this,m="onRequest"===this.link.viewRefreshMode?3E3:Math.max(0,this.link.viewRefreshTime-1E3),this.stopRefresh=setTimeout(function(){if(!this.region||w.isRegionActive&&w.isRegionActive(this.region)){var e=z(a.link.getHref(),a.loadedDoc.visible,a,function(h){var m=e||h.doc;a.loadedDoc.remove();for(h=0;h<a.containers.length;h++)if(a.containers[h]===a.loadedDoc){a.containers.splice(h,1);a.loadedDoc=m;break}a.loadLargeFile=
m.loadLargeFile;a.loadMorePlacemarks=m.loadMorePlacemarks},null,a.loadedDoc);e.visibility=a.loadedDoc.visibility}},m)};x.prototype.getHref=function(){var e=this.href||"";this.viewFormat&&(this.viewFormat.length&&w.formatView)&&(e=0>e.indexOf("?")?e+"?":e+"&",e+=w.formatView(this.viewFormat));return e};return{init:function(e){w=$.extend(!0,{},O,e)},loadKml:function(e,a,m,b,g,s,d,u){return z(e,a,m,function(e){!e.doc&&b&&b(e)},b,g,s,d,u)},parseKmlString:function(e,a,m,z,g){var b=new p(m),d;b.remaining=
1;b.parseCompleteCallback=function(e){!e.doc&&z&&z(e)};b.initialParseCompleteCallback=z;b.visibility=b.visible=a;b.clustering=g;setTimeout(function(){d=$.parseXML(e);S(d,b)},1);return b},Container:p,totalEntities:function(){return H},getEntitiesString:function(a){return"Approximately "+P(e)+" of data containing approximately "+(H+(a||0))+" entities loaded."},getTreeData:u}}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.infoWindow=function(){function a(){var a;!k.containment||k.containment instanceof jQuery||(k.containment=$(k.containment));b=$('<div id="infoWindow" class="infoWindow"><span class="closeInfoWindow"></span><div id="infoWindowContent" class="infoWindowContent"></div></div>').appendTo(k.containment||$("body")).draggable({cancel:"#infoWindowContent",containment:k.containment,cursor:"move"}).resizable({containment:k.containment,stop:function(a,b){d=!0}});a=$(".closeInfoWindow",b).hover(function(){a.addClass("closeInfoWindowOver")},
function(){a.removeClass("closeInfoWindowOver")}).click(function(){jc2cui.mapWidget.infoWindow.close()});p=$("#infoWindowContent");k.zIndex&&b.css("z-index",k.zIndex)}function c(){if(k.containment){var a=d?Math.min(k.containment.innerHeight()-(b.outerHeight()-b.innerHeight())-18,b.height()):Math.min(500,0.6*k.containment.height()),f=d?Math.min(k.containment.innerWidth()-(b.outerWidth()-b.innerWidth())-12,b.width()):Math.min(542,0.6*k.containment.width());b.css("height",Math.max(10,a)+"px");b.css("width",
Math.max(10,f)+"px");if(k.containment){var a=parseInt(b.css("top").replace("px",""),10),f=parseInt(b.css("left").replace("px",""),10),c=k.containment.position();a+b.outerHeight()>k.containment.height()+c.top&&b.css("top",Math.max(c.top,k.containment.height()-b.outerHeight()+c.top)+"px");f+b.outerWidth()>=k.containment.width()&&b.css("left",Math.max(0,k.containment.width()-b.outerWidth())+"px")}}}var b,k,p,q=!0,d=!1,f;return{init:function(a){k=a||{}},open:function(r,l){b||a();r.content&&("string"===
typeof r.content?p.html(r.content):(p.empty(),p.append(r.content)),$("a",p).addClass("external").attr({target:"_blank"}));p.text().length&&(r.width&&(b.css("width",r.width),d=!0),r.height&&(b.css("height",r.height),d=!0),r.bgColor&&(b.css("background-color",r.bgColor),d=!0),r.textColor&&(b.css("color",r.textColor),d=!0),f=l,b.show(),p.scrollTop(0),q&&(q=!1,c(),k.containment&&(b.css("left",Math.max(0,(k.containment.width()-b.outerWidth())/2+k.containment.scrollLeft())+"px"),b.css("top",Math.max(0,
(k.containment.height()-b.outerHeight())/2+k.containment.scrollTop())+"px"))))},close:function(){f=null;b&&b.hide()},setPosition:function(){},checkResize:function(){b&&c()},getMapItem:function(){return f}}}();
(function(a){var c={},b,k=function(a){if(a.match(/[0-9a-fA-F]{3}$/)||a.match(/[0-9a-fA-F]{6}$/))a="#"===a.charAt(0)?a:"#"+a;else if(a.match(/^rgb\(([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5])\)$/)){var b=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],c,l=function(a){var b,d;if(2>a.length)for(b=0,d=2-a.length;b<d;b++)a="0"+a;return a};
3===b.length&&(a=l(b[0].toString(16)),c=l(b[1].toString(16)),b=l(b[2].toString(16)),a="#"+a+c+b)}else a=null;return a},p=function(d){c.control=a("<div class='color-picker'></div>");var f=function(a){a.bind({click:function(d){d=a.css("background-color");d=(d=k(d))||"transparent";c.selector.css("background-color",d);b(!0,d)},mouseover:function(b){a.css("border-color","#598FEF")},mouseout:function(b){a.css("border-color","#000")}});c.control.append(a)};a.each(a.fn.colorPicker.defaultColors,function(b){b=
a("<div class='color_swatch'>&nbsp;</div>");b.css("background-color","#"+this);f(b)});f(a("<div class='nocolor'>transparent</div>"));a("body").append(c.control);d&&(c.iframeShim=document.createElement("iframe"),c.iframeShim.frameBorder=0,c.iframeShim.scrolling="no",c.iframeShim.src="javascript:false;",c.iframeShim.style.position="absolute",c.iframeShim.style.width=c.control.width()+"px",c.iframeShim.style.height=c.control.height()+"px",a("body").append(c.iframeShim))},q=function(d){d.target!==c.control&&
a(d.target).parent()[0]!==c.control[0]&&b()};b=function(b,f){c.control.stop(!0);b?c.control.slideUp("slow",function(){c.control.css("height","")}):(c.control.hide(),c.control.css("height",""));a("body").unbind("mousedown",q);c.iframeShim&&(c.iframeShim.style.zIndex=-500);c.callback&&(c.callback(f),delete c.callback)};a.fn.colorPicker=function(d,f,r){var l=this;return this.css("background-color",d).bind("mouseover",function(a){l.css("border-color","#598FEF")}).bind("mouseout",function(a){l.css("border-color",
"#000")}).click(function(){c.selector=l;c.control||p(r);b();var d=l.offset(),k=Math.max(0,d.top-c.control.height()),A=a(window),d=Math.max(0,d.left),k=Math.min(k,A.height()-c.control.height()),d=Math.min(d,A.width()-c.control.width());c.control.css({left:d+"px",top:k+"px"});c.iframeShim&&(c.iframeShim.style.left=d+"px",c.iframeShim.style.top=k+"px",c.iframeShim.style.zIndex=c.control.css("z-index")-1);c.control.slideDown("slow");c.callback=f;a("body").bind("mousedown",q)})};a.fn.colorPicker.hide=
function(a){b(a)};a.fn.colorPicker.defaultColors="000000 993300 333300 000080 333399 333333 800000 FF6600 808000 008000 008080 0000FF 666699 808080 FF0000 FF9900 99CC00 339966 33CCCC 3366FF 800080 999999 FF00FF FFCC00 FFFF00 00FF00 00FFFF 00CCFF 993366 C0C0C0 FF99CC FFCC99 FFFF99 CCFFFF 99CCFF FFFFFF 15428B DFE8F6".split(" ")})(jQuery);util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.featureEditor=function(){function a(a){var b=$('<div id="marker-icons">').appendTo(a),c,k,p=function(d){return function(c){q.iconUrl=d;$("#characteristicsButton",a.parent()).attr("src",q.iconUrl);$(".marker-icon",b).removeClass("selected");$(this).addClass("selected")}};for(c=0;c<f.length;c++)k=[32*-(c%d),32*-Math.floor(c/d)],$('<a class="marker-icon" tabindex="1"></a>').css("background-position",k[0]+"px "+k[1]+"px").appendTo(b).click(p(f[c]))}function c(a){var b=$('<div><label>line color <input id="strokeColor" type="text"></label><label>line width (pixels) <input id="strokeWeight" type="text"></label><label>line opacity <input id="strokeOpacity" type="text"></label></div>').appendTo(a);
$("#strokeColor",b).colorPicker(q.strokeColor,function(b){q.strokeColor=b;$("#mask",a.parent()).css({"background-color":"line"===q.type?q.strokeColor:q.fillColor,"border-color":q.strokeColor})},p);$("#strokeWeight",b).val(q.strokeWeight).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(q.strokeWeight=a)});$("#strokeOpacity",b).val(Math.floor(100*q.strokeOpacity)).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(a=Math.max(0,Math.min(100,a))/100,q.strokeOpacity=a)})}function b(a){var b=
$('<div><label>fill color <input id="fillColor" type="text"></label><label>fill opacity <input id="fillOpacity" type="text"></label></div>').appendTo(a);$("#fillColor",b).colorPicker(q.fillColor,function(b){q.fillColor=b;$("#mask",a.parent()).css({"background-color":"line"===q.type?q.strokeColor:q.fillColor})},p);$("#fillOpacity",b).val(Math.floor(100*q.fillOpacity)).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(a=Math.max(0,Math.min(100,a))/100,q.fillOpacity=a)})}function k(d,f){var n=
$('<div id="characteristics""><div id="back">back</div></div>').appendTo(f);switch(d){case "marker":a(n);break;case "line":c(n);break;case "shape":c(n),b(n)}return n}var p,q,d=7,f=function(){var a=[],b=["-circle.png","-blank.png","-pushpin.png"],d="blu red grn ltblu ylw purple pink".split(" "),c="dining coffee bars snack_bar tram lodging wheel_chair_accessible shopping movies convenience grocery arts homegardenbusiness electronics mechanic partly_cloudy realestate salon dollar parking_lot gas_stations cabs bus truck rail airports ferry heliport subway info flag earthquake webcam post_office police firedept hospitals info_circle phone caution falling_rocks camera parks campfire picnic campground ranger_station toilets poi hiker cycling motorcycling horsebackriding play golf trail water snowflake_simple marina fishing sailing swimming ski woman man rainy volcano sunny euro yen".split(" "),
f,k,q;for(f=0;f<b.length;f++)for(k=0;k<d.length;k++)q=d[k],a.push([jc2cui.mapWidget.getAppPath(),"images/",q,b[f]].join(""));for(f=0;f<c.length;f++)a.push([jc2cui.mapWidget.getAppPath(),"images/",c[f],".png"].join(""));return a}();return{useShim:function(a){p=a},getEditFeatureHtml:function(a,b){q=a;var d=$(['<div class="editFeature"><div id="outer"><div id="basic"><div class="bold top">Title <input id="title" type="text" id="title" /><div id="mask"><img id="characteristicsButton" src="',q.iconUrl,
'" title="Click to set ',q.type,' characteristics"></div></div><div class="bold section">Description</div><textarea id="description"></textarea></div></div><div class="buttons"><span id="delete" class="button">delete</span><span id="cancel" class="button">cancel</span><span id="ok" class="button">ok</span></div></div>'].join("")),c,f;$("#title",d).val(q.title||"");$("#description",d).val(q.description||"");$("#characteristicsButton",d).click(function(){c||(c=$("#basic",d));f||(f=k(q.type,$("#outer",
d)));$("#back",f).click(function(){f.hide();c.show()});c.hide();f.show()});$("#mask",d).css({"background-color":"marker"===q.type?"transparent":"line"===q.type?q.strokeColor:q.fillColor,"border-color":"marker"===q.type?"transparent":q.strokeColor});$("#delete",d).click(function(){b&&b.deleted&&b.deleted()});$("#ok",d).click(function(){b&&b.updated&&(q.title=$("#title",d).val(),q.description=$("#description",d).val(),b.updated(q))});$("#cancel",d).click(function(){b&&b.canceled&&b.canceled()});return d[0]}}}();
(function(a){for(var c,b=document.getElementsByTagName("head")[0].style,k=["transformProperty","WebkitTransform","OTransform","msTransform","MozTransform"],p=0;p<k.length;p++)void 0!==b[k[p]]&&(c=k[p]);var q=eval('"v"=="\v"');jQuery.fn.extend({rotate:function(b){if(0!==this.length&&"undefined"!=typeof b){"number"==typeof b&&(b={angle:b});for(var c=[],k=0,q=this.length;k<q;k++){var n=this.get(k);if(n.Wilq32&&n.Wilq32.PhotoEffect)n.Wilq32.PhotoEffect._handleRotation(b);else{var p=a.extend(!0,{},b),
n=(new Wilq32.PhotoEffect(n,p))._rootObj;c.push(a(n))}}return c}},getRotateAngle:function(){for(var a=[],b=0,c=this.length;b<c;b++){var k=this.get(b);k.Wilq32&&k.Wilq32.PhotoEffect&&(a[b]=k.Wilq32.PhotoEffect._angle)}return a},stopRotate:function(){for(var a=0,b=this.length;a<b;a++){var c=this.get(a);c.Wilq32&&c.Wilq32.PhotoEffect&&clearTimeout(c.Wilq32.PhotoEffect._timer)}}});Wilq32=window.Wilq32||{};Wilq32.PhotoEffect=function(){return c?function(a,b){a.Wilq32={PhotoEffect:this};this._img=this._rootObj=
this._eventObj=a;this._handleRotation(b)}:q?function(a,b){this._img=a;this._rootObj=document.createElement("span");this._rootObj.style.display="inline-block";this._rootObj.Wilq32={PhotoEffect:this};a.parentNode.insertBefore(this._rootObj,a);this._Loader(b)}:function(a,b){this._rootObj=a}}();Wilq32.PhotoEffect.prototype={_setupParameters:function(a){this._parameters=this._parameters||{};"number"!==typeof this._angle&&(this._angle=0);"number"===typeof a.angle&&(this._angle=a.angle);this._parameters.animateTo=
"number"===typeof a.animateTo?a.animateTo:this._angle;this._parameters.step=a.step||this._parameters.step||null;this._parameters.easing=a.easing||this._parameters.easing||function(a,b,c,d,k){return-d*((b=b/k-1)*b*b*b-1)+c};this._parameters.duration=a.duration||this._parameters.duration||1E3;this._parameters.callback=a.callback||this._parameters.callback||function(){};a.bind&&a.bind!=this._parameters.bind&&this._BindEvents(a.bind)},_handleRotation:function(a){this._setupParameters(a);this._angle==
this._parameters.animateTo?this._rotate(this._angle):this._animateStart()},_BindEvents:function(a){if(a&&this._eventObj){if(this._parameters.bind){var b=this._parameters.bind,c;for(c in b)b.hasOwnProperty(c)&&jQuery(this._eventObj).unbind(c,b[c])}this._parameters.bind=a;for(c in a)a.hasOwnProperty(c)&&jQuery(this._eventObj).bind(c,a[c])}},_Loader:function(a){this._rootObj.appendChild(this._img);this._rootObj.style.width=this._img.offsetWidth;this._rootObj.style.height=this._img.offsetHeight;this._img.style.position=
"absolute";this._rootObj=this._img;this._rootObj.Wilq32={PhotoEffect:this};this._rootObj.style.filter+="progid:DXImageTransform.Microsoft.Matrix(M11=1,M12=1,M21=1,M22=1,sizingMethod='auto expand')";this._eventObj=this._rootObj;this._handleRotation(a)},_animateStart:function(){this._timer&&clearTimeout(this._timer);this._animateStartTime=+new Date;this._animateStartAngle=this._angle;this._animate()},_animate:function(){var a=+new Date,b=a-this._animateStartTime>this._parameters.duration;if(b&&!this._parameters.animatedGif)clearTimeout(this._timer);
else{if(this._canvas||this._vimage||this._img)a=this._parameters.easing(0,a-this._animateStartTime,this._animateStartAngle,this._parameters.animateTo-this._animateStartAngle,this._parameters.duration),this._rotate(~~(10*a)/10);this._parameters.step&&this._parameters.step(this._angle);var c=this;this._timer=setTimeout(function(){c._animate.call(c)},10)}this._parameters.callback&&b&&(this._angle=this._parameters.animateTo,this._rotate(this._angle),this._parameters.callback.call(this._rootObj))},_rotate:function(){var a=
Math.PI/180;if(q)return function(b){this._angle=b;b*=a;costheta=Math.cos(b);sintheta=Math.sin(b);b=this._rootObj.filters.item("DXImageTransform.Microsoft.Matrix");b.M11=costheta;b.M12=-sintheta;b.M21=sintheta;b.M22=costheta;this._rootObj.style.marginLeft=-(this._rootObj.offsetWidth-this._rootObj.clientWidth)/2+"px";this._rootObj.style.marginTop=-(this._rootObj.offsetHeight-this._rootObj.clientHeight)/2+"px"};if(c)return function(a){this._angle=a;this._img.style[c]="rotate("+a%360+"deg)"}}()}})(jQuery);
document.createElement("canvas").getContext||function(){function a(){return this.context_||(this.context_=new l(this))}function c(a,b,c){var d=Y.call(arguments,2);return function(){return a.apply(b,d.concat(Y.call(arguments)))}}function b(a){var b=a.srcElement;switch(a.propertyName){case "width":b.style.width=b.attributes.width.nodeValue+"px";b.getContext().clearRect();break;case "height":b.style.height=b.attributes.height.nodeValue+"px",b.getContext().clearRect()}}function k(a){a=a.srcElement;a.firstChild&&
(a.firstChild.style.width=a.clientWidth+"px",a.firstChild.style.height=a.clientHeight+"px")}function p(){return[[1,0,0],[0,1,0],[0,0,1]]}function q(a,b){for(var c=p(),d=0;3>d;d++)for(var f=0;3>f;f++){for(var k=0,q=0;3>q;q++)k+=a[d][q]*b[q][f];c[d][f]=k}return c}function d(a,b){b.fillStyle=a.fillStyle;b.lineCap=a.lineCap;b.lineJoin=a.lineJoin;b.lineWidth=a.lineWidth;b.miterLimit=a.miterLimit;b.shadowBlur=a.shadowBlur;b.shadowColor=a.shadowColor;b.shadowOffsetX=a.shadowOffsetX;b.shadowOffsetY=a.shadowOffsetY;
b.strokeStyle=a.strokeStyle;b.globalAlpha=a.globalAlpha;b.font=a.font;b.textAlign=a.textAlign;b.textBaseline=a.textBaseline;b.arcScaleX_=a.arcScaleX_;b.arcScaleY_=a.arcScaleY_;b.lineScale_=a.lineScale_;b.rotation_=a.rotation_}function f(a){var b,c=1;a=String(a);if("rgb"==a.substring(0,3)){b=a.indexOf("(",3);var d=a.indexOf(")",b+1),d=a.substring(b+1,d).split(",");b="#";for(var f=0;3>f;f++)b+=D[Number(d[f])];4==d.length&&"a"==a.substr(3,1)&&(c=d[3])}else b=a;return{color:b,alpha:c}}function r(a){switch(a){case "butt":return"flat";
case "round":return"round";default:return"square"}}function l(a){this.m_=p();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=1*G;this.globalAlpha=1;this.font="10px sans-serif";this.textAlign="left";this.textBaseline="alphabetic";this.canvas=a;var b=a.ownerDocument.createElement("div");b.style.width=a.clientWidth+"px";b.style.height=a.clientHeight+"px";b.style.overflow="hidden";b.style.position=
"absolute";a.appendChild(b);this.element_=b;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1;this.rotation_=0}function n(a,b,c,d){a.currentPath_.push({type:"bezierCurveTo",cp1x:b.x,cp1y:b.y,cp2x:c.x,cp2y:c.y,x:d.x,y:d.y});a.currentX_=d.x;a.currentY_=d.y}function v(a,b,c){var d;a:{for(d=0;3>d;d++)for(var f=0;2>f;f++)if(!isFinite(b[d][f])||isNaN(b[d][f])){d=!1;break a}d=!0}d&&(a.m_=b,c&&(a.lineScale_=J(I(b[0][0]*b[1][1]-b[0][1]*b[1][0]))))}function A(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,
"&quot;")}function t(a,b,c,d){var k=a.fillStyle,q=a.arcScaleX_,n=a.arcScaleY_,p=d.x-c.x,l=d.y-c.y;if(k instanceof y){var K=0,r=d=0,t=0,B=1;if("gradient"==k.type_){K=k.x1_/q;c=k.y1_/n;var v=getCoords(a,k.x0_/q,k.y0_/n),K=getCoords(a,K,c),K=180*Math.atan2(K.x-v.x,K.y-v.y)/Math.PI;0>K&&(K+=360);1E-6>K&&(K=0)}else v=getCoords(a,k.x0_,k.y0_),d=(v.x-c.x)/p,r=(v.y-c.y)/l,p/=q*G,l/=n*G,B=F.max(p,l),t=2*k.r0_/B,B=2*k.r1_/B-t;q=k.colors_;q.sort(function(e,a){return e.offset-a.offset});n=q.length;v=q[0].color;
c=q[n-1].color;p=q[0].alpha*a.globalAlpha;a=q[n-1].alpha*a.globalAlpha;for(var l=[],A=0;A<n;A++){var e=q[A];l.push(e.offset*B+t+" "+e.color)}b.push('<g_vml_:fill type="',k.type_,'"',' method="none" focus="100%"',' color="',v,'"',' color2="',c,'"',' colors="',l.join(","),'"',' opacity="',a,'"',' g_o_:opacity2="',p,'"',' angle="',K,'"',' focusposition="',d,",",r,'" />')}else k instanceof x?p&&l&&b.push("<g_vml_:fill",' position="',-c.x/p*q*q,",",-c.y/l*n*n,'"',' type="tile"',' src="',k.src_,'" />'):
(k=f(a.fillStyle),b.push('<g_vml_:fill color="',k.color,'" opacity="',k.alpha*a.globalAlpha,'" />'))}function y(a){this.type_=a;this.r1_=this.y1_=this.x1_=this.r0_=this.y0_=this.x0_=0;this.colors_=[]}function x(){}var F=Math,B=F.round,M=F.sin,L=F.cos,I=F.abs,J=F.sqrt,G=10,N=G/2,Y=Array.prototype.slice,Z={init:function(a){/MSIE/.test(navigator.userAgent)&&!window.opera&&(a=a||document,a.createElement("canvas"),"complete"!==a.readyState?a.attachEvent("onreadystatechange",c(this.init_,this,a)):this.init_(a))},
init_:function(a){a.namespaces.g_vml_||a.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");a.namespaces.g_o_||a.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!a.styleSheets.ex_canvas_){var b=a.createStyleSheet();b.owningElement.id="ex_canvas_";b.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}a=a.getElementsByTagName("canvas");
for(b=0;b<a.length;b++)this.initElement(a[b])},initElement:function(c){if(!c.getContext){c.getContext=a;c.innerHTML="";c.attachEvent("onpropertychange",b);c.attachEvent("onresize",k);var d=c.attributes;d.width&&d.width.specified?c.style.width=d.width.nodeValue+"px":c.width=c.clientWidth;d.height&&d.height.specified?c.style.height=d.height.nodeValue+"px":c.height=c.clientHeight}return c}};Z.init();for(var D=[],E=0;16>E;E++)for(var S=0;16>S;S++)D[16*E+S]=E.toString(16)+S.toString(16);E=l.prototype;
E.clearRect=function(){this.element_.innerHTML=""};E.beginPath=function(){this.currentPath_=[]};E.moveTo=function(a,b){var c=this.getCoords_(a,b);this.currentPath_.push({type:"moveTo",x:c.x,y:c.y});this.currentX_=c.x;this.currentY_=c.y};E.lineTo=function(a,b){var c=this.getCoords_(a,b);this.currentPath_.push({type:"lineTo",x:c.x,y:c.y});this.currentX_=c.x;this.currentY_=c.y};E.bezierCurveTo=function(a,b,c,d,f,k){f=this.getCoords_(f,k);a=this.getCoords_(a,b);c=this.getCoords_(c,d);n(this,a,c,f)};E.quadraticCurveTo=
function(a,b,c,d){a=this.getCoords_(a,b);c=this.getCoords_(c,d);d={x:this.currentX_+2/3*(a.x-this.currentX_),y:this.currentY_+2/3*(a.y-this.currentY_)};n(this,d,{x:d.x+(c.x-this.currentX_)/3,y:d.y+(c.y-this.currentY_)/3},c)};E.arc=function(a,b,c,d,f,k){c*=G;var q=k?"at":"wa",n=a+L(d)*c-N,p=b+M(d)*c-N;d=a+L(f)*c-N;f=b+M(f)*c-N;n!=d||k||(n+=0.125);a=this.getCoords_(a,b);n=this.getCoords_(n,p);d=this.getCoords_(d,f);this.currentPath_.push({type:q,x:a.x,y:a.y,radius:c,xStart:n.x,yStart:n.y,xEnd:d.x,yEnd:d.y})};
E.rect=function(a,b,c,d){this.moveTo(a,b);this.lineTo(a+c,b);this.lineTo(a+c,b+d);this.lineTo(a,b+d);this.closePath()};E.strokeRect=function(a,b,c,d){var f=this.currentPath_;this.beginPath();this.moveTo(a,b);this.lineTo(a+c,b);this.lineTo(a+c,b+d);this.lineTo(a,b+d);this.closePath();this.stroke();this.currentPath_=f};E.fillRect=function(a,b,c,d){var f=this.currentPath_;this.beginPath();this.moveTo(a,b);this.lineTo(a+c,b);this.lineTo(a+c,b+d);this.lineTo(a,b+d);this.closePath();this.fill();this.currentPath_=
f};E.createLinearGradient=function(a,b,c,d){var f=new y("gradient");f.x0_=a;f.y0_=b;f.x1_=c;f.y1_=d;return f};E.createRadialGradient=function(a,b,c,d,f,k){var q=new y("gradientradial");q.x0_=a;q.y0_=b;q.r0_=c;q.x1_=d;q.y1_=f;q.r1_=k;return q};getTheDistanceTo=function(a,b){var c=a.y,d=b.y;return Math.sqrt(Math.pow(a.x-b.x,2)+Math.pow(c-d,2))};doRotate=function(a,b,c){a*=Math.PI/180;var d=getTheDistanceTo(c,b);a+=Math.atan2(c.y-b.y,c.x-b.x);c.x=b.x+d*Math.cos(a);c.y=b.y+d*Math.sin(a)};getAdjustedBounds=
function(a,b){if(a&&b){if(null==a.left||b.left<a.left)a.left=b.left;if(null==a.bottom||b.bottom<a.bottom)a.bottom=b.bottom;if(null==a.right||b.right>a.right)a.right=b.right;if(null==a.top||b.top>a.top)a.top=b.top}};getAdjustedTopLeft=function(a,b,c,d,f,k,q){var n={x:-c,y:-d},p={x:0,y:0},l={x:f,y:0};f={x:f,y:k};k={x:0,y:k};var r={left:null,bottom:null,right:null,top:null};a+=c;b+=d;doRotate(q,n,p);doRotate(q,n,l);doRotate(q,n,f);doRotate(q,n,k);getAdjustedBounds(r,{left:p.x,bottom:p.y,right:p.x,top:p.y});
getAdjustedBounds(r,{left:l.x,bottom:l.y,right:l.x,top:l.y});getAdjustedBounds(r,{left:f.x,bottom:f.y,right:f.x,top:f.y});getAdjustedBounds(r,{left:k.x,bottom:k.y,right:k.x,top:k.y});return{top:Math.round(b+r.bottom),left:Math.round(a+r.left)}};E.drawImageWithRotate=function(a,b,c,d,f,k,n,p){var l=a.runtimeStyle.width;if(l){var r=a.runtimeStyle.width,t=a.runtimeStyle.height;a.runtimeStyle.width="auto";a.runtimeStyle.height="auto"}var x=a.width,y=a.height;l&&(a.runtimeStyle.width=r,a.runtimeStyle.height=
t);sx=sy=0;sw=x;sh=y;this.getCoords_(d,f);l=[];t=scaleY=1;l.push(' <div style="position:absolute;');var r=[],t=L(this.rotation_),B=M(this.rotation_),B=q([[t,-B,0],[B,t,0],[0,0,1]],this.m_),t=B[0][0];scaleY=B[1][1];var v=p*(Math.PI/180),B=Math.cos(v),v=Math.sin(v);r.push("M11=",B,",","M12=",-v,",","M21=",v,",","M22=",B);b=getAdjustedTopLeft(b,c,d,f,k,n,p);l.push("top:",b.top,"px;left:",b.left,"px;filter:progid:DXImageTransform.Microsoft.Matrix(",r.join(""),", sizingmethod='auto expand');");l.push(' ">');
l.push('<div style="width:',Math.round(t*x*k/sw),"px;"," height:",Math.round(scaleY*y*n/sh),"px;"," filter:");1>this.globalAlpha&&l.push(" progid:DXImageTransform.Microsoft.Alpha(opacity="+100*this.globalAlpha+")");l.push(" progid:DXImageTransform.Microsoft.AlphaImageLoader(src=",a.src,',sizingMethod=scale)">');l.push("</div></div>");this.element_.insertAdjacentHTML("beforeEnd",l.join(""))};E.drawImage=function(a){var b,c,d,f,k,n,l,p;if(d=a.runtimeStyle.width)f=a.runtimeStyle.width,k=a.runtimeStyle.height,
a.runtimeStyle.width="auto",a.runtimeStyle.height="auto";var r=a.width,t=a.height;d&&(a.runtimeStyle.width=f,a.runtimeStyle.height=k);if(3==arguments.length)b=arguments[1],c=arguments[2],k=n=0,l=d=r,p=f=t;else if(5==arguments.length)b=arguments[1],c=arguments[2],d=arguments[3],f=arguments[4],k=n=0,l=r,p=t;else if(9==arguments.length)k=arguments[1],n=arguments[2],l=arguments[3],p=arguments[4],b=arguments[5],c=arguments[6],d=arguments[7],f=arguments[8];else throw Error("Invalid number of arguments");
var x=this.getCoords_(b,c),y=[],v=scaleY=1;y.push(' <div style="position:absolute;');if(1!=this.m_[0][0]||this.m_[0][1]||1!=this.m_[1][1]||this.m_[1][0]){var A=[],e=L(this.rotation_),m=M(this.rotation_),h=q([[e,-m,0],[m,e,0],[0,0,1]],this.m_),v=h[0][0];scaleY=h[1][1];A.push("M11=",e,",","M12=",-m,",","M21=",m,",","M22=",e,",","Dx=",x.x/G,",","Dy=",x.y/G);e=this.getCoords_(b+d,c);m=this.getCoords_(b,c+f);b=this.getCoords_(b+d,c+f);x.x=F.max(x.x,e.x,m.x,b.x);x.y=F.max(x.y,e.y,m.y,b.y);y.push("padding:0 ",
B(x.x/G),"px ",B(x.y/G),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",A.join(""),", sizingmethod='clip');")}else y.push("top:",B(x.y/G),"px;left:",B(x.x/G),"px;");y.push(' ">');(k||n)&&y.push('<div style="overflow: hidden; width:',Math.ceil((d+k*d/l)*v),"px;"," height:",Math.ceil((f+n*f/p)*scaleY),"px;"," filter:progid:DxImageTransform.Microsoft.Matrix(Dx=",-k*d/l*v,",Dy=",-n*f/p*scaleY,');">');y.push('<div style="width:',Math.round(v*r*d/l),"px;"," height:",Math.round(scaleY*t*f/p),"px;",
" filter:");1>this.globalAlpha&&y.push(" progid:DXImageTransform.Microsoft.Alpha(opacity="+100*this.globalAlpha+")");y.push(" progid:DXImageTransform.Microsoft.AlphaImageLoader(src=",a.src,',sizingMethod=scale)">');(k||n)&&y.push("</div>");y.push("</div></div>");this.element_.insertAdjacentHTML("beforeEnd",y.join(""))};E.stroke=function(a){var b=[],c=f(a?this.fillStyle:this.strokeStyle),d=c.color,c=c.alpha*this.globalAlpha;b.push("<g_vml_:shape",' filled="',!!a,'"',' style="position:absolute;width:',
10,"px;height:",10,'px;"',' coordorigin="0 0" coordsize="',10*G," ",10*G,'"',' stroked="',!a,'"',' path="');for(var k=null,q=null,n=null,l=null,p=0;p<this.currentPath_.length;p++){var t=this.currentPath_[p];switch(t.type){case "moveTo":b.push(" m ",B(t.x),",",B(t.y));break;case "lineTo":b.push(" l ",B(t.x),",",B(t.y));break;case "close":b.push(" x ");t=null;break;case "bezierCurveTo":b.push(" c ",B(t.cp1x),",",B(t.cp1y),",",B(t.cp2x),",",B(t.cp2y),",",B(t.x),",",B(t.y));break;case "at":case "wa":b.push(" ",
t.type," ",B(t.x-this.arcScaleX_*t.radius),",",B(t.y-this.arcScaleY_*t.radius)," ",B(t.x+this.arcScaleX_*t.radius),",",B(t.y+this.arcScaleY_*t.radius)," ",B(t.xStart),",",B(t.yStart)," ",B(t.xEnd),",",B(t.yEnd))}if(t){if(null==k||t.x<k)k=t.x;if(null==n||t.x>n)n=t.x;if(null==q||t.y<q)q=t.y;if(null==l||t.y>l)l=t.y}}b.push(' ">');if(a)if("object"==typeof this.fillStyle){var d=this.fillStyle,y=0,t=c=a=0,x=1;"gradient"==d.type_?(y=d.x1_/this.arcScaleX_,k=d.y1_/this.arcScaleY_,p=this.getCoords_(d.x0_/this.arcScaleX_,
d.y0_/this.arcScaleY_),y=this.getCoords_(y,k),y=180*Math.atan2(y.x-p.x,y.y-p.y)/Math.PI,0>y&&(y+=360),1E-6>y&&(y=0)):(p=this.getCoords_(d.x0_,d.y0_),t=n-k,x=l-q,a=(p.x-k)/t,c=(p.y-q)/x,t/=this.arcScaleX_*G,x/=this.arcScaleY_*G,p=F.max(t,x),t=2*d.r0_/p,x=2*d.r1_/p-t);k=d.colors_;k.sort(function(a,e){return a.offset-e.offset});for(var q=k.length,l=k[0].color,n=k[q-1].color,v=k[0].alpha*this.globalAlpha,A=k[q-1].alpha*this.globalAlpha,D=[],p=0;p<q;p++){var e=k[p];D.push(e.offset*x+t+" "+e.color)}b.push('<g_vml_:fill type="',
d.type_,'"',' method="none" focus="100%"',' color="',l,'"',' color2="',n,'"',' colors="',D.join(","),'"',' opacity="',A,'"',' g_o_:opacity2="',v,'"',' angle="',y,'"',' focusposition="',a,",",c,'" />')}else b.push('<g_vml_:fill color="',d,'" opacity="',c,'" />');else a=this.lineScale_*this.lineWidth,1>a&&(c*=a),b.push("<g_vml_:stroke",' opacity="',c,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,'"',' endcap="',r(this.lineCap),'"',' weight="',a,'px"',' color="',d,'" />');b.push("</g_vml_:shape>");
this.element_.insertAdjacentHTML("beforeEnd",b.join(""))};E.fill=function(){this.stroke(!0)};E.closePath=function(){this.currentPath_.push({type:"close"})};E.getCoords_=function(a,b){var c=this.m_;return{x:G*(a*c[0][0]+b*c[1][0]+c[2][0])-N,y:G*(a*c[0][1]+b*c[1][1]+c[2][1])-N}};E.save=function(){var a={};d(this,a);this.aStack_.push(a);this.mStack_.push(this.m_);this.m_=q(p(),this.m_)};E.restore=function(){d(this.aStack_.pop(),this);this.m_=this.mStack_.pop()};E.translate=function(a,b){v(this,q([[1,
0,0],[0,1,0],[a,b,1]],this.m_),!1)};E.rotate=function(a){var b=L(a),c=M(a);this.rotation_+=a;v(this,q([[b,c,0],[-c,b,0],[0,0,1]],this.m_),!1)};E.scale=function(a,b){this.arcScaleX_*=a;this.arcScaleY_*=b;v(this,q([[a,0,0],[0,b,0],[0,0,1]],this.m_),!0)};E.transform=function(a,b,c,d,f,k){v(this,q([[a,b,0],[c,d,0],[f,k,1]],this.m_),!0)};E.setTransform=function(a,b,c,d,f,k){v(this,[[a,b,0],[c,d,0],[f,k,1]],!0)};var P={};E.drawText_=function(a,b,c,d,f){var k=this.m_;d=0;var q=1E3,p=0,n=[],l;l=this.font;
if(P[l])l=P[l];else{var r=document.createElement("div").style;try{r.font=l}catch(y){}l=P[l]={style:r.fontStyle||"normal",variant:r.fontVariant||"normal",weight:r.fontWeight||"normal",size:r.fontSize||10,family:r.fontFamily||"sans-serif"}}var r=l,x=this.element_;l={};for(var v in r)l[v]=r[v];v=parseFloat(x.currentStyle.fontSize);x=parseFloat(r.size);"number"==typeof r.size?l.size=r.size:-1!=r.size.indexOf("px")?l.size=x:-1!=r.size.indexOf("em")?l.size=v*x:-1!=r.size.indexOf("%")?l.size=v/100*x:-1!=
r.size.indexOf("pt")?l.size=x/0.75:l.size=v;l.size*=0.981;v=l.style+" "+l.variant+" "+l.weight+" "+l.size+"px "+l.family;x=this.element_.currentStyle;r=this.textAlign.toLowerCase();switch(r){case "left":case "center":case "right":break;case "end":r="ltr"==x.direction?"right":"left";break;case "start":r="rtl"==x.direction?"right":"left";break;default:r="left"}switch(this.textBaseline){case "hanging":case "top":p=l.size/1.75;break;case "middle":break;default:case null:case "alphabetic":case "ideographic":case "bottom":p=
-l.size/2.25}switch(r){case "right":d=1E3;q=0.05;break;case "center":d=q=500}b=this.getCoords_(b+0,c+p);n.push('<g_vml_:line from="',-d,' 0" to="',q,' 0.05" ',' coordsize="100 100" coordorigin="0 0"',' filled="',!f,'" stroked="',!!f,'" style="position:absolute;width:1px;height:1px;">');f?appendStroke(this,n):t(this,n,{x:-d,y:0},{x:q,y:l.size});f=k[0][0].toFixed(3)+","+k[1][0].toFixed(3)+","+k[0][1].toFixed(3)+","+k[1][1].toFixed(3)+",0,0";b=B(b.x/G)+","+B(b.y/G);n.push('<g_vml_:skew on="t" matrix="',
f,'" ',' offset="',b,'" origin="',d,' 0" />','<g_vml_:path textpathok="true" />','<g_vml_:textpath on="true" string="',A(a),'" style="v-text-align:',r,";font:",A(v),'" /></g_vml_:line>');this.element_.insertAdjacentHTML("beforeEnd",n.join(""))};E.fillText=function(a,b,c,d){this.drawText_(a,b,c,d,!1)};E.strokeText=function(a,b,c,d){this.drawText_(a,b,c,d,!0)};E.measureText=function(a){this.textMeasureEl_||(this.element_.insertAdjacentHTML("beforeEnd",'<span style="position:absolute;top:-20000px;left:0;padding:0;margin:0;border:none;white-space:pre;"></span>'),
this.textMeasureEl_=this.element_.lastChild);var b=this.element_.ownerDocument;this.textMeasureEl_.innerHTML="";this.textMeasureEl_.style.font=this.font;this.textMeasureEl_.appendChild(b.createTextNode(a));return{width:this.textMeasureEl_.offsetWidth}};E.clip=function(){};E.arcTo=function(){};E.createPattern=function(){return new x};y.prototype.addColorStop=function(a,b){b=f(b);this.colors_.push({offset:a,color:b.color,alpha:b.alpha})};G_vmlCanvasManager=Z;CanvasRenderingContext2D=l;CanvasGradient=
y;CanvasPattern=x}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.markerOverlay=function(){function a(a,b){google.maps.OverlayView.call(this);this.setValues({map:a});this.placemarks=[];this.doc=b;this.markerLayer=$('<div class="marker-overlay"/>');this.mouseOverTimeout=0;this.projection=this.toolTip=null;this.topCanvas=this.leftCanvas=0;this.needsSorting=!0;for(var c=this,k,l;b;){if(b.overlayId){k=b.overlayId;l=b.featureId;break}b=b.parent}this.mouseOutMapListener=google.maps.event.addListener(a,"mouseout",function(b){clearTimeout(c.mouseOverTimeout);
null!==c.toolTip&&($(".markerCanvas",a.getDiv()).css("cursor","inherit"),c.toolTip.remove())});this.clickMapListener=google.maps.event.addListener(a,"click",function(b){var d,p,t;clearTimeout(c.mouseOverTimeout);null!==c.toolTip&&($(".markerCanvas",a.getDiv()).css("cursor","inherit"),c.toolTip.remove());if(!b.handled&&null!==c.projection)for(d=c.projection.fromLatLngToDivPixel(b.latLng),d.x-=c.leftCanvas,d.y-=c.topCanvas,p=c.placemarks.length-1;0<=p;p--)if(t=c.placemarks[p].placemark,t.visible&&t.hitRegion&&
t.hitRegion.minX<=d.x&&t.hitRegion.maxX>=d.x&&t.hitRegion.minY<=d.y&&t.hitRegion.maxY>=d.y){d={selectedId:t.id||void 0,selectedName:t.name||void 0,featureId:l,overlayId:k};jc2cui.mapWidget.showPlacemarkInfoWindow(t);jc2cui.mapWidget.itemSelected(d);b.handled=!0;break}});this.mouseMoveMapListener=google.maps.event.addListener(a,"mousemove",function(b){var d,k,l;b.latLng.equals(this.lastMouseMove)||(this.lastMouseMove=b.latLng,null!==c.toolTip&&($(".markerCanvas",a.getDiv()).css("cursor","inherit"),
c.toolTip.remove()),clearTimeout(c.mouseOverTimeout),c.mouseOverTimeout=setTimeout(function(){if(!b.handled&&null!==c.projection)for(d=c.projection.fromLatLngToDivPixel(b.latLng),d.x-=c.leftCanvas,d.y-=c.topCanvas,k=c.placemarks.length-1;0<=k;k--)if(l=c.placemarks[k].placemark,l.visible&&l.hitRegion&&l.name&&l.hitRegion.minX<=d.x&&l.hitRegion.maxX>=d.x&&l.hitRegion.minY<=d.y&&l.hitRegion.maxY>=d.y){$(".markerCanvas",a.getDiv()).css("cursor","pointer");c.toolTip=$('<span class="placeMarkTooltip">'+
l.name+"</span>").appendTo(a.getDiv()).css({left:(d.x+18).toString()+"px",top:(d.y-9).toString()+"px"});b.handled=!0;break}},500))});this.boundsChangedListener=google.maps.event.addListener(a,"bounds_changed",function(){c.redraw(!0)})}function c(){a.prototype=new google.maps.OverlayView;a.prototype.onAdd=function(){this.getPanes().overlayImage.appendChild(this.markerLayer[0])};a.prototype.removeFromMap=function(){this.ieMarkerOverlay?this.ieMarkerOverlay.setMap(null):this.setMap(null)};a.prototype.onRemove=
function(){clearTimeout(this.mouseOverTimeout);null!==this.toolTip&&this.toolTip.remove();this.killCurrentDraw();google.maps.event.removeListener(this.mouseOutMapListener);google.maps.event.removeListener(this.clickMapListener);google.maps.event.removeListener(this.mouseMoveMapListener);google.maps.event.removeListener(this.boundsChangedListener);this.markerLayer.remove();delete this.markerLayer};a.prototype.hide=function(){this.ieMarkerOverlay?this.ieMarkerOverlay.hide():this.markerLayer.hide()};
a.prototype.show=function(){this.ieMarkerOverlay?this.ieMarkerOverlay.show():this.markerLayer.show()};a.prototype.killCurrentDraw=function(a){clearTimeout(this.redrawTimeout);clearTimeout(this.drawPlacemarksTimeout);this.canvas=null};a.prototype.addMarker=function(a,c){a.addedToMarkerOverlay=!0;if(this.ieMarkerOverlay)this.ieMarkerOverlay.addMarker(a,c);else{var f=this,p,l;this.placemarks.push({placemark:a,latLng:c});k&&100<=this.placemarks.length?(this.killCurrentDraw(),l=new jc2cui.mapWidget.markerOverlayIE.MarkerOverlay(this.map,
this.doc,this.placemarks),this.setMap(null),this.ieMarkerOverlay=l):(this.needsSorting=!0,a.visible&&(this.redrawNeeded=!0),p=a.style&&a.style.IconStyle&&a.style.IconStyle.Icon&&a.style.IconStyle.Icon.href?a.style.IconStyle.Icon.href:jc2cui.mapWidget.getDefaultIcon(),b[p]||(b[p]=new Image,this.imagesLoading=this.imagesLoading?this.imagesLoading+1:1,b[p].onload=function(){f.imagesLoading--;f.needsDraw&&(f.needsDraw=!1,f.redraw(!0))},b[p].onerror=function(){console.log("Error thrown, image "+b[p].src+
" didn't load, probably a 404.");b[p].src=jc2cui.mapWidget.getErrorIcon()},b[p].src=p))}};a.prototype.removeMarker=function(a){a.addedToMarkerOverlay=!1;if(this.ieMarkerOverlay)this.ieMarkerOverlay.removeMarker(a);else{var b=-1;$.each(this.placemarks,function(c,k){if(a===k.placemark)return b=c,!1});-1<b&&this.placemarks.splice(b,1)}};a.prototype.redraw=function(a){if(this.ieMarkerOverlay)this.ieMarkerOverlay.redraw(a);else if(this.markerLayer){var b=this;if(this.redrawNeeded=this.redrawNeeded||a)this.killCurrentDraw(),
this.redrawTimeout=setTimeout(function(){b.redrawNeeded&&b.draw()},k?100:10)}};a.prototype.placemarkVisibilityChanged=function(a){if(this.ieMarkerOverlay)return this.ieMarkerOverlay.placemarkVisibilityChanged(a);this.redraw(!0)};a.prototype.drawPlacemarks=function(a,c,f,r){var l,n,v,A,t,y,x,F,B,M,L=jc2cui.mapWidget.options().labels&&jc2cui.mapWidget.options().labels.value;r=r||0;for(l=0;l<this.placemarks.length&&l<r+500;l++){if(this.doc.removed||this.canvas!==a)return;n=this.placemarks[l].placemark;
if(n.visible&&(!n.style||!n.style.IconStyle||!n.style.IconStyle.Icon||void 0===n.style.IconStyle.Icon.href||n.style.IconStyle.Icon.href)){if(!this.projection)return;v=this.projection.fromLatLngToDivPixel(this.placemarks[l].latLng);A=n.style&&n.style.IconStyle&&n.style.IconStyle.scale?n.style.IconStyle.scale:1;n.style&&n.style.IconStyle&&n.style.IconStyle.Icon&&n.style.IconStyle.Icon.href&&0<=n.style.IconStyle.Icon.href.indexOf("http://maps.google.com/mapfiles/kml")?(y=t=64,A/=2):y=t=32;0!==A&&(t*=
A,y*=A,n.style&&n.style.IconStyle&&n.style.IconStyle.hotSpot?(x=n.style.IconStyle.hotSpot.x,F=n.style.IconStyle.hotSpot.y,"pixels"===n.style.IconStyle.hotSpot.xunits&&(x=-x*A),"insetPixels"===n.style.IconStyle.hotSpot.xunits&&(x=-t+x*A),"fraction"===n.style.IconStyle.hotSpot.xunits&&(x*=-t),"pixels"===n.style.IconStyle.hotSpot.yunits&&(F=-y+F*A+1),"insetPixels"===n.style.IconStyle.hotSpot.yunits&&(F=-(F*A)+1),"fraction"===n.style.IconStyle.hotSpot.yunits&&(F=-y*(1-F)+1)):(x=n.style&&n.style.IconStyle&&
n.style.IconStyle.Icon&&n.style.IconStyle.Icon.href?-t/2:0.625*-t,F=-y/2),A=v.x-this.leftCanvas,v=v.y-this.topCanvas,n.hitRegion=n.hitRegion||{},n.hitRegion.minX=A+x,n.hitRegion.minY=v+F,n.hitRegion.maxX=A+x+t,n.hitRegion.maxY=v+F+y,B=n.style&&n.style.IconStyle&&n.style.IconStyle.Icon&&n.style.IconStyle.Icon.href?n.style.IconStyle.Icon.href:jc2cui.mapWidget.getDefaultIcon(),n.style&&n.style.IconStyle&&n.style.IconStyle.Icon&&n.style.IconStyle.Icon.w?c.drawImage(b[B],n.style.IconStyle.Icon.x,b[B].height-
n.style.IconStyle.Icon.y-n.style.IconStyle.Icon.h,n.style.IconStyle.Icon.w,n.style.IconStyle.Icon.h,A+x,v+F,t,y):(n.style&&n.style.IconStyle&&n.style.IconStyle.heading?(c.save(),c.translate(A,v),c.rotate(n.style.IconStyle.heading*Math.PI/180),k?c.drawImageWithRotate(b[B],A,v,x,F,t,y,n.style.IconStyle.heading):c.drawImage(b[B],x,F,t,y),c.restore()):c.drawImage(b[B],A+x,v+F,t,y),n.name&&(n.name.length&&L)&&(!k||f.contains(this.placemarks[l].latLng))&&(c.font='10pt Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif',
c.fillStyle="rgba(255, 255, 255, 0.5)",B=void 0!==p[n.name]?p[n.name]:c.measureText(n.name).width,k&&(p[n.name]=B),c.fillRect(A+x-B/2+t/2-1,v+F+y-(k?3:1)-1,B+(k?0.07*B:0)+1,(k?1:0)+11),c.fillStyle="blue",c.fillText(n.name,A+x-B/2+t/2,v+F+y+8))))}}l<this.placemarks.length?(M=this,this.drawPlacemarksTimeout=setTimeout(function(){M.drawPlacemarks(a,c,f,l)},10)):$(this.canvas).css("z-index",0).siblings().remove()};a.prototype.draw=function(){var a,b,c,p,l=this;if(this.projection=this.getProjection())this.imagesLoading&&
0<this.imagesLoading?this.needsDraw=!0:(this.redrawNeeded=!1,this.killCurrentDraw(),k&&(a=this.map.getBounds()),this.lastZoom!==this.map.getZoom()&&(this.markerLayer.empty(),this.lastZoom=this.map.getZoom()),this.canvas=document.createElement("canvas"),this.markerLayer.append(this.canvas),k&&(this.canvas=G_vmlCanvasManager.initElement(this.canvas)),b=this.canvas.getContext("2d"),this.canvas.width=this.getMap().getDiv().scrollWidth,this.canvas.height=this.getMap().getDiv().scrollHeight,this.canvas.className=
"markerCanvas",this.leftCanvas=this.topCanvas=0,this.needsSorting&&(this.placemarks.sort(function(a,b){return b.latLng.lat()-a.latLng.lat()}),this.needsSorting=!1),this.placemarks.length&&(c=this.projection.fromLatLngToContainerPixel(this.placemarks[0].latLng),p=this.projection.fromLatLngToDivPixel(this.placemarks[0].latLng),this.topCanvas=p.y-c.y,this.leftCanvas=p.x-c.x,this.canvas.style.top=this.topCanvas+"px",this.canvas.style.left=this.leftCanvas+"px",this.canvas.style.zIndex=-1),this.drawPlacemarksTimeout=
setTimeout(function(){l.drawPlacemarks(l.canvas,b,a)},10))}}var b={},k=!document.createElement("canvas").getContext,p={};return{init:function(){c();k&&jc2cui.mapWidget.markerOverlayIE.init()},MarkerOverlay:a}}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.markerOverlayIE=function(){function a(a){return a.style&&a.style.IconStyle&&a.style.IconStyle.Icon&&a.style.IconStyle.Icon.href&&"https://sageearth.northcom.mil/TrackService/icons/white_outlined_arrow.png"===a.style.IconStyle.Icon.href}function c(b,c,d){google.maps.OverlayView.call(this);this.setValues({map:b});this.placemarks=[];this.doc=c;this.container=$("<div />");var f=this,k,l;if(d)for(b=0;b<d.length;b++)a(d[b].placemark)?d[b].placemark.visible=d[b].placemark.visibility=!1:
(d[b].placemark.latLng=d[b].latLng,this.placemarks.push(d[b].placemark));for(;c;){if(c.overlayId){k=c.overlayId;l=c.featureId;break}c=c.parent}this.click=function(a){a=f.placemarks[parseInt(a.target.id.substr(1),10)];var b={selectedId:a.id||void 0,selectedName:a.name||void 0,featureId:l,overlayId:k};jc2cui.mapWidget.showPlacemarkInfoWindow(a);jc2cui.mapWidget.itemSelected(b)}}function b(){c.prototype=new google.maps.OverlayView;c.prototype.onAdd=function(){this.getPanes().overlayImage.appendChild(this.container[0])};
c.prototype.onRemove=function(){this.container.remove()};c.prototype.hide=function(){this.container.hide()};c.prototype.show=function(){this.container.show()};c.prototype.addMarker=function(b,c){if(a(b))b.visible=b.visibility=!1;else{b.latLng=c;this.placemarks.push(b);if(b.style&&(b.style.IconStyle&&b.style.IconStyle.Icon&&b.style.IconStyle.Icon.w)&&!k[b.style.IconStyle.Icon.href]){k[b.style.IconStyle.Icon.href]={};var d=$('<img src="'+b.style.IconStyle.Icon.href+'"/></img>').appendTo("body"),f=this;
this.paletteLoading=this.paletteLoading?this.paletteLoading+1:1;d.load(function(){k[b.style.IconStyle.Icon.href]={height:d.height(),width:d.width()};d.remove();f.paletteLoading--;f.needsDraw&&(f.needsDraw=!1,f.redraw())})}b.visible&&(this.forceRefresh=!0)}};c.prototype.removeMarker=function(a){var b=-1;$.each(this.placemarks,function(c,f){if(a===f)return b=c,!1});-1<b&&this.placemarks.splice(b,1)};c.prototype.killCurrentDraw=function(a){clearTimeout(this.redrawTimeout);clearTimeout(this.drawPlacemarksTimer);
this.markerLayer=null};c.prototype.redraw=function(){var a=this;this.forceRefresh=!0;this.killCurrentDraw();this.redrawTimeout=setTimeout(function(){a.forceRefresh&&a.draw()},100)};c.prototype.placemarkVisibilityChanged=function(b){if(a(b))return!1;this.redraw()};c.prototype.drawPlacemarks=function(a,b,c){var f=[],r,l,n,v,A,t,y=1,x=1,F,B,M,L,I,J,G=this,N=jc2cui.mapWidget.options().labels&&jc2cui.mapWidget.options().labels.value;for(r=c=c||0;r<this.placemarks.length&&r<c+200;r++){if(this.doc.removed||
b!==this.markerLayer)return;l=this.placemarks[r];if(l.visible&&(!l.style||!l.style.IconStyle||!l.style.IconStyle.Icon||void 0===l.style.IconStyle.Icon.href||l.style.IconStyle.Icon.href)){n=a.fromLatLngToDivPixel(this.placemarks[r].latLng);f.push('<img id="t');f.push(r);f.push('" class="marker"');l.name&&0<l.name.length&&(f.push(' title="'),f.push(l.name),f.push('"'));f.push(' style="z-index:');f.push(-Math.round(1E3*(this.placemarks[r].latLng.lat()+90))+18E4);t=l.style&&l.style.IconStyle&&l.style.IconStyle.scale?
l.style.IconStyle.scale:1;l.style&&l.style.IconStyle&&l.style.IconStyle.Icon&&l.style.IconStyle.Icon.href&&0<=l.style.IconStyle.Icon.href.indexOf("http://maps.google.com/mapfiles/kml")?(A=v=64,t/=2):A=v=32;v*=t;A*=t;l.style&&l.style.IconStyle&&l.style.IconStyle.hotSpot?(I=l.style.IconStyle.hotSpot.x,J=l.style.IconStyle.hotSpot.y,"pixels"===l.style.IconStyle.hotSpot.xunits&&(I=-I*t),"insetPixels"===l.style.IconStyle.hotSpot.xunits&&(I=-v+I*t),"fraction"===l.style.IconStyle.hotSpot.xunits&&(I*=-v),
"pixels"===l.style.IconStyle.hotSpot.yunits&&(J=-A+J*t+1),"insetPixels"===l.style.IconStyle.hotSpot.yunits&&(J=-(J*t)+1),"fraction"===l.style.IconStyle.hotSpot.yunits&&(J=-A*(1-J)+1)):(I=l.style&&l.style.IconStyle&&l.style.IconStyle.Icon&&l.style.IconStyle.Icon.href?-v/2:0.625*-v,J=-A/2);f.push("; left:");f.push(n.x+I);f.push("px; top:");f.push(n.y+J);f.push("px;");if(l.style&&l.style.IconStyle&&l.style.IconStyle.Icon&&l.style.IconStyle.Icon.w){t=k[l.style.IconStyle.Icon.href];if(l.style.IconStyle.Icon.h&&
32!==l.style.IconStyle.Icon.h||32!==A)y=(l.style.IconStyle.Icon.h||32)/A,f.push("height:"),f.push(t.height/y),f.push("px;");if(l.style.IconStyle.Icon.w&&32!==l.style.IconStyle.Icon.w||32!==v)x=(l.style.IconStyle.Icon.w||32)/v,f.push("width:"),f.push(t.width/x),f.push("px;");F=(t.height-l.style.IconStyle.Icon.y)/y-A;B=l.style.IconStyle.Icon.x/x+v;M=F+A;L=B-v;f.push("clip: rect(");f.push(F);f.push("px,");f.push(B);f.push("px,");f.push(M);f.push("px,");f.push(L);f.push("px);");f.push("margin-left:");
f.push(-(l.style.IconStyle.Icon.x/x));f.push("px;");f.push("margin-top:");f.push(-(t.height/y)+l.style.IconStyle.Icon.y/y+A);f.push("px;")}else 32!==A&&(f.push("height:"),f.push(A),f.push("px;")),32!==v&&(f.push("width:"),f.push(v),f.push("px;"));f.push('" src="');f.push(l.style&&l.style.IconStyle&&l.style.IconStyle.Icon&&l.style.IconStyle.Icon.href?l.style.IconStyle.Icon.href:jc2cui.mapWidget.getDefaultIcon());f.push('">');l.name&&(l.name.length&&N)&&(f.push('<div class="markerLabelOuter"'),f.push('style="left:'),
f.push(n.x+I+v/2),f.push("px; top:"),f.push(n.y+J+A/2+8),f.push("px;"),f.push('"><span class="markerLabelInner">'),f.push(l.name),f.push("</span>"),f.push("</div>"))}}c=b.append(f.join(""));$("img",c).one("error",function(){this.src=jc2cui.mapWidget.getErrorIcon()});r<this.placemarks.length?this.drawPlacemarksTimer=setTimeout(function(){G.drawPlacemarks(a,b,r)},10):(b.detach().css("z-index",0),this.container.empty().append(b))};c.prototype.draw=function(){var a=this.getProjection(),b,c,f=this;if(a)if(this.paletteLoading&&
0<this.paletteLoading)this.needsDraw=!0;else{if(this.placemarks.length&&(b=a.fromLatLngToDivPixel(this.placemarks[0].latLng),c=this.map.getZoom(),this.lastZoom===c&&!this.forceRefresh&&b.equals(this.lastFirstLoc)))return;this.forceRefresh=!1;this.killCurrentDraw();this.lastFirstLoc=b;this.lastZoom=c;this.markerLayer=$('<div class="marker-overlay"/>').click(this.click);this.container.append(this.markerLayer);this.drawPlacemarksTimer=setTimeout(function(){f.drawPlacemarks(a,f.markerLayer)},10)}}}var k=
{};return{init:function(){b()},MarkerOverlay:c}}();function ClusterIcon(a,c){a.getMarkerClusterer().extend(ClusterIcon,google.maps.OverlayView);this.cluster_=a;this.className_=a.getMarkerClusterer().getClusterClass();this.styles_=c;this.sums_=this.div_=this.center_=null;this.visible_=!1;this.setMap(a.getMap())}
ClusterIcon.prototype.onAdd=function(){var a=this,c,b;this.div_=document.createElement("div");this.div_.className=this.className_;this.visible_&&this.show();this.getPanes().overlayMouseTarget.appendChild(this.div_);google.maps.event.addListener(this.getMap(),"bounds_changed",function(){b=c});google.maps.event.addDomListener(this.div_,"mousedown",function(){c=!0;b=!1});google.maps.event.addDomListener(this.div_,"click",function(k){c=!1;if(!b){var p,q,d=a.cluster_.getMarkerClusterer();google.maps.event.trigger(d,
"click",a.cluster_);google.maps.event.trigger(d,"clusterclick",a.cluster_);d.getZoomOnClick()&&(q=d.getMaxZoom(),p=a.cluster_.getBounds(),jc2cui.mapWidget.renderer.fitToBounds(p),setTimeout(function(){jc2cui.mapWidget.renderer.fitToBounds(p);null!==q&&d.getMap().getZoom()>q&&d.getMap().setZoom(q+1)},100));k.cancelBubble=!0;k.stopPropagation&&k.stopPropagation()}});google.maps.event.addDomListener(this.div_,"mouseover",function(){var b=a.cluster_.getMarkerClusterer();google.maps.event.trigger(b,"mouseover",
a.cluster_)});google.maps.event.addDomListener(this.div_,"mouseout",function(){var b=a.cluster_.getMarkerClusterer();google.maps.event.trigger(b,"mouseout",a.cluster_)})};ClusterIcon.prototype.onRemove=function(){this.div_&&this.div_.parentNode&&(this.hide(),google.maps.event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)};
ClusterIcon.prototype.draw=function(){if(this.visible_){var a=this.getPosFromLatLng_(this.center_);this.div_.style.top=a.y+"px";this.div_.style.left=a.x+"px"}};ClusterIcon.prototype.hide=function(){this.div_&&(this.div_.style.display="none");this.visible_=!1};
ClusterIcon.prototype.show=function(a){if(this.div_){if(a||!this.div_.style.cssText.length)a=this.getPosFromLatLng_(this.center_),this.div_.style.cssText=this.createCss(a);this.div_.innerHTML=this.cluster_.printable_?"<img src='"+this.url_+"'><div style='position: absolute; top: 0px; left: 0px; width: "+this.width_+"px;'>"+this.sums_.text+"</div>":this.sums_.text;this.div_.title="undefined"===typeof this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title}this.visible_=
!0};
ClusterIcon.prototype.useStyle=function(a){this.sums_=a;a=Math.max(0,a.index-1);a=Math.min(this.styles_.length-1,a);a=this.styles_[a];this.url_=a.url;this.height_=a.height;this.width_=a.width;this.anchor_=a.anchor;this.anchorIcon_=a.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)];this.textColor_=a.textColor||"black";this.textSize_=a.textSize||11;this.textDecoration_=a.textDecoration||"none";this.fontWeight_=a.fontWeight||"bold";this.fontStyle_=a.fontStyle||"normal";this.fontFamily_=a.fontFamily||
"Arial,sans-serif";this.backgroundPosition_=a.backgroundPosition||"0 0"};ClusterIcon.prototype.setCenter=function(a){this.center_=a};
ClusterIcon.prototype.createCss=function(a){var c=[];this.cluster_.printable_||(c.push("background-image:url("+this.url_+");"),c.push("background-position:"+this.backgroundPosition_+";"));"object"===typeof this.anchor_?("number"===typeof this.anchor_[0]&&0<this.anchor_[0]&&this.anchor_[0]<this.height_?c.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):c.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"===typeof this.anchor_[1]&&0<this.anchor_[1]&&
this.anchor_[1]<this.width_?c.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):c.push("width:"+this.width_+"px; text-align:center;")):c.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");c.push("cursor:pointer; top:"+a.y+"px; left:"+a.x+"px; color:"+this.textColor_+"; position:absolute; font-size:"+this.textSize_+"px; font-family:"+this.fontFamily_+"; font-weight:"+this.fontWeight_+"; font-style:"+this.fontStyle_+
"; text-decoration:"+this.textDecoration_+";");return c.join("")};ClusterIcon.prototype.getPosFromLatLng_=function(a){a=this.getProjection().fromLatLngToDivPixel(a);a.x-=this.anchorIcon_[1];a.y-=this.anchorIcon_[0];return a};
function Cluster(a){this.markerClusterer_=a;this.map_=a.getMap();this.gridSize_=a.getGridSize();this.minClusterSize_=a.getMinimumClusterSize();this.averageCenter_=a.getAverageCenter();this.printable_=a.getPrintable();this.markers_=[];this.bounds_=this.center_=null;this.clusterIcon_=new ClusterIcon(this,a.getStyles())}Cluster.prototype.getAttributes=function(){return this.attributes_};Cluster.prototype.getSize=function(){return this.markers_.length};Cluster.prototype.getMarkers=function(){return this.markers_};
Cluster.prototype.getCenter=function(){return this.center_};Cluster.prototype.getMap=function(){return this.map_};Cluster.prototype.getMarkerClusterer=function(){return this.markerClusterer_};Cluster.prototype.getBounds=function(){var a,c=new google.maps.LatLngBounds(this.center_,this.center_),b=this.getMarkers();for(a=0;a<b.length;a++)c.extend(b[a].getPosition());return c};Cluster.prototype.remove=function(){this.clusterIcon_.setMap(null);delete this.markers_};
Cluster.prototype.addMarker=function(a){var c,b;if(this===a.cluster)return!1;this.center_?this.averageCenter_&&(b=this.markers_.length+1,c=(this.center_.lat()*(b-1)+a.getPosition().lat())/b,b=(this.center_.lng()*(b-1)+a.getPosition().lng())/b,this.center_=new google.maps.LatLng(c,b),this.calculateBounds_()):(this.center_=a.getPosition(),this.calculateBounds_());a.cluster=this;this.markers_.push(a);c=this.markers_.length;1===c&&this.configureAttributesAndRollups_(a);this.performRollup_(a);b=this.markerClusterer_.getMaxZoom();
if(null!==b&&this.map_.getZoom()>b)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c<this.minClusterSize_)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c===this.minClusterSize_)for(a=0;a<c;a++)this.markers_[a].setMap(null);else a.setMap(null);this.updateIcon_(this.averageCenter_);return!0};
Cluster.prototype.configureAttributesAndRollups_=function(a){var c=this.markerClusterer_.getAttributes(),b=this.markerClusterer_.getRollups(),k;if(c&&c.length)for(this.attributes_={},k=0;k<c.length;k++)this.attributes_[c[k]]=a.placemark.extendedData?a.placemark.extendedData[c[k]]:void 0;if(b&&b.length)for(this.attributes_=this.attributes_||{},k=0;k<b.length;k++)if(attribute=b[k].attribute)if(rollup=this.attributes_[attribute],!rollup&&(rollup=this.attributes_[attribute]={},(vals=b[k].values)&&vals.length))for(j=
0;j<vals.length;j++)rollup[vals[j]]=0};Cluster.prototype.doMarkerAttributesMatch=function(a){var c=this.markerClusterer_.getAttributes(),b;if(!c)return!0;for(b=0;b<c.length;b++)if(this.attributes_[c[b]]!==(a.placemark.extendedData?a.placemark.extendedData[c[b]]:void 0))return!1;return!0};
Cluster.prototype.performRollup_=function(a){var c=this.markerClusterer_.getRollups(),b,k,p;if(c&&c.length)for(p=0;p<c.length;p++)if(b=c[p].attribute)k=this.attributes_[b],(b=a.placemark.extendedData?a.placemark.extendedData[b]:void 0)&&b.length||(b="_other_"),k[b]="undefined"===typeof k[b]?1:k[b]+1};Cluster.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)};
Cluster.prototype.updateIcon_=function(a){var c=this.markers_.length,b=this.markerClusterer_.getMaxZoom();null!==b&&this.map_.getZoom()>b?this.clusterIcon_.hide():c<this.minClusterSize_?this.clusterIcon_.hide():(c=this.markerClusterer_.getStyles().length,c=this.markerClusterer_.getCalculator()(this,c),this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(c),this.clusterIcon_.show(a))};
function MarkerClusterer(a,c,b){this.extend(MarkerClusterer,google.maps.OverlayView);c=c||[];b=b||{};this.markers_={};this.clusters_=[];this.listeners_=[];this.activeMap_=null;this.ready_=!1;this.gridSize_=b.gridSize||60;this.minClusterSize_=b.minimumClusterSize||2;this.maxZoom_=b.maxZoom||null;this.styles_=b.styles||[];this.title_=b.title||"";this.zoomOnClick_=!0;void 0!==b.zoomOnClick&&(this.zoomOnClick_=b.zoomOnClick);this.averageCenter_=!1;void 0!==b.averageCenter&&(this.averageCenter_=b.averageCenter);
this.ignoreHidden_=!1;void 0!==b.ignoreHidden&&(this.ignoreHidden_=b.ignoreHidden);this.printable_=!1;void 0!==b.printable&&(this.printable_=b.printable);this.imagePath_=b.imagePath||MarkerClusterer.IMAGE_PATH;this.imageExtension_=b.imageExtension||MarkerClusterer.IMAGE_EXTENSION;this.imageSizes_=b.imageSizes||MarkerClusterer.IMAGE_SIZES;this.calculator_=b.calculator||MarkerClusterer.CALCULATOR;this.batchSize_=b.batchSize||MarkerClusterer.BATCH_SIZE;this.batchSizeIE_=b.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE;
this.clusterClass_=b.clusterClass||"cluster";this.attributes_=b.attributes;this.rollups_=b.rollups;-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_);this.setupStyles_();this.addMarkers(c,!0);this.setMap(a)}
MarkerClusterer.prototype.onAdd=function(){var a=this;this.activeMap_=this.getMap();this.ready_=!0;this.repaint();this.listeners_=[google.maps.event.addListener(this.getMap(),"zoom_changed",function(){var c=this.getBounds();c.equals(a.lastBounds)||(a.lastBounds=c,a.resetViewport_(!1))}),google.maps.event.addListener(this.getMap(),"idle",function(){a.redraw_()})]};
MarkerClusterer.prototype.onRemove=function(){var a,c;for(a in this.markers_)this.markers_.hasOwnProperty(a)&&(c=this.markers_[a],c.getMap()!==this.activeMap_&&c.setMap(this.activeMap_),delete c.cluster);this.markers_={};for(i=0;i<this.clusters_.length;i++)this.clusters_[i].remove();this.clusters_=[];for(i=0;i<this.listeners_.length;i++)google.maps.event.removeListener(this.listeners_[i]);this.listeners_=[];this.activeMap_=null;this.ready_=!1};MarkerClusterer.prototype.draw=function(){};
MarkerClusterer.prototype.setupStyles_=function(){var a,c;if(!(0<this.styles_.length))for(a=0;a<this.imageSizes_.length;a++)c=this.imageSizes_[a],this.styles_.push({url:this.imagePath_+(a+1)+"."+this.imageExtension_,height:c,width:c})};MarkerClusterer.prototype.fitMapToMarkers=function(){var a,c=this.getMarkers(),b=new google.maps.LatLngBounds;for(a=0;a<c.length;a++)b.extend(c[a].getPosition());jc2cui.mapWidget.renderer.fitToBounds(b)};MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};
MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a};MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_};MarkerClusterer.prototype.setMinimumClusterSize=function(a){this.minClusterSize_=a};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_};MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a};MarkerClusterer.prototype.getStyles=function(){return this.styles_};
MarkerClusterer.prototype.setStyles=function(a){this.styles_=a};MarkerClusterer.prototype.getTitle=function(){return this.title_};MarkerClusterer.prototype.setTitle=function(a){this.title_=a};MarkerClusterer.prototype.getZoomOnClick=function(){return this.zoomOnClick_};MarkerClusterer.prototype.setZoomOnClick=function(a){this.zoomOnClick_=a};MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_};
MarkerClusterer.prototype.setAverageCenter=function(a){this.averageCenter_=a};MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_};MarkerClusterer.prototype.setIgnoreHidden=function(a){this.ignoreHidden_=a};MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_};MarkerClusterer.prototype.setImageExtension=function(a){this.imageExtension_=a};MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_};
MarkerClusterer.prototype.setImagePath=function(a){this.imagePath_=a};MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_};MarkerClusterer.prototype.setImageSizes=function(a){this.imageSizes_=a};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=a};MarkerClusterer.prototype.getPrintable=function(){return this.printable_};
MarkerClusterer.prototype.setPrintable=function(a){this.printable_=a};MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_};MarkerClusterer.prototype.setBatchSizeIE=function(a){this.batchSizeIE_=a};MarkerClusterer.prototype.getClusterClass=function(){return this.clusterClass_};MarkerClusterer.prototype.setClusterClass=function(a){this.clusterClass_=a};MarkerClusterer.prototype.getAttributes=function(){return this.attributes_};
MarkerClusterer.prototype.setAttributes=function(a){this.attributes_=a};MarkerClusterer.prototype.getRollups=function(){return this.rollups_};MarkerClusterer.prototype.setRollups=function(a){this.rollups_=a};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return getKeys(this.markers_).length};MarkerClusterer.prototype.getClusters=function(){return this.clusters_};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length};
MarkerClusterer.prototype.addMarker=function(a,c){this.pushMarkerTo_(a);c||this.redraw_()};MarkerClusterer.prototype.addMarkers=function(a,c){var b;for(b=0;b<a.length;b++)this.pushMarkerTo_(a[b]);c||this.redraw_()};MarkerClusterer.prototype.pushMarkerTo_=function(a){if(a.getDraggable()){var c=this;google.maps.event.addListener(a,"dragend",function(){c.ready_&&(delete this.cluster,c.repaint())})}delete a.cluster;this.markers_[a.placemark.internalId]=a};
MarkerClusterer.prototype.removeMarker=function(a,c){var b=this.removeMarker_(a);!c&&b&&this.repaint();return b};MarkerClusterer.prototype.removeMarkers=function(a,c){var b,k,p=!1;for(b=0;b<a.length;b++)k=this.removeMarker_(a[b]),p=p||k;!c&&p&&this.repaint();return p};MarkerClusterer.prototype.removeMarker_=function(a){var c=this.markers_[a.placemark.internalId];c&&(a.setMap(null),delete this.markers_[a.placemark.internalId]);return void 0!==c};
MarkerClusterer.prototype.clearMarkers=function(){this.resetViewport_(!0);this.markers_={}};MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_=[];this.resetViewport_(!1);this.redraw_();setTimeout(function(){var c;for(c=0;c<a.length;c++)a[c].remove()},0)};
MarkerClusterer.prototype.getExtendedBounds=function(a){var c=this.getProjection(),b=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng()),k=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng()),b=c.fromLatLngToDivPixel(b);b.x+=this.gridSize_;b.y-=this.gridSize_;k=c.fromLatLngToDivPixel(k);k.x-=this.gridSize_;k.y+=this.gridSize_;b=c.fromDivPixelToLatLng(b);c=c.fromDivPixelToLatLng(k);a.extend(b);a.extend(c);return a};MarkerClusterer.prototype.redraw_=function(){this.createClusters()};
MarkerClusterer.prototype.resetViewport_=function(a){var c,b;for(c=0;c<this.clusters_.length;c++)this.clusters_[c].remove();this.clusters_=[];for(c in this.markers_)this.markers_.hasOwnProperty(c)&&(b=this.markers_[c],delete b.cluster,a&&b.setMap(null))};
function getKeys(a){var c;if(Object.keys)c=Object.keys(a);else{var b=Object.prototype.hasOwnProperty,k=!{toString:null}.propertyIsEnumerable("toString"),p="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),q=p.length;if("object"!=typeof a&&"function"!=typeof a||null===a)return;c=[];for(var d in a)b.call(a,d)&&c.push(d);if(k)for(a=0;a<q;a++)b.call(o,p[a])&&c.push(p[a])}return c}function toRadians(a){return a*Math.PI/180}
MarkerClusterer.prototype.distanceBetweenPoints_=function(a,c,b,k){var p=toRadians(a),q=toRadians(b);a=toRadians(b-a);c=toRadians(k-c);p=Math.pow(Math.sin(a/2),2)+Math.cos(p)*Math.cos(q)*Math.pow(Math.sin(c/2),2);return 12756*Math.atan2(Math.sqrt(p),Math.sqrt(1-p))};
MarkerClusterer.prototype.addToClosestCluster_=function(a){var c,b,k;c=a.getPosition();var p=c.lat(),q=c.lng(),d=4E4,f=null;for(c=0;c<this.clusters_.length;c++)if(k=this.clusters_[c],(!this.attributes_||k.doMarkerAttributesMatch(a))&&k.bounds_.contains(a.getPosition())&&(b=k.getCenter()))b=this.distanceBetweenPoints_(b.lat(),b.lng(),p,q),b<d&&(d=b,f=k);f?f.addMarker(a):(k=new Cluster(this),k.addMarker(a),this.clusters_.push(k))};
MarkerClusterer.prototype.createClusters=function(){var a=getKeys(this.markers_);this.createClusters_(a,0)};
MarkerClusterer.prototype.createClusters_=function(a,c){var b,k,p=this;if(this.ready_){0===c&&(google.maps.event.trigger(this,"clusteringbegin",this),"undefined"!==typeof this.timerRefStatic&&(clearTimeout(this.timerRefStatic),delete this.timerRefStatic));3<this.getMap().getZoom()&&(b=new google.maps.LatLngBounds(this.getMap().getBounds().getSouthWest(),this.getMap().getBounds().getNorthEast()));var q=b?this.getExtendedBounds(b):void 0,d=Math.min(c+this.batchSize_,a.length);for(b=c;b<d;b++)k=a[b],
this.markers_.hasOwnProperty(k)&&(k=this.markers_[k],k.cluster||(!(!this.ignoreHidden_||this.ignoreHidden_&&k.getVisible())||q&&!q.contains(k.getPosition()))||this.addToClosestCluster_(k));d<a.length?this.timerRefStatic=setTimeout(function(){p.createClusters_(a,d)},0):(delete this.timerRefStatic,google.maps.event.trigger(this,"clusteringend",this))}};MarkerClusterer.prototype.extend=function(a,c){return function(a){for(var c in a.prototype)this.prototype[c]=a.prototype[c];return this}.apply(a,[c])};
MarkerClusterer.CALCULATOR=function(a,c){for(var b=0,k=a.getMarkers().length.toString(),p=k;0!==p;)p=parseInt(p/10,10),b++;b=Math.min(b,c);return{text:k,index:b,title:""}};MarkerClusterer.BATCH_SIZE=2E3;MarkerClusterer.BATCH_SIZE_IE=500;MarkerClusterer.IMAGE_PATH="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m";MarkerClusterer.IMAGE_EXTENSION="png";MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90];util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.clusterManager=function(){function a(b){var c=[];$.each(b,function(b,d){if("object"===typeof d)return c.push(a(d)),c.push(", "),!0;c.push(b);c.push(": ");c.push(d);c.push(", ")});c.length?(c.pop(),b=c.join("")):b="No data found";return b}function c(b,c){var d;"string"===typeof c&&-1!==c.indexOf("${")&&(c=c.replace(/\$\{([\w.]+?)\}/g,function(c,f){if("count"===f)return b.getSize();var k=f.split(/\.+/),l=b.getAttributes();for(d=0;d<k.length&&(l=l[k[d]],l);d++);"object"===typeof l&&
(l=a(l));return l}),c=isNaN(c)||!c?c:parseFloat(c));return c}function b(a){if(jc2cui.mapWidget.options().clustering&&jc2cui.mapWidget.options().clustering.value)return a.clustering?a:a.parent?b(a.parent):a.overlayId&&(a=n[a.overlayId])?b(a):v}function k(a,b,d){d=d.style||{};a={name:c(b,d.title)||a.getTitle()||"",description:c(b,d.description)||"",placemarks:b.getMarkers(),attributes:"placemark",bounds:b.getBounds()};jc2cui.mapWidget.showClusterInfoWindow(a)}function p(a,b){var d=$.extend(!0,{},r,
"object"===typeof b.clustering?b.clustering:{}),f=new MarkerClusterer(l,a,{zoomOnClick:!1,gridSize:d.distance,minimumClusterSize:d.threshold,maxZoom:d.maxZoom,styles:[{url:"/widgets/common/kml/icons/"+((d.style||{}).fillColor||"red")+".png",height:33,width:34}],calculator:function(a,b){var f=0,k,l=a.getMarkers().length,n=l.toString();for(d.style&&d.style.title&&(k=c(a,d.style.title));0!==l;)l=Math.floor(l/10),f++;f=Math.min(f,b);return{text:n,index:f,title:k}},attributes:d.attributes,rollups:d.rollups});
google.maps.event?google.maps.event.addListener(f,"click",function(a){k(f,a,d)}):google.maps.Event.addListener(f,"clusterclick",function(a){k(f,a,d)});return f}function q(a,b,c){b&&(a?b.markerClusterer?b.markerClusterer.addMarkers(c):(b.markerClusterer=p(c,b),A.push(b)):b.markerClusterer&&b.markerClusterer.removeMarkers(c))}function d(a,c){var d=b(c),f=[],k=[],l;if(d)if(a){c.getAllVisiblePlacemarks(f);for(l=0;l<f.length;l++)f[l].getPosition&&k.push(f[l]);d.markerClusterer?d.markerClusterer.addMarkers(k):
(d.markerClusterer=p(k,d),A.push(d))}else if(d.markerClusterer)if(c===d)d.markerClusterer.setMap(null),delete d.markerClusterer,A.splice($.inArray(d,A),1);else{c.getAllPlacemarks(f);for(l=0;l<f.length;l++)(f[l].getPosition||f[l].draggable)&&k.push(f[l]);d.markerClusterer.removeMarkers(k)}}function f(a,c){var d=b(c.placemark),f;d&&d.markerClusterer&&(d.markerClusterer.markersToAdd=d.markerClusterer.markersToAdd||[],d.markerClusterer.markersToRemove=d.markerClusterer.markersToRemove||[],a?d.markerClusterer.markersToAdd.push(c):
d.markerClusterer.markersToRemove.push(c),f=function(a){a.markerClusterer.markersToAdd.length&&(q(!0,a,a.markerClusterer.markersToAdd),a.markerClusterer.markersToAdd=[]);a.markerClusterer.markersToRemove.length&&(q(!1,a,a.markerClusterer.markersToRemove),a.markerClusterer.markersToRemove=[])},clearTimeout(d.markersTimeout),d.markersTimeout=setTimeout(function(){f(d)},100))}var r={distance:60,threshold:2,maxZoom:19,style:{label:"${count}",title:"${count} items"}},l,n,v={},A=[];return{init:function(a,
b){l=a;n=b},getClusterer:function(a){return b(a)},cluster:function(a,b){d(a,b)},setMarkerVisible:function(a,b){f(a,b)},setClustering:function(a){a?$.each(n,function(b,c){$.each(c.docs,function(b,c){d(a,c)})}):($.each(A,function(a,b){b.markerClusterer.setMap(null);delete b.markerClusterer}),A=[],v={})}}}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.latLonControl=function(){function a(a){var b=this,k=$('<div class="customMapControl"><span id="latLon-control"></span><div class="controlBack"></div></div>');a.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(k[0]);$(".controlBack",k).css({opacity:0.3});this.control=$("#latLon-control",k)[0];google.maps.event.addListener(a,"mousemove",function(a){b.updatePosition(a.latLng)})}a.prototype.updatePosition=function(a){this.control.innerHTML=a.toUrlValue(4)};return{Control:a}}();
var OWF;function mapsLoaded(){jc2cui.mapWidget.renderer.mapsReady()}util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.renderer=function(){function a(a,b,c){this.id=a;this.clustering=c;this.children={};this.docs={};this.features={};b?(this.parent=b,b.children[this.id]=this,this.visible=b.visible):this.visible=!0;u[this.id]=this}function c(a){var b=new google.maps.LatLngBounds;switch(a.data.type){case "marker":b.extend(a.mapObject.getPosition());break;case "line":case "shape":a.mapObject.getPath().forEach(function(a,e){b.extend(a)})}return b}function b(a,b){"transparent"===a&&(a="#ffffff",b=0);var c=
a.replace(/#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})/i,"ff$3$2$1").toLowerCase(),d;void 0!==b&&(d=Math.floor(255*b).toString(16),2>d.length&&(d="0"+d),c=d+c.substring(2));return c}function k(a){var c=[];c.push('<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:gx="http://www.google.com/kml/ext/2.2" xmlns:kml="http://www.opengis.net/kml/2.2" xmlns:atom="http://www.w3.org/2005/Atom"><Placemark id="');c.push(a.id);c.push('">');a.title&&(c.push("<name>"),c.push(a.title),c.push("</name>"));a.description&&
(c.push("<description><![CDATA["),c.push(a.description),c.push("]]\x3e</description>"));c.push("<Style>");switch(a.type){case "marker":c.push("<IconStyle><Icon><href>");c.push(a.iconUrl);c.push('</href></Icon><hotSpot x="0.5" y="0" xunits="fraction" yunits="fraction"></hotSpot></IconStyle></Style><Point>');break;case "line":case "shape":c.push("<LineStyle><color>"),c.push(b(a.strokeColor,a.strokeOpacity)),c.push("</color><width>"),c.push(a.strokeWeight),c.push("</width></LineStyle>"),"shape"===a.type&&
(c.push("<PolyStyle><color>"),c.push(b(a.fillColor,a.fillOpacity)),c.push("</color></PolyStyle>")),c.push("</Style>"),"line"===a.type?c.push("<LineString><tessellate>1</tessellate>"):c.push("<Polygon><outerBoundaryIs><LinearRing>")}c.push("<coordinates>");"shape"===a.type&&0<a.coordinates.length&&a.coordinates.push(a.coordinates[0]);$.each(a.coordinates,function(a,e){c.push(e.lng());c.push(",");c.push(e.lat());c.push(",0 ")});c.push("</coordinates>");switch(a.type){case "marker":c.push("</Point>");
break;case "shape":c.push("</LinearRing></outerBoundaryIs></Polygon>");break;case "line":c.push("</LineString>")}c.push("</Placemark></kml>");return c.join("")}function p(a){jc2cui.mapWidget.showUserDrawnEditWindow(a.data,{deleted:function(){jc2cui.mapWidget.deleteDrawing(a.data.id)},updated:function(b){var c=k(b);switch(a.data.type){case "marker":a.mapObject.setIcon(new google.maps.MarkerImage(b.iconUrl,null,null,new google.maps.Point(16,32),new google.maps.Size(32,32)));a.mapObject.setTitle(b.title);
a.mapObject.setMap(null);a.mapObject.setMap(D);break;case "line":case "shape":a.mapObject.setOptions({strokeColor:b.strokeColor,strokeWeight:b.strokeWeight,strokeOpacity:b.strokeOpacity,fillColor:b.fillColor,fillOpacity:b.fillOpacity})}jc2cui.mapWidget.publishDrawing(c,a.data.id,a.data.title,a.mapObject.getVisible())}})}function q(a){T&&(aa=a,T.setOptions({drawingControl:a}),$.each(u,function(b,c){$.each(c.features,function(b,c){"marker"===c.data.type?c.mapObject.setDraggable(a):c.mapObject.setEditable(a)})}))}
function d(e){(u[jc2cui.mapWidget.USER_DRAWN_OVERLAY]||new a(jc2cui.mapWidget.USER_DRAWN_OVERLAY)).features[e.data.id]=e;google.maps.event.addListener(e.mapObject,"click",function(){aa?p(e):jc2cui.mapWidget.showPlacemarkInfoWindow(e.data);jc2cui.mapWidget.itemSelected({selectedId:e.data.id||void 0,selectedName:e.data.title||void 0,featureId:e.data.id,overlayId:jc2cui.mapWidget.USER_DRAWN_OVERLAY})})}function f(){var a=D.getBounds(),b=D.getCenter(),c=a.getSouthWest(),a=a.getNorthEast(),d=D.getZoom(),
d=352E5/Math.pow(2,d),b=new google.maps.LatLng(b.lat(),b.lng()),c=new google.maps.LatLng(c.lat(),c.lng()),a=new google.maps.LatLng(a.lat(),a.lng());return jc2cui.mapWidget.createViewStatus(c.lat(),c.lng(),a.lat(),a.lng(),b.lat(),b.lng(),d)}function r(a,b,c){google.maps.event.addListener(a,"click",function(a){for(var e,d;c;){if(c.overlayId){e=c.overlayId;d=c.featureId;break}c=c.parent}a={selectedId:b.id||void 0,selectedName:b.name||void 0,featureId:d,overlayId:e};jc2cui.mapWidget.showPlacemarkInfoWindow(b);
jc2cui.mapWidget.itemSelected(a)});google.maps.event.addListener(a,"mousemove",function(a){google.maps.event.trigger(D,"mousemove",a)})}function l(a){var b={strokeColor:a.style&&a.style.LineStyle&&a.style.LineStyle.color?a.style.LineStyle.color.color:"#ffffff",strokeOpacity:a.style&&a.style.LineStyle&&a.style.LineStyle.color?a.style.LineStyle.color.opacity:1,strokeWeight:a.style&&a.style.LineStyle&&a.style.LineStyle.width?a.style.LineStyle.width:1,fillColor:a.style&&a.style.PolyStyle&&a.style.PolyStyle.color?
a.style.PolyStyle.color.color:"#ffffff",fillOpacity:a.style&&a.style.PolyStyle&&a.style.PolyStyle.color?a.style.PolyStyle.color.opacity:1,map:D,visible:a.visible,title:a.name};a.style&&(a.style.PolyStyle&&"0"===a.style.PolyStyle.fill)&&(b.fillOpacity=0);a.style&&(a.style.PolyStyle&&"0"===a.style.PolyStyle.outline)&&(b.strokeWeight=0);return b}function n(a){var b=[],c;for(c=0;c<a.length;c++)b.push(new google.maps.LatLng(a[c].lat,a[c].lon));return b}function v(){$("div:first",$("div:first",$("#map"))).mousedown(function(a){Q=
{x:a.pageX,y:a.pageY}}).mouseup(function(a){if(!Q||2>Math.abs(a.pageX-Q.x)&&2>Math.abs(a.pageY-Q.y)){var b=(new Date).getTime(),c=1;X===a.which&&500>b-H?(c=2,H=1E3):H=b;X=a.which;jc2cui.mapWidget.mapClicked(O.lat(),O.lng(),c,a.which,a.shiftKey,a.ctrlKey,a.altKey)}Q=null})}function A(){var a,b,c;function q(a){google.maps.OverlayView.call(this);this.setMap(a)}function C(a,b,e){this.placemark=a;this.latLng=b;this.markerOverlay=e;this.visible=a.visible}E=[google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.SATELLITE,
google.maps.MapTypeId.HYBRID,google.maps.MapTypeId.TERRAIN];S=E.slice();P=google.maps.MapTypeId.ROADMAP;D=new google.maps.Map(document.getElementById("map"),{zoom:3,center:new google.maps.LatLng(39.5,-98.3),mapTypeControlOptions:{mapTypeIds:E},mapTypeId:P,scaleControl:!0});google.maps.event.addListener(D,"maptypeid_changed",function(){var a=D.getMapTypeId();$.each(z,function(b,e){e.name===a?e.visible||(jc2cui.mapWidget.sidebar?jc2cui.mapWidget.sidebar.showFeature(e.featureId,e.overlayId,!0):e.setVisible(!0,
!0)):e.visible&&(jc2cui.mapWidget.sidebar?jc2cui.mapWidget.sidebar.hideFeature(e.featureId,e.overlayId,!0):e.setVisible(!1,!0))});-1<$.inArray(a,S)&&(P=a)});google.maps.event.addListener(D,"mousemove",function(a){O=a.latLng});google.maps.event.addListener(D,"resize",function(){setTimeout(function(){jc2cui.mapWidget.infoWindow.checkResize();$.each(u,function(a,b){$.each(b.docs,function(a,b){var e=b.getAllScreenOverlays();$.each(e,function(a,b){b.placer()})})})},250)});new jc2cui.mapWidget.latLonControl.Control(D);
var t,g;google.maps.event.addListener(D,"idle",function(){clearTimeout(t);t=setTimeout(function(){jc2cui.mapWidget.publishView(f());$.each(u,function(a,b){$.each(b.docs,function(a,b){b.onViewUpdate()})})},1E3)});q.prototype=new google.maps.OverlayView;q.prototype.onAdd=function(){v()};q.prototype.onRemove=function(){};q.prototype.draw=function(){};q.prototype.latLngToPixel=function(a){return this.getProjection().fromLatLngToDivPixel(a)};q.prototype.pixelToLatLng=function(a){return this.getProjection().fromDivPixelToLatLng(a)};
U=new q(D);C.prototype.removeFromMap=function(){};C.prototype.extendBounds=function(a){a.extend(this.latLng)};C.prototype.setVisible=function(a){this.visible!==a&&(this.markerOverlay.placemarkVisibilityChanged(this.placemark),this.visible=a,jc2cui.mapWidget.clusterManager.setMarkerVisible(a,this))};C.prototype.getPosition=function(){return this.latLng};C.prototype.getDraggable=function(){return!1};C.prototype.setMap=function(a){a?(this.placemark.addedToMarkerOverlay||this.markerOverlay.addMarker(this.placemark,
this.latLng),this.markerOverlay.placemarkVisibilityChanged(this.placemark)):this.placemark.addedToMarkerOverlay&&(this.markerOverlay.removeMarker(this.placemark),this.markerOverlay.placemarkVisibilityChanged(this.placemark))};C.prototype.getMap=function(){return this.placemark.addedToMarkerOverlay?D:void 0};C.prototype.getVisible=function(){return this.visible};g={proxy:w,maxFileSize:R,maxPlacemarks:V,container:"#map :first",refreshInfoWindow:function(a){jc2cui.mapWidget.showPlacemarkInfoWindow(a)},
containerRemoved:function(a){a.markerOverlay&&a.markerOverlay.removeFromMap();jc2cui.mapWidget.clusterManager.cluster(!1,a)},parseCallback:function(a){jc2cui.mapWidget.totalMarkersLoaded(jc2cui.mapWidget.kmlParser.totalEntities());var b,e;e=a;var c,h;for(e=a;e.parent;)e=e.parent;b=e.overlayId;e=e.featureId;if(c=jc2cui.mapWidget.kmlParser.getTreeData(a,a.visible,b,e))if($.isArray(c))for(h=0;h<c.length;h++)jc2cui.mapWidget.addTreeItems(c[h],b,e,a.parent?a.parent.internalId:void 0);else jc2cui.mapWidget.addTreeItems(c,
b,e,a.parent?a.parent.internalId:void 0);jc2cui.mapWidget.clusterManager.getClusterer(a)?jc2cui.mapWidget.clusterManager.cluster(!0,a):a.markerOverlay&&a.markerOverlay.redraw()},region:function(a){a.latLonAltBox=new google.maps.LatLngBounds(new google.maps.LatLng(a.latLonAltBox.south,a.latLonAltBox.west),new google.maps.LatLng(a.latLonAltBox.north,a.latLonAltBox.east));return a},isRegionActive:function(a){var b,e,c;if(!D.getBounds().intersects(a.latLonAltBox))return!1;b=U.latLngToPixel(a.latLonAltBox.getSouthWest());
e=U.latLngToPixel(a.latLonAltBox.getNorthEast());c=Math.abs(e.x-b.x);b=Math.abs(e.y-b.y);c=Math.round(Math.sqrt(c*b)).toFixed(0);return c<a.lod.minLodPixels||0<=a.lod.maxLodPixels&&c>a.lod.maxLodPixels?!1:!0},formatView:function(a){var b=D.getBounds(),e=b.getSouthWest(),c=b.getNorthEast(),h=new google.maps.LatLng(c.lat(),e.lng()),b=b.getCenter(),d=D.getZoom(),d=352E5/Math.pow(2,d),m=google.maps.geometry.spherical.computeDistanceBetween(e,h),h=google.maps.geometry.spherical.computeDistanceBetween(c,
h),g=$(D.getDiv());a=a.replace("[bboxWest]",e.lng());a=a.replace("[bboxSouth]",e.lat());a=a.replace("[bboxEast]",c.lng());a=a.replace("[bboxNorth]",c.lat());a=a.replace("[lookatLon]",b.lng());a=a.replace("[lookatLat]",b.lat());a=a.replace("[lookatRange]",d);a=a.replace("[lookatTilt]",0);a=a.replace("[lookatHeading]",0);a=a.replace("[horizFov]",h/2/d);a=a.replace("[vertFov]",m/2/d);a=a.replace("[horizPixels]",g.width());a=a.replace("[vertPixels]",g.height());return a=a.replace("[terrainEnabled]",0)},
marker:function(a,b,e){e.markerOverlay||(e.markerOverlay=new jc2cui.mapWidget.markerOverlay.MarkerOverlay(D,e));b=new google.maps.LatLng(b.lat,b.lon);jc2cui.mapWidget.clusterManager.getClusterer(e)||e.markerOverlay.addMarker(a,b);return new C(a,b,e.markerOverlay)},polyline:function(a,b,e){var c=l(a);c.path=n(b);b=new google.maps.Polyline(c);r(b,a,e);return b},polygon:function(a,b,e){var c,h=l(a),d;h.paths=[];for(c=0;c<b.length;c++)d=n(b[c]),0!==c&&d.reverse(),h.paths.push(d);b=new google.maps.Polygon(h);
r(b,a,e);return b},groundOverlay:function(a,b){var e;e=a.icon.viewFormat&&a.icon.viewFormat.length&&0<=a.icon.viewFormat.indexOf("BBOX")?D.getBounds():new google.maps.LatLngBounds(new google.maps.LatLng(a.latLonBox.south,a.latLonBox.west),new google.maps.LatLng(a.latLonBox.north,a.latLonBox.east));return new google.maps.GroundOverlay(a.icon.getHref(),e,{clickable:!1,map:a.visible?D:null,opacity:a.opacity})},bounds:function(){return new google.maps.LatLngBounds}};google.maps.Marker.prototype.removeFromMap=
function(){this.setMap(null)};google.maps.Marker.prototype.extendBounds=function(a){a.extend(this.getPosition())};google.maps.Polyline.prototype.removeFromMap=google.maps.Marker.prototype.removeFromMap;google.maps.Polyline.prototype.extendBounds=function(a){this.getPath().forEach(function(b){a.extend(b)})};google.maps.Polygon.prototype.removeFromMap=google.maps.Marker.prototype.removeFromMap;google.maps.Polygon.prototype.extendBounds=google.maps.Polyline.prototype.extendBounds;google.maps.GroundOverlay.prototype.removeFromMap=
google.maps.Marker.prototype.removeFromMap;google.maps.GroundOverlay.prototype.extendBounds=function(a){a.union(this.getBounds())};google.maps.GroundOverlay.prototype.setVisible=function(a){a?this.setMap(D):this.setMap(null)};google.maps.GroundOverlay.prototype.refreshIcon=function(a){this.remove();a.features=[g.groundOverlay(a)]};jc2cui.mapWidget.kmlParser.init(g);jc2cui.mapWidget.clusterManager.init(D,u);jc2cui.mapWidget.markerOverlay.init();jc2cui.mapWidget.infoWindow.init({containment:"#map"});
ca&&(a={icon:new google.maps.MarkerImage(jc2cui.mapWidget.getDefaultDrawingIcon(),null,null,new google.maps.Point(16,32),new google.maps.Size(32,32)),draggable:!0},b={strokeColor:"#15428B",strokeOpacity:0.8,strokeWeight:3,editable:!0},c={strokeColor:"#15428B",strokeOpacity:0.8,strokeWeight:3,fillColor:"#DFE8F6",fillOpacity:0.5,editable:!0},T=new google.maps.drawing.DrawingManager({drawingControl:!1,drawingControlOptions:{position:google.maps.ControlPosition.TOP_CENTER,drawingModes:[google.maps.drawing.OverlayType.MARKER,
google.maps.drawing.OverlayType.POLYLINE,google.maps.drawing.OverlayType.POLYGON]},markerOptions:a,polylineOptions:b,polygonOptions:c}),T.setMap(D),google.maps.event.addListener(T,"overlaycomplete",function(a){var e=function(){var b=new google.maps.LatLngBounds;a.overlay.extendBounds(b);return b},g={id:jc2cui.mapWidget.getNewId(),getBounds:e},f={data:g,mapObject:a.overlay,getBounds:e},e=!1,l;switch(a.type){case google.maps.drawing.OverlayType.MARKER:g.type="marker";g.title=g.type+" "+ ++K.marker;
g.coordinates=[a.overlay.getPosition()];g.iconUrl=a.overlay.getIcon().url;google.maps.event.addListener(f.mapObject,"dragend",function(a){g.coordinates[0]=a.latLng;l=k(g);jc2cui.mapWidget.publishDrawing(l,f.data.id,f.data.title,f.mapObject.getVisible())});break;case google.maps.drawing.OverlayType.POLYLINE:case google.maps.drawing.OverlayType.POLYGON:e=a.type===google.maps.drawing.OverlayType.POLYGON,g.type=e?"shape":"line",g.title=g.type+" "+ ++K[g.type],g.coordinates=a.overlay.getPath().getArray(),
g.iconUrl=[jc2cui.mapWidget.getAppPath(),"images/",e?"poly":"line",'Mask.png"'].join(""),g.strokeColor=b.strokeColor,g.strokeWeight=b.strokeWeight,g.strokeOpacity=b.strokeOpacity,e&&(g.fillColor=c.fillColor,g.fillOpacity=c.fillOpacity),google.maps.event.addListener(a.overlay.getPath(),"insert_at",function(a){l=k(g);jc2cui.mapWidget.publishDrawing(l,f.data.id,f.data.title,f.mapObject.getVisible())}),google.maps.event.addListener(a.overlay.getPath(),"remove_at",function(a,b){l=k(g);jc2cui.mapWidget.publishDrawing(l,
f.data.id,f.data.title,f.mapObject.getVisible())}),google.maps.event.addListener(a.overlay.getPath(),"set_at",function(a,b){l=k(g);jc2cui.mapWidget.publishDrawing(l,f.data.id,f.data.title,f.mapObject.getVisible())})}d(f);p(f);l=k(g);jc2cui.mapWidget.publishDrawing(l,f.data.id,f.data.title,f.mapObject.getVisible());T.setDrawingMode(null)}));a=document.location.href;a=a.substring(0,a.lastIndexOf("/")+1);$('<link rel="stylesheet" type="text/css" href="'+(a+"css/google.maps.v3.all.min.css")+'" >').appendTo("head");
jc2cui.mapWidget.rendererReady()}function t(a,b){var c=[b],d;b.getAllContainers(c);$.each(c,function(b,c){if(c.internalId===a)return d=c,!1});d||(c=b.getAllFeatures(),$.each(c,function(b,c){if(c.internalId===a)return d=c,!1}));d||(c=b.getAllScreenOverlays(),$.each(c,function(b,c){if(c.internalId===a)return d=c,!1}));return d}function y(a,b,c,d){jc2cui.mapWidget.kmlParser.Container.call(this);this.name=a;this.wmsLayer=b;if(this.background=c)D.mapTypes.set(a,b),E.push(a),D.setOptions({mapTypeControlOptions:{mapTypeIds:E}}),
z[this.name]=this;d&&this.setVisible(!0,!0)}function x(b,c,d,f,k,l,g,n){g=u[b]||new a(b);var p=g.docs[c];n=p?p.visible:g.visible;var q=!1,r={alt:"Load "+d,getTileUrl:function(a,b){var e=D.getProjection(),c=Math.pow(2,b),d=new google.maps.Point(256*a.x/c,256*(a.y+1)/c),c=new google.maps.Point(256*(a.x+1)/c,256*a.y/c),d=e.fromPointToLatLng(d),e=e.fromPointToLatLng(c),h="",g=0>f.indexOf("?");$.each(k,function(a,b){g?(h="?",g=!1):h+="&";h+=a;h+="=";h+=b});e=q?d.lat()+","+d.lng()+","+e.lat()+","+e.lng():
d.lng()+","+d.lat()+","+e.lng()+","+e.lat();h+="&BBOX="+e;return f+h},isPng:!1,maxZoom:17,minZoom:1,name:d,tileSize:new google.maps.Size(256,256)},t={};k=k||{};$.each(k,function(a,b){t[a.toUpperCase()]=b});k=t;k.SERVICE="WMS";k.REQUEST="GetMap";k.VERSION=k.VERSION||"1.1.1";"1.1.1"===k.VERSION||"1.1.0"===k.VERSION||"1.0.0"===k.VERSION?k.SRS="EPSG:4326":(q=!0,k.CRS="EPSG:4326");k.FORMAT=k.FORMAT||"image/png";k.TRANSPARENT=k.TRANSPARENT||"TRUE";k.STYLES=k.STYLES||"";k.BGCOLOR=k.BGCOLOR||"0xFFFFFF";k.WIDTH=
"256";k.HEIGHT="256";r=new google.maps.ImageMapType(r);p&&p.remove();l=new y(d,r,l,n);l.featureId=c;l.internalId=c;l.overlayId=b;l.name=d;g.docs[c]=l;jc2cui.mapWidget.addTreeItems({title:l.name||l.featureId,key:l.featureId,isFeature:!0,select:n},b)}function F(a){a=Math.round(Math.log(352E5/a)/Math.log(2));if(0>a)a=0;else if(21<a||Infinity===a)a=21;D.getZoom()!==a&&D.setZoom(a)}function B(a,b){void 0!==b&&null!==b&&F("auto"===b?0:b);D.getCenter().equals(a)||D.panTo(a)}function M(a){var b=U.getProjection(),
c=b.fromLatLngToContainerPixel(a.getSouthWest());a=b.fromLatLngToContainerPixel(a.getNorthEast());return new google.maps.Point(Math.abs(c.y-a.y),Math.abs(c.x-a.x))}function L(a,b){a.isEmpty()||("auto"===b?D.getBounds().equals(a)||(D.fitBounds(a),google.maps.event.addListenerOnce(D,"bounds_changed",function(){var b;var c=D.getBounds();b=M(a);var d=M(c);0===Math.floor(b.x)||0===Math.floor(b.y)?b=0:(c=d.x/b.x,b=d.y/b.y,b=c<b?c:b,b=1>b?0:Math.floor(Math.log(b)/Math.log(2)));0<b&&D.setZoom(D.getZoom()+
b)})):B(a.getCenter(),b))}function I(a,b){var c;a.viewer?B(new google.maps.LatLng(a.viewer.latitude,a.viewer.longitude),"auto"===b?a.viewer.altitude:b):(c=new google.maps.LatLngBounds,a.extendBounds(c),L(c,b))}function J(b,c,d,f,k,l,g,n,p){var q,r,t;try{q=u[b]||new a(b),t=q.docs[c],r=jc2cui.mapWidget.kmlParser.loadKml(k,t?t.visible:q.visible,null,function(a){t&&t.remove();a.error||l&&I(r,"auto")},null,null,g),r.featureId=c,r.overlayId=b,r.name=d,q.docs[c]=r}catch(v){b="Failed to plot KML.",v&&(b+=
": "+v),jc2cui.mapWidget.error({sender:n?n.id:"",type:"map.feature.plot",msg:p,error:b})}}function G(b,c,d,f,k,l,g,n){var p,q,r;try{p=u[b]||new a(b),r=p.docs[c],q=jc2cui.mapWidget.kmlParser.parseKmlString(f,r?r.visible:p.visible,null,function(a){r&&r.remove();a.error||k&&I(q,"auto")},l),q.featureId=c,q.overlayId=b,q.name=d,p.docs[c]=q}catch(t){b="Failed to plot KML.",t&&(b+=": "+t),jc2cui.mapWidget.error({sender:g?g.id:"",type:"map.feature.plot",msg:n,error:b})}}function N(a,b){var c=u[b],d;c&&$.each(c.docs,
function(b,c){d=t(a,c);return!d});return d}function Y(a){var b=u[a.overlayId],c,d,f;if(b){if(c=b.features[a.selectedId])switch(c.data.type){case "marker":d=c.mapObject.getPosition();break;case "line":case "shape":f=new google.maps.LatLngBounds,c.mapObject.getPath().forEach(function(a,b){f.extend(a)}),d=f.getCenter()}else a.selectedId&&0<a.selectedId.length&&$.each(b.docs,function(b,d){var f=d.getAllFeatures();$.each(f,function(b,d){if(d.id===a.selectedId)return c=d,!1});return!c}),!c&&(a.selectedName&&
0<a.selectedName.length)&&$.each(b.docs,function(b,d){var f=d.getAllFeatures();$.each(f,function(b,d){if(d.name===a.selectedName)return c=d,!1});return!c}),c&&(f=new google.maps.LatLngBounds,c.extendBounds(f),f.isEmpty()||(d=f.getCenter()));c?d?B(d):console.log("maps V3 configured map widget unable to determine location of selected item with id "+a.selectedId+" and name "+a.selectedName):console.log("maps V3 configured map widget unable to find selected item with id "+a.selectedId+" and name "+a.selectedName)}else console.log("maps V3 configured map widget unable to find overlay "+
a.overlayId+" for selected item with id "+a.selectedId+" and name "+a.selectedName)}function Z(a,b,c){a=u[a];var d=!1;a&&$.each(a.docs,function(a,e){var f=e.getAllContainers();$.each(f,function(a,e){if(e.internalId===b)return e.open=c,d=!0,!1});return!d})}var D,E,S,P,z={},u={},O,w,R,V,ca,T,aa=!1,K={marker:0,shape:0,line:0},U,W={},Q,X=-1,H=1E3;a.prototype.setVisibility=function(a){this.visible=a;$.each(this.docs,function(b,c){c.setVisible(a,!0)});$.each(this.features,function(b,c){c.mapObject.setMap(a?
D:null);!a&&(jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===c.data.id)&&jc2cui.mapWidget.infoWindow.close()});$.each(this.children,function(b,c){c.setVisibility(a)})};a.prototype.remove=function(){delete u[this.id];this.parent&&delete this.parent.children[this.id];$.each(this.docs,function(a,b){b.remove()});$.each(this.features,function(a,b){b.mapObject.setMap(null);jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===b.data.id&&
jc2cui.mapWidget.infoWindow.close()});$.each(this.children,function(a,b){b.remove()})};a.prototype.bounds=function(){var a=new google.maps.LatLngBounds;$.each(this.features,function(b,d){var f=c(d);f.isEmpty()||(a.isEmpty()?a=f:a.union(f))});$.each(this.docs,function(b,c){c.extendBounds(a)});$.each(this.children,function(b,c){var d=c.bounds();d&&!d.isEmpty()&&(a.isEmpty()?a=d:a.union(d))});return a};y.prototype=new jc2cui.mapWidget.kmlParser.Container(null,!0);y.prototype.remove=function(){this.background?
(delete z[this.name],D.mapTypes.set(this.name,null),E.splice($.inArray(this.name,E),1),D.setOptions({mapTypeControlOptions:{mapTypeIds:E}}),D.getMapTypeId()===this.name&&D.setMapTypeId(P)):this.setVisible(!1,!0)};y.prototype.setVisible=function(a,b){if(this.visible!==a)if(this.visible=a,b&&(this.visibility=a),this.background)a?D.setMapTypeId(this.name):D.getMapTypeId()===this.name&&D.setMapTypeId(P);else if(a)D.overlayMapTypes.push(this.wmsLayer);else{var c=this,d;D.overlayMapTypes.forEach(function(a,
b){a===c.wmsLayer&&(d=b)});void 0!==d&&D.overlayMapTypes.removeAt(d)}};return{init:function(a){w=a.proxy;R=a.constraints?a.constraints.maxFileSize:void 0;V=a.constraints?a.constraints.maxPlacemarks:void 0;ca=a.sidebar&&a.sidebar.drawing;a=(a.server||"https://maps.googleapis.com/maps/api/js")+"?v=3&sensor=false&callback=mapsLoaded&libraries=geometry";ca&&(a+=",drawing");$.ajax({url:a,dataType:"script",timeout:2E4,error:function(a,b,c){a="Error initializing Google Maps";b&&"error"!==b&&(a+=": "+b);
jc2cui.mapWidget.showError(a)}})},createOverlay:function(b,c,d){if(!u[b.overlayId]){var f;b.parentId&&((f=u[b.parentId])||console.log("maps V3 configured map widget unable to find parent overlay with id "+b.parentId));return new a(b.overlayId,f,b.clustering)}},removeOverlay:function(a,b,c){var d=u[a];d?(d.remove(),delete W[a]):jc2cui.mapWidget.error({sender:b?b.id:"",type:"removeOverlay",msg:c,error:"No overlay with id "+a+" found to remove."})},setOverlayVisibility:function(a,b,c,d){var f=u[a];f?
f.setVisibility(b):jc2cui.mapWidget.error({sender:c?c.id:"",type:"map.overlay."+(b?"show":"hide"),msg:d,error:"No overlay with id "+a+" found to "+(b?"show.":"hide.")})},isOverlayVisible:function(a){a=(a=u[a])?a.visible:!1;return a},updateOverlay:function(a,b,c){b=u[a.overlayId];var d,f;if(!b)return!1;a.clustering&&(b.clustering=a.clustering,f=!0);a.parentId&&((c=u[a.parentId])||console.log("maps V3 configured map widget unable to find parent overlay with id "+a.parentId),d=b.parent,d!==c&&(a=jc2cui.mapWidget.clusterManager.getClusterer(b),
d&&delete d.children[b.id],b.parent=c,c.children[b.id]=b,b=jc2cui.mapWidget.clusterManager.getClusterer(b),a!==b&&(f=!0)));f&&(jc2cui.mapWidget.clusterManager.setClustering(!1),jc2cui.mapWidget.clusterManager.setClustering(!0));return!0},loadKml:function(a,b,c){J(a.overlayId,a.featureId,a.name||a.featureName||a.url,a.proxy,a.url,a.zoom,a.clustering,b,c)},loadWms:function(a,b,c){x(a.overlayId,a.featureId,a.name||a.featureName||a.url,a.url,a.params,a.background,b,c)},parseKml:function(a,b,c){G(a.overlayId,
a.featureId,a.name||a.featureName||"kml",a.feature,a.zoom,a.clustering,b,c)},removeFeature:function(a,b,c){var d=u[a.overlayId],f,k=!1;d?(d.features[a.featureId]&&(d.features[a.featureId].mapObject.setMap(null),delete d.features[a.featureId],k=!0,jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===a.featureId&&jc2cui.mapWidget.infoWindow.close()),!k&&(f=d.docs[a.featureId])&&(f.remove(),delete d.docs[a.featureId],k=!0),k||jc2cui.mapWidget.error({sender:b?b.id:"",
type:"map.feature.remove",msg:c,error:"Unable to find kml "+a.featureId+" in overlay "+a.overlayId})):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.unplot",msg:c,error:"Unable to find overlay "+a.overlayId})},updateFeature:function(a,b,c,d){c=u[a.overlayId];var f,k,g;a.clustering&&(f=!0);if(!c)return b.push("Unable to find overlay "+a.overlayId),!1;k=c.docs[a.featureId];if(!k)return b.push("Unable to find feature "+a.featureId+" in overlay "+a.overlayId),!1;if(a.newOverlayId&&a.newOverlayId!==
a.overlayId){f||(g=jc2cui.mapWidget.clusterManager.getClusterer(k));d=u[a.newOverlayId];if(!d)return b.push("Unable to find overlay "+a.newOverlayId),!1;k.overlayId=a.newOverlayId;d.docs[a.featureId]=k;delete c.docs[a.featureId];k.clustering=a.clustering;f||(a=jc2cui.mapWidget.clusterManager.getClusterer(k),g!==a&&(f=!0))}else f&&(k.clustering=a.clustering);f&&(jc2cui.mapWidget.clusterManager.setClustering(!1),jc2cui.mapWidget.clusterManager.setClustering(!0));return!0},showFeature:function(a,b,c){var d=
u[a.overlayId],f=!1;d?(d.features[a.featureId]&&(d.features[a.featureId].mapObject.setMap(D),f=!0),!f&&(d=d.docs[a.featureId])&&(d.setVisible(!0,!0),f=!0),f||jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.show",msg:c,error:"No feature with id "+a.featureId+" found to show."})):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.show",msg:c,error:"No overlay with id "+a.overlayId+" found."})},hideFeature:function(a,b,c){var d=u[a.overlayId],f=!1;d?(d.features[a.featureId]&&(d.features[a.featureId].mapObject.setMap(null),
f=!0,jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===a.featureId&&jc2cui.mapWidget.infoWindow.close()),!f&&(d=d.docs[a.featureId])&&(d.setVisible(!1,!0),f=!0),f||jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.hide",msg:c,error:"No feature with id "+a.featureId+" found to hide."})):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.hide",msg:c,error:"No overlay with id "+a.overlayId+" found."})},showItem:function(a){var b=N(a.itemId,a.overlayId);
b&&(b.setVisible(!0,!0),a.zoom&&(a=new google.maps.LatLngBounds,b.extendBounds(a),L(a)))},hideItem:function(a){(a=N(a.itemId,a.overlayId))&&a.setVisible(!1,!0)},centerOnOverlay:function(a,b,c){var d=a.overlayId;a=a.zoom;var f=u[d];f?L(f.bounds(),a):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.view.center.overlay",msg:c,error:"Unable to find overlay "+d})},centerOnFeature:function(a,b,d){a:{var f=u[a.overlayId],k,l;if(f){if(k=f.features[a.featureId])b=c(k),L(b,a.zoom),a.select&&(l={selectedId:k.data.id||
void 0,selectedName:k.data.title||void 0,featureId:a.featureId,overlayId:a.overlayId});else{k=f.docs[a.featureId];if(!k){jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.view.center.feature",msg:d,error:"Unable to find feature "+a.featureId});break a}I(k,a.zoom);a.select&&a.overlayId===jc2cui.mapWidget.USER_DRAWN_OVERLAY&&(l={selectedId:a.featureId||void 0,selectedName:k.features.length?k.features[0].name||void 0:void 0,featureId:a.featureId,overlayId:a.overlayId})}l&&jc2cui.mapWidget.itemSelected(l)}else jc2cui.mapWidget.error({sender:b?
b.id:"",type:"map.view.center.feature",msg:d,error:"Unable to find overlay "+a.overlayId})}},centerOnItem:function(a){var b=N(a.itemId,a.overlayId);if(b&&(I(b,a.zoom),a.select)){for(a=b.parent;a.parent;)a=a.parent;b={selectedId:b.id||void 0,selectedName:b.name||void 0,featureId:a.featureId,overlayId:a.overlayId};jc2cui.mapWidget.itemSelected(b)}},centerOnLocation:function(a,b,c){b=new google.maps.LatLng(a.location.lat,a.location.lon);B(b,a.zoom)},fitToBounds:function(a){L(a,"auto")},centerOnBounds:function(a,
b,c){b=new google.maps.LatLng(a.bounds.southWest.lat,a.bounds.southWest.lon);c=new google.maps.LatLng(a.bounds.northEast.lat,a.bounds.northEast.lon);b=new google.maps.LatLngBounds(b,c);L(b,a.zoom)},zoomToRange:function(a,b,c){F(a.range)},selected:function(a,b,c){Y(a)},getViewStatus:function(a,b,c){return f(a,b,c)},getDropLocation:function(){return{lat:O.lat(),lon:O.lng()}},checkResize:function(){D&&google.maps.event.trigger(D,"resize")},setDrawingToolsVisibility:function(a){q(a)},setExpanded:function(a,
b,c){Z(a,b,c)},optionChanged:function(a,b){"labels"===a?$.each(u,function(a,b){$.each(b.docs,function(a,b){var c=[b];b.getAllContainers(c);$.each(c,function(a,b){b.markerOverlay&&b.markerOverlay.redraw(!0)})})}):"clustering"===a&&jc2cui.mapWidget.clusterManager.setClustering(b)},mapsReady:function(){A()},info:function(){var a=0;$.each(u,function(b,c){++a});return{name:"Google Maps V3",type:"2D",entities:jc2cui.mapWidget.kmlParser.getEntitiesString(a)}}}}();
