util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.kmlParser=function(){function t(){if(void 0===R){var k=document.createElement("x"),a=document.documentElement,d=window.getComputedStyle;void 0===k.style.pointerEvents?R=!1:(k.style.pointerEvents="auto",k.style.pointerEvents="x",a.appendChild(k),d=d&&"auto"===d(k,"").pointerEvents,a.removeChild(k),R=!!d)}return R}function g(k,a,d,n){if(0===k&&void 0!==U)n(U);else if(1===k&&void 0!==M)n(M);else if(V)setTimeout(function(){g(k,a,d,n)},1E3);else{V=!0;"function"===typeof a&&(a=a());var B=
$("<div>"+a+'<br><br><div><input type="checkbox" id="global">Dont show again, apply to all overlays<br></div>'),b=$(window),f=b.innerHeight(),b=b.innerWidth();B.dialog({preferredHeight:220,preferredWidth:300,height:Math.min(220,f-20),width:Math.min(300,b-20),modal:!1,title:d,buttons:{Yes:function(){B.dialog("close");n(!0,$("#global",B).is(":checked"))},No:function(){B.dialog("close");n(!1,$("#global",B).is(":checked"))}},close:function(k,a){V=!1;B.remove()}})}}function a(k){var a=$(u.container),d=
$('<img class="screenOverlay" src='+k.href+">"),n,B=!1,b=this;this.visibility=k.visibility;this.visible=k.visible;this.name=k.name;this.placer=function(){return function(){var f={},e=0,c=0,u,q,C=d[0].height,K=d[0].width,I=k.overlayXY.x,p=k.overlayXY.y;k.screenXY&&(q=a.height(),u=a.width(),e=k.screenXY.x,c=k.screenXY.y,"insetPixels"===k.screenXY.xunits?e=u-e-K:"fraction"===k.screenXY.xunits&&(e*=u),"pixels"===k.screenXY.yunits?c=q-c:"fraction"===k.screenXY.yunits&&(c=q*(1-c)));k.sizeXY&&(0<k.sizeXY.x&&
("pixels"===k.sizeXY.xunits?K=k.sizeXY.x:"fraction"===k.sizeXY.xunits&&(u=u||a.width(),K=u*k.sizeXY.x)),0<k.sizeXY.y&&("pixels"===k.sizeXY.yunits?C=k.sizeXY.y:"fraction"===k.sizeXY.yunits&&(q=q||a.height(),C=q*k.sizeXY.y)),0===k.sizeXY.x&&0!==k.sizeXY.y&&(u=d[0].width/d[0].height,K=C*u),0===k.sizeXY.y&&0!==k.sizeXY.x&&(u=d[0].width/d[0].height,C=K/u),K&&(f.width=K),C&&(f.height=C));k.overlayXY&&("pixels"===k.overlayXY.xunits?I=-I:"insetPixels"===k.overlayXY.xunits?I=-(K-I):"fraction"===k.overlayXY.xunits&&
(I*=-K),"pixels"===k.overlayXY.yunits?p=-C+p:"insetPixels"===k.overlayXY.yunits?p=-p:"fraction"===k.overlayXY.yunits&&(p=-C*(1-p)),e+=I,c+=p);0!==e&&(f.left=e+"px");0!==c&&(f.top=c+"px");d.css(f);n&&n.css(f);k.rotation&&!B&&(B=!0,k.rotation=0>k.rotation?-k.rotation:360-k.rotation,d.rotate(k.rotation));b.visible||b.setVisible(!1);d.css("opacity",1)}}();d.css("opacity",0);d.load(this.placer);this.image=d.appendTo(a);t()||(n=$('<span class="screenOverlay"></span>'),n.css({"background-color":"#F5F5F5",
opacity:0.3,"z-index":0}),this.mask=n.appendTo(a));this.internalId="a"+(++ha).toString()}function c(k){this.internalId="a"+(++ha).toString();this.parent=k;this.features=[]}function e(k,a){a||++J;this.internalId="a"+(++ha).toString();this.containers=[];this.features=[];this.screenOverlays=[];this.viewSensitiveFeatures=[];this.visibility=!0;k&&(this.parent=k,k.containers.push(this),k.maintainState&&(this.maintainState=!0,this.idMap={},this.nameMap={}),this.loadMorePlacemarks=k.loadMorePlacemarks)}function h(k){return setTimeout(function(){k.features.length&&
k.features[0].refreshIcon(k)},k.icon.viewRefreshTime)}function b(){e.apply(this,arguments);this.intervals=[];this.loaded=!1}function l(k){var a="",d;if(k)if(2===k.nodeType||3===k.nodeType||4===k.nodeType)a=k.nodeValue;else if(1===k.nodeType||9===k.nodeType||11===k.nodeType)for(d=0;d<k.childNodes.length;++d)a+=l(k.childNodes[d]);return $.trim(a)}function f(k,a){if(k){var d=k.getElementsByTagName(a);if(d.length)return l(d[0])}}function s(k,a){var d=l(k);return d.length?0!==parseInt(d,10):a||!1}function p(k,
a,d){return k&&(k=k.getElementsByTagName(a),k.length)?s(k[0],d):d}function m(k){var a={},d,n,B;if(1===k.nodeType||9===k.nodeType||11===k.nodeType){if(0<k.attributes.length)for(n=0;n<k.attributes.length;n++)d=k.attributes.item(n),a[d.nodeName]=l(d)}else if(2===k.nodeType||3===k.nodeType||4===k.nodeType)a=l(k);if(k.hasChildNodes())if(1!==k.childNodes.length||2!==k.childNodes[0].nodeType&&3!==k.childNodes[0].nodeType&&4!==k.childNodes[0].nodeType)for(n=0;n<k.childNodes.length;n++)B=k.childNodes.item(n),
3!==B.nodeType&&8!==B.nodeType&&(d=B.nodeName,B=m(B),a[d]?($.isArray(a[d])||(a[d]=[a[d]]),a[d].push(B)):a[d]=B);else a=l(k.childNodes[0]);return a}function E(k){return{x:parseFloat(k.getAttribute("x")),y:parseFloat(k.getAttribute("y")),xunits:k.getAttribute("xunits"),yunits:k.getAttribute("yunits")}}function A(k){var a=parseFloat(f(k,"altitude")),d=f(k,"altitudeMode"),n=parseFloat(f(k,"range"));isNaN(n)?isNaN(a)&&(a=0):a=n;d&&d.length||(d="relativeToGround");return{latitude:parseFloat(f(k,"latitude")),
longitude:parseFloat(f(k,"longitude")),altitude:a,altitudeMode:d,range:n}}function w(k){if(k.childNodes.length)return k={latLonAltBox:{north:parseFloat(f(k,"north")),south:parseFloat(f(k,"south")),east:parseFloat(f(k,"east")),west:parseFloat(f(k,"west"))},lod:{minLodPixels:parseFloat(f(k,"minLodPixels")),maxLodPixels:parseFloat(f(k,"maxLodPixels"))||-1}},u.region?u.region(k):k}function x(k){k&&(this.href=f(k,"href"),this.refreshMode=f(k,"refreshMode"),this.viewRefreshMode=f(k,"viewRefreshMode"),this.viewFormat=
f(k,"viewFormat"),"onInterval"===this.refreshMode&&(this.interval=parseFloat(f(k,"refreshInterval"))),"onStop"===this.viewRefreshMode&&(this.viewRefreshTime=parseFloat(f(k,"viewRefreshTime")),isNaN(this.viewRefreshTime)&&(this.viewRefreshTime=4),this.viewRefreshTime*=1E3,this.viewFormat&&this.viewFormat.length||(this.viewFormat="BBOX=[bboxWest],[bboxSouth],[bboxEast],[bboxNorth]")))}function D(k,a){var d={},n,B,b,f;k=k||"ffffffff";n=k.substr(0,2);f=k.substr(2,2);b=k.substr(4,2);B=k.substr(6,2);d.opacity=
parseInt(n,16)/256;if("random"===a){n=[B,b,f];for(b=0;2>b;b++)f=Math.round(Math.random()*parseInt(B,16)).toString(16),1===f.length&&(f="0"+f),n[b]=f;B="#"+n[0]+n[1]+n[2]}else B="#"+B+b+f;d.color=B;return d}function y(k){var a={},d,n,B,b,e;n=k.getElementsByTagName("Style");for(d=0;d<n.length;d++)B=n[d],(b=B.getAttribute("id"))&&(a["#"+b]=m(B));n=k.getElementsByTagName("StyleMap");for(d=0;d<n.length;d++)if(B=n[d],b=B.getAttribute("id"))k=f(n[d],"key"),"normal"===k&&((k=f(n[d],"styleUrl"))?(B=k.indexOf("#"),
0<B?(e=k.substring(0,B),k=k.substring(B),r[e]&&(k=r[e][k])):(0>B&&(k="#"+k),k=a[k]),k?a["#"+b]=k:console.log("styleMap styleUrl of #"+b+" not found")):(k=n[d].getElementsByTagName("Style"),k.childNodes.length&&(a["#"+b]=m(k.childNodes[0]))));$.each(a,function(k,a){a.LineStyle&&a.LineStyle.color&&"string"===typeof a.LineStyle.color&&(a.LineStyle.color=D(a.LineStyle.color,a.LineStyle.colorMode));a.PolyStyle&&a.PolyStyle.color&&"string"===typeof a.PolyStyle.color&&(a.PolyStyle.color=D(a.PolyStyle.color,
a.PolyStyle.colorMode))});return a}function F(k){var a=[];k=k.getElementsByTagName("Schema");var d;for(d=0;d<k.length;d++)"Placemark"===k[d].getAttribute("parent")&&a.push(k[d].getAttribute("name"));return a}function H(k,a,d,n){return function(b){r[a]=b.doc?b.doc.styles:{};L(k,d+1,n)}}function L(k,a,d){for(var b=k.getElementsByTagName("styleUrl"),B,f,e;a<b.length;a++)if(B=l(b[a]),f=B.indexOf("#"),0<f&&0===B.indexOf("http")&&(B=B.substring(0,f),!r[B])){e=n(B,!1,null,H(k,B,a,d),null,null,!0);break}e||
d()}function O(k){var a,d=[],n;k=k.replace(/,\s+/g,",");k=k.split(/\s+/g);for(n=0;n<k.length;n++)a=k[n].split(","),1<a.length&&d.push({lon:parseFloat(a[0]),lat:parseFloat(a[1]),alt:parseFloat(a[2])});return d}function G(k,a,d,n){var b=new c(a),e,h=[],g=[],s=[],z,q,C,K,I,ba;b.id=k.getAttribute("id");b.name=f(k,"name");b.description=f(k,"description");b.styleUrl=f(k,"styleUrl");e=k.getElementsByTagName("Style");e.length&&(b.style=m(e[0]),b.style.LineStyle&&b.style.LineStyle.color&&"string"===typeof b.style.LineStyle.color&&
(b.style.LineStyle.color=D(b.style.LineStyle.color,b.style.LineStyle.colorMode)),b.style.PolyStyle&&b.style.PolyStyle.color&&"string"===typeof b.style.PolyStyle.color&&(b.style.PolyStyle.color=D(b.style.PolyStyle.color,b.style.PolyStyle.colorMode)));b.styleUrl&&(e=b.styleUrl.indexOf("#"),0<e?(q=b.styleUrl.substring(0,e),e=b.styleUrl.substring(e),r[q]&&(e=r[q][e])):(0>e&&(b.styleUrl="#"+b.styleUrl),e=n.styles[b.styleUrl]),b.style=b.style?$.extend(!0,{},e,b.style):e);e=k.getElementsByTagName("Region");
e.length&&(b.region=w(e[0]));e=k.getElementsByTagName("Point");for(z=0;z<e.length;z++){if(n.removed)return;(C=f(e[z],"coordinates"))&&h.push(O(C))}e=k.getElementsByTagName("LineString");for(z=0;z<e.length;z++){if(n.removed)return;(C=f(e[z],"coordinates"))&&g.push(O(C))}e=k.getElementsByTagName("LinearRing");for(z=0;z<e.length;z++){if(n.removed)return;"outerBoundaryIs"!==e[z].parentNode.nodeName&&"innerBoundaryIs"!==e[z].parentNode.nodeName&&(C=f(e[z],"coordinates"))&&(C[C.length-1].lat===C[0].lat&&
C[C.length-1].lon===C[0].lon||C.push(C[0]),g.push(O(C)))}e=k.getElementsByTagName("Polygon");for(z=0;z<e.length;z++){if(n.removed)return;I=[];K=e[z].getElementsByTagName("outerBoundaryIs");C=f(K[0],"coordinates");I.push(O(C));K=e[z].getElementsByTagName("innerBoundaryIs");for(q=0;q<K.length;q++)C=f(K[q],"coordinates"),I.push(O(C));s.push(I)}q=k.getElementsByTagName("Camera");q.length?q=A(q[0]):(q=k.getElementsByTagName("LookAt"),q=q.length?A(q[0]):void 0);b.viewer=q;a&&(a.features.push(b),b.region&&
a.viewSensitiveFeatures.push(b),a.maintainState&&(b.id?(d&&(ba=d.idMap[b.id]),a.idMap[b.id]=b):b.name&&(d&&(ba=d.nameMap[b.name]),a.nameMap[b.name]=b)));e=k.getElementsByTagName("ExtendedData");if(e.length){d=e[0].getElementsByTagName("Data");e={};if(d.length)for(q=0;q<d.length;q++)z=d[q].getAttribute("name"),C=l(d[q].getElementsByTagName("value")[0]),e[z]=C;b.extendedData=e}ba&&(b.visibility=ba.visibility);void 0===b.visibility&&(b.visibility=p(k,"visibility",!0));b.visibility=b.visibility&&a.visibility;
b.visible=b.visibility&&(!b.region||u.isRegionActive&&u.isRegionActive(b.region));if(u.marker)for(q=0;q<h.length;q++){if(n.removed)return;(k=u.marker(b,h[q][0],n))&&b.features.push(k)}if(u.polyline)for(q=0;q<g.length;q++){if(n.removed)return;(k=u.polyline(b,g[q],n))&&b.features.push(k)}if(u.polygon)for(q=0;q<s.length;q++){if(n.removed)return;(k=u.polygon(b,s[q],n))&&($.isArray(k)?$.merge(b.features,k):b.features.push(k))}ba&&jc2cui.mapWidget.infoWindow&&jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().internalId===
ba.internalId&&u.refreshInfoWindow&&u.refreshInfoWindow(b);J+=Math.max(1,b.features.length)}function P(k,d,b,n){var e={name:f(k,"name"),id:k.getAttribute("id"),parent:d},c=k.getElementsByTagName("Icon"),z=k.getElementsByTagName("screenXY"),h=k.getElementsByTagName("overlayXY"),r=k.getElementsByTagName("size"),m=k.getElementsByTagName("rotation");z&&z.length&&(e.screenXY=E(z[0]));h&&h.length&&(e.overlayXY=E(h[0]));r&&r.length&&(e.sizeXY=E(r[0]));c&&c.length&&(e.href=f(c[0],"href"));m&&m.length&&(e.rotation=
parseFloat(l(m[0])));d&&d.maintainState&&(e.id?b&&b.idMap[e.id]&&(e.visibility=b.idMap[e.id].visibility):e.name&&(b&&b.nameMap[e.name])&&(e.visibility=b.nameMap[e.name].visibility));void 0===e.visibility&&(e.visibility=p(k,"visibility",!0));e.visible=e.visibility&&(!d||d.visibility);e=u.screenOverlay?u.screenOverlay(e,n):new a(e);++J;d&&(d.screenOverlays.push(e),d.maintainState&&(e.id?d.idMap[e.id]=e:e.name&&(d.nameMap[e.name]=e)))}function ca(k,a,d,b){var n=new c(a),e=f(k,"color"),l;n.latLonBox=
{north:parseFloat(f(k,"north")),east:parseFloat(f(k,"east")),south:parseFloat(f(k,"south")),west:parseFloat(f(k,"west"))};n.opacity=0.5;n.id=k.getAttribute("id");n.name=f(k,"name");l=k.getElementsByTagName("Icon");n.icon=l.length?new x(l[0]):new x;e&&(n.opacity=D(e).opacity);e=k.getElementsByTagName("Region");e.length&&(n.region=w(e[0]));a&&(a.features.push(n),(n.region||"onStop"===n.icon.viewRefreshMode||"onRequest"===n.icon.viewRefreshMode)&&a.viewSensitiveFeatures.push(n),a.maintainState&&(n.id?
(d&&d.idMap[n.id]&&(n.visibility=d.idMap[n.id].visibility),a.idMap[n.id]=n):n.name&&(d&&d.nameMap[n.name]&&(n.visibility=d.nameMap[n.name].visibility),a.nameMap[n.name]=n)));void 0===n.visibility&&(n.visibility=p(k,"visibility",!0));n.visible=n.visibility&&(!a||a.visibility)&&(!n.region||u.isRegionActive&&u.isRegionActive(n.region));u.groundOverlay&&n.features.push(u.groundOverlay(n,b));++J;return n}function da(a,d,e,c){var l=new b(d),z=a.getElementsByTagName("Link"),h;z.length?l.link=new x(z[0]):
(z=a.getElementsByTagName("Url"),z.length&&(l.link=new x(z[0])));l.link||(l.link=new x);l.maintainState=!p(a,"refreshVisibility",!1);l.visibility=d.visibility&&p(a,"visibility",!0);l.visible=l.visibility&&d.visibility;l.open=p(a,"open",!1);l.id=a.getAttribute("id");l.name=f(a,"name");l.name&&l.name.length||(l.name=l.link.href);d.maintainState&&(e&&(h=e.containers[0]),h&&(l.visibility=h.visibility,l.open=h.open));z=a.getElementsByTagName("Region");z.length&&(l.region=w(z[0]));!l.region||u.isRegionActive&&
u.isRegionActive(l.region)?(++c.remaining,l.loaded=!0,l.loading=!0,l.loadedDoc=n(l.link.getHref(),l.visible,l,function(a){--c.remaining;!c.remaining&&c.initialParseCompleteCallback&&c.initialParseCompleteCallback({doc:c});a=l.loadedDoc||a.doc;l.loadLargeFile=a.loadLargeFile;l.loadMorePlacemarks=a.loadMorePlacemarks;l.loading=!1}),l.loadedDoc.visibility=l.visibility,"onInterval"===l.link.refreshMode&&l.link.interval&&l.intervals.push(setInterval(function(){if(!l.loading){l.loading=!0;var a=n(l.link.getHref(),
l.loadedDoc.visible,l,function(k){var d=a||k.doc;l.loading=!1;l.loadedDoc.remove();for(k=0;k<l.containers.length;k++)if(l.containers[k]===l.loadedDoc){l.containers.splice(k,1);l.loadedDoc=d;break}l.loadLargeFile=d.loadLargeFile;l.loadMorePlacemarks=d.loadMorePlacemarks},null,l.loadedDoc);a.visibility=l.loadedDoc.visibility}},1E3*l.link.interval))):l.visible=!1}function ea(a,d,n,b,e,f){return function(){v(a,d,n,b,e,f)}}function v(a,d,n,b,f,c){++Q;if(Y)setTimeout(function(){--Q;v(a,d,n,b,f,c)},10*Q);
else{--Q;Y=!0;var p,z,h,r,q,C,K,I;c=c||0;try{for(p=c;p<a.childNodes.length&&p<c+100;p++){if(b.removed){Y=!1;return}h=a.childNodes.item(p);r=h.nodeName;if("kml"===r){C=!0;v(h,d,n,b,f);break}if("Document"===r||"Folder"===r){q=new e(d);q.type=r;q.visible=d.visibility;q.visibility=d.visibility;q.id=h.getAttribute("id");if(d.maintainState){if("Document"===q.type)n&&(I=n.containers[0]);else if(q.id)n&&n.idMap[q.id]&&(I=n.idMap[q.id]),d.idMap[q.id]=q;else for(z=0;z<h.childNodes.length;z++)if(K=h.childNodes.item(z),
"name"===K.nodeName){q.name=l(K);n&&n.nameMap[q.name]&&(I=n.nameMap[q.name]);d.nameMap[q.name]=q;break}I&&(q.visibility=I.visibility,q.open=I.open)}C=!0;v(h,q,I,b,ea(a,d,n,b,f,p+1));break}if("NetworkLink"===r)da(h,d,n,b);else if("Placemark"===r||-1<$.inArray(r,b.placemarkNames))G(h,d,n,b);else if("ScreenOverlay"===r)P(h,d,n,b);else if("GroundOverlay"===r)ca(h,d,n,b);else if("Region"===r){if(q=w(h,b))d.region=q,d.visible=d.visible&&d.visibility&&u.isRegionActive(d.region)}else if("visibility"===r)d.visibility=
d.visibility&&s(h,!0),d.visible=d.visible&&d.visibility&&(!d.region||u.isRegionActive(d.region));else if("name"===r)d.name=l(h);else if("open"===r)void 0===d.open&&(d.open=s(h,!1));else if("LookAt"===r||"Camera"===r)d.viewer=A(h),d.parent&&(d.parent.overlayId&&!d.parent.viewer)&&(d.parent.viewer=d.viewer)}}catch(m){console.log(m)}Y=!1;C||(p<a.childNodes.length?setTimeout(function(){v(a,d,n,b,f,p)},1):(f&&f({doc:b}),d===b&&(b.parseCompleteCallback&&b.parseCompleteCallback({doc:b}),u.parseCallback&&
u.parseCallback(b),--b.remaining,!b.remaining&&b.initialParseCompleteCallback&&b.initialParseCompleteCallback({doc:b}))))}}function S(a,d,n,b,e){d.fileSize&&(T+=d.fileSize);e&&(r[e]=r[e]||{});L(a,0,function(){d.styles=y(a);if(b)d.parseCompleteCallback({doc:d});else{d.placemarkNames=F(a);if(!d.loadMorePlacemarks&&!M){var e=0,f,c,l;c=d.placemarkNames.slice();c.push("Placemark");c.push("ScreenOverlay");c.push("GroundOverlay");c.push("NetworkLink");c.push("Document");c.push("Folder");for(f=0;f<c.length;f++)e+=
a.getElementsByTagName(c[f]).length;if(e+J>u.maxPlacemarks){f=[];for(c=d;c;)c.name&&c.name.length&&f.push(c.name),c=c.parent;f.reverse();l=f.join("/");g(1,function(){var d=["Overlay "];d.push(l);d.push(" contains approximately ");d.push(e);d.push(" entities. There are currently approximately ");d.push(J);d.push(" entities already loaded. ");d.push("Loading the additional entities may cause the browser to become unresponsive. Continue loading anyway?");return d.join("")},"Warning - Large Number Of Entities",
function(e,q){q&&(M=e);(d.loadMorePlacemarks=e)?v(a,d,n,d):(T-=d.fileSize,d.fileSize=0,--J,d.name=d.name||"",d.name+=" - LOAD CANCELED",d.parseCompleteCallback&&d.parseCompleteCallback({error:"canceled",doc:d}),!b&&u.parseCallback&&u.parseCallback(d))});return}}v(a,d,n,d)}})}function W(d){return 1048576>d?(d/1024).toFixed(2)+"kB":(d/1048576).toFixed(2)+"MB"}function n(d,a,b,f,c,l,p,h,r){var z;z=u.proxy.length?encodeURIComponent(d):d;var q=J,C;r=r||new e(b);r.remaining=1;r.parseCompleteCallback=f;
r.initialParseCompleteCallback=c;r.visibility=r.visible=a;r.clustering=h;l&&(r.open=l.open,r.loadLargeFile=r.loadLargeFile||l.loadLargeFile,r.loadMorePlacemarks=r.loadMorePlacemarks||l.loadMorePlacemarks);if(u.maxPlacemarks<q&&(!M&&!r.loadMorePlacemarks)&&(l&&(q-=l.getAllFeatures().length),u.maxPlacemarks<q)){if(void 0===r.loadMorePlacemarks){z=[];for(q=r;q;)q.name&&q.name.length&&z.push(q.name),q=q.parent;z.reverse();C=z.join("/");g(1,function(){var q=["There are currently approximately "];q.push(J);
q.push(" entities loaded. ");l?q.push("Reloading overlay "):q.push("Loading additional entities included in overlay ");q.push(C);q.push(" may cause the browser to become unresponsive. Continue loading anyway?");return q.join("")},"Warning - Large Number Of Entities",function(q,e){e&&(M=q);(r.loadMorePlacemarks=q)?n(d,a,b,f,c,l,p,h,r):(r.name=r.name||"",r.name+=" - LOAD CANCELED",f&&f({error:"canceled",doc:r}),!p&&u.parseCallback&&u.parseCallback(r))})}else r.parseCompleteCallback({error:"canceled",
doc:r}),!p&&u.parseCallback&&u.parseCallback(r);return r}if(Z>=N)return++fa,setTimeout(function(){--fa;r.removed||n(d,a,b,f,c,l,p,h,r)},500+10*fa),r;++Z;z=$.ajax({dataType:"xml",url:u.proxy+z});z.done(function(q,a,b){var n,e,C,c;--Z;if(!r.removed){r.fileSize=b.responseText.length;a=l?l.loadLargeFile:U;if(!a){C=T+b.responseText.length;if(l)for(e=[l],l.getAllContainers(e),c=0;c<e.length;c++)e[c].fileSize&&(C-=e[c].fileSize);if(C>1048576*u.maxFileSize){if(void 0===a){a=[];for(e=r;e;)e.name&&e.name.length&&
a.push(e.name),e=e.parent;a.reverse();n=a.join("/");g(0,function(){var q=["Overlay "];q.push(n);q.push(" is ");q.push(W(b.responseText.length));q.push(". After loading it, total loaded data will be ");q.push(W(C));q.push(". Loading so much data may cause the browser to become unresponsive. Load it anyway?");return q.join("")},"Warning - Large File Size",function(a,b){b&&(U=a);(r.loadLargeFile=a)?S(q,r,l,p,d):(r.fileSize=0,--J,r.name=r.name||"",r.name+=" - LOAD CANCELED",f&&f({error:"canceled",doc:r}),
!p&&u.parseCallback&&u.parseCallback(r))});return}if(!a){r.fileSize=0;--J;f&&f({error:"canceled",doc:r});!p&&u.parseCallback&&u.parseCallback(r);return}}}S(q,r,l,p,d)}});z.fail(function(q,a,b){--Z;r.name=r.name||"";r.name+=" - LOAD FAILED";console.log("Failed to load "+d+" - "+a);f&&f({error:a,doc:r});!p&&u.parseCallback&&u.parseCallback(r)});return r}function d(a,b,n,e){var f,c,l,r;if((!a.name||!a.name.length)&&1>=a.containers.length&&!a.features.length&&!a.screenOverlays.length){f=[];for(c=0;c<
a.containers.length;c++)if(r=d(a.containers[0],b,n,e))if($.isArray(r))for(l=0;l<r.length;l++)f.push(r[l]);else f.push(r);return f}f={title:a.name||"[no name]",tooltip:"click to zoom to",key:a.parent?a.internalId:e,isFolder:!0,expand:a.open,select:a.visibility&&b,children:[]};a.parent||(f.isFeature=!0);for(c=0;c<a.containers.length;c++)if(r=d(a.containers[c],f.select,n))if($.isArray(r))for(l=0;l<r.length;l++)f.children.push(r[l]);else f.children.push(r);for(c=0;c<a.features.length;c++)b={title:a.features[c].name||
"[no name]",tooltip:"click to zoom to",key:a.features[c].internalId,select:a.features[c].visibility&&f.select},f.children.push(b);for(c=0;c<a.screenOverlays.length;c++)b={title:a.screenOverlays[c].name||"[no name]",tooltip:"click to zoom to",key:a.screenOverlays[c].internalId,select:a.screenOverlays[c].visibility&&f.select},f.children.push(b);return f}var z={proxy:"",maxFileSize:25,maxPlacemarks:75E3},u,r={},R,N=5,Z=0,fa=0,Y,Q=0,U,M,V,J=0,T=0,ha=0;a.prototype.remove=function(){this.image.remove();
this.mask&&this.mask.remove()};a.prototype.setVisible=function(a,d){var b;this.visible=a;if(d&&(this.visibility=a))for(b=this.parent;b&&!b.visibility;)b.visibility=!0,b=b.parent;a?(this.image.show(),this.mask&&this.mask.show()):(this.image.hide(),this.mask&&this.mask.hide())};a.prototype.extendBounds=function(a){};c.prototype.remove=function(){var a;this.removed=!0;for(a=0;a<this.features.length;a++)this.features[a].removeFromMap();jc2cui.mapWidget.infoWindow&&(jc2cui.mapWidget.infoWindow.getMapItem()&&
jc2cui.mapWidget.infoWindow.getMapItem().internalId===this.internalId)&&jc2cui.mapWidget.infoWindow.close();J-=Math.max(1,this.features.length)};c.prototype.setVisible=function(a,d){var b;this.visible=a;if(d&&(this.visibility=a))for(b=this.parent;b&&!b.visibility;)b.visibility=!0,b=b.parent;for(b=0;b<this.features.length;b++)this.features[b].setVisible(a);!a&&(jc2cui.mapWidget.infoWindow&&jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().internalId===this.internalId)&&
jc2cui.mapWidget.infoWindow.close()};c.prototype.getBounds=function(){var a;u.bounds&&(a=u.bounds(),this.extendBounds(a));return a};c.prototype.extendBounds=function(a){var d;for(d=0;d<this.features.length;d++)this.features[d].extendBounds(a)};c.prototype.getAllVisiblePlacemarks=function(a){a=a||[];$.each(this.features,function(d,b){b.getVisible&&b.getVisible()&&a.push(b)});return a};e.prototype.getAllPlacemarks=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllPlacemarks(a);
for(d=0;d<this.features.length;d++)$.merge(a,this.features[d].features);return a};e.prototype.getAllVisiblePlacemarks=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllVisiblePlacemarks(a);for(d=0;d<this.features.length;d++)this.features[d].getAllVisiblePlacemarks(a);return a};e.prototype.remove=function(){var a;--J;this.removed=!0;this.fileSize&&(T-=this.fileSize);for(a=0;a<this.containers.length;a++)this.containers[a].remove();for(a=0;a<this.features.length;a++)this.features[a].remove();
for(a=0;a<this.screenOverlays.length;a++)this.screenOverlays[a].remove(),--J;u.containerRemoved&&u.containerRemoved(this)};e.prototype.setVisible=function(a,d){var b;this.visible=a;if(d&&(this.visibility=a))for(b=this.parent;b&&!b.visibility;)b.visibility=!0,b=b.parent;for(b=0;b<this.containers.length;b++)this.containers[b].setVisible(a,d);for(b=0;b<this.features.length;b++)this.features[b].setVisible(a,d);for(b=0;b<this.screenOverlays.length;b++)this.screenOverlays[b].setVisible(a,d)};e.prototype.extendBounds=
function(a){var d;for(d=0;d<this.containers.length;d++)this.containers[d].extendBounds(a);for(d=0;d<this.features.length;d++)this.features[d].extendBounds(a)};e.prototype.onViewUpdate=function(a){var d,b;this.region&&u.isRegionActive&&(b=u.isRegionActive(this.region),this.visibility&&b!==this.visible&&this.setVisible(b));for(d=0;d<this.containers.length;d++)this.containers[d].onViewUpdate(a);if(u.isRegionActive)for(d=0;d<this.viewSensitiveFeatures.length;d++)a=this.viewSensitiveFeatures[d],a.region&&
(b=u.isRegionActive(a.region),a.visibility&&b!==a.visible&&a.setVisible(b)),!a.icon||"onStop"!==a.icon.viewRefreshMode&&"onRequest"!==a.icon.viewRefreshMode||(clearTimeout(a.stopRefresh),a.stopRefresh=h(a))};e.prototype.getAllContainers=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllContainers(a);$.merge(a,this.containers);return a};e.prototype.getAllFeatures=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllFeatures(a);
$.merge(a,this.features);return a};e.prototype.getAllScreenOverlays=function(a){var d;a=a||[];for(d=0;d<this.containers.length;d++)this.containers[d].getAllScreenOverlays(a);$.merge(a,this.screenOverlays);return a};b.prototype=new e(null,!0);b.prototype.remove=function(){var a;e.prototype.remove.call(this);for(a=0;a<this.intervals.length;a++)clearInterval(this.intervals[a])};b.prototype.onViewUpdate=function(a){var d=this,b;if(!(this.link.viewRefreshMode&&"never"!==this.link.viewRefreshMode||this.region&&
!this.loaded)||"onRegion"===this.link.viewRefreshMode&&this.loaded)e.prototype.onViewUpdate.apply(this,arguments);else if(this.region&&u.isRegionActive&&("onRegion"===this.link.viewRefreshMode||!this.loaded))u.isRegionActive(this.region)&&(this.setVisible(this.visibility),this.loaded=!0,this.loadedDoc=n(this.link.getHref(),this.visible,this,function(a){a=a.doc||this.loadedDoc;d.loadLargeFile=a.loadLargeFile;d.loadMorePlacemarks=a.loadMorePlacemarks}),this.loadedDoc.visibility=this.visibility);else if("onStop"===
this.link.viewRefreshMode||"onRequest"===this.link.viewRefreshMode)clearTimeout(this.stopRefresh),d=this,b="onRequest"===this.link.viewRefreshMode?3E3:Math.max(0,this.link.viewRefreshTime-1E3),this.stopRefresh=setTimeout(function(){if(!this.region||u.isRegionActive&&u.isRegionActive(this.region)){var a=n(d.link.getHref(),d.loadedDoc.visible,d,function(b){var n=a||b.doc;d.loadedDoc.remove();for(b=0;b<d.containers.length;b++)if(d.containers[b]===d.loadedDoc){d.containers.splice(b,1);d.loadedDoc=n;break}d.loadLargeFile=
n.loadLargeFile;d.loadMorePlacemarks=n.loadMorePlacemarks},null,d.loadedDoc);a.visibility=d.loadedDoc.visibility}},b)};x.prototype.getHref=function(){var a=this.href||"";this.viewFormat&&(this.viewFormat.length&&u.formatView)&&(a=0>a.indexOf("?")?a+"?":a+"&",a+=u.formatView(this.viewFormat));return a};return{init:function(a){u=$.extend(!0,{},z,a)},loadKml:function(a,d,b,e,f,c,l,r){return n(a,d,b,function(a){!a.doc&&e&&e(a)},e,f,c,l,r)},parseKmlString:function(a,d,b,n,f){var c=new e(b),l;c.remaining=
1;c.parseCompleteCallback=function(a){!a.doc&&n&&n(a)};c.initialParseCompleteCallback=n;c.visibility=c.visible=d;c.clustering=f;setTimeout(function(){l=$.parseXML(a);S(l,c)},1);return c},Container:e,totalEntities:function(){return J},getEntitiesString:function(a){return"Approximately "+W(T)+" of data containing approximately "+(J+(a||0))+" entities loaded."},getTreeData:d}}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.infoWindow=function(){function t(){var f;!c.containment||c.containment instanceof jQuery||(c.containment=$(c.containment));a=$('<div id="infoWindow" class="infoWindow"><span class="closeInfoWindow"></span><div id="infoWindowContent" class="infoWindowContent"></div></div>').appendTo(c.containment||$("body")).draggable({cancel:"#infoWindowContent",containment:c.containment,cursor:"move"}).resizable({containment:c.containment,stop:function(a,e){b=!0}});f=$(".closeInfoWindow",a).hover(function(){f.addClass("closeInfoWindowOver")},
function(){f.removeClass("closeInfoWindowOver")}).click(function(){jc2cui.mapWidget.infoWindow.close()});e=$("#infoWindowContent");c.zIndex&&a.css("z-index",c.zIndex)}function g(){if(c.containment){var e=b?Math.min(c.containment.innerHeight()-(a.outerHeight()-a.innerHeight())-18,a.height()):Math.min(500,0.6*c.containment.height()),l=b?Math.min(c.containment.innerWidth()-(a.outerWidth()-a.innerWidth())-12,a.width()):Math.min(542,0.6*c.containment.width());a.css("height",Math.max(10,e)+"px");a.css("width",
Math.max(10,l)+"px");if(c.containment){var e=parseInt(a.css("top").replace("px",""),10),l=parseInt(a.css("left").replace("px",""),10),p=c.containment.position();e+a.outerHeight()>c.containment.height()+p.top&&a.css("top",Math.max(p.top,c.containment.height()-a.outerHeight()+p.top)+"px");l+a.outerWidth()>=c.containment.width()&&a.css("left",Math.max(0,c.containment.width()-a.outerWidth())+"px")}}}var a,c,e,h=!0,b=!1,l;return{init:function(a){c=a||{}},open:function(f,s){a||t();f.content&&("string"===
typeof f.content?e.html(f.content):(e.empty(),e.append(f.content)),$("a",e).addClass("external").attr({target:"_blank"}));e.text().length&&(f.width&&(a.css("width",f.width),b=!0),f.height&&(a.css("height",f.height),b=!0),f.bgColor&&(a.css("background-color",f.bgColor),b=!0),f.textColor&&(a.css("color",f.textColor),b=!0),l=s,a.show(),e.scrollTop(0),h&&(h=!1,g(),c.containment&&(a.css("left",Math.max(0,(c.containment.width()-a.outerWidth())/2+c.containment.scrollLeft())+"px"),a.css("top",Math.max(0,
(c.containment.height()-a.outerHeight())/2+c.containment.scrollTop())+"px"))))},close:function(){l=null;a&&a.hide()},setPosition:function(){},checkResize:function(){a&&g()},getMapItem:function(){return l}}}();
(function(t){var g={},a,c=function(a){if(a.match(/[0-9a-fA-F]{3}$/)||a.match(/[0-9a-fA-F]{6}$/))a="#"===a.charAt(0)?a:"#"+a;else if(a.match(/^rgb\(([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5]),[ ]{0,1}([0-9]|[1-9][0-9]|[1][0-9]{2}|[2][0-4][0-9]|[2][5][0-5])\)$/)){var e=[parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)],f,c=function(a){var b,e;if(2>a.length)for(b=0,e=2-a.length;b<e;b++)a="0"+a;return a};
3===e.length&&(a=c(e[0].toString(16)),f=c(e[1].toString(16)),e=c(e[2].toString(16)),a="#"+a+f+e)}else a=null;return a},e=function(b){g.control=t("<div class='color-picker'></div>");var e=function(b){b.bind({click:function(e){e=b.css("background-color");e=(e=c(e))||"transparent";g.selector.css("background-color",e);a(!0,e)},mouseover:function(a){b.css("border-color","#598FEF")},mouseout:function(a){b.css("border-color","#000")}});g.control.append(b)};t.each(t.fn.colorPicker.defaultColors,function(a){a=
t("<div class='color_swatch'>&nbsp;</div>");a.css("background-color","#"+this);e(a)});e(t("<div class='nocolor'>transparent</div>"));t("body").append(g.control);b&&(g.iframeShim=document.createElement("iframe"),g.iframeShim.frameBorder=0,g.iframeShim.scrolling="no",g.iframeShim.src="javascript:false;",g.iframeShim.style.position="absolute",g.iframeShim.style.width=g.control.width()+"px",g.iframeShim.style.height=g.control.height()+"px",t("body").append(g.iframeShim))},h=function(b){b.target!==g.control&&
t(b.target).parent()[0]!==g.control[0]&&a()};a=function(a,e){g.control.stop(!0);a?g.control.slideUp("slow",function(){g.control.css("height","")}):(g.control.hide(),g.control.css("height",""));t("body").unbind("mousedown",h);g.iframeShim&&(g.iframeShim.style.zIndex=-500);g.callback&&(g.callback(e),delete g.callback)};t.fn.colorPicker=function(b,c,f){var s=this;return this.css("background-color",b).bind("mouseover",function(a){s.css("border-color","#598FEF")}).bind("mouseout",function(a){s.css("border-color",
"#000")}).click(function(){g.selector=s;g.control||e(f);a();var b=s.offset(),m=Math.max(0,b.top-g.control.height()),E=t(window),b=Math.max(0,b.left),m=Math.min(m,E.height()-g.control.height()),b=Math.min(b,E.width()-g.control.width());g.control.css({left:b+"px",top:m+"px"});g.iframeShim&&(g.iframeShim.style.left=b+"px",g.iframeShim.style.top=m+"px",g.iframeShim.style.zIndex=g.control.css("z-index")-1);g.control.slideDown("slow");g.callback=c;t("body").bind("mousedown",h)})};t.fn.colorPicker.hide=
function(b){a(b)};t.fn.colorPicker.defaultColors="000000 993300 333300 000080 333399 333333 800000 FF6600 808000 008000 008080 0000FF 666699 808080 FF0000 FF9900 99CC00 339966 33CCCC 3366FF 800080 999999 FF00FF FFCC00 FFFF00 00FF00 00FFFF 00CCFF 993366 C0C0C0 FF99CC FFCC99 FFFF99 CCFFFF 99CCFF FFFFFF 15428B DFE8F6".split(" ")})(jQuery);util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.featureEditor=function(){function t(a){var e=$('<div id="marker-icons">').appendTo(a),c,m,g=function(b){return function(c){h.iconUrl=b;$("#characteristicsButton",a.parent()).attr("src",h.iconUrl);$(".marker-icon",e).removeClass("selected");$(this).addClass("selected")}};for(c=0;c<l.length;c++)m=[32*-(c%b),32*-Math.floor(c/b)],$('<a class="marker-icon" tabindex="1"></a>').css("background-position",m[0]+"px "+m[1]+"px").appendTo(e).click(g(l[c]))}function g(a){var b=$('<div><label>line color <input id="strokeColor" type="text"></label><label>line width (pixels) <input id="strokeWeight" type="text"></label><label>line opacity <input id="strokeOpacity" type="text"></label></div>').appendTo(a);
$("#strokeColor",b).colorPicker(h.strokeColor,function(b){h.strokeColor=b;$("#mask",a.parent()).css({"background-color":"line"===h.type?h.strokeColor:h.fillColor,"border-color":h.strokeColor})},e);$("#strokeWeight",b).val(h.strokeWeight).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(h.strokeWeight=a)});$("#strokeOpacity",b).val(Math.floor(100*h.strokeOpacity)).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(a=Math.max(0,Math.min(100,a))/100,h.strokeOpacity=a)})}function a(a){var b=
$('<div><label>fill color <input id="fillColor" type="text"></label><label>fill opacity <input id="fillOpacity" type="text"></label></div>').appendTo(a);$("#fillColor",b).colorPicker(h.fillColor,function(b){h.fillColor=b;$("#mask",a.parent()).css({"background-color":"line"===h.type?h.strokeColor:h.fillColor})},e);$("#fillOpacity",b).val(Math.floor(100*h.fillOpacity)).change(function(){var a=parseInt($(this).val(),10);isNaN(a)||(a=Math.max(0,Math.min(100,a))/100,h.fillOpacity=a)})}function c(b,e){var c=
$('<div id="characteristics""><div id="back">back</div></div>').appendTo(e);switch(b){case "marker":t(c);break;case "line":g(c);break;case "shape":g(c),a(c)}return c}var e,h,b=7,l=function(){var a=[],b=["-circle.png","-blank.png","-pushpin.png"],e="blu red grn ltblu ylw purple pink".split(" "),c="dining coffee bars snack_bar tram lodging wheel_chair_accessible shopping movies convenience grocery arts homegardenbusiness electronics mechanic partly_cloudy realestate salon dollar parking_lot gas_stations cabs bus truck rail airports ferry heliport subway info flag earthquake webcam post_office police firedept hospitals info_circle phone caution falling_rocks camera parks campfire picnic campground ranger_station toilets poi hiker cycling motorcycling horsebackriding play golf trail water snowflake_simple marina fishing sailing swimming ski woman man rainy volcano sunny euro yen".split(" "),
l,h,g;for(l=0;l<b.length;l++)for(h=0;h<e.length;h++)g=e[h],a.push([jc2cui.mapWidget.getAppPath(),"images/",g,b[l]].join(""));for(l=0;l<c.length;l++)a.push([jc2cui.mapWidget.getAppPath(),"images/",c[l],".png"].join(""));return a}();return{useShim:function(a){e=a},getEditFeatureHtml:function(a,b){h=a;var e=$(['<div class="editFeature"><div id="outer"><div id="basic"><div class="bold top">Title <input id="title" type="text" id="title" /><div id="mask"><img id="characteristicsButton" src="',h.iconUrl,
'" title="Click to set ',h.type,' characteristics"></div></div><div class="bold section">Description</div><textarea id="description"></textarea></div></div><div class="buttons"><span id="delete" class="button">delete</span><span id="cancel" class="button">cancel</span><span id="ok" class="button">ok</span></div></div>'].join("")),l,g;$("#title",e).val(h.title||"");$("#description",e).val(h.description||"");$("#characteristicsButton",e).click(function(){l||(l=$("#basic",e));g||(g=c(h.type,$("#outer",
e)));$("#back",g).click(function(){g.hide();l.show()});l.hide();g.show()});$("#mask",e).css({"background-color":"marker"===h.type?"transparent":"line"===h.type?h.strokeColor:h.fillColor,"border-color":"marker"===h.type?"transparent":h.strokeColor});$("#delete",e).click(function(){b&&b.deleted&&b.deleted()});$("#ok",e).click(function(){b&&b.updated&&(h.title=$("#title",e).val(),h.description=$("#description",e).val(),b.updated(h))});$("#cancel",e).click(function(){b&&b.canceled&&b.canceled()});return e[0]}}}();
(function(t){for(var g,a=document.getElementsByTagName("head")[0].style,c=["transformProperty","WebkitTransform","OTransform","msTransform","MozTransform"],e=0;e<c.length;e++)void 0!==a[c[e]]&&(g=c[e]);var h=eval('"v"=="\v"');jQuery.fn.extend({rotate:function(a){if(0!==this.length&&"undefined"!=typeof a){"number"==typeof a&&(a={angle:a});for(var e=[],c=0,h=this.length;c<h;c++){var g=this.get(c);if(g.Wilq32&&g.Wilq32.PhotoEffect)g.Wilq32.PhotoEffect._handleRotation(a);else{var m=t.extend(!0,{},a),
g=(new Wilq32.PhotoEffect(g,m))._rootObj;e.push(t(g))}}return e}},getRotateAngle:function(){for(var a=[],e=0,c=this.length;e<c;e++){var h=this.get(e);h.Wilq32&&h.Wilq32.PhotoEffect&&(a[e]=h.Wilq32.PhotoEffect._angle)}return a},stopRotate:function(){for(var a=0,e=this.length;a<e;a++){var c=this.get(a);c.Wilq32&&c.Wilq32.PhotoEffect&&clearTimeout(c.Wilq32.PhotoEffect._timer)}}});Wilq32=window.Wilq32||{};Wilq32.PhotoEffect=function(){return g?function(a,e){a.Wilq32={PhotoEffect:this};this._img=this._rootObj=
this._eventObj=a;this._handleRotation(e)}:h?function(a,e){this._img=a;this._rootObj=document.createElement("span");this._rootObj.style.display="inline-block";this._rootObj.Wilq32={PhotoEffect:this};a.parentNode.insertBefore(this._rootObj,a);this._Loader(e)}:function(a,e){this._rootObj=a}}();Wilq32.PhotoEffect.prototype={_setupParameters:function(a){this._parameters=this._parameters||{};"number"!==typeof this._angle&&(this._angle=0);"number"===typeof a.angle&&(this._angle=a.angle);this._parameters.animateTo=
"number"===typeof a.animateTo?a.animateTo:this._angle;this._parameters.step=a.step||this._parameters.step||null;this._parameters.easing=a.easing||this._parameters.easing||function(a,b,e,c,h){return-c*((b=b/h-1)*b*b*b-1)+e};this._parameters.duration=a.duration||this._parameters.duration||1E3;this._parameters.callback=a.callback||this._parameters.callback||function(){};a.bind&&a.bind!=this._parameters.bind&&this._BindEvents(a.bind)},_handleRotation:function(a){this._setupParameters(a);this._angle==
this._parameters.animateTo?this._rotate(this._angle):this._animateStart()},_BindEvents:function(a){if(a&&this._eventObj){if(this._parameters.bind){var e=this._parameters.bind,c;for(c in e)e.hasOwnProperty(c)&&jQuery(this._eventObj).unbind(c,e[c])}this._parameters.bind=a;for(c in a)a.hasOwnProperty(c)&&jQuery(this._eventObj).bind(c,a[c])}},_Loader:function(a){this._rootObj.appendChild(this._img);this._rootObj.style.width=this._img.offsetWidth;this._rootObj.style.height=this._img.offsetHeight;this._img.style.position=
"absolute";this._rootObj=this._img;this._rootObj.Wilq32={PhotoEffect:this};this._rootObj.style.filter+="progid:DXImageTransform.Microsoft.Matrix(M11=1,M12=1,M21=1,M22=1,sizingMethod='auto expand')";this._eventObj=this._rootObj;this._handleRotation(a)},_animateStart:function(){this._timer&&clearTimeout(this._timer);this._animateStartTime=+new Date;this._animateStartAngle=this._angle;this._animate()},_animate:function(){var a=+new Date,e=a-this._animateStartTime>this._parameters.duration;if(e&&!this._parameters.animatedGif)clearTimeout(this._timer);
else{if(this._canvas||this._vimage||this._img)a=this._parameters.easing(0,a-this._animateStartTime,this._animateStartAngle,this._parameters.animateTo-this._animateStartAngle,this._parameters.duration),this._rotate(~~(10*a)/10);this._parameters.step&&this._parameters.step(this._angle);var c=this;this._timer=setTimeout(function(){c._animate.call(c)},10)}this._parameters.callback&&e&&(this._angle=this._parameters.animateTo,this._rotate(this._angle),this._parameters.callback.call(this._rootObj))},_rotate:function(){var a=
Math.PI/180;if(h)return function(e){this._angle=e;e*=a;costheta=Math.cos(e);sintheta=Math.sin(e);e=this._rootObj.filters.item("DXImageTransform.Microsoft.Matrix");e.M11=costheta;e.M12=-sintheta;e.M21=sintheta;e.M22=costheta;this._rootObj.style.marginLeft=-(this._rootObj.offsetWidth-this._rootObj.clientWidth)/2+"px";this._rootObj.style.marginTop=-(this._rootObj.offsetHeight-this._rootObj.clientHeight)/2+"px"};if(g)return function(a){this._angle=a;this._img.style[g]="rotate("+a%360+"deg)"}}()}})(jQuery);
document.createElement("canvas").getContext||function(){function t(){return this.context_||(this.context_=new s(this))}function g(a,d,b){var e=ca.call(arguments,2);return function(){return a.apply(d,e.concat(ca.call(arguments)))}}function a(a){var d=a.srcElement;switch(a.propertyName){case "width":d.style.width=d.attributes.width.nodeValue+"px";d.getContext().clearRect();break;case "height":d.style.height=d.attributes.height.nodeValue+"px",d.getContext().clearRect()}}function c(a){a=a.srcElement;
a.firstChild&&(a.firstChild.style.width=a.clientWidth+"px",a.firstChild.style.height=a.clientHeight+"px")}function e(){return[[1,0,0],[0,1,0],[0,0,1]]}function h(a,d){for(var b=e(),c=0;3>c;c++)for(var f=0;3>f;f++){for(var l=0,h=0;3>h;h++)l+=a[c][h]*d[h][f];b[c][f]=l}return b}function b(a,d){d.fillStyle=a.fillStyle;d.lineCap=a.lineCap;d.lineJoin=a.lineJoin;d.lineWidth=a.lineWidth;d.miterLimit=a.miterLimit;d.shadowBlur=a.shadowBlur;d.shadowColor=a.shadowColor;d.shadowOffsetX=a.shadowOffsetX;d.shadowOffsetY=
a.shadowOffsetY;d.strokeStyle=a.strokeStyle;d.globalAlpha=a.globalAlpha;d.font=a.font;d.textAlign=a.textAlign;d.textBaseline=a.textBaseline;d.arcScaleX_=a.arcScaleX_;d.arcScaleY_=a.arcScaleY_;d.lineScale_=a.lineScale_;d.rotation_=a.rotation_}function l(a){var d,b=1;a=String(a);if("rgb"==a.substring(0,3)){d=a.indexOf("(",3);var e=a.indexOf(")",d+1),e=a.substring(d+1,e).split(",");d="#";for(var c=0;3>c;c++)d+=ea[Number(e[c])];4==e.length&&"a"==a.substr(3,1)&&(b=e[3])}else d=a;return{color:d,alpha:b}}
function f(a){switch(a){case "butt":return"flat";case "round":return"round";default:return"square"}}function s(a){this.m_=e();this.mStack_=[];this.aStack_=[];this.currentPath_=[];this.fillStyle=this.strokeStyle="#000";this.lineWidth=1;this.lineJoin="miter";this.lineCap="butt";this.miterLimit=1*G;this.globalAlpha=1;this.font="10px sans-serif";this.textAlign="left";this.textBaseline="alphabetic";this.canvas=a;var d=a.ownerDocument.createElement("div");d.style.width=a.clientWidth+"px";d.style.height=
a.clientHeight+"px";d.style.overflow="hidden";d.style.position="absolute";a.appendChild(d);this.element_=d;this.lineScale_=this.arcScaleY_=this.arcScaleX_=1;this.rotation_=0}function p(a,d,b,e){a.currentPath_.push({type:"bezierCurveTo",cp1x:d.x,cp1y:d.y,cp2x:b.x,cp2y:b.y,x:e.x,y:e.y});a.currentX_=e.x;a.currentY_=e.y}function m(a,d,b){var e;a:{for(e=0;3>e;e++)for(var c=0;2>c;c++)if(!isFinite(d[e][c])||isNaN(d[e][c])){e=!1;break a}e=!0}e&&(a.m_=d,b&&(a.lineScale_=O(L(d[0][0]*d[1][1]-d[0][1]*d[1][0]))))}
function E(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;")}function A(a,d,b,e){var c=a.fillStyle,f=a.arcScaleX_,h=a.arcScaleY_,g=e.x-b.x,m=e.y-b.y;if(c instanceof w){var p=0,y=e=0,s=0,A=1;if("gradient"==c.type_){p=c.x1_/f;b=c.y1_/h;var E=getCoords(a,c.x0_/f,c.y0_/h),p=getCoords(a,p,b),p=180*Math.atan2(p.x-E.x,p.y-E.y)/Math.PI;0>p&&(p+=360);1E-6>p&&(p=0)}else E=getCoords(a,c.x0_,c.y0_),e=(E.x-b.x)/g,y=(E.y-b.y)/m,g/=f*G,m/=h*G,A=D.max(g,m),s=2*c.r0_/A,A=2*c.r1_/A-s;f=c.colors_;f.sort(function(a,
d){return a.offset-d.offset});h=f.length;E=f[0].color;b=f[h-1].color;g=f[0].alpha*a.globalAlpha;a=f[h-1].alpha*a.globalAlpha;for(var m=[],t=0;t<h;t++){var v=f[t];m.push(v.offset*A+s+" "+v.color)}d.push('<g_vml_:fill type="',c.type_,'"',' method="none" focus="100%"',' color="',E,'"',' color2="',b,'"',' colors="',m.join(","),'"',' opacity="',a,'"',' g_o_:opacity2="',g,'"',' angle="',p,'"',' focusposition="',e,",",y,'" />')}else c instanceof x?g&&m&&d.push("<g_vml_:fill",' position="',-b.x/g*f*f,",",
-b.y/m*h*h,'"',' type="tile"',' src="',c.src_,'" />'):(c=l(a.fillStyle),d.push('<g_vml_:fill color="',c.color,'" opacity="',c.alpha*a.globalAlpha,'" />'))}function w(a){this.type_=a;this.r1_=this.y1_=this.x1_=this.r0_=this.y0_=this.x0_=0;this.colors_=[]}function x(){}var D=Math,y=D.round,F=D.sin,H=D.cos,L=D.abs,O=D.sqrt,G=10,P=G/2,ca=Array.prototype.slice,da={init:function(a){/MSIE/.test(navigator.userAgent)&&!window.opera&&(a=a||document,a.createElement("canvas"),"complete"!==a.readyState?a.attachEvent("onreadystatechange",
g(this.init_,this,a)):this.init_(a))},init_:function(a){a.namespaces.g_vml_||a.namespaces.add("g_vml_","urn:schemas-microsoft-com:vml","#default#VML");a.namespaces.g_o_||a.namespaces.add("g_o_","urn:schemas-microsoft-com:office:office","#default#VML");if(!a.styleSheets.ex_canvas_){var d=a.createStyleSheet();d.owningElement.id="ex_canvas_";d.cssText="canvas{display:inline-block;overflow:hidden;text-align:left;width:300px;height:150px}g_vml_\\:*{behavior:url(#default#VML)}g_o_\\:*{behavior:url(#default#VML)}"}a=
a.getElementsByTagName("canvas");for(d=0;d<a.length;d++)this.initElement(a[d])},initElement:function(b){if(!b.getContext){b.getContext=t;b.innerHTML="";b.attachEvent("onpropertychange",a);b.attachEvent("onresize",c);var d=b.attributes;d.width&&d.width.specified?b.style.width=d.width.nodeValue+"px":b.width=b.clientWidth;d.height&&d.height.specified?b.style.height=d.height.nodeValue+"px":b.height=b.clientHeight}return b}};da.init();for(var ea=[],v=0;16>v;v++)for(var S=0;16>S;S++)ea[16*v+S]=v.toString(16)+
S.toString(16);v=s.prototype;v.clearRect=function(){this.element_.innerHTML=""};v.beginPath=function(){this.currentPath_=[]};v.moveTo=function(a,d){var b=this.getCoords_(a,d);this.currentPath_.push({type:"moveTo",x:b.x,y:b.y});this.currentX_=b.x;this.currentY_=b.y};v.lineTo=function(a,d){var b=this.getCoords_(a,d);this.currentPath_.push({type:"lineTo",x:b.x,y:b.y});this.currentX_=b.x;this.currentY_=b.y};v.bezierCurveTo=function(a,d,b,e,c,f){c=this.getCoords_(c,f);a=this.getCoords_(a,d);b=this.getCoords_(b,
e);p(this,a,b,c)};v.quadraticCurveTo=function(a,d,b,e){a=this.getCoords_(a,d);b=this.getCoords_(b,e);e={x:this.currentX_+2/3*(a.x-this.currentX_),y:this.currentY_+2/3*(a.y-this.currentY_)};p(this,e,{x:e.x+(b.x-this.currentX_)/3,y:e.y+(b.y-this.currentY_)/3},b)};v.arc=function(a,d,b,e,c,f){b*=G;var l=f?"at":"wa",h=a+H(e)*b-P,g=d+F(e)*b-P;e=a+H(c)*b-P;c=d+F(c)*b-P;h!=e||f||(h+=0.125);a=this.getCoords_(a,d);h=this.getCoords_(h,g);e=this.getCoords_(e,c);this.currentPath_.push({type:l,x:a.x,y:a.y,radius:b,
xStart:h.x,yStart:h.y,xEnd:e.x,yEnd:e.y})};v.rect=function(a,d,b,e){this.moveTo(a,d);this.lineTo(a+b,d);this.lineTo(a+b,d+e);this.lineTo(a,d+e);this.closePath()};v.strokeRect=function(a,d,b,e){var c=this.currentPath_;this.beginPath();this.moveTo(a,d);this.lineTo(a+b,d);this.lineTo(a+b,d+e);this.lineTo(a,d+e);this.closePath();this.stroke();this.currentPath_=c};v.fillRect=function(a,d,b,e){var c=this.currentPath_;this.beginPath();this.moveTo(a,d);this.lineTo(a+b,d);this.lineTo(a+b,d+e);this.lineTo(a,
d+e);this.closePath();this.fill();this.currentPath_=c};v.createLinearGradient=function(a,d,b,e){var c=new w("gradient");c.x0_=a;c.y0_=d;c.x1_=b;c.y1_=e;return c};v.createRadialGradient=function(a,d,b,e,c,f){var l=new w("gradientradial");l.x0_=a;l.y0_=d;l.r0_=b;l.x1_=e;l.y1_=c;l.r1_=f;return l};getTheDistanceTo=function(a,d){var b=a.y,e=d.y;return Math.sqrt(Math.pow(a.x-d.x,2)+Math.pow(b-e,2))};doRotate=function(a,d,b){a*=Math.PI/180;var e=getTheDistanceTo(b,d);a+=Math.atan2(b.y-d.y,b.x-d.x);b.x=d.x+
e*Math.cos(a);b.y=d.y+e*Math.sin(a)};getAdjustedBounds=function(a,d){if(a&&d){if(null==a.left||d.left<a.left)a.left=d.left;if(null==a.bottom||d.bottom<a.bottom)a.bottom=d.bottom;if(null==a.right||d.right>a.right)a.right=d.right;if(null==a.top||d.top>a.top)a.top=d.top}};getAdjustedTopLeft=function(a,d,b,e,c,f,l){var h={x:-b,y:-e},g={x:0,y:0},m={x:c,y:0};c={x:c,y:f};f={x:0,y:f};var p={left:null,bottom:null,right:null,top:null};a+=b;d+=e;doRotate(l,h,g);doRotate(l,h,m);doRotate(l,h,c);doRotate(l,h,f);
getAdjustedBounds(p,{left:g.x,bottom:g.y,right:g.x,top:g.y});getAdjustedBounds(p,{left:m.x,bottom:m.y,right:m.x,top:m.y});getAdjustedBounds(p,{left:c.x,bottom:c.y,right:c.x,top:c.y});getAdjustedBounds(p,{left:f.x,bottom:f.y,right:f.x,top:f.y});return{top:Math.round(d+p.bottom),left:Math.round(a+p.left)}};v.drawImageWithRotate=function(a,d,b,e,c,f,l,g){var m=a.runtimeStyle.width;if(m){var p=a.runtimeStyle.width,x=a.runtimeStyle.height;a.runtimeStyle.width="auto";a.runtimeStyle.height="auto"}var w=
a.width,y=a.height;m&&(a.runtimeStyle.width=p,a.runtimeStyle.height=x);sx=sy=0;sw=w;sh=y;this.getCoords_(e,c);m=[];x=scaleY=1;m.push(' <div style="position:absolute;');var p=[],x=H(this.rotation_),s=F(this.rotation_),s=h([[x,-s,0],[s,x,0],[0,0,1]],this.m_),x=s[0][0];scaleY=s[1][1];var A=g*(Math.PI/180),s=Math.cos(A),A=Math.sin(A);p.push("M11=",s,",","M12=",-A,",","M21=",A,",","M22=",s);d=getAdjustedTopLeft(d,b,e,c,f,l,g);m.push("top:",d.top,"px;left:",d.left,"px;filter:progid:DXImageTransform.Microsoft.Matrix(",
p.join(""),", sizingmethod='auto expand');");m.push(' ">');m.push('<div style="width:',Math.round(x*w*f/sw),"px;"," height:",Math.round(scaleY*y*l/sh),"px;"," filter:");1>this.globalAlpha&&m.push(" progid:DXImageTransform.Microsoft.Alpha(opacity="+100*this.globalAlpha+")");m.push(" progid:DXImageTransform.Microsoft.AlphaImageLoader(src=",a.src,',sizingMethod=scale)">');m.push("</div></div>");this.element_.insertAdjacentHTML("beforeEnd",m.join(""))};v.drawImage=function(a){var d,b,e,c,f,l,g,m;if(e=
a.runtimeStyle.width)c=a.runtimeStyle.width,f=a.runtimeStyle.height,a.runtimeStyle.width="auto",a.runtimeStyle.height="auto";var p=a.width,x=a.height;e&&(a.runtimeStyle.width=c,a.runtimeStyle.height=f);if(3==arguments.length)d=arguments[1],b=arguments[2],f=l=0,g=e=p,m=c=x;else if(5==arguments.length)d=arguments[1],b=arguments[2],e=arguments[3],c=arguments[4],f=l=0,g=p,m=x;else if(9==arguments.length)f=arguments[1],l=arguments[2],g=arguments[3],m=arguments[4],d=arguments[5],b=arguments[6],e=arguments[7],
c=arguments[8];else throw Error("Invalid number of arguments");var w=this.getCoords_(d,b),s=[],A=scaleY=1;s.push(' <div style="position:absolute;');if(1!=this.m_[0][0]||this.m_[0][1]||1!=this.m_[1][1]||this.m_[1][0]){var E=[],t=H(this.rotation_),v=F(this.rotation_),k=h([[t,-v,0],[v,t,0],[0,0,1]],this.m_),A=k[0][0];scaleY=k[1][1];E.push("M11=",t,",","M12=",-v,",","M21=",v,",","M22=",t,",","Dx=",w.x/G,",","Dy=",w.y/G);t=this.getCoords_(d+e,b);v=this.getCoords_(d,b+c);d=this.getCoords_(d+e,b+c);w.x=
D.max(w.x,t.x,v.x,d.x);w.y=D.max(w.y,t.y,v.y,d.y);s.push("padding:0 ",y(w.x/G),"px ",y(w.y/G),"px 0;filter:progid:DXImageTransform.Microsoft.Matrix(",E.join(""),", sizingmethod='clip');")}else s.push("top:",y(w.y/G),"px;left:",y(w.x/G),"px;");s.push(' ">');(f||l)&&s.push('<div style="overflow: hidden; width:',Math.ceil((e+f*e/g)*A),"px;"," height:",Math.ceil((c+l*c/m)*scaleY),"px;"," filter:progid:DxImageTransform.Microsoft.Matrix(Dx=",-f*e/g*A,",Dy=",-l*c/m*scaleY,');">');s.push('<div style="width:',
Math.round(A*p*e/g),"px;"," height:",Math.round(scaleY*x*c/m),"px;"," filter:");1>this.globalAlpha&&s.push(" progid:DXImageTransform.Microsoft.Alpha(opacity="+100*this.globalAlpha+")");s.push(" progid:DXImageTransform.Microsoft.AlphaImageLoader(src=",a.src,',sizingMethod=scale)">');(f||l)&&s.push("</div>");s.push("</div></div>");this.element_.insertAdjacentHTML("beforeEnd",s.join(""))};v.stroke=function(a){var d=[],b=l(a?this.fillStyle:this.strokeStyle),e=b.color,b=b.alpha*this.globalAlpha;d.push("<g_vml_:shape",
' filled="',!!a,'"',' style="position:absolute;width:',10,"px;height:",10,'px;"',' coordorigin="0 0" coordsize="',10*G," ",10*G,'"',' stroked="',!a,'"',' path="');for(var c=null,h=null,g=null,m=null,p=0;p<this.currentPath_.length;p++){var s=this.currentPath_[p];switch(s.type){case "moveTo":d.push(" m ",y(s.x),",",y(s.y));break;case "lineTo":d.push(" l ",y(s.x),",",y(s.y));break;case "close":d.push(" x ");s=null;break;case "bezierCurveTo":d.push(" c ",y(s.cp1x),",",y(s.cp1y),",",y(s.cp2x),",",y(s.cp2y),
",",y(s.x),",",y(s.y));break;case "at":case "wa":d.push(" ",s.type," ",y(s.x-this.arcScaleX_*s.radius),",",y(s.y-this.arcScaleY_*s.radius)," ",y(s.x+this.arcScaleX_*s.radius),",",y(s.y+this.arcScaleY_*s.radius)," ",y(s.xStart),",",y(s.yStart)," ",y(s.xEnd),",",y(s.yEnd))}if(s){if(null==c||s.x<c)c=s.x;if(null==g||s.x>g)g=s.x;if(null==h||s.y<h)h=s.y;if(null==m||s.y>m)m=s.y}}d.push(' ">');if(a)if("object"==typeof this.fillStyle){var e=this.fillStyle,w=0,s=b=a=0,x=1;"gradient"==e.type_?(w=e.x1_/this.arcScaleX_,
c=e.y1_/this.arcScaleY_,p=this.getCoords_(e.x0_/this.arcScaleX_,e.y0_/this.arcScaleY_),w=this.getCoords_(w,c),w=180*Math.atan2(w.x-p.x,w.y-p.y)/Math.PI,0>w&&(w+=360),1E-6>w&&(w=0)):(p=this.getCoords_(e.x0_,e.y0_),s=g-c,x=m-h,a=(p.x-c)/s,b=(p.y-h)/x,s/=this.arcScaleX_*G,x/=this.arcScaleY_*G,p=D.max(s,x),s=2*e.r0_/p,x=2*e.r1_/p-s);c=e.colors_;c.sort(function(a,d){return a.offset-d.offset});for(var h=c.length,m=c[0].color,g=c[h-1].color,A=c[0].alpha*this.globalAlpha,E=c[h-1].alpha*this.globalAlpha,t=
[],p=0;p<h;p++){var v=c[p];t.push(v.offset*x+s+" "+v.color)}d.push('<g_vml_:fill type="',e.type_,'"',' method="none" focus="100%"',' color="',m,'"',' color2="',g,'"',' colors="',t.join(","),'"',' opacity="',E,'"',' g_o_:opacity2="',A,'"',' angle="',w,'"',' focusposition="',a,",",b,'" />')}else d.push('<g_vml_:fill color="',e,'" opacity="',b,'" />');else a=this.lineScale_*this.lineWidth,1>a&&(b*=a),d.push("<g_vml_:stroke",' opacity="',b,'"',' joinstyle="',this.lineJoin,'"',' miterlimit="',this.miterLimit,
'"',' endcap="',f(this.lineCap),'"',' weight="',a,'px"',' color="',e,'" />');d.push("</g_vml_:shape>");this.element_.insertAdjacentHTML("beforeEnd",d.join(""))};v.fill=function(){this.stroke(!0)};v.closePath=function(){this.currentPath_.push({type:"close"})};v.getCoords_=function(a,d){var b=this.m_;return{x:G*(a*b[0][0]+d*b[1][0]+b[2][0])-P,y:G*(a*b[0][1]+d*b[1][1]+b[2][1])-P}};v.save=function(){var a={};b(this,a);this.aStack_.push(a);this.mStack_.push(this.m_);this.m_=h(e(),this.m_)};v.restore=function(){b(this.aStack_.pop(),
this);this.m_=this.mStack_.pop()};v.translate=function(a,d){m(this,h([[1,0,0],[0,1,0],[a,d,1]],this.m_),!1)};v.rotate=function(a){var d=H(a),b=F(a);this.rotation_+=a;m(this,h([[d,b,0],[-b,d,0],[0,0,1]],this.m_),!1)};v.scale=function(a,d){this.arcScaleX_*=a;this.arcScaleY_*=d;m(this,h([[a,0,0],[0,d,0],[0,0,1]],this.m_),!0)};v.transform=function(a,d,b,e,c,f){m(this,h([[a,d,0],[b,e,0],[c,f,1]],this.m_),!0)};v.setTransform=function(a,d,b,e,c,f){m(this,[[a,d,0],[b,e,0],[c,f,1]],!0)};var W={};v.drawText_=
function(a,b,e,c,f){var l=this.m_;c=0;var h=1E3,g=0,m=[],p;p=this.font;if(W[p])p=W[p];else{var s=document.createElement("div").style;try{s.font=p}catch(w){}p=W[p]={style:s.fontStyle||"normal",variant:s.fontVariant||"normal",weight:s.fontWeight||"normal",size:s.fontSize||10,family:s.fontFamily||"sans-serif"}}var s=p,x=this.element_;p={};for(var t in s)p[t]=s[t];t=parseFloat(x.currentStyle.fontSize);x=parseFloat(s.size);"number"==typeof s.size?p.size=s.size:-1!=s.size.indexOf("px")?p.size=x:-1!=s.size.indexOf("em")?
p.size=t*x:-1!=s.size.indexOf("%")?p.size=t/100*x:-1!=s.size.indexOf("pt")?p.size=x/0.75:p.size=t;p.size*=0.981;t=p.style+" "+p.variant+" "+p.weight+" "+p.size+"px "+p.family;x=this.element_.currentStyle;s=this.textAlign.toLowerCase();switch(s){case "left":case "center":case "right":break;case "end":s="ltr"==x.direction?"right":"left";break;case "start":s="rtl"==x.direction?"right":"left";break;default:s="left"}switch(this.textBaseline){case "hanging":case "top":g=p.size/1.75;break;case "middle":break;
default:case null:case "alphabetic":case "ideographic":case "bottom":g=-p.size/2.25}switch(s){case "right":c=1E3;h=0.05;break;case "center":c=h=500}b=this.getCoords_(b+0,e+g);m.push('<g_vml_:line from="',-c,' 0" to="',h,' 0.05" ',' coordsize="100 100" coordorigin="0 0"',' filled="',!f,'" stroked="',!!f,'" style="position:absolute;width:1px;height:1px;">');f?appendStroke(this,m):A(this,m,{x:-c,y:0},{x:h,y:p.size});f=l[0][0].toFixed(3)+","+l[1][0].toFixed(3)+","+l[0][1].toFixed(3)+","+l[1][1].toFixed(3)+
",0,0";b=y(b.x/G)+","+y(b.y/G);m.push('<g_vml_:skew on="t" matrix="',f,'" ',' offset="',b,'" origin="',c,' 0" />','<g_vml_:path textpathok="true" />','<g_vml_:textpath on="true" string="',E(a),'" style="v-text-align:',s,";font:",E(t),'" /></g_vml_:line>');this.element_.insertAdjacentHTML("beforeEnd",m.join(""))};v.fillText=function(a,b,e,c){this.drawText_(a,b,e,c,!1)};v.strokeText=function(a,b,e,c){this.drawText_(a,b,e,c,!0)};v.measureText=function(a){this.textMeasureEl_||(this.element_.insertAdjacentHTML("beforeEnd",
'<span style="position:absolute;top:-20000px;left:0;padding:0;margin:0;border:none;white-space:pre;"></span>'),this.textMeasureEl_=this.element_.lastChild);var b=this.element_.ownerDocument;this.textMeasureEl_.innerHTML="";this.textMeasureEl_.style.font=this.font;this.textMeasureEl_.appendChild(b.createTextNode(a));return{width:this.textMeasureEl_.offsetWidth}};v.clip=function(){};v.arcTo=function(){};v.createPattern=function(){return new x};w.prototype.addColorStop=function(a,b){b=l(b);this.colors_.push({offset:a,
color:b.color,alpha:b.alpha})};G_vmlCanvasManager=da;CanvasRenderingContext2D=s;CanvasGradient=w;CanvasPattern=x}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.markerOverlay=function(){function t(a,e,c){for(var h,g,m;e;){if(e.overlayId){h=e.overlayId;g=e.featureId;break}e=e.parent}m={selectedId:a.id||void 0,selectedName:a.name||void 0,featureId:g,overlayId:h};setTimeout(function(){jc2cui.mapWidget.showPlacemarkInfoWindow(a);jc2cui.mapWidget.itemSelected(m)},1)}function g(a,e){google.maps.Overlay.call(this);this.map=a;this.placemarks=[];this.doc=e;this.markerLayer=$('<div class="marker-overlay"/>');this.mouseOverTimeout=0;this.toolTip=null;
this.topCanvas=this.leftCanvas=0;this.needsSorting=!0;this.lastSize=a.getSize();var c=this;this.dragEndListener=google.maps.Event.addListener(this.map,"dragend",function(){c.doRedraw()});this.resizeMapListener=google.maps.Event.addListener(this.map,"resize",function(){var e=a.getSize();if(2<Math.abs(c.lastSize.width-e.width)||2<Math.abs(c.lastSize.height-e.height))c.lastSize=e,c.doRedraw()});this.mouseOutMapListener=google.maps.Event.addListener(this.map,"mouseout",function(a){clearTimeout(c.mouseOverTimeout);
null!==c.toolTip&&($(".markerCanvas",c.map.getContainer()).css("cursor","inherit"),c.toolTip.remove())});this.clickMapListener=google.maps.Event.addListener(this.map,"click",function(a,b,h){a=b||h;var g;clearTimeout(c.mouseOverTimeout);null!==c.toolTip&&($(".markerCanvas",c.map.getContainer()).css("cursor","inherit"),c.toolTip.remove());if(a&&!a.mouseClickHandled)for(b=c.map.fromLatLngToDivPixel(a),b.x-=c.leftCanvas,b.y-=c.topCanvas,h=c.placemarks.length-1;0<=h;h--)if(g=c.placemarks[h].placemark,
g.visible&&g.hitRegion&&g.hitRegion.minX<=b.x&&g.hitRegion.maxX>=b.x&&g.hitRegion.minY<=b.y&&g.hitRegion.maxY>=b.y){t(g,e);a.mouseClickHandled=!0;break}});this.mouseMoveMapListener=google.maps.Event.addListener(this.map,"mousemove",function(a){var b,e,h;a.equals(this.lastMouseMove)||(this.lastMouseMove=a,null!==c.toolTip&&($(".markerCanvas",c.map.getContainer()).css("cursor","inherit"),c.toolTip.remove()),clearTimeout(c.mouseOverTimeout),c.mouseOverTimeout=setTimeout(function(){if(!a.mouseMoveHandled)for(b=
c.map.fromLatLngToDivPixel(a),b.x-=c.leftCanvas,b.y-=c.topCanvas,e=c.placemarks.length-1;0<=e;e--)if(h=c.placemarks[e].placemark,h.visible&&h.hitRegion&&h.name&&h.hitRegion.minX<=b.x&&h.hitRegion.maxX>=b.x&&h.hitRegion.minY<=b.y&&h.hitRegion.maxY>=b.y){$(".markerCanvas",c.map.getContainer()).css("cursor","pointer");c.toolTip=$('<span class="placeMarkTooltip">'+h.name+"</span>").appendTo(c.map.getContainer()).css({left:(b.x+18).toString()+"px",top:(b.y-9).toString()+"px"});a.mouseMoveHandled=!0;break}},
500))});this.map.addOverlay(this)}function a(){g.prototype=new google.maps.Overlay;g.prototype.initialize=function(a){a.getPane(G_MAP_MARKER_SHADOW_PANE).appendChild(this.markerLayer[0])};g.prototype.removeFromMap=function(){this.ieMarkerOverlay?this.ieMarkerOverlay.remove():this.map.removeOverlay(this)};g.prototype.remove=function(){clearTimeout(this.mouseOverTimeout);this.toolTip&&($(".markerCanvas",this.map.getContainer()).css("cursor","inherit"),this.toolTip.remove());this.killCurrentDraw();google.maps.Event.removeListener(this.dragEndListener);
google.maps.Event.removeListener(this.resizeMapListener);google.maps.Event.removeListener(this.mouseOutMapListener);google.maps.Event.removeListener(this.clickMapListener);google.maps.Event.removeListener(this.mouseMoveMapListener);this.markerLayer.remove();delete this.markerLayer};g.prototype.hide=function(){this.ieMarkerOverlay?this.ieMarkerOverlay.hide():this.markerLayer.hide()};g.prototype.show=function(){this.ieMarkerOverlay?this.ieMarkerOverlay.show():this.markerLayer.show()};g.prototype.copy=
function(){var a=new g(this.doc,this.doc);a.placemarks=this.placemarks.slice();return a};g.prototype.addMarker=function(a,h){a.addedToMarkerOverlay=!0;if(this.ieMarkerOverlay)this.ieMarkerOverlay.addMarker(a,h);else{var f=this,g,p;this.placemarks.push({placemark:a,latLng:h});e&&100<=this.placemarks.length&&(p=new jc2cui.mapWidget.markerOverlayIE.MarkerOverlay(this.map,this.doc,this.placemarks),this.map.removeOverlay(this),this.ieMarkerOverlay=p);this.needsSorting=!0;a.visible&&(this.redrawNeeded=
!0);g=a.style&&a.style.IconStyle&&a.style.IconStyle.Icon&&a.style.IconStyle.Icon.href?a.style.IconStyle.Icon.href:jc2cui.mapWidget.getDefaultIcon();c[g]||(c[g]=new Image,this.imagesLoading=this.imagesLoading?this.imagesLoading+1:1,c[g].onload=function(){f.imagesLoading--;f.needsDraw&&(f.needsDraw=!1,f.doRedraw())},c[g].onerror=function(){console.log("Error thrown, image "+c[g].src+" didn't load, probably a 404.");c[g].src=jc2cui.mapWidget.getErrorIcon()},c[g].src=g)}};g.prototype.removeMarker=function(a){a.addedToMarkerOverlay=
!1;if(this.ieMarkerOverlay)this.ieMarkerOverlay.removeMarker(a);else{var e=-1;$.each(this.placemarks,function(c,h){if(a===h.placemark)return e=c,!1});-1<e&&this.placemarks.splice(e,1)}};g.prototype.killCurrentDraw=function(a){clearTimeout(this.redrawTimeout);clearTimeout(this.doDrawTimeout);this.canvas=null};g.prototype.doRedraw=function(){if(this.ieMarkerOverlay)this.ieMarkerOverlay.doRedraw();else if(this.markerLayer){var a=this;this.killCurrentDraw();this.redrawNeeded=!0;a.redrawTimeout=setTimeout(function(){a.redrawNeeded&&
a.redraw(!0)},e?100:10)}};g.prototype.placemarkVisibilityChanged=function(a){if(this.ieMarkerOverlay)return this.ieMarkerOverlay.placemarkVisibilityChanged(a);this.doRedraw()};g.prototype.drawPlacemarks=function(a,l,f,g){var p,m,t,A,w,x,D,y,F,H,L=jc2cui.mapWidget.options().labels&&jc2cui.mapWidget.options().labels.value;g=g||0;for(p=0;p<this.placemarks.length&&p<g+500;p++){if(this.doc.removed||this.canvas!==a)return;m=this.placemarks[p].placemark;!m.visible||m.style&&m.style.IconStyle&&m.style.IconStyle.Icon&&
void 0!==m.style.IconStyle.Icon.href&&!m.style.IconStyle.Icon.href||(t=this.map.fromLatLngToDivPixel(this.placemarks[p].latLng),A=m.style&&m.style.IconStyle&&m.style.IconStyle.scale?m.style.IconStyle.scale:1,m.style&&m.style.IconStyle&&m.style.IconStyle.Icon&&m.style.IconStyle.Icon.href&&0<=m.style.IconStyle.Icon.href.indexOf("http://maps.google.com/mapfiles/kml")?(x=w=64,A/=2):x=w=32,0!==A&&(w*=A,x*=A,m.style&&m.style.IconStyle&&m.style.IconStyle.hotSpot?(D=m.style.IconStyle.hotSpot.x,y=m.style.IconStyle.hotSpot.y,
"pixels"===m.style.IconStyle.hotSpot.xunits&&(D=-D*A),"insetPixels"===m.style.IconStyle.hotSpot.xunits&&(D=-w+D*A),"fraction"===m.style.IconStyle.hotSpot.xunits&&(D*=-w),"pixels"===m.style.IconStyle.hotSpot.yunits&&(y=-x+y*A+1),"insetPixels"===m.style.IconStyle.hotSpot.yunits&&(y=-(y*A)+1),"fraction"===m.style.IconStyle.hotSpot.yunits&&(y=-x*(1-y)+1)):(D=m.style&&m.style.IconStyle&&m.style.IconStyle.Icon&&m.style.IconStyle.Icon.href?-w/2:0.625*-w,y=-x/2),A=t.x-this.leftCanvas,t=t.y-this.topCanvas,
m.hitRegion=m.hitRegion||{},m.hitRegion.minX=A+D,m.hitRegion.minY=t+y,m.hitRegion.maxX=A+D+w,m.hitRegion.maxY=t+y+x,F=m.style&&m.style.IconStyle&&m.style.IconStyle.Icon&&m.style.IconStyle.Icon.href?m.style.IconStyle.Icon.href:jc2cui.mapWidget.getDefaultIcon(),m.style&&m.style.IconStyle&&m.style.IconStyle.Icon&&m.style.IconStyle.Icon.w?l.drawImage(c[F],m.style.IconStyle.Icon.x,c[F].height-m.style.IconStyle.Icon.y-m.style.IconStyle.Icon.h,m.style.IconStyle.Icon.w,m.style.IconStyle.Icon.h,A+D,t+y,w,
x):(m.style&&m.style.IconStyle&&m.style.IconStyle.heading?(l.save(),l.translate(A,t),l.rotate(m.style.IconStyle.heading*Math.PI/180),e?l.drawImageWithRotate(c[F],A,t,D,y,w,x,m.style.IconStyle.heading):l.drawImage(c[F],D,y,w,x),l.restore()):l.drawImage(c[F],A+D,t+y,w,x),m.name&&(m.name.length&&L)&&(!e||f.containsLatLng(this.placemarks[p].latLng))&&(l.font='10pt Calibri, Candara, Segoe, "Segoe UI", Optima, Arial, sans-serif',l.fillStyle="rgba(255, 255, 255, 0.5)",F=void 0!==h[m.name]?h[m.name]:l.measureText(m.name).width,
e&&(h[m.name]=F),l.fillRect(A+D-F/2+w/2-1,t+y+x-(e?3:1)-1,F+(e?0.07*F:0)+1,(e?1:0)+11),l.fillStyle="blue",l.fillText(m.name,A+D-F/2+w/2,t+y+x+8)))))}p<this.placemarks.length?(H=this,this.doDrawTimeout=setTimeout(function(){H.drawPlacemarks(a,l,f,p)},10)):$(this.canvas).css("z-index",0).siblings().remove()};g.prototype.redraw=function(a){var c,f,h,g=this;a?this.imagesLoading&&0<this.imagesLoading?this.needsDraw=!0:(this.redrawNeeded=!1,this.killCurrentDraw(),e&&(c=this.map.getBounds()),this.lastZoom!==
this.map.getZoom()&&(this.markerLayer.empty(),this.lastZoom=this.map.getZoom()),this.canvas=document.createElement("canvas"),this.markerLayer.append(this.canvas),e&&(this.canvas=G_vmlCanvasManager.initElement(this.canvas)),f=this.canvas.getContext("2d"),this.canvas.width=this.map.getSize().width,this.canvas.height=this.map.getSize().height,this.canvas.className="markerCanvas",this.leftCanvas=this.topCanvas=0,this.needsSorting&&(this.placemarks.sort(function(a,b){return b.latLng.lat()-a.latLng.lat()}),
this.needsSorting=!1),this.placemarks.length&&(a=this.map.fromLatLngToContainerPixel(this.placemarks[0].latLng),h=this.map.fromLatLngToDivPixel(this.placemarks[0].latLng),this.topCanvas=h.y-a.y,this.leftCanvas=h.x-a.x,this.canvas.style.top=this.topCanvas+"px",this.canvas.style.left=this.leftCanvas+"px",this.canvas.style.zIndex=-1),this.doDrawTimeout=setTimeout(function(){g.drawPlacemarks(g.canvas,f,c)},10)):this.doRedraw()}}var c={},e=!document.createElement("canvas").getContext,h={};return{init:function(){a();
e&&jc2cui.mapWidget.markerOverlayIE.init()},MarkerOverlay:g}}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.markerOverlayIE=function(){function t(a){return a.style&&a.style.IconStyle&&a.style.IconStyle.Icon&&a.style.IconStyle.Icon.href&&"https://sageearth.northcom.mil/TrackService/icons/white_outlined_arrow.png"===a.style.IconStyle.Icon.href}function g(a,c,b){google.maps.Overlay.call(this);this.map=a;this.placemarks=[];this.doc=c;var l=this,f,g;if(b)for(a=0;a<b.length;a++)t(b[a].placemark)?b[a].placemark.visible=b[a].placemark.visibility=!1:(b[a].placemark.latLng=b[a].latLng,this.placemarks.push(b[a].placemark));
for(;c;){if(c.overlayId){f=c.overlayId;g=c.featureId;break}c=c.parent}this.container=$("<div />").click(function(a){a=l.placemarks[parseInt(a.target.id.substr(1),10)];var b={selectedId:a.id||void 0,selectedName:a.name||void 0,featureId:g,overlayId:f};jc2cui.mapWidget.showPlacemarkInfoWindow(a);jc2cui.mapWidget.itemSelected(b)});this.map.addOverlay(this)}function a(){g.prototype=new google.maps.Overlay;g.prototype.initialize=function(a){a.getPane(G_MAP_MARKER_PANE).appendChild(this.container[0])};
g.prototype.remove=function(){this.container.remove()};g.prototype.hide=function(){this.container.hide()};g.prototype.show=function(){this.container.show()};g.prototype.copy=function(){var a=new g(this.map,this.doc);a.placemarks=this.placemarks.slice();return a};g.prototype.addMarker=function(a,h){if(t(a))a.visible=a.visibility=!1;else if(a.latLng=h,a.visible&&(this.forceRefresh=!0),this.placemarks.push(a),a.style&&(a.style.IconStyle&&a.style.IconStyle.Icon&&a.style.IconStyle.Icon.w)&&!c[a.style.IconStyle.Icon.href]){c[a.style.IconStyle.Icon.href]=
{};var b=$('<img src="'+a.style.IconStyle.Icon.href+'"/></img>').appendTo("body"),l=this;this.paletteLoading=this.paletteLoading?this.paletteLoading+1:1;b.load(function(){c[a.style.IconStyle.Icon.href]={height:b.height(),width:b.width()};b.remove();l.paletteLoading--;l.needsDraw&&(l.needsDraw=!1,l.redraw())})}};g.prototype.removeMarker=function(a){var c=-1;$.each(this.placemarks,function(b,l){if(a===l)return c=b,!1});-1<c&&this.placemarks.splice(c,1)};g.prototype.killCurrentDraw=function(a){clearTimeout(this.redrawTimeout);
clearTimeout(this.drawPlacemarksTimer);this.markerLayer=null};g.prototype.doRedraw=function(){var a=this;this.forceRefresh=!0;this.killCurrentDraw();this.redrawTimeout=setTimeout(function(){a.forceRefresh&&a.redraw(!0)},100)};g.prototype.placemarkVisibilityChanged=function(a){if(t(a))return!1;this.doRedraw()};g.prototype.drawPlacemarks=function(a,h){var b=[],l,f,g,p,m,t,A=1,w=1,x,D,y,F,H,L,O=this,G=jc2cui.mapWidget.options().labels&&jc2cui.mapWidget.options().labels.value;for(l=h=h||0;l<this.placemarks.length&&
l<h+200;l++){if(this.doc.removed||a!==this.markerLayer)return;f=this.placemarks[l];if(f.visible&&(!f.style||!f.style.IconStyle||!f.style.IconStyle.Icon||void 0===f.style.IconStyle.Icon.href||f.style.IconStyle.Icon.href)){g=this.map.fromLatLngToDivPixel(this.placemarks[l].latLng);b.push('<img id="t');b.push(l);b.push('" class="marker"');f.name&&0<f.name.length&&(b.push(' title="'),b.push(f.name),b.push('"'));b.push(' style="z-index:');b.push(-Math.round(1E3*(this.placemarks[l].latLng.lat()+90))+18E4);
t=f.style&&f.style.IconStyle&&f.style.IconStyle.scale?f.style.IconStyle.scale:1;f.style&&f.style.IconStyle&&f.style.IconStyle.Icon&&f.style.IconStyle.Icon.href&&0<=f.style.IconStyle.Icon.href.indexOf("http://maps.google.com/mapfiles/kml")?(m=p=64,t/=2):m=p=32;p*=t;m*=t;f.style&&f.style.IconStyle&&f.style.IconStyle.hotSpot?(H=f.style.IconStyle.hotSpot.x,L=f.style.IconStyle.hotSpot.y,"pixels"===f.style.IconStyle.hotSpot.xunits&&(H=-H*t),"insetPixels"===f.style.IconStyle.hotSpot.xunits&&(H=-p+H*t),"fraction"===
f.style.IconStyle.hotSpot.xunits&&(H*=-p),"pixels"===f.style.IconStyle.hotSpot.yunits&&(L=-m+L*t+1),"insetPixels"===f.style.IconStyle.hotSpot.yunits&&(L=-(L*t)+1),"fraction"===f.style.IconStyle.hotSpot.yunits&&(L=-m*(1-L)+1)):(H=f.style&&f.style.IconStyle&&f.style.IconStyle.Icon&&f.style.IconStyle.Icon.href?-p/2:0.625*-p,L=-m/2);b.push("; left:");b.push(g.x+H);b.push("px; top:");b.push(g.y+L);b.push("px;");if(f.style&&f.style.IconStyle&&f.style.IconStyle.Icon&&f.style.IconStyle.Icon.w){t=c[f.style.IconStyle.Icon.href];
if(f.style.IconStyle.Icon.h&&32!==f.style.IconStyle.Icon.h||32!==m)A=(f.style.IconStyle.Icon.h||32)/m,b.push("height:"),b.push(t.height/A),b.push("px;");if(f.style.IconStyle.Icon.w&&32!==f.style.IconStyle.Icon.w||32!==p)w=(f.style.IconStyle.Icon.w||32)/p,b.push("width:"),b.push(t.width/w),b.push("px;");x=(t.height-f.style.IconStyle.Icon.y)/A-m;D=f.style.IconStyle.Icon.x/w+p;y=x+m;F=D-p;b.push("clip: rect(");b.push(x);b.push("px,");b.push(D);b.push("px,");b.push(y);b.push("px,");b.push(F);b.push("px);");
b.push("margin-left:");b.push(-(f.style.IconStyle.Icon.x/w));b.push("px;");b.push("margin-top:");b.push(-(t.height/A)+f.style.IconStyle.Icon.y/A+m);b.push("px;")}else 32!==m&&(b.push("height:"),b.push(m),b.push("px;")),32!==p&&(b.push("width:"),b.push(p),b.push("px;"));b.push('" src="');b.push(f.style&&f.style.IconStyle&&f.style.IconStyle.Icon&&f.style.IconStyle.Icon.href?f.style.IconStyle.Icon.href:jc2cui.mapWidget.getDefaultIcon());b.push('">');f.name&&(f.name.length&&G)&&(b.push('<div class="markerLabelOuter"'),
b.push('style="left:'),b.push(g.x+H+p/2),b.push("px; top:"),b.push(g.y+L+m/2+8),b.push("px;"),b.push('"><span class="markerLabelInner">'),b.push(f.name),b.push("</span>"),b.push("</div>"))}}b=a.append(b.join(""));$("img",b).one("error",function(){this.src=jc2cui.mapWidget.getErrorIcon()});l<this.placemarks.length?this.drawPlacemarksTimer=setTimeout(function(){O.drawPlacemarks(a,l)},10):(a.detach().css("z-index",0),this.container.empty().append(a))};g.prototype.redraw=function(a){if(a){var c,b,g=this;
if(this.paletteLoading&&0<this.paletteLoading)this.needsDraw=!0;else{if(this.placemarks.length&&(c=this.map.fromLatLngToDivPixel(this.placemarks[0].latLng),b=this.map.getZoom(),this.lastZoom===b&&!this.forceRefresh&&c.equals(this.lastFirstLoc)))return;this.forceRefresh=!1;this.killCurrentDraw();this.lastFirstLoc=c;this.lastZoom=b;this.markerLayer=$('<div class="marker-overlay"/>').click(this.click);this.container.append(this.markerLayer);this.drawPlacemarksTimer=setTimeout(function(){g.drawPlacemarks(g.markerLayer)},
10)}}else this.doRedraw()}}var c={};return{init:function(){a()},MarkerOverlay:g}}();
function clusterInit(){function t(a,c){google.maps.Overlay.call(this);this.cluster_=a;this.className_=a.getMarkerClusterer().getClusterClass();this.styles_=c;this.sums_=this.div_=this.center_=null;this.visible_=!1;this.activeMap_=null}function g(a){this.markerClusterer_=a;this.map_=a.activeMap_;this.gridSize_=a.getGridSize();this.minClusterSize_=a.getMinimumClusterSize();this.averageCenter_=a.getAverageCenter();this.printable_=a.getPrintable();this.markers_=[];this.bounds_=this.center_=null;this.clusterIcon_=
new t(this,a.getStyles());this.map_.addOverlay(this.clusterIcon_)}t.prototype=new google.maps.Overlay;t.prototype.initialize=function(a){this.activeMap_=a;var c=this,e,h;this.div_=document.createElement("div");this.div_.className=this.className_;this.visible_&&this.show();this.activeMap_.getPane(G_MAP_MARKER_PANE).appendChild(this.div_);google.maps.Event.addListener(this.activeMap_,"bounds_changed",function(){h=e});google.maps.Event.addDomListener(this.div_,"mousedown",function(){e=!0;h=!1});google.maps.Event.addDomListener(this.div_,
"click",function(a){e=!1;if(!h){var g,f=c.cluster_.getMarkerClusterer();google.maps.Event.trigger(f,"clusterclick",c.cluster_);f.getZoomOnClick()&&(g=c.cluster_.getBounds(),jc2cui.mapWidget.renderer.fitToBounds(g),setTimeout(function(){jc2cui.mapWidget.renderer.fitToBounds(g);void 0<f.activeMap_.getZoom()&&f.activeMap_.setZoom(NaN)},100));a.cancelBubble=!0;a.stopPropagation&&a.stopPropagation()}});google.maps.Event.addDomListener(this.div_,"mouseover",function(){var a=c.cluster_.getMarkerClusterer();
google.maps.Event.trigger(a,"mouseover",c.cluster_)});google.maps.Event.addDomListener(this.div_,"mouseout",function(){var a=c.cluster_.getMarkerClusterer();google.maps.Event.trigger(a,"mouseout",c.cluster_)})};t.prototype.remove=function(){this.activeMap_=null;this.div_&&this.div_.parentNode&&(this.hide(),google.maps.Event.clearInstanceListeners(this.div_),this.div_.parentNode.removeChild(this.div_),this.div_=null)};t.prototype.redraw=function(a){this.visible_&&(a=this.getPosFromLatLng_(this.center_),
this.div_.style.top=a.y+"px",this.div_.style.left=a.x+"px")};t.prototype.hide=function(){this.div_&&(this.div_.style.display="none");this.visible_=!1};t.prototype.show=function(a){if(this.div_){if(a||!this.div_.style.cssText.length||"none"===this.div_.style.display)a=this.getPosFromLatLng_(this.center_),this.div_.style.cssText=this.createCss(a);this.div_.innerHTML=this.cluster_.printable_?"<img src='"+this.url_+"'><div style='position: absolute; top: 0px; left: 0px; width: "+this.width_+"px;'>"+this.sums_.text+
"</div>":this.sums_.text;this.div_.title="undefined"===typeof this.sums_.title||""===this.sums_.title?this.cluster_.getMarkerClusterer().getTitle():this.sums_.title;this.div_.style.display=""}this.visible_=!0};t.prototype.useStyle=function(a){this.sums_=a;a=Math.max(0,a.index-1);a=Math.min(this.styles_.length-1,a);a=this.styles_[a];this.url_=a.url;this.height_=a.height;this.width_=a.width;this.anchor_=a.anchor;this.anchorIcon_=a.anchorIcon||[parseInt(this.height_/2,10),parseInt(this.width_/2,10)];
this.textColor_=a.textColor||"black";this.textSize_=a.textSize||11;this.textDecoration_=a.textDecoration||"none";this.fontWeight_=a.fontWeight||"bold";this.fontStyle_=a.fontStyle||"normal";this.fontFamily_=a.fontFamily||"Arial,sans-serif";this.backgroundPosition_=a.backgroundPosition||"0 0"};t.prototype.setCenter=function(a){this.center_=a};t.prototype.createCss=function(a){var c=[];this.cluster_.printable_||(c.push("background-image:url("+this.url_+");"),c.push("background-position:"+this.backgroundPosition_+
";"));"object"===typeof this.anchor_?("number"===typeof this.anchor_[0]&&0<this.anchor_[0]&&this.anchor_[0]<this.height_?c.push("height:"+(this.height_-this.anchor_[0])+"px; padding-top:"+this.anchor_[0]+"px;"):c.push("height:"+this.height_+"px; line-height:"+this.height_+"px;"),"number"===typeof this.anchor_[1]&&0<this.anchor_[1]&&this.anchor_[1]<this.width_?c.push("width:"+(this.width_-this.anchor_[1])+"px; padding-left:"+this.anchor_[1]+"px;"):c.push("width:"+this.width_+"px; text-align:center;")):
c.push("height:"+this.height_+"px; line-height:"+this.height_+"px; width:"+this.width_+"px; text-align:center;");c.push("cursor:pointer; top:"+a.y+"px; left:"+a.x+"px; color:"+this.textColor_+"; position:absolute; font-size:"+this.textSize_+"px; font-family:"+this.fontFamily_+"; font-weight:"+this.fontWeight_+"; font-style:"+this.fontStyle_+"; text-decoration:"+this.textDecoration_+";");return c.join("")};t.prototype.getPosFromLatLng_=function(a){a=this.activeMap_.fromLatLngToDivPixel(a);a.x-=this.anchorIcon_[1];
a.y-=this.anchorIcon_[0];return a};g.prototype.getAttributes=function(){return this.attributes_};g.prototype.getSize=function(){return this.markers_.length};g.prototype.getMarkers=function(){return this.markers_};g.prototype.getCenter=function(){return this.center_};g.prototype.getMarkerClusterer=function(){return this.markerClusterer_};g.prototype.getBounds=function(){var a,c=new google.maps.LatLngBounds(this.center_,this.center_),e=this.getMarkers();for(a=0;a<e.length;a++)c.extend(e[a].getPosition());
return c};g.prototype.remove=function(){this.map_.removeOverlay(this.clusterIcon_);delete this.markers_};g.prototype.addMarker=function(a){var c,e;if(this===a.cluster)return!1;this.center_?this.averageCenter_&&(e=this.markers_.length+1,c=(this.center_.lat()*(e-1)+a.getPosition().lat())/e,e=(this.center_.lng()*(e-1)+a.getPosition().lng())/e,this.center_=new google.maps.LatLng(c,e),this.calculateBounds_()):(this.center_=a.getPosition(),this.calculateBounds_());a.cluster=this;this.markers_.push(a);c=
this.markers_.length;1===c&&this.configureAttributesAndRollups_(a);this.performRollup_(a);e=this.markerClusterer_.getMaxZoom();if(null!==e&&this.map_.getZoom()>e)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c<this.minClusterSize_)a.getMap()!==this.map_&&a.setMap(this.map_);else if(c===this.minClusterSize_)for(a=0;a<c;a++)this.markers_[a].setMap(null);else a.setMap(null);this.updateIcon_(this.averageCenter_);return!0};g.prototype.configureAttributesAndRollups_=function(a){var c=this.markerClusterer_.getAttributes(),
e=this.markerClusterer_.getRollups(),h;if(c&&c.length)for(this.attributes_={},h=0;h<c.length;h++)this.attributes_[c[h]]=a.placemark.extendedData?a.placemark.extendedData[c[h]]:void 0;if(e&&e.length)for(this.attributes_=this.attributes_||{},h=0;h<e.length;h++)if(attribute=e[h].attribute)if(rollup=this.attributes_[attribute],!rollup&&(rollup=this.attributes_[attribute]={},(vals=e[h].values)&&vals.length))for(j=0;j<vals.length;j++)rollup[vals[j]]=0};g.prototype.doMarkerAttributesMatch=function(a){var c=
this.markerClusterer_.getAttributes(),e;if(!c)return!0;for(e=0;e<c.length;e++)if(this.attributes_[c[e]]!==(a.placemark.extendedData?a.placemark.extendedData[c[e]]:void 0))return!1;return!0};g.prototype.performRollup_=function(a){var c=this.markerClusterer_.getRollups(),e,h,b;if(c&&c.length)for(b=0;b<c.length;b++)if(e=c[b].attribute)h=this.attributes_[e],(e=a.placemark.extendedData?a.placemark.extendedData[e]:void 0)&&e.length||(e="_other_"),h[e]="undefined"===typeof h[e]?1:h[e]+1};g.prototype.isMarkerInClusterBounds=
function(a){return this.markerClusterer_.isMarkerInBounds_(a,this.bounds_)};g.prototype.calculateBounds_=function(){var a=new google.maps.LatLngBounds(this.center_,this.center_);this.bounds_=this.markerClusterer_.getExtendedBounds(a)};g.prototype.updateIcon_=function(a){var c=this.markers_.length,e=this.markerClusterer_.getMaxZoom();null!==e&&this.map_.getZoom()>e?this.clusterIcon_.hide():c<this.minClusterSize_?this.clusterIcon_.hide():(c=this.markerClusterer_.getStyles().length,c=this.markerClusterer_.getCalculator()(this,
c),this.clusterIcon_.setCenter(this.center_),this.clusterIcon_.useStyle(c),this.clusterIcon_.show(a))};MarkerClusterer.prototype=new google.maps.Overlay;MarkerClusterer.prototype.setMap=function(a){this.activeMap_!==a&&(this.activeMap_&&this.activeMap_.removeOverlay(this),a&&a.addOverlay(this))};MarkerClusterer.prototype.regenerate=function(){clearTimeout(this.regenerateTimeout);var a=this;this.regenerateTimeout=setTimeout(function(){a.resetViewport_(!1);a.redraw_();for(i=0;i<a.markers_.length;i++)marker=
a.markers_[i],marker.cluster||marker.setMap(null)},100)};MarkerClusterer.prototype.initialize=function(a){this.activeMap_=a;var c=this;this.ready_=!0;this.repaint();this.listeners_=[google.maps.Event.addListener(this.activeMap_,"zoomend",function(a,h){c.regenerate()}),google.maps.Event.addListener(this.activeMap_,"moveend",function(){var a=c.activeMap_.getCenter();a.equals(c.lastCenter)||(c.lastCenter=a,c.regenerate())})]};MarkerClusterer.prototype.remove=function(){var a,c;for(a in this.markers_)this.markers_.hasOwnProperty(a)&&
(c=this.markers_[a],c.getMap()!==this.activeMap_&&c.setMap(this.activeMap_),delete c.cluster);this.markers_={};for(i=0;i<this.clusters_.length;i++)this.clusters_[i].remove();this.clusters_=[];for(i=0;i<this.listeners_.length;i++)google.maps.Event.removeListener(this.listeners_[i]);this.listeners_=[];this.activeMap_=null;this.ready_=!1};MarkerClusterer.prototype.redraw=function(a){};MarkerClusterer.prototype.setupStyles_=function(){var a,c;if(!(0<this.styles_.length))for(a=0;a<this.imageSizes_.length;a++)c=
this.imageSizes_[a],this.styles_.push({url:this.imagePath_+(a+1)+"."+this.imageExtension_,height:c,width:c})};MarkerClusterer.prototype.fitMapToMarkers=function(){var a,c=this.getMarkers(),e=new google.maps.LatLngBounds;for(a=0;a<c.length;a++)e.extend(c[a].getPosition());jc2cui.mapWidget.fitToBounds(e)};MarkerClusterer.prototype.getGridSize=function(){return this.gridSize_};MarkerClusterer.prototype.setGridSize=function(a){this.gridSize_=a};MarkerClusterer.prototype.getMinimumClusterSize=function(){return this.minClusterSize_};
MarkerClusterer.prototype.setMinimumClusterSize=function(a){this.minClusterSize_=a};MarkerClusterer.prototype.getMaxZoom=function(){return this.maxZoom_};MarkerClusterer.prototype.setMaxZoom=function(a){this.maxZoom_=a};MarkerClusterer.prototype.getStyles=function(){return this.styles_};MarkerClusterer.prototype.setStyles=function(a){this.styles_=a};MarkerClusterer.prototype.getTitle=function(){return this.title_};MarkerClusterer.prototype.setTitle=function(a){this.title_=a};MarkerClusterer.prototype.getZoomOnClick=
function(){return this.zoomOnClick_};MarkerClusterer.prototype.setZoomOnClick=function(a){this.zoomOnClick_=a};MarkerClusterer.prototype.getAverageCenter=function(){return this.averageCenter_};MarkerClusterer.prototype.setAverageCenter=function(a){this.averageCenter_=a};MarkerClusterer.prototype.getIgnoreHidden=function(){return this.ignoreHidden_};MarkerClusterer.prototype.setIgnoreHidden=function(a){this.ignoreHidden_=a};MarkerClusterer.prototype.getImageExtension=function(){return this.imageExtension_};
MarkerClusterer.prototype.setImageExtension=function(a){this.imageExtension_=a};MarkerClusterer.prototype.getImagePath=function(){return this.imagePath_};MarkerClusterer.prototype.setImagePath=function(a){this.imagePath_=a};MarkerClusterer.prototype.getImageSizes=function(){return this.imageSizes_};MarkerClusterer.prototype.setImageSizes=function(a){this.imageSizes_=a};MarkerClusterer.prototype.getCalculator=function(){return this.calculator_};MarkerClusterer.prototype.setCalculator=function(a){this.calculator_=
a};MarkerClusterer.prototype.getPrintable=function(){return this.printable_};MarkerClusterer.prototype.setPrintable=function(a){this.printable_=a};MarkerClusterer.prototype.getBatchSizeIE=function(){return this.batchSizeIE_};MarkerClusterer.prototype.setBatchSizeIE=function(a){this.batchSizeIE_=a};MarkerClusterer.prototype.getClusterClass=function(){return this.clusterClass_};MarkerClusterer.prototype.setClusterClass=function(a){this.clusterClass_=a};MarkerClusterer.prototype.getAttributes=function(){return this.attributes_};
MarkerClusterer.prototype.setAttributes=function(a){this.attributes_=a};MarkerClusterer.prototype.getRollups=function(){return this.rollups_};MarkerClusterer.prototype.setRollups=function(a){this.rollups_=a};MarkerClusterer.prototype.getMarkers=function(){return this.markers_};MarkerClusterer.prototype.getTotalMarkers=function(){return this.markers_.length};MarkerClusterer.prototype.getClusters=function(){return this.clusters_};MarkerClusterer.prototype.getTotalClusters=function(){return this.clusters_.length};
MarkerClusterer.prototype.addMarker=function(a,c){this.pushMarkerTo_(a);c||this.redraw_()};MarkerClusterer.prototype.addMarkers=function(a,c){var e;for(e=0;e<a.length;e++)this.pushMarkerTo_(a[e]);c||this.redraw_()};MarkerClusterer.prototype.pushMarkerTo_=function(a){var c=this;a.getDraggable()&&google.maps.Event.addListener(a,"dragend",function(){c.ready_&&(delete this.cluster,c.repaint())});this.markers_[a.placemark.internalId]=a;a.cluster&&(delete a.cluster,clearTimeout(this.repaintTimer),this.repaintTimer=
setTimeout(function(){c.repaint()},200))};MarkerClusterer.prototype.removeMarker=function(a,c){var e=this.removeMarker_(a);!c&&e&&this.repaint();return e};MarkerClusterer.prototype.removeMarkers=function(a,c){var e,h,b=!1;for(e=0;e<a.length;e++)h=this.removeMarker_(a[e]),b=b||h;!c&&b&&this.repaint();return b};MarkerClusterer.prototype.removeMarker_=function(a){var c=this.markers_[a.placemark.internalId];c&&(a.setMap(null),delete this.markers_[a.placemark.internalId]);return void 0!==c};MarkerClusterer.prototype.clearMarkers=
function(){this.resetViewport_(!0);this.markers_={}};MarkerClusterer.prototype.repaint=function(){var a=this.clusters_.slice();this.clusters_=[];this.resetViewport_(!1);this.redraw_();setTimeout(function(){var c;for(c=0;c<a.length;c++)a[c].remove()},0)};MarkerClusterer.prototype.getExtendedBounds=function(a){var c=new google.maps.LatLng(a.getNorthEast().lat(),a.getNorthEast().lng());a=new google.maps.LatLng(a.getSouthWest().lat(),a.getSouthWest().lng());c=this.activeMap_.fromLatLngToDivPixel(c);c.x+=
this.gridSize_;c.y-=this.gridSize_;a=this.activeMap_.fromLatLngToDivPixel(a);a.x-=this.gridSize_;a.y+=this.gridSize_;return{sw:a,ne:c}};MarkerClusterer.prototype.redraw_=function(){this.createClusters()};MarkerClusterer.prototype.resetViewport_=function(a){var c,e;for(c=0;c<this.clusters_.length;c++)this.clusters_[c].remove();this.clusters_=[];for(c in this.markers_)this.markers_.hasOwnProperty(c)&&(e=this.markers_[c],delete e.cluster,a&&e.setMap(null))};MarkerClusterer.prototype.distanceBetweenPoints_=
function(a,c,e,h){var b=a*Math.PI/180,g=e*Math.PI/180;c=(h-c)*Math.PI/180;a=Math.pow(Math.sin((e-a)*Math.PI/180/2),2)+Math.cos(b)*Math.cos(g)*Math.pow(Math.sin(c/2),2);return 12756*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))};MarkerClusterer.prototype.isMarkerInBounds_=function(a,c){var e=this.activeMap_.fromLatLngToDivPixel(a.getPosition());return e.x>c.sw.x&&e.x<c.ne.x&&e.y>c.ne.y&&e.y<c.sw.y};MarkerClusterer.prototype.addToClosestCluster_=function(a){var c,e,h;c=a.getPosition();var b=c.lat(),l=c.lng(),
f=4E4,s=null;for(c=0;c<this.clusters_.length;c++)if(h=this.clusters_[c],(!this.attributes_||h.doMarkerAttributesMatch(a))&&h.isMarkerInClusterBounds(a)&&(e=h.getCenter()))e=this.distanceBetweenPoints_(e.lat(),e.lng(),b,l),e<f&&(f=e,s=h);s?s.addMarker(a):(h=new g(this),h.addMarker(a),this.clusters_.push(h))};MarkerClusterer.prototype.createClusters=function(){var a;a:{var c=this.markers_;if(Object.keys)a=Object.keys(c);else{var e=Object.prototype.hasOwnProperty,h=!{toString:null}.propertyIsEnumerable("toString"),
b="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),g=b.length;if("object"!=typeof c&&"function"!=typeof c||null===c){a=void 0;break a}a=[];for(var f in c)e.call(c,f)&&a.push(f);if(h)for(c=0;c<g;c++)e.call(o,b[c])&&a.push(b[c])}}this.createClusters_(a,0)};MarkerClusterer.prototype.createClusters_=function(a,c){var e,h,b=this;if(this.ready_){0===c&&(google.maps.Event.trigger(this,"clusteringbegin",this),"undefined"!==typeof this.timerRefStatic&&
(clearTimeout(this.timerRefStatic),delete this.timerRefStatic));3<this.activeMap_.getZoom()&&(e=new google.maps.LatLngBounds(this.activeMap_.getBounds().getSouthWest(),this.activeMap_.getBounds().getNorthEast()));var g=e?this.getExtendedBounds(e):void 0,f=Math.min(c+this.batchSize_,a.length);for(e=c;e<f;e++)h=a[e],this.markers_.hasOwnProperty(h)&&(h=this.markers_[h],h.cluster||(!(!this.ignoreHidden_||this.ignoreHidden_&&h.getVisible())||g&&!this.isMarkerInBounds_(h,g))||this.addToClosestCluster_(h));
f<a.length?this.timerRefStatic=setTimeout(function(){b.createClusters_(a,f)},0):(delete this.timerRefStatic,google.maps.Event.trigger(this,"clusteringend",this))}};MarkerClusterer.prototype.extend=function(a,c){return function(a){for(var c in a.prototype)this.prototype[c]=a.prototype[c];return this}.apply(a,[c])};MarkerClusterer.CALCULATOR=function(a,c){for(var e=0,g=a.getMarkers().length.toString(),b=g;0!==b;)b=parseInt(b/10,10),e++;e=Math.min(e,c);return{text:g,index:e,title:""}};MarkerClusterer.BATCH_SIZE=
2E3;MarkerClusterer.BATCH_SIZE_IE=500;MarkerClusterer.IMAGE_PATH="http://google-maps-utility-library-v3.googlecode.com/svn/trunk/markerclustererplus/images/m";MarkerClusterer.IMAGE_EXTENSION="png";MarkerClusterer.IMAGE_SIZES=[53,56,66,78,90]}
function MarkerClusterer(t,g,a){google.maps.Overlay.call(this);g=g||[];a=a||{};this.markers_={};this.clusters_=[];this.listeners_=[];this.activeMap_=null;this.ready_=!1;this.gridSize_=a.gridSize||60;this.minClusterSize_=a.minimumClusterSize||2;this.maxZoom_=a.maxZoom||null;this.styles_=a.styles||[];this.title_=a.title||"";this.zoomOnClick_=!0;void 0!==a.zoomOnClick&&(this.zoomOnClick_=a.zoomOnClick);this.averageCenter_=!1;void 0!==a.averageCenter&&(this.averageCenter_=a.averageCenter);this.ignoreHidden_=
!1;void 0!==a.ignoreHidden&&(this.ignoreHidden_=a.ignoreHidden);this.printable_=!1;void 0!==a.printable&&(this.printable_=a.printable);this.imagePath_=a.imagePath||MarkerClusterer.IMAGE_PATH;this.imageExtension_=a.imageExtension||MarkerClusterer.IMAGE_EXTENSION;this.imageSizes_=a.imageSizes||MarkerClusterer.IMAGE_SIZES;this.calculator_=a.calculator||MarkerClusterer.CALCULATOR;this.batchSize_=a.batchSize||MarkerClusterer.BATCH_SIZE;this.batchSizeIE_=a.batchSizeIE||MarkerClusterer.BATCH_SIZE_IE;this.clusterClass_=
a.clusterClass||"cluster";this.attributes_=a.attributes;this.rollups_=a.rollups;-1!==navigator.userAgent.toLowerCase().indexOf("msie")&&(this.batchSize_=this.batchSizeIE_);this.setupStyles_();this.addMarkers(g,!0);t.addOverlay(this)}util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.clusterManager=function(){function t(a){var b=[];$.each(a,function(a,c){if("object"===typeof c)return b.push(t(c)),b.push(", "),!0;b.push(a);b.push(": ");b.push(c);b.push(", ")});b.length?(b.pop(),a=b.join("")):a="No data found";return a}function g(a,b){var c;"string"===typeof b&&-1!==b.indexOf("${")&&(b=b.replace(/\$\{([\w.]+?)\}/g,function(b,e){if("count"===e)return a.getSize();var f=e.split(/\.+/),g=a.getAttributes();for(c=0;c<f.length&&(g=g[f[c]],g);c++);"object"===typeof g&&
(g=t(g));return g}),b=isNaN(b)||!b?b:parseFloat(b));return b}function a(b){if(jc2cui.mapWidget.options().clustering&&jc2cui.mapWidget.options().clustering.value)return b.clustering?b:b.parent?a(b.parent):b.overlayId&&(b=p[b.overlayId])?a(b):m}function c(a,b,c){c=c.style||{};a={name:g(b,c.title)||a.getTitle()||"",description:g(b,c.description)||"",placemarks:b.getMarkers(),attributes:"placemark",bounds:b.getBounds()};jc2cui.mapWidget.showClusterInfoWindow(a)}function e(a,b){var e=$.extend(!0,{},f,
"object"===typeof b.clustering?b.clustering:{}),h=new MarkerClusterer(s,a,{zoomOnClick:!1,gridSize:e.distance,minimumClusterSize:e.threshold,maxZoom:e.maxZoom,styles:[{url:"/widgets/common/kml/icons/"+((e.style||{}).fillColor||"red")+".png",height:33,width:34}],calculator:function(a,b){var c=0,f,h=a.getMarkers().length,l=h.toString();for(e.style&&e.style.title&&(f=g(a,e.style.title));0!==h;)h=Math.floor(h/10),c++;c=Math.min(c,b);return{text:l,index:c,title:f}},attributes:e.attributes,rollups:e.rollups});
google.maps.event?google.maps.event.addListener(h,"click",function(a){c(h,a,e)}):google.maps.Event.addListener(h,"clusterclick",function(a){c(h,a,e)});return h}function h(a,b,c){b&&(a?b.markerClusterer?b.markerClusterer.addMarkers(c):(b.markerClusterer=e(c,b),E.push(b)):b.markerClusterer&&b.markerClusterer.removeMarkers(c))}function b(b,c){var f=a(c),g=[],h=[],l;if(f)if(b){c.getAllVisiblePlacemarks(g);for(l=0;l<g.length;l++)g[l].getPosition&&h.push(g[l]);f.markerClusterer?f.markerClusterer.addMarkers(h):
(f.markerClusterer=e(h,f),E.push(f))}else if(f.markerClusterer)if(c===f)f.markerClusterer.setMap(null),delete f.markerClusterer,E.splice($.inArray(f,E),1);else{c.getAllPlacemarks(g);for(l=0;l<g.length;l++)(g[l].getPosition||g[l].draggable)&&h.push(g[l]);f.markerClusterer.removeMarkers(h)}}function l(b,c){var e=a(c.placemark),f;e&&e.markerClusterer&&(e.markerClusterer.markersToAdd=e.markerClusterer.markersToAdd||[],e.markerClusterer.markersToRemove=e.markerClusterer.markersToRemove||[],b?e.markerClusterer.markersToAdd.push(c):
e.markerClusterer.markersToRemove.push(c),f=function(a){a.markerClusterer.markersToAdd.length&&(h(!0,a,a.markerClusterer.markersToAdd),a.markerClusterer.markersToAdd=[]);a.markerClusterer.markersToRemove.length&&(h(!1,a,a.markerClusterer.markersToRemove),a.markerClusterer.markersToRemove=[])},clearTimeout(e.markersTimeout),e.markersTimeout=setTimeout(function(){f(e)},100))}var f={distance:60,threshold:2,maxZoom:19,style:{label:"${count}",title:"${count} items"}},s,p,m={},E=[];return{init:function(a,
b){s=a;p=b},getClusterer:function(b){return a(b)},cluster:function(a,c){b(a,c)},setMarkerVisible:function(a,b){l(a,b)},setClustering:function(a){a?$.each(p,function(c,e){$.each(e.docs,function(c,e){b(a,e)})}):($.each(E,function(a,b){b.markerClusterer.setMap(null);delete b.markerClusterer}),E=[],m={})}}}();util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.latLonControl=function(){function t(){return this}return{init:function(){t.prototype=new google.maps.Control(!0,!1);t.prototype.printable=function(){return!0};t.prototype.selectable=function(){return!1};t.prototype.getDefaultPosition=function(){return new google.maps.ControlPosition(google.maps.ANCHOR_BOTTOM_RIGHT,new google.maps.Size(0,14))};t.prototype.initialize=function(g){var a=this,c=$('<div class="customMapControl"><span id="latLon-control"></span><div class="controlBack"></div></div>');
g.getContainer().appendChild(c[0]);$(".controlBack",c).css({opacity:0.3});this.control=$("#latLon-control",c)[0];google.maps.Event.addListener(g,"mousemove",function(c){a.updatePosition(c)});return c[0]};t.prototype.updatePosition=function(g){this.control.innerHTML=g.toUrlValue(4)}},Control:t}}();var OWF;function googleLoaded(){jc2cui.mapWidget.renderer.googleReady()}function mapsLoaded(){jc2cui.mapWidget.renderer.mapsReady()}util.namespace("jc2cui.mapWidget");
jc2cui.mapWidget.renderer=function(){function t(a,b){"marker"===a.data.type?b?a.mapObject.enableDragging():a.mapObject.disableDragging():b?a.mapObject.enableEditing():a.mapObject.disableEditing()}function g(a,b,c){this.id=a;this.clustering=c;this.children={};this.docs={};this.features={};b?(this.parent=b,b.children[this.id]=this,this.visible=b.visible):this.visible=!0;r[this.id]=this}function a(a){var b;switch(a.data.type){case "marker":b=new google.maps.LatLngBounds;b.extend(a.mapObject.getLatLng());
break;case "line":case "shape":b=a.mapObject.getBounds()}return b}function c(a,b){"transparent"===a&&(a="#ffffff",b=0);var c=a.replace(/#?([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})/i,"ff$3$2$1").toLowerCase(),d;void 0!==b&&(d=Math.floor(255*b).toString(16),2>d.length&&(d="0"+d),c=d+c.substring(2));return c}function e(a){var b=[];b.push('<kml xmlns="http://www.opengis.net/kml/2.2" xmlns:gx="http://www.google.com/kml/ext/2.2" xmlns:kml="http://www.opengis.net/kml/2.2" xmlns:atom="http://www.w3.org/2005/Atom"><Placemark id="');
b.push(a.id);b.push('">');a.title&&(b.push("<name>"),b.push(a.title),b.push("</name>"));a.description&&(b.push("<description><![CDATA["),b.push(a.description),b.push("]]\x3e</description>"));b.push("<Style>");switch(a.type){case "marker":b.push("<IconStyle><Icon><href>");b.push(a.iconUrl);b.push('</href></Icon><hotSpot x="0.5" y="0" xunits="fraction" yunits="fraction"></hotSpot></IconStyle></Style><Point>');break;case "line":case "shape":b.push("<LineStyle><color>"),b.push(c(a.strokeColor,a.strokeOpacity)),
b.push("</color><width>"),b.push(a.strokeWeight),b.push("</width></LineStyle>"),"shape"===a.type&&(b.push("<PolyStyle><color>"),b.push(c(a.fillColor,a.fillOpacity)),b.push("</color></PolyStyle>")),b.push("</Style>"),"line"===a.type?b.push("<LineString><tessellate>1</tessellate>"):b.push("<Polygon><outerBoundaryIs><LinearRing>")}b.push("<coordinates>");"shape"===a.type&&0<a.coordinates.length&&a.coordinates.push(a.coordinates[0]);$.each(a.coordinates,function(a,c){b.push(c.lng());b.push(",");b.push(c.lat());
b.push(",0 ")});b.push("</coordinates>");switch(a.type){case "marker":b.push("</Point>");break;case "shape":b.push("</LinearRing></outerBoundaryIs></Polygon>");break;case "line":b.push("</LineString>")}b.push("</Placemark></kml>");return b.join("")}function h(a){jc2cui.mapWidget.showUserDrawnEditWindow(a.data,{deleted:function(){jc2cui.mapWidget.deleteDrawing(a.data.id)},updated:function(b){var c=e(b);switch(a.data.type){case "marker":b=new google.maps.Marker(b.coordinates[0],{icon:new google.maps.Icon(a.mapObject.getIcon(),
b.iconUrl),title:b.title,draggable:!0});google.maps.Event.addListener(b,"dragend",function(b){a.data.coordinates[0]=b;c=e(a.data);jc2cui.mapWidget.publishDrawing(c,a.data.id,a.data.title,!a.mapObject.isHidden())});d.addOverlay(b);d.removeOverlay(a.mapObject);a.mapObject=b;ia(a);break;case "line":a.mapObject.setStrokeStyle({color:b.strokeColor,weight:b.strokeWeight,opacity:b.strokeOpacity});break;case "shape":a.mapObject.setStrokeStyle({color:b.strokeColor,weight:b.strokeWeight,opacity:b.strokeOpacity}),
a.mapObject.setFillStyle({color:b.fillColor,opacity:b.fillOpacity})}jc2cui.mapWidget.publishDrawing(c,a.data.id,a.data.title,!a.mapObject.isHidden())}})}function b(a){var b=$("body"),c=$(d.getContainer()),f=$('<img class="placementmarker" src="'+jc2cui.mapWidget.getDefaultDrawingIcon()+'">').appendTo(b),g,l,m,X=jc2cui.mapWidget.getNewId();f.css({left:(a.pageX-f.width()/2).toString()+"px",top:(a.pageY-f.height()-1).toString()+"px"});3>J++&&(g=$('<span class="tooltip">Click to place me on the map</span>').appendTo(b).css({left:(a.pageX+
18).toString()+"px",top:(a.pageY-9).toString()+"px"}));l=function(a){a.pageX<c.position().left||(f.css({left:(a.pageX-f.width()/2).toString()+"px",top:(a.pageY-f.height()-1).toString()+"px"}),g&&g.css({left:(a.pageX+18).toString()+"px",top:(a.pageY-9).toString()+"px"}))};b.bind("mousemove",l);m=google.maps.Event.addListener(d,"click",function(a,b,c){a="marker "+ ++k.marker;var q={type:"marker",id:X,coordinates:[b||c],title:a,iconUrl:jc2cui.mapWidget.getDefaultDrawingIcon()},f={data:q},g;aa||(aa=new google.maps.Icon(null,
q.iconUrl),aa.iconAnchor=new google.maps.Point(16,32),aa.iconSize=new google.maps.Size(32,32),aa.shadow="");f.mapObject=new google.maps.Marker(q.coordinates[0],{icon:aa,title:q.title,draggable:!0});f.getBounds=function(){var a=new google.maps.LatLngBounds;f.mapObject.extendBounds(a);return a};q.getBounds=f.getBounds;d.addOverlay(f.mapObject);google.maps.Event.addListener(f.mapObject,"dragend",function(a){q.coordinates[0]=a;g=e(q);jc2cui.mapWidget.publishDrawing(g,f.data.id,f.data.title,!f.mapObject.isHidden())});
ia(f);t(f,!0);h(f);g=e(q);jc2cui.mapWidget.publishDrawing(g,f.data.id,f.data.title,!f.mapObject.isHidden());M(0)});V=function(){f.remove();g&&g.remove();b.unbind("mousemove",l);google.maps.Event.removeListener(m)}}function l(a,b){var c=$(d.getContainer()),f=$("body"),g,l=jc2cui.mapWidget.getNewId(),m,X,n,p,r;g=b?new google.maps.Polygon([],"#15428B",3,0.8,"#DFE8F6",0.5):new google.maps.Polyline([],"#15428B",3,0.8);d.addOverlay(g);g.enableDrawing();if(b&&3>ha++||!b&&3>T++)X="Click to start drawing a "+
(b?"shape":"line"),n=$('<span class="tooltip">'+X+"</span>").appendTo(f).css({left:(a.pageX+18).toString()+"px",top:(a.pageY-9).toString()+"px"});n&&(p=function(a){a.pageX<c.position().left||n.css({left:(a.pageX+18).toString()+"px",top:(a.pageY-9).toString()+"px"})},f.bind("mousemove",p),r=google.maps.Event.addListener(d,"click",function(a,c,d){X=1===g.getVertexCount()||b&&2===g.getVertexCount()?"Click to continue drawing a ":"Click first or last point to end this ";X+=b?"shape":"line";n.html(X)}));
google.maps.Event.addListener(g,"endline",function(){var a=(b?"shape ":"line ")+ ++k[b?"shape":"line"],c={type:b?"shape":"line",id:l,coordinates:[],title:a,iconUrl:[jc2cui.mapWidget.getAppPath(),"images/",b?"poly":"line",'Mask.png"'].join(""),strokeColor:"#15428B",strokeWeight:3,strokeOpacity:0.8},d,q;m=!0;for(d=0;d<g.getVertexCount();d++)c.coordinates.push(g.getVertex(d));b&&(c.fillColor="#DFE8F6",c.fillOpacity=0.5);q={data:c,mapObject:g,getBounds:function(){var a=new google.maps.LatLngBounds;q.mapObject.extendBounds(a);
return a}};c.getBounds=q.getBounds;ia(q);setTimeout(function(){t(q,!0)},500);google.maps.Event.addListener(g,"lineupdated",function(){c.coordinates=[];for(d=0;d<g.getVertexCount();d++)c.coordinates.push(g.getVertex(d));var a=e(c);jc2cui.mapWidget.publishDrawing(a,q.data.id,q.data.title,!q.mapObject.isHidden())});h(q);a=e(c);jc2cui.mapWidget.publishDrawing(a,q.data.id,q.data.title,!q.mapObject.isHidden());M(0)});google.maps.Event.addListener(g,"cancelline",function(){M(0)});V=function(){n&&(n.remove(),
f.unbind("mousemove",p),google.maps.Event.removeListener(r));m||(g.disableEditing(),d.removeOverlay(g))}}function f(a){a?N?N.show():(N=$('<div id="drawingtools"><img id="select" title="Select/edit map features"><img id="placemark" title="Add a placemark"><span><img id="poly"><span id="polydrop"></span></span><div id="polytype" class="menu"><div id="line" class="menuitem"><img src="images/Ml.png">&nbsp;Draw a line</div><div id="shape" class="menuitem"><img src="images/Mp.png">&nbsp;Draw a shape</div></div>').appendTo($(d.getContainer())),
Z=$("#select",N).click(function(a){M(0,a)}),fa=$("#placemark",N).click(function(a){M(1,a)}),Y=$("#poly",N).click(function(a){M(U,a)}),Q=$("#polytype",N),$("#polydrop",N).click(function(a){Q.show()}),$("#line",Q).hover(function(){$(this).addClass("selectedmenuitem")},function(){$(this).removeClass("selectedmenuitem")}).click(function(a){U=2;M(2,a)}),$("#shape",Q).hover(function(){$(this).addClass("selectedmenuitem")},function(){$(this).removeClass("selectedmenuitem")}).click(function(a){U=3;M(3,a)}),
N.mouseleave(function(a){Q.hide()}),M(0)):N&&(N.hide(),M(0));$.each(r,function(b,c){$.each(c.features,function(b,c){t(c,a)})})}function s(){var a=d.getBounds(),b=d.getCenter(),c=d.getZoom(),c=352E5/Math.pow(2,c);return jc2cui.mapWidget.createViewStatus(a.getSouthWest().lat(),a.getSouthWest().lng(),a.getNorthEast().lat(),a.getNorthEast().lng(),b.lat(),b.lng(),c)}function p(a,b,c){d.addOverlay(a);b.visible||a.hide();google.maps.Event.addListener(a,"click",function(a){for(var d,e;c;){if(c.overlayId){d=
c.overlayId;e=c.featureId;break}c=c.parent}a={selectedId:b.id||void 0,selectedName:b.name||void 0,featureId:e,overlayId:d};jc2cui.mapWidget.showPlacemarkInfoWindow(b);jc2cui.mapWidget.itemSelected(a)})}function m(a){var b={strokeColor:a.style&&a.style.LineStyle&&a.style.LineStyle.color?a.style.LineStyle.color.color:"#ffffff",strokeOpacity:a.style&&a.style.LineStyle&&a.style.LineStyle.color?a.style.LineStyle.color.opacity:1,strokeWeight:a.style&&a.style.LineStyle&&a.style.LineStyle.width?a.style.LineStyle.width:
1,fillColor:a.style&&a.style.PolyStyle&&a.style.PolyStyle.color?a.style.PolyStyle.color.color:"#ffffff",fillOpacity:a.style&&a.style.PolyStyle&&a.style.PolyStyle.color?a.style.PolyStyle.color.opacity:1,map:d,visible:a.visible,title:a.name};a.style&&(a.style.PolyStyle&&"0"===a.style.PolyStyle.fill)&&(b.fillOpacity=0);return b}function E(a){var b=[],c;for(c=0;c<a.length;c++)b.push(new google.maps.LatLng(a[c].lat,a[c].lon));return b}function A(){function a(b,c,d){this.placemark=b;this.latLng=c;this.markerOverlay=
d;this.visible=b.visible}function b(a,c,d,e){this.url=a;this.bounds=c;this.map=d;this.opacity=e;this.groundOverlay=new google.maps.GroundOverlay(a,c);this.map.addOverlay(this.groundOverlay);this.trySetOpacityAttempts=0;this.setOpacity();var q=this;google.maps.Event.addListener(d,"zoomend",function(){q.isHidden()||(q.trySetOpacityAttempts=0,q.setOpacity())})}var c,e="",f,g,h;if(n.fusionMap)for(d=new GFusionMap(document.getElementById("map"),{isAuthenticated:!1,layers:n.fusionMap.layers,serverUrl:n.fusionMap.serverUrl,
useGoogleLayers:!1},{logoPassive:!0}),h=0;h<n.fusionMap.arcGISLayers;h++)addArcGISMapType(n.fusionMap.arcGISLayers[h].url,0,15,n.fusionMap.arcGISLayers[h].name,!0,1024,512,512,d);else d=new google.maps.Map2(document.getElementById("map"),{logoPassive:!0});d.setCenter(new google.maps.LatLng(39.5,-98.3),3);"function"===typeof d.getDefaultUI?(e=d.getDefaultUI(),e.controls.scalecontrol=!0,d.setUI(e)):(d.addControl(new GSmallMapControl),d.addControl(new GMapTypeControl),d.addControl(new GScaleControl),
new GKeyboardHandler(d),d.enableDoubleClickZoom(),d.enableScrollWheelZoom());la=d.getMapTypes().slice();ja=d.getCurrentMapType();google.maps.Event.addListener(d,"mousemove",function(a){R=a});$(d.getPane(G_MAP_MAP_PANE)).parent().mousedown(function(a){ga={x:a.pageX,y:a.pageY}}).mouseup(function(a){if(!ga||2>Math.abs(a.pageX-ga.x)&&2>Math.abs(a.pageY-ga.y)){var b=(new Date).getTime(),c=1;ma===a.which&&500>b-ka?(c=2,ka=1E3):ka=b;ma=a.which;jc2cui.mapWidget.mapClicked(R.lat(),R.lng(),c,a.which,a.shiftKey,
a.ctrlKey,a.altKey)}ga=null});f=function(){clearTimeout(c);c=setTimeout(function(){jc2cui.mapWidget.publishView(s());$.each(r,function(a,b){$.each(b.docs,function(a,b){b.onViewUpdate()})})},1E3)};google.maps.Event.addListener(d,"moveend",function(){var a=d.getCenter();a.equals(B)||(B=a,f())});google.maps.Event.addListener(d,"zoomend",f);google.maps.Event.addListener(d,"maptypechanged",function(){var a=d.getCurrentMapType();$.each(z,function(b,c){c.features[0].mapType!==a?c.visible&&(jc2cui.mapWidget.sidebar?
jc2cui.mapWidget.sidebar.hideFeature(c.featureId,c.overlayId,!0):c.setVisible(!1,!0)):c.visible||(jc2cui.mapWidget.sidebar?jc2cui.mapWidget.sidebar.showFeature(c.featureId,c.overlayId,!0):c.setVisible(!0,!0))});-1<$.inArray(a,la)&&(ja=a)});a.prototype.removeFromMap=function(){};a.prototype.extendBounds=function(a){a.extend(this.latLng)};a.prototype.setVisible=function(a){this.visible!==a&&(this.markerOverlay.placemarkVisibilityChanged(this.placemark),this.visible=a,jc2cui.mapWidget.clusterManager.setMarkerVisible(a,
this))};a.prototype.getLatLng=function(){return this.latLng};a.prototype.getPosition=function(){return this.getLatLng()};a.prototype.setMap=function(a){a?(this.placemark.addedToMarkerOverlay||this.markerOverlay.addMarker(this.placemark,this.getLatLng()),this.markerOverlay.placemarkVisibilityChanged(this.placemark)):this.placemark.addedToMarkerOverlay&&(this.markerOverlay.removeMarker(this.placemark),this.markerOverlay.placemarkVisibilityChanged(this.placemark))};a.prototype.getMap=function(){return this.placemark.addedToMarkerOverlay?
d:void 0};a.prototype.getDraggable=function(){return!1};a.prototype.getVisible=function(){return this.visible};b.prototype.extendBounds=function(a){this.bounds&&!this.bounds.isEmpty()&&(a.extend(this.bounds.getSouthWest()),a.extend(this.bounds.getNorthEast()))};b.prototype.setOpacity=function(){if(this.map&&!this.groundOverlay.isHidden()){var a=this,b=$("img[src$='"+this.url+"']");b.length?b.css("opacity",this.opacity):60>++this.trySetOpacityAttempts&&setTimeout(function(){a.setOpacity()},1E3)}};
b.prototype.removeFromMap=function(){this.map.removeOverlay(this.groundOverlay)};b.prototype.isHidden=function(){return this.groundOverlay.isHidden()};b.prototype.setVisible=function(a){a?(this.groundOverlay.show(),this.trySetOpacityAttempts=0,this.setOpacity()):this.groundOverlay.hide()};b.prototype.refreshIcon=function(a){this.remove();a.features=[g.groundOverlay(a)]};g={proxy:n.proxy,maxFileSize:n.constraints?n.constraints.maxFileSize:void 0,maxPlacemarks:n.constraints?n.constraints.maxPlacemarks:
void 0,container:"#map",refreshInfoWindow:function(a){jc2cui.mapWidget.showPlacemarkInfoWindow(a)},containerRemoved:function(a){a.markerOverlay&&a.markerOverlay.removeFromMap();jc2cui.mapWidget.clusterManager.cluster(!1,a)},parseCallback:function(a){var b,c;c=a;var d;for(jc2cui.mapWidget.totalMarkersLoaded(jc2cui.mapWidget.kmlParser.totalEntities());c.parent;)c=c.parent;b=c.overlayId;c=c.featureId;if(d=jc2cui.mapWidget.kmlParser.getTreeData(a,a.visible,b,c))if($.isArray(d))for(h=0;h<d.length;h++)jc2cui.mapWidget.addTreeItems(d[h],
b,c,a.parent?a.parent.internalId:void 0);else jc2cui.mapWidget.addTreeItems(d,b,c,a.parent?a.parent.internalId:void 0);jc2cui.mapWidget.clusterManager.getClusterer(a)?jc2cui.mapWidget.clusterManager.cluster(!0,a):a.markerOverlay&&a.markerOverlay.doRedraw()},region:function(a){a.latLonAltBox=new google.maps.LatLngBounds(new google.maps.LatLng(a.latLonAltBox.south,a.latLonAltBox.west),new google.maps.LatLng(a.latLonAltBox.north,a.latLonAltBox.east));return a},isRegionActive:function(a){var b,c,e;if(!d.getBounds().intersects(a.latLonAltBox))return!1;
b=d.fromLatLngToDivPixel(a.latLonAltBox.getSouthWest());c=d.fromLatLngToDivPixel(a.latLonAltBox.getNorthEast());e=Math.abs(c.x-b.x);b=Math.abs(c.y-b.y);e=Math.round(Math.sqrt(e*b)).toFixed(0);return e<a.lod.minLodPixels||0<=a.lod.maxLodPixels&&e>a.lod.maxLodPixels?!1:!0},formatView:function(a){var b=d.getBounds(),c=b.getSouthWest(),e=b.getNorthEast(),q=new google.maps.LatLng(e.lat(),c.lng()),b=b.getCenter(),f=d.getZoom(),f=352E5/Math.pow(2,f);a=a.replace("[bboxWest]",c.lng());a=a.replace("[bboxSouth]",
c.lat());a=a.replace("[bboxEast]",e.lng());a=a.replace("[bboxNorth]",e.lat());a=a.replace("[lookatLon]",b.lng());a=a.replace("[lookatLat]",b.lat());a=a.replace("[lookatRange]",f);a=a.replace("[lookatTilt]",0);a=a.replace("[lookatHeading]",0);a=a.replace("[horizFov]",e.distanceFrom(q)/2/f);a=a.replace("[vertFov]",c.distanceFrom(q)/2/f);a=a.replace("[horizPixels]",d.getSize().width);a=a.replace("[vertPixels]",d.getSize().height);return a=a.replace("[terrainEnabled]",0)},marker:function(b,c,e){e.markerOverlay||
(e.markerOverlay=new jc2cui.mapWidget.markerOverlay.MarkerOverlay(d,e));c=new google.maps.LatLng(c.lat,c.lon);jc2cui.mapWidget.clusterManager.getClusterer(e)||e.markerOverlay.addMarker(b,c);return new a(b,c,e.markerOverlay)},polyline:function(a,b,c){var d=m(a);d.path=E(b);b=new google.maps.Polyline(d.path,d.strokeColor,d.strokeWeight,d.strokeOpacity);p(b,a,c);return b},polygon:function(a,b,c){var d,e=m(a),q,f=[];for(d=0;d<b.length;d++)q=E(b[d]),q=new google.maps.Polygon(q,e.strokeColor,e.strokeWeight,
e.strokeOpacity,e.fillColor,e.fillOpacity),p(q,a,c),f.push(q);return f},groundOverlay:function(a,c){var e;e=a.icon.viewFormat&&a.icon.viewFormat.length&&0<=a.icon.viewFormat.indexOf("BBOX")?d.getBounds():new google.maps.LatLngBounds(new google.maps.LatLng(a.latLonBox.south,a.latLonBox.west),new google.maps.LatLng(a.latLonBox.north,a.latLonBox.east));e=new b(a.icon.getHref(),e,d,a.opacity);a.visible||e.setVisible(!1);return e},bounds:function(){return new google.maps.LatLngBounds}};google.maps.Marker.prototype.extendBounds=
function(a){a.extend(this.getLatLng())};google.maps.Marker.prototype.removeFromMap=function(){d.removeOverlay(this)};google.maps.Marker.prototype.setVisible=function(a){a?this.show():this.hide()};google.maps.Polyline.prototype.extendBounds=function(a){var b=this.getBounds();b&&!b.isEmpty()&&(a.extend(b.getSouthWest()),a.extend(b.getNorthEast()))};google.maps.Polyline.prototype.removeFromMap=google.maps.Marker.prototype.removeFromMap;google.maps.Polyline.prototype.setVisible=google.maps.Marker.prototype.setVisible;
google.maps.Polygon.prototype.extendBounds=google.maps.Polyline.prototype.extendBounds;google.maps.Polygon.prototype.removeFromMap=google.maps.Marker.prototype.removeFromMap;google.maps.Polygon.prototype.setVisible=google.maps.Marker.prototype.setVisible;jc2cui.mapWidget.kmlParser.init(g);jc2cui.mapWidget.clusterManager.init(d,r);jc2cui.mapWidget.markerOverlay.init();jc2cui.mapWidget.infoWindow.init({containment:"#map"});e=document.location.href;e=e.substring(0,e.lastIndexOf("/")+1);$('<link rel="stylesheet" type="text/css" href="'+
(e+"css/google.maps.v2.all.min.css")+'" >').appendTo("head");clusterInit();jc2cui.mapWidget.latLonControl.init();d.addControl(new jc2cui.mapWidget.latLonControl.Control);jc2cui.mapWidget.rendererReady()}function w(){google.load("maps","2",{callback:function(){A()}})}function x(a,b){var c=[b],d;b.getAllContainers(c);$.each(c,function(b,c){if(c.internalId===a)return d=c,!1});d||(c=b.getAllFeatures(),$.each(c,function(b,c){if(c.internalId===a)return d=c,!1}));d||(c=b.getAllScreenOverlays(),$.each(c,
function(b,c){if(c.internalId===a)return d=c,!1}));return d}function D(a){a=Math.round(Math.log(352E5/a)/Math.log(2));if(0>a)a=0;else if(21<a||Infinity===a)a=21;d.getZoom()!==a&&d.setZoom(a)}function y(a,b){void 0!==b&&null!==b&&D("auto"===b?0:b);d.getCenter().equals(a)||d.panTo(a)}function F(a,b){var c;a.isEmpty()||("auto"===b?(c=d.getBoundsZoomLevel(a),c!==d.getZoom()&&d.setZoom(c),y(a.getCenter())):y(a.getCenter(),b))}function H(a,b){var c;a.viewer?y(new google.maps.LatLng(a.viewer.latitude,a.viewer.longitude),
"auto"===b?a.viewer.altitude:b):(c=new google.maps.LatLngBounds,a.extendBounds(c),c.isEmpty()||d.getBounds().equals(c)||F(c,b))}function L(a,b,c){var d=new google.maps.TileLayer(new google.maps.CopyrightCollection(""),1,17);d.baseUrl=a;d.params=b;d.getTileUrl=function(d,e){var f=new google.maps.Point(256*d.x,256*(d.y+1)),g=new google.maps.Point(256*(d.x+1),256*d.y),f=google.maps.NORMAL_MAP.getProjection().fromPixelToLatLng(f,e),g=google.maps.NORMAL_MAP.getProjection().fromPixelToLatLng(g,e),h="",
k=0>a.indexOf("?");$.each(b,function(a,b){k?(h="?",k=!1):h+="&";h+=a;h+="=";h+=b});h+="&BBOX="+(c?f.y+","+f.x+","+g.y+","+g.x:f.x+","+f.y+","+g.x+","+g.y);return a+h};return d}function O(a){this.layer=a;this.features=[]}function G(a){this.mapType=a;this.features=[]}function P(a){jc2cui.mapWidget.kmlParser.Container.call(this);this.id=a;z[a]=this}function ca(a,b,c,e,f,h,k,l){k=r[a]||new g(a);var m=(l=k.docs[b])?l.visible:k.visible,n={},p=!1;f=f||{};$.each(f,function(a,b){n[a.toUpperCase()]=b});f=n;
f.SERVICE="WMS";f.REQUEST="GetMap";f.VERSION=f.VERSION||"1.1.1";"1.1.1"===f.VERSION||"1.1.0"===f.VERSION||"1.0.0"===f.VERSION?f.SRS="EPSG:4326":(p=!0,f.CRS="EPSG:4326");f.FORMAT=f.FORMAT||"image/png";f.TRANSPARENT=f.TRANSPARENT||"TRUE";f.STYLES=f.STYLES||"";f.BGCOLOR=f.BGCOLOR||"0xFFFFFF";f.WIDTH="256";f.HEIGHT="256";e=L(e,f,p);h?(e=new google.maps.MapType([e],google.maps.NORMAL_MAP.getProjection(),c),d.addMapType(e),"function"===typeof d.setUIToDefault?d.setUIToDefault():d.addControl(new GMapTypeControl),
h=new P(a+b),h.features.push(new G(e))):(e=new google.maps.TileLayerOverlay(e),d.addOverlay(e),h=new jc2cui.mapWidget.kmlParser.Container,h.features.push(new O(e)));h.setVisible(m,!0);l&&l.remove();h.featureId=b;h.internalId=b;h.overlayId=a;h.name=c;k.docs[b]=h;jc2cui.mapWidget.addTreeItems({title:h.name||h.featureId,key:h.featureId,isFeature:!0,select:m},a)}function da(a,b,c,d,e,f,h,k,l){var m,n,p;try{m=r[a]||new g(a),p=m.docs[b],n=jc2cui.mapWidget.kmlParser.loadKml(e,p?p.visible:m.visible,null,
function(a){p&&p.remove();a.error||f&&H(n,"auto")},null,null,h),n.featureId=b,n.overlayId=a,n.name=c,m.docs[b]=n}catch(s){a="Failed to plot KML.",s&&(a+=": "+s),jc2cui.mapWidget.error({sender:k?k.id:"",type:"map.feature.plot",msg:l,error:a})}}function ea(a,b,c,d,e,f,h,k){var l,m,n;try{l=r[a]||new g(a),n=l.docs[b],m=jc2cui.mapWidget.kmlParser.parseKmlString(d,n?n.visible:l.visible,null,function(a){n&&n.remove();a.error||e&&H(m,"auto")},f),m.featureId=b,m.overlayId=a,m.name=c,l.docs[b]=m}catch(p){a=
"Failed to plot KML.",p&&(a+=": "+p),jc2cui.mapWidget.error({sender:h?h.id:"",type:"map.feature.plot",msg:k,error:a})}}function v(a,b){var c=r[b],d;c&&$.each(c.docs,function(b,c){d=x(a,c);return!d});return d}function S(a){var b=r[a.overlayId],c,d;if(b){if(c=b.features[a.selectedId])switch(b=c.data.type,c=c.mapObject,b){case "marker":d=c.getLatLng();break;case "line":case "shape":b=c.getBounds(),d=b.getCenter()}else a.selectedId&&0<a.selectedId.length&&$.each(b.docs,function(b,d){var e=d.getAllFeatures();
$.each(e,function(b,d){if(d.id===a.selectedId)return c=d,!1});return!c}),!c&&(a.selectedName&&0<a.selectedName.length)&&$.each(b.docs,function(b,d){var e=d.getAllFeatures();$.each(e,function(b,d){if(d.name===a.selectedName)return c=d,!1});return!c}),c&&(b=new google.maps.LatLngBounds,c.extendBounds(b),b.isEmpty()||(d=b.getCenter()));c?d?y(d):console.log("maps V2 configured map widget unable to determine location of selected item with id "+a.selectedId+" and name "+a.selectedName):console.log("maps V2 configured map widget unable to find selected item with id "+
a.selectedId+" and name "+a.selectedName)}else console.log("maps V2 configured map widget unable to find overlay "+a.overlayId+" for selected item with id "+a.selectedId+" and name "+a.selectedName)}function W(a,b,c){a=r[a];var d=!1;a&&$.each(a.docs,function(a,e){var f=e.getAllContainers();$.each(f,function(a,e){if(e.internalId===b)return e.open=c,d=!0,!1});return!d})}var n,d,z={},u,r={},R,N,Z,fa,Y,Q,U=2,M,V,J=0,T=0,ha=0,k={marker:0,shape:0,line:0},aa,ia,na={},B,la,ja,ga,ma=-1,ka=1E3;g.prototype.setVisibility=
function(a){this.visible=a;$.each(this.docs,function(b,c){c.setVisible(a,!0)});$.each(this.features,function(b,c){a?(c.mapObject.show(),N.is(":visible")&&t(c,!0)):(c.mapObject.hide(),N.is(":visible")&&t(c,!1),jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===c.data.id&&jc2cui.mapWidget.infoWindow.close())});$.each(this.children,function(b,c){c.setVisibility(a)})};g.prototype.remove=function(){delete r[this.id];this.parent&&delete this.parent.children[this.id];
$.each(this.docs,function(a,b){b.remove()});$.each(this.features,function(a,b){d.removeOverlay(b.mapObject);jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===b.data.id&&jc2cui.mapWidget.infoWindow.close()});$.each(this.children,function(a,b){b.remove()})};g.prototype.bounds=function(){var b=new google.maps.LatLngBounds;$.each(this.features,function(c,d){var e=a(d);e&&!e.isEmpty()&&(b.isEmpty()?b=e:(b.extend(e.getSouthWest()),b.extend(e.getNorthEast())))});$.each(this.docs,
function(a,c){c.extendBounds(b)});$.each(this.children,function(a,c){var d=c.bounds();d&&!d.isEmpty()&&(b.isEmpty()?b=d:(b.extend(d.getSouthWest()),b.extend(d.getNorthEast())))});return b};ia=function(a){(r[jc2cui.mapWidget.USER_DRAWN_OVERLAY]||new g(jc2cui.mapWidget.USER_DRAWN_OVERLAY)).features[a.data.id]=a;google.maps.Event.addListener(a.mapObject,"click",function(b){N.is(":visible")?h(a):jc2cui.mapWidget.showPlacemarkInfoWindow(a.data);jc2cui.mapWidget.itemSelected({selectedId:a.data.id||void 0,
selectedName:a.data.title||void 0,featureId:a.data.id,overlayId:jc2cui.mapWidget.USER_DRAWN_OVERLAY})})};M=function(a,c){var d="images/";Z.attr("src",0===a?"images/Bsd.png":"images/Bsu.png");fa.attr("src",1===a?"images/Bmd.png":"images/Bmu.png");d=2===a?d+"Bldm.png":3===a?d+"Bpdm.png":d+(2===U?"Blum.png":"Bpum.png");Y.attr("src",d);Q.hide();V&&(V(),V=null);if(c&&a)switch(a){case 1:b(c);break;case 2:l(c);break;case 3:l(c,!0)}};O.prototype.remove=function(){d.removeOverlay(this.layer)};O.prototype.extendBounds=
function(a){};O.prototype.getAllVisiblePlacemarks=function(a){return a||[]};O.prototype.setVisible=function(a){a?this.layer.show():this.layer.hide()};G.prototype.remove=function(){d.getCurrentMapType()===this.mapType&&d.setMapType(ja);d.removeMapType(this.mapType)};G.prototype.extendBounds=function(a){};G.prototype.getAllVisiblePlacemarks=function(a){return a||[]};G.prototype.setVisible=function(a){a?d.getCurrentMapType()!==this.mapType&&d.setMapType(this.mapType):d.getCurrentMapType()===this.mapType&&
d.setMapType(ja)};P.prototype=new jc2cui.mapWidget.kmlParser.Container(null,!0);u=P.prototype.remove;P.prototype.remove=function(){delete z[this.id];u.call(this)};return{init:function(a){n=a;mapsLoaded()},createOverlay:function(a,b,c){if(!r[a.overlayId]){var d;a.parentId&&((d=r[a.parentId])||console.log("maps V2 configured map widget unable to find parent overlay with id "+a.parentId));return new g(a.overlayId,d,a.clustering)}},removeOverlay:function(a,b,c){var d=r[a];d?(d.remove(),delete na[a]):
jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.overlay.remove",msg:c,error:"No overlay with id "+a+" found to remove."})},setOverlayVisibility:function(a,b,c,d){var e=r[a];e?e.setVisibility(b):jc2cui.mapWidget.error({sender:c?c.id:"",type:"map.overlay."+(b?"show":"hide"),msg:d,error:"No overlay with id "+a+" found to "+(b?"show.":"hide.")})},isOverlayVisible:function(a){a=(a=r[a])?a.visible:!1;return a},updateOverlay:function(a,b,c){b=r[a.overlayId];var d,e;if(!b)return!1;a.clustering&&(b.clustering=
a.clustering,e=!0);a.parentId&&((c=r[a.parentId])||console.log("maps V3 configured map widget unable to find parent overlay with id "+a.parentId),d=b.parent,d!==c&&(a=jc2cui.mapWidget.clusterManager.getClusterer(b),d&&delete d.children[b.id],b.parent=c,c.children[b.id]=b,b=jc2cui.mapWidget.clusterManager.getClusterer(b),a!==b&&(e=!0)));e&&(jc2cui.mapWidget.clusterManager.setClustering(!1),jc2cui.mapWidget.clusterManager.setClustering(!0));return!0},loadKml:function(a,b,c){da(a.overlayId,a.featureId,
a.name||a.featureName||a.url,a.proxy,a.url,a.zoom,a.clustering,b,c)},loadWms:function(a,b,c){ca(a.overlayId,a.featureId,a.name||a.featureName||a.url,a.url,a.params,a.background,b,c)},parseKml:function(a,b,c){ea(a.overlayId,a.featureId,a.name||a.featureName||"kml",a.feature,a.zoom,a.clustering,b,c)},removeFeature:function(a,b,c){var e=r[a.overlayId],f=!1,g;e?(e.features[a.featureId]&&(d.removeOverlay(e.features[a.featureId].mapObject),delete e.features[a.featureId],f=!0,jc2cui.mapWidget.infoWindow.getMapItem()&&
jc2cui.mapWidget.infoWindow.getMapItem().id===a.featureId&&jc2cui.mapWidget.infoWindow.close()),!f&&(g=e.docs[a.featureId])&&(g.remove(),delete e.docs[a.featureId],f=!0),f||jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.unplot",msg:c,error:"Unable to find feature "+a.featureId+" in overlay "+a.overlayId})):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.unplot",msg:c,error:"Unable to find overlay "+a.overlayId||a.url})},updateFeature:function(a,b,c,d){c=r[a.overlayId];var e,
f,g;a.clustering&&(e=!0);if(!c)return b.push("Unable to find overlay "+a.overlayId),!1;f=c.docs[a.featureId];if(!f)return b.push("Unable to find feature "+a.featureId+" in overlay "+a.overlayId),!1;if(a.newOverlayId&&a.newOverlayId!==a.overlayId){e||(g=jc2cui.mapWidget.clusterManager.getClusterer(f));d=r[a.newOverlayId];if(!d)return b.push("Unable to find overlay "+a.newOverlayId),!1;f.overlayId=a.newOverlayId;d.docs[a.featureId]=f;delete c.docs[a.featureId];f.clustering=a.clustering;e||(a=jc2cui.mapWidget.clusterManager.getClusterer(f),
g!==a&&(e=!0))}else e&&(f.clustering=a.clustering);e&&(jc2cui.mapWidget.clusterManager.setClustering(!1),jc2cui.mapWidget.clusterManager.setClustering(!0));return!0},showFeature:function(a,b,c){var d=r[a.overlayId],e=!1;d?(d.features[a.featureId]&&(d.features[a.featureId].mapObject.show(),N.is(":visible")&&t(d.features[a.featureId],!0),e=!0),!e&&(d=d.docs[a.featureId])&&(d.setVisible(!0,!0),e=!0),e||jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.show",msg:c,error:"Unable to find feature "+
a.featureId+" in overlay "+a.overlayId})):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.show",msg:c,error:"Unable to find overlay "+a.overlayId||a.url})},hideFeature:function(a,b,c){var d=r[a.overlayId],e=!1;d?(d.features[a.featureId]&&(d.features[a.featureId].mapObject.hide(),N.is(":visible")&&t(d.features[a.featureId],!1),jc2cui.mapWidget.infoWindow.getMapItem()&&jc2cui.mapWidget.infoWindow.getMapItem().id===a.featureId&&jc2cui.mapWidget.infoWindow.close(),e=!0),!e&&(d=d.docs[a.featureId])&&
(d.setVisible(!1,!0),e=!0),e||jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.hide",msg:c,error:"Unable to find feature "+a.featureId+" in overlay "+a.overlayId})):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.feature.hide",msg:c,error:"Unable to find overlay "+a.overlayId||a.url})},showItem:function(a){var b=v(a.itemId,a.overlayId);b&&(b.setVisible(!0,!0),a.zoom&&(a=new google.maps.LatLngBounds,b.extendBounds(a),F(a)))},hideItem:function(a){(a=v(a.itemId,a.overlayId))&&a.setVisible(!1,
!0)},centerOnOverlay:function(a,b,c){var d=a.overlayId;a=a.zoom;var e=r[d];e?F(e.bounds(),a):jc2cui.mapWidget.error({sender:b?b.id:"",type:"map.view.center.overlay",msg:c,error:"Unable to find overlay "+d})},centerOnFeature:function(b,c,d){a:{var e=r[b.overlayId],f,g;if(e){if(f=e.features[b.featureId])c=a(f),F(c,b.zoom),b.select&&(g={selectedId:f.data.id||void 0,selectedName:f.data.title||void 0,featureId:b.featureId,overlayId:b.overlayId});else{f=e.docs[b.featureId];if(!f){jc2cui.mapWidget.error({sender:c?
c.id:"",type:"map.view.center.feature",msg:d,error:"Unable to find feature "+b.featureId});break a}H(f,b.zoom);b.select&&b.overlayId===jc2cui.mapWidget.USER_DRAWN_OVERLAY&&(g={selectedId:b.featureId||void 0,selectedName:f.features.length?f.features[0].name||void 0:void 0,featureId:b.featureId,overlayId:b.overlayId})}g&&jc2cui.mapWidget.itemSelected(g)}else jc2cui.mapWidget.error({sender:c?c.id:"",type:"map.view.center.feature",msg:d,error:"Unable to find overlay "+b.overlayId})}},centerOnItem:function(a){var b=
v(a.itemId,a.overlayId);if(b&&(H(b,a.zoom),a.select)){for(a=b.parent;a.parent;)a=a.parent;b={selectedId:b.id||void 0,selectedName:b.name||void 0,featureId:a.featureId,overlayId:a.overlayId};jc2cui.mapWidget.itemSelected(b)}},centerOnLocation:function(a,b,c){b=new google.maps.LatLng(a.location.lat,a.location.lon);y(b,a.zoom)},fitToBounds:function(a){F(a,"auto")},centerOnBounds:function(a,b,c){b=new google.maps.LatLng(a.bounds.southWest.lat,a.bounds.southWest.lon);c=new google.maps.LatLng(a.bounds.northEast.lat,
a.bounds.northEast.lon);b=new google.maps.LatLngBounds(b,c);F(b,a.zoom)},zoomToRange:function(a,b,c){D(a.range)},selected:function(a,b,c){S(a)},getViewStatus:function(a,b,c){return s(a,b,c)},getDropLocation:function(){return{lat:R.lat(),lon:R.lng()}},checkResize:function(){d&&d.checkResize();setTimeout(function(){jc2cui.mapWidget.infoWindow.checkResize();$.each(r,function(a,b){$.each(b.docs,function(a,b){var c=b.getAllScreenOverlays();$.each(c,function(a,b){b.placer()})})})},250)},setDrawingToolsVisibility:function(a){f(a)},
setExpanded:function(a,b,c){W(a,b,c)},optionChanged:function(a,b){"labels"===a?$.each(r,function(a,b){$.each(b.docs,function(a,b){var c=[b];b.getAllContainers(c);$.each(c,function(a,b){b.markerOverlay&&b.markerOverlay.doRedraw(!0)})})}):"clustering"===a&&jc2cui.mapWidget.clusterManager.setClustering(b)},googleReady:function(){w()},mapsReady:function(){A()},info:function(){var a=0;$.each(r,function(b,c){++a});return{name:"Google Maps V2",type:"2D",entities:jc2cui.mapWidget.kmlParser.getEntitiesString(a)}}}}();
